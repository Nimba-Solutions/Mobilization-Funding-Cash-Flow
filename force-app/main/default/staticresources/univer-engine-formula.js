(function(w,S){typeof exports=="object"&&typeof module<"u"?S(exports,require("@univerjs/core"),require("rxjs"),require("@univerjs/engine-numfmt"),require("@univerjs/rpc")):typeof define=="function"&&define.amd?define(["exports","@univerjs/core","rxjs","@univerjs/engine-numfmt","@univerjs/rpc"],S):(w=typeof globalThis<"u"?globalThis:w||self,S(w.UniverEngineFormula={},w.UniverCore,w.rxjs,w.UniverEngineNumfmt,w.UniverRpc))})(this,function(w,S,De,Wu,Qu){"use strict";var xE=Object.defineProperty;var UE=(w,S,De)=>S in w?xE(w,S,{enumerable:!0,configurable:!0,writable:!0,value:De}):w[S]=De;var A=(w,S,De)=>UE(w,typeof S!="symbol"?S+"":S,De);var wa;function qu(i){let u=i;for(;u!=null&&u.getParent();)u=u.getParent();return u}function zn(i,u=0,e=0){return{node:i,refOffsetX:u,refOffsetY:e}}function Ku(i){return i.isError()?i.getValue():i.isReferenceObject()?i.toArrayValueObject().toValue():i.isArray()?i.toValue():i.getValue()}var bt=(i=>(i.FALSE="FALSE",i.TRUE="TRUE",i))(bt||{}),yt=(i=>(i[i.SUCCESS=0]="SUCCESS",i[i.ERROR=1]="ERROR",i))(yt||{}),et=(i=>(i[i.FRONT=0]="FRONT",i[i.BACK=1]="BACK",i))(et||{});function Pa(i,u,e,t,r){for(let n=0,s=i.length;n<s;n++){const a=i[n];if(u!==a.unitId||e!==a.sheetId)continue;const{startRow:o,startColumn:c,endRow:l,endColumn:f}=a.range;if(t>=o&&t<=l&&r>=c&&r<=f)return!0}return!1}var h=(i=>(i.DIV_BY_ZERO="#DIV/0!",i.NAME="#NAME?",i.VALUE="#VALUE!",i.NUM="#NUM!",i.NA="#N/A",i.CYCLE="#CYCLE!",i.REF="#REF!",i.SPILL="#SPILL!",i.CALC="#CALC!",i.ERROR="#ERROR!",i.CONNECT="#GETTING_DATA",i.NULL="#NULL!",i))(h||{});const xt=new Set(Object.values(h)),ja=[...new Set(Object.values(h).map(i=>i.length))];var xa=(i=>(i[i.Financial=0]="Financial",i[i.Date=1]="Date",i[i.Math=2]="Math",i[i.Statistical=3]="Statistical",i[i.Lookup=4]="Lookup",i[i.Database=5]="Database",i[i.Text=6]="Text",i[i.Logical=7]="Logical",i[i.Information=8]="Information",i[i.Engineering=9]="Engineering",i[i.Cube=10]="Cube",i[i.Compatibility=11]="Compatibility",i[i.Web=12]="Web",i[i.Array=13]="Array",i[i.Univer=14]="Univer",i[i.User=15]="User",i[i.DefinedName=16]="DefinedName",i))(xa||{}),Z=(i=>(i.PLUS="+",i.MINUS="-",i.MULTIPLY="*",i.DIVIDED="/",i.CONCATENATE="&",i.POWER="^",i.EQUALS="=",i.NOT_EQUAL="<>",i.GREATER_THAN=">",i.GREATER_THAN_OR_EQUAL=">=",i.LESS_THAN="<",i.LESS_THAN_OR_EQUAL="<=",i))(Z||{}),H=(i=>(i.EQUALS="=",i.NOT_EQUAL="<>",i.GREATER_THAN=">",i.GREATER_THAN_OR_EQUAL=">=",i.LESS_THAN="<",i.LESS_THAN_OR_EQUAL="<=",i))(H||{});const Br=new Map([["<>",4],["<",4],[">=",4],["=",4],[">",4],["<=",4],["&",3],["+",2],["-",2],["/",1],["*",1],["^",0]]),Rt=new Set(Br.keys()),Xu=new Set(["=","<>",">",">=","<","<="]);var X=(i=>(i.OPEN_BRACKET="(",i.CLOSE_BRACKET=")",i.COMMA=",",i.SINGLE_QUOTATION="'",i.DOUBLE_QUOTATION='"',i.OPEN_BRACES="{",i.CLOSE_BRACES="}",i.COLON=":",i.OPEN_SQUARE_BRACKET="[",i.CLOSE_SQUARE_BRACKET="]",i))(X||{}),qe=(i=>(i.PERCENTAGE="%",i.POUND="#",i))(qe||{});const Jn=new Set(["%","#"]);var Ve=(i=>(i.AT="@",i.MINUS="-",i.PLUS="+",i))(Ve||{});const Zu=" ",Ua=[...Object.values(H),...Object.values(Z),...Object.values(X),...Object.values(qe),...Object.values(Ve)];function gr(i){return Ua.includes(i)}function va(i){for(const u of Ua)if(i.indexOf(u)>-1)return!0;return!1}function zu(i){return i[0]==="'"&&i[i.length-1]==="'"?i.substring(1,i.length-1):i}function Ju(i){return gr(i)&&i!==X.CLOSE_BRACES&&i!==X.CLOSE_BRACKET&&i!==X.SINGLE_QUOTATION&&i!==X.DOUBLE_QUOTATION||i===" "}const ec=new Set([Z.PLUS,Z.MINUS,Z.MULTIPLY,Z.DIVIDED,Z.CONCATENATE,Z.POWER,Z.EQUALS,Z.NOT_EQUAL,Z.GREATER_THAN,Z.GREATER_THAN_OR_EQUAL,Z.LESS_THAN,Z.LESS_THAN_OR_EQUAL,X.OPEN_BRACKET,X.COMMA,X.COLON,X.OPEN_BRACES,X.OPEN_SQUARE_BRACKET]);function tc(i){return ec.has(i)}const rc=new Set([Z.PLUS,Z.MINUS,Z.MULTIPLY,Z.DIVIDED,Z.CONCATENATE,Z.POWER,Z.EQUALS,Z.NOT_EQUAL,Z.GREATER_THAN,Z.GREATER_THAN_OR_EQUAL,Z.LESS_THAN,Z.LESS_THAN_OR_EQUAL,X.OPEN_BRACKET,X.COMMA,X.COLON,X.OPEN_BRACES,X.OPEN_SQUARE_BRACKET,qe.PERCENTAGE,qe.POUND]);function nc(i){return rc.has(i)}function Ta(i){const u={};return Object.keys(i).forEach(e=>{const t=i[e];if(t==null)return!0;u[e]==null&&(u[e]={}),Object.keys(t).forEach(r=>{const n=t[r];u[e][r]=new S.ObjectMatrix(n)})}),u}function sc(i){const u={};for(const e in i){const t=i[e];if(t!=null){u[e]==null&&(u[e]={});for(const r in t){const n=t[r],s={};n.forValue((a,o,c)=>{s[a]===void 0&&(s[a]={}),s[a][o]=c}),u[e][r]=s}}}return u}const Ba='\\[([^\\[\\]\\/?:"<>|*\\\\]+)\\]',Fa=new RegExp(Ba),ac="((?![\\[\\]\\/?*\\\\]).)*!",Nt="$",es="\\s*?:\\s*?",Fr="[A-Za-z]+",Ir="[1-9][0-9]*",zt=`'?(${Ba})?(${ac})?'?`,ts=`\\${Nt}?${Fr}\\${Nt}?${Ir}`,ic=`^(${Ve.AT})?${zt}${ts}${es}${ts}$`,Ia=new RegExp(ic),oc=`^${zt}\\s*?${ts}(${qe.POUND})?$`,ka=new RegExp(oc),uc=`^${zt}\\${Nt}?${Ir}${es}\\${Nt}?${Ir}$`,$a=new RegExp(uc),cc=`^${zt}\\${Nt}?${Fr}${es}\\${Nt}?${Fr}$`,Ya=new RegExp(cc),lc=`^${zt}\\s*?\\${Nt}?${Ir}$`,Ha=new RegExp(lc),fc=`^${zt}\\s*?\\${Nt}?${Fr}$`,Ga=new RegExp(fc),mc="{.*?}",Wa=new RegExp(mc,"g");function dr(i){return ka.lastIndex=0,ka.test(i)}function hc(i){return Ia.lastIndex=0,Ia.test(i)}function Qa(i){return $a.lastIndex=0,$a.test(i)}function qa(i){return Ya.lastIndex=0,Ya.test(i)}function Ka(i){return Ha.lastIndex=0,Ha.test(i)}function Xa(i){return Ga.lastIndex=0,Ga.test(i)}function gc(i){return Wa.lastIndex=0,Wa.test(i)}function Za(i){return dr(i)||hc(i)||Qa(i)||qa(i)}const za={id:"formula.mutation.register-function",type:S.CommandType.MUTATION,handler:()=>!0},kr={id:"formula.mutation.set-array-formula-data",type:S.CommandType.MUTATION,handler:(i,u)=>!0},dc=/[^0-9]/g,Cc=/[^A-Za-z]/g;function Cr(i){let u=i[0]==="$";const e=i.substring(1);let t=e.indexOf("$")>-1;return S.Tools.isStringNumber(e)&&u&&!t&&(u=!1,t=!0),u&&t?S.AbsoluteRefType.ALL:u?S.AbsoluteRefType.COLUMN:t?S.AbsoluteRefType.ROW:S.AbsoluteRefType.NONE}function _c(i){const u=i.split("!");u.length>1&&(i=u[u.length-1]);const e=i.split(":");return e.length>1?{startAbsoluteRefType:Cr(e[0]),endAbsoluteRefType:Cr(e[1])}:{startAbsoluteRefType:Cr(e[0])}}function Ja(i=S.AbsoluteRefType.NONE){let u="",e="";return i===S.AbsoluteRefType.ROW?u="$":i===S.AbsoluteRefType.COLUMN?e="$":i===S.AbsoluteRefType.ALL&&(u="$",e="$"),{rowAbsoluteString:u,columnAbsoluteString:e}}function Ut(i){const{startColumn:u,startRow:e,endColumn:t,endRow:r,startAbsoluteRefType:n,endAbsoluteRefType:s,rangeType:a=S.RANGE_TYPE.NORMAL}=i,o=Ja(n),c=Ja(s);if(a===S.RANGE_TYPE.ROW||a===S.RANGE_TYPE.ALL){const m=`${o.rowAbsoluteString}${e+1}`,d=`${c.rowAbsoluteString}${r+1}`;return`${m}:${d}`}if(a===S.RANGE_TYPE.COLUMN){const m=`${o.columnAbsoluteString}${S.Tools.chatAtABC(u)}`,d=`${c.columnAbsoluteString}${S.Tools.chatAtABC(t)}`;return`${m}:${d}`}const l=`${o.columnAbsoluteString}${S.Tools.chatAtABC(u)}${o.rowAbsoluteString}${e+1}`,f=`${c.columnAbsoluteString}${S.Tools.chatAtABC(t)}${c.rowAbsoluteString}${r+1}`;return l===f?l:`${l}:${f}`}function ei(i,u){return`${si(i)}!${Ut(u)}`}function ti(i,u,e){return rs(i)||rs(u)?`'[${ns(i)}]${ns(u)}'!${Ut(e)}`:`[${i}]${u}!${Ut(e)}`}function $r(i){const{unitId:u,sheetName:e,range:t}=i;return u!=null&&u.length>0&&e!=null&&e.length>0?ti(u,e,t):e!=null&&e.length>0?ei(e,t):Ut(t)}function Yr(i){const u=Number.parseInt(i.replace(dc,""))-1,e=S.Tools.ABCatNum(i.replace(Cc,"")),t=Cr(i);return{row:u,column:e,absoluteRefType:t}}function Hr(i){const u=Fa.exec(i);let e="";u!=null&&(e=u[0].trim(),e=ai(e.slice(1,e.length-1)),i=i.replace(Fa,""));const t=i.indexOf("!");let r="",n="";return t>-1?(r=i.substring(0,t),r[0]==="'"&&r[r.length-1]==="'"&&(r=r.substring(1,r.length-1)),r=ai(r),n=i.substring(t+1)):n=i,{refBody:n,sheetName:r,unitId:e}}function _r(i){const{refBody:u,sheetName:e,unitId:t}=Hr(i),r=u.indexOf(":");if(r===-1){const C=Yr(u),_=C.row,E=C.column,b=C.absoluteRefType;return{unitId:t,sheetName:e,range:{startRow:_,startColumn:E,endRow:_,endColumn:E,startAbsoluteRefType:b,endAbsoluteRefType:b}}}const n=u.substring(0,r),s=u.substring(r+1),a=Yr(n),o=Yr(s),c=a.row>o.row?o.row:a.row,l=a.column>o.column?o.column:a.column,f=a.row>o.row?a.row:o.row,m=a.column>o.column?a.column:o.column;let d=S.RANGE_TYPE.NORMAL;return Number.isNaN(c)&&Number.isNaN(f)?d=S.RANGE_TYPE.COLUMN:Number.isNaN(l)&&Number.isNaN(m)&&(d=S.RANGE_TYPE.ROW),{unitId:t,sheetName:e,range:{startRow:c,startColumn:l,endRow:f,endColumn:m,startAbsoluteRefType:a.absoluteRefType,endAbsoluteRefType:o.absoluteRefType,rangeType:d}}}const Ac=["LOG10"];function Ar(i){const u=ri(i);if(!Za(u)||Ac.includes(u.toUpperCase().trim()))return!1;const{range:e}=_r(u);return!(e.endColumn>=16384)}function ri(i){const u=[];let e=!1;for(let t=0,r=i.length;t<r;t++){const n=i[t];if(n===Zu&&!e)u.push(n);else{if(!e&&(n===Ve.AT||n===Ve.MINUS||n===Ve.PLUS))continue;u.push(n),e=!0}}return u.join("")}function Ec(i,u){const e=(i==null?void 0:i.split(","))||[];return i===""||e.length===0?[]:ni(i)?e.map(n=>{const s=_r(n);return{unitId:s.unitId,sheetId:u(s.sheetName),range:s.range,sheetName:s.sheetName}}):[]}function ni(i){return((i==null?void 0:i.split(","))||[]).every(e=>Ar(e.trim()))}function rs(i){return i.length===0?!1:!!(va(i)||bc(i)||yc(i)||Rc(i)||/[\s!$%^&*()+\-=\[\]{};':"\\|,.<>\/?（）]/.test(i))}function si(i){return rs(i)?`'${ns(i)}'`:i}function ns(i){return i.replace(/'/g,"''")}function ai(i){return i.replace(/''/g,"'")}function bc(i){const u=i.match(/[1-9][0-9]{0,6}/);return/^[A-Z]+[1-9][0-9]{0,6}$/.test(i)&&u!==null}function yc(i){return/^(R(-?[0-9]+)?C(-?[0-9]+)?|C(-?[0-9]+)?|R(-?[0-9]+)?)$/.test(i)}function Rc(i){return!new RegExp("^\\p{Letter}","u").test(i.charAt(0))}var Nc=Object.getOwnPropertyDescriptor,pc=(i,u,e,t)=>{for(var r=t>1?void 0:t?Nc(u,e):u,n=i.length-1,s;n>=0;n--)(s=i[n])&&(r=s(r)||r);return r},Vc=(i,u)=>(e,t)=>u(e,t,i);w.DefinedNamesService=class extends S.Disposable{constructor(e){super();A(this,"_definedNameMap",{});A(this,"_nameCacheMap",{});A(this,"_update$",new De.Subject);A(this,"update$",this._update$.asObservable());A(this,"_currentRange",{unitId:"",sheetId:"",range:{startRow:0,endRow:0,startColumn:0,endColumn:0}});A(this,"_currentRange$",new De.Subject);A(this,"currentRange$",this._currentRange$.asObservable());A(this,"_focusRange$",new De.Subject);A(this,"focusRange$",this._focusRange$.asObservable());this._univerInstanceService=e}dispose(){super.dispose(),this._definedNameMap={},this._nameCacheMap={},this._update$.complete(),this._currentRange$.complete(),this._focusRange$.complete()}getWorksheetByRef(e,t){var n;const{sheetName:r}=Hr(t);return(n=this._univerInstanceService.getUnit(e))==null?void 0:n.getSheetBySheetName(r)}focusRange(e,t){const r=this.getValueById(e,t);r!==void 0&&this._focusRange$.next({...r,unitId:e})}setCurrentRange(e){this._currentRange=e,this._currentRange$.next(e)}getCurrentRange(){return this._currentRange}getCurrentRangeForString(){return Ut(this._currentRange.range)}registerDefinedNames(e,t){this._definedNameMap[e]=t,this._updateCache(e),this._update()}registerDefinedName(e,t){this._definedNameMap[e]===void 0&&(this._definedNameMap[e]={}),this._definedNameMap[e][t.id]=t,this._updateCache(e),this._update()}removeDefinedName(e,t){var r;(r=this._definedNameMap[e])==null||delete r[t],this._updateCache(e),this._update()}removeUnitDefinedName(e){delete this._definedNameMap[e],this._updateCache(e),this._update()}getDefinedNameMap(e){return this._definedNameMap[e]}getValueByName(e,t){const r=this._nameCacheMap[e];if(r)return r[t]||null;const n=this._definedNameMap[e];if(n===void 0)return null;let s=null;for(const a of Object.values(n))if(a.name===t){s=a;break}return s&&(this._nameCacheMap[e]=this._nameCacheMap[e]||{},this._nameCacheMap[e][t]=s),s}getValueById(e,t){var r;return(r=this._definedNameMap[e])==null?void 0:r[t]}hasDefinedName(e){return this._definedNameMap[e]===void 0?!1:(Array.from(Object.values(this._definedNameMap[e])).length||0)!==0}_update(){this._update$.next(null)}_updateCache(e){const t=this._definedNameMap[e];if(t===void 0){delete this._nameCacheMap[e];return}this._nameCacheMap[e]={};for(const r of Object.values(t))this._nameCacheMap[e][r.name]=r}},w.DefinedNamesService=pc([Vc(0,S.IUniverInstanceService)],w.DefinedNamesService);const vt=S.createIdentifier("univer.formula.defined-names.service"),Oc=(i,u)=>{const{unitId:e,id:t}=u;return{...i.get(vt).getValueById(e,t),unitId:e}},Gr={id:"formula.mutation.set-defined-name",type:S.CommandType.MUTATION,handler:(i,u)=>{if(u==null)return!1;const e=i.get(vt),{id:t,unitId:r,name:n,formulaOrRefString:s,comment:a,hidden:o,localSheetId:c}=u;return e.registerDefinedName(r,{id:t,name:n.trim(),formulaOrRefString:s.trim(),comment:a==null?void 0:a.trim(),hidden:o,localSheetId:c}),!0}},ss={id:"formula.mutation.remove-defined-name",type:S.CommandType.MUTATION,handler:(i,u)=>{if(u==null)return!1;const e=i.get(vt),{unitId:t,id:r}=u;return e.removeDefinedName(t,r),!0}},Wr={id:"formula.mutation.set-feature-calculation",type:S.CommandType.MUTATION,handler:()=>!0},Qr={id:"formula.mutation.remove-feature-calculation",type:S.CommandType.MUTATION,handler:()=>!0},as={id:"formula.mutation.set-formula-calculation-start",type:S.CommandType.MUTATION,handler:()=>!0},is={id:"formula.mutation.set-formula-calculation-stop",type:S.CommandType.MUTATION,handler:()=>!0},Er={id:"formula.mutation.set-formula-calculation-notification",type:S.CommandType.MUTATION,handler:()=>!0},os={id:"formula.mutation.set-formula-calculation-result",type:S.CommandType.MUTATION,handler:()=>!0},us={id:"formula.mutation.set-formula-data",type:S.CommandType.MUTATION,handler:(i,u)=>!0},qr={id:"formula.mutation.set-other-formula",type:S.CommandType.MUTATION,handler:()=>!0},Kr={id:"formula.mutation.remove-other-formula",type:S.CommandType.MUTATION,handler:()=>!0},ii={id:"formula.mutation.set-super-table",type:S.CommandType.MUTATION,handler:()=>!0},oi={id:"formula.mutation.remove-super-table",type:S.CommandType.MUTATION,handler:()=>!0},cs={id:"formula.mutation.set-super-table-option",type:S.CommandType.MUTATION,handler:()=>!0};class dt{constructor(u){A(this,"_cache");this._cache=new S.LRUMap(u)}set(u,e){const t=this._hash(u);this._cache.set(t,e)}get(u){const e=this._hash(u);return this._cache.get(e)}clear(){this._cache.clear()}delete(u){this._cache.delete(this._hash(u))}forEach(u,e){this._cache.forEach(u,e)}_hash(u){return u.length<=64?u:S.hashAlgorithm(u).toString()}}const at="P_1",pt="R_1",Jt="L_1",br="LR_1",ui="LO_1",Sc="LET",yr="LAMBDA",Mc="CUBE",Dc=new Set(["RAND","RANDBETWEEN","NOW","TODAY"]),ls=new dt(1e5);function Tt(i){const u=ls.get(i);if(u)return u;const e=_r(i);return ls.set(i,e),_r(i)}function wc(){ls.clear()}var Te=(i=>(i[i.NORMAL=0]="NORMAL",i[i.NUMBER=1]="NUMBER",i[i.STRING=2]="STRING",i[i.FUNCTION=3]="FUNCTION",i[i.REFERENCE=4]="REFERENCE",i[i.ARRAY=5]="ARRAY",i[i.DEFINED_NAME=6]="DEFINED_NAME",i))(Te||{});function fs(i){let u="";for(const e of i)typeof e=="string"?u+=e:u+=e.token;return u}class ie{constructor(){A(this,"_parent");A(this,"_token",pt);A(this,"_children",[]);A(this,"_lambdaId");A(this,"_functionDefinitionPrivacyVar");A(this,"_lambdaParameter","");A(this,"_startIndex",-1);A(this,"_endIndex",-1);A(this,"_definedNames",[])}dispose(){var u;this._children.forEach(e=>{typeof e!="string"&&e.dispose()}),(u=this._functionDefinitionPrivacyVar)==null||u.clear(),this._functionDefinitionPrivacyVar=null,this._children=[],this._parent=null,this._definedNames=[]}getDefinedNames(){return this._definedNames}getStartIndex(){return this._startIndex}getLambdaId(){return this._lambdaId}setLambdaId(u){this._lambdaId=u}getFunctionDefinitionPrivacyVar(){return this._functionDefinitionPrivacyVar}setLambdaPrivacyVar(u){this._functionDefinitionPrivacyVar=u}getLambdaParameter(){return this._lambdaParameter}setLambdaParameter(u){this._lambdaParameter=u}getParent(){return this._parent}setParent(u){this._parent=u}getChildren(){return this._children}setChildren(u){this._children=u}addChildren(u){this._children.push(u)}addChildrenFirst(u){this._children.unshift(u)}getToken(){return this._token}setToken(u){this._token=u}setIndex(u,e){this._startIndex=u,this._endIndex=e}setDefinedNames(u){this._definedNames=u}hasDefinedNames(){return this._definedNames.length>0}replaceChild(u,e){const t=this._getIndexInParent(u);t!=null&&(this.getChildren().splice(t,1,e),e.setParent(this))}changeToParent(u){const e=this.getParent();e&&e.removeChild(this),this.setParent(u),u.getChildren().push(this)}removeChild(u){const e=this._getIndexInParent(u);e!=null&&this.getChildren().splice(e,1)}serialize(){const u=this.getToken(),e=this.getChildren(),t=[],r=e.length;for(let n=0;n<r;n++){const s=e[n];s instanceof ie?t.push(s.serialize()):t.push(s)}return{token:u,st:this._startIndex,ed:this._endIndex,children:t}}_getIndexInParent(u){const e=this.getChildren(),t=e.length;for(let r=0;r<t;r++)if(e[r]===u)return r}}const ci=2e3,ms=new dt(ci),hs=new dt(ci);class Xr extends S.Disposable{constructor(){super(...arguments);A(this,"_currentLexerNode",new ie);A(this,"_upLevel",0);A(this,"_segment","");A(this,"_bracketState",[]);A(this,"_squareBracketState",0);A(this,"_bracesState",0);A(this,"_singleQuotationState",0);A(this,"_doubleQuotationState",0);A(this,"_lambdaState",!1);A(this,"_colonState",!1);A(this,"_formulaErrorCount",0);A(this,"_tableBracketState",!1)}dispose(){this._resetTemp(),this._currentLexerNode.dispose(),ms.clear(),hs.clear()}getUpLevel(){return this._upLevel}isColonClose(){return this._colonState===!1}isColonOpen(){return this._colonState===!0}isDoubleQuotationClose(){return this._doubleQuotationState===0}isLambdaOpen(){return this._lambdaState===!0}isLambdaClose(){return this._lambdaState===!1}isSingleQuotationClose(){return this._singleQuotationState===0}isBracesClose(){return this._bracesState===0}isBracketClose(){return this._bracketState.length===0}isSquareBracketClose(){return this._squareBracketState===0}getCurrentLexerNode(){return this._currentLexerNode}getFunctionAndParameter(e,t){const r=this._getCurrentParamIndex(e,t);if(r==null||r===h.VALUE)return;const n=r[0];if(typeof n=="string")return;let s=n.getParent(),a=n;for(;s;){const o=s.getToken();if(o!==at&&!gr(o)&&s.getStartIndex()!==-1){const c=s.getChildren().indexOf(a);return{functionName:o,paramIndex:c}}a=s,s=s.getParent()}}checkIfAddBracket(e){let t=0,r=e.length-1,n=e[r];for(;(n===X.CLOSE_BRACKET||n===" ")&&r>=0;)n===X.CLOSE_BRACKET&&t++,n=e[--r];const s=this._getCurrentParamIndex(e,e.length-2);if(s==null||s===h.VALUE)return 0;const a=s[0];if(typeof a=="string")return 0;let o=a.getParent(),c=0;for(s[1]===X.OPEN_BRACKET&&c++;o;){const l=o.getToken();l!==at&&l!==X.COLON&&o.getStartIndex()!==-1&&l.toUpperCase()!==yr&&(t===0?c+=1:t--),o=o.getParent()}return c}sequenceNodesBuilder(e){const t=hs.get(e);if(t)return[...t];const r=this._getSequenceArray(e);if(r.length===0)return;const n=this.getSequenceNode(r);return hs.set(e,[...n]),n}convertRefersToAbsolute(e,t,r,n=""){const s=this.sequenceNodesBuilder(e);if(s==null)return e;let a="";e.substring(0,1)===Z.EQUALS&&(a=Z.EQUALS);for(let o=0,c=s.length;o<c;o++){const l=s[o];if(typeof l!="string"&&l.nodeType===Te.REFERENCE){const{token:f,endIndex:m}=l,d=Tt(f);if(d==null)continue;const{range:C,sheetName:_,unitId:E}=d,b={...C,startAbsoluteRefType:t,endAbsoluteRefType:r},R=$r({range:b,unitId:E,sheetName:_||n}),N=R.length-f.length;s[o]={...l,token:R,endIndex:m+N};for(let V=o+1;V<c;V++){const M=s[V];typeof M!="string"&&(M.startIndex+=N,M.endIndex+=N)}}}return`${a}${fs(s)}`}moveFormulaRefOffset(e,t,r,n=!1){const s=this.sequenceNodesBuilder(e);if(s==null)return e;const a=[];for(let o=0,c=s.length;o<c;o++){const l=s[o];if(typeof l=="string"||l.nodeType!==Te.REFERENCE){a.push(l);continue}const{token:f}=l,m=Tt(f),{sheetName:d,unitId:C}=m;let _=m.range;if(!n&&_.startAbsoluteRefType===S.AbsoluteRefType.ALL&&_.endAbsoluteRefType===S.AbsoluteRefType.ALL){a.push(l);continue}else _=S.moveRangeByOffset(_,t,r,n);let E="";S.isValidRange(_)?E=$r({range:_,unitId:C,sheetName:d}):E=h.REF,a.push({...l,token:E})}return`=${fs(a)}`}_formulaSpellCheck(){if(this._currentLexerNode.getChildren().length===0)return!0;const e=this._currentLexerNode.getChildren()[0];return!!(e instanceof ie||Rt.has(e)||Jn.has(e)||e===Ve.AT||e===X.COMMA||e===X.COLON||e===X.OPEN_BRACKET)}getSequenceNode(e){const t=[];let r=!1;for(let n=0,s=e.length;n<s;n++){const a=e[n],o=e[n-1],{segment:c,currentString:l}=a;if(l===X.DOUBLE_QUOTATION&&(r=!0),(c!==""||n===0)&&n!==s-1){t.push(l);continue}let f=(o==null?void 0:o.segment)||"";const m=n-f.length;let d=n-1;const C=n-1;if(n===s-1&&this._isLastMergeString(l)&&(f+=l,d+=1),f===""||Br.has(f)){t.push(l);continue}const _=f.trim(),E=ri(_);r===!0&&_[_.length-1]===X.DOUBLE_QUOTATION&&_[0]!==X.OPEN_BRACES?(r=!1,this._processPushSequenceNode(t,Te.STRING,f,m,d,C)):dr(E)&&Ar(E)?this._processPushSequenceNode(t,Te.REFERENCE,f,m,d,C):S.Tools.isStringNumber(_)?this._processPushSequenceNode(t,Te.NUMBER,f,m,d,C):_.length>0&&this._processPushSequenceNode(t,Te.FUNCTION,f,m,d,C),(n!==s-1||!this._isLastMergeString(l))&&t.push(l)}return this._mergeSequenceNodeReference(t)}_processPushSequenceNode(e,t,r,n,s,a){this._pushSequenceNode(e,{nodeType:t,token:r,startIndex:n,endIndex:s},a)}_getCurrentParamIndex(e,t){return this._nodeMaker(e,void 0,t)}_isLastMergeString(e){return e===X.DOUBLE_QUOTATION||S.Tools.isStringNumber(e)||!gr(e)}_mergeSequenceNodeReference(e){const t=[],r=e.length;let n=0;for(;n<r;){const s=e[n];if(typeof s=="string"){const a=e[n-1];if(s.trim()===X.CLOSE_BRACES&&a!=null&&typeof a!="string"&&a.nodeType===Te.FUNCTION&&a.token.trim().substring(0,1)===X.OPEN_BRACES){a.nodeType=Te.ARRAY,a.token+=s,a.endIndex+=s.length,n++;continue}t.push(s)}else{const a=e[n+1],o=e[n+2];a===X.COLON&&typeof s!="string"&&o!=null&&typeof o!="string"&&Ar((s.token+a+o.token).trim())&&(s.nodeType=Te.REFERENCE,s.token+=a+o.token,s.endIndex=o.endIndex,n+=2),t.push(s)}n++}return this._minusSplitSequenceNode(t)}_minusSplitSequenceNode(e){const t=[];for(const r of e){if(typeof r!="string"){const s=r.token.match(/^(\s*([-@+]\s*)+)(.*)$/);if(s){const a=s[1],o=s[3];if(Ar(o.trim())){const c=a.length,l=r.startIndex,f=r.startIndex+c-1,m={nodeType:Te.NORMAL,token:a,startIndex:l,endIndex:f},d={nodeType:Te.REFERENCE,token:o,startIndex:f+1,endIndex:r.endIndex};t.push(m),t.push(d);continue}}}t.push(r)}return t}_pushSequenceNode(e,t,r){const n=r-t.startIndex+1;e.splice(e.length-n,n,t)}nodeMakerTest(e){return this._nodeMaker(e)}treeBuilder(e,t=!0,r,n){if(t===!0){const m=ms.get(e),d=n==null?void 0:n(e);if(m&&!d)return m}this._resetCurrentLexerNode(),this._currentLexerNode.setToken(pt);const s=[];let a=this._nodeMaker(e,s);if(a===h.VALUE||s.length===0)return a;let o=!1,c="",l=[];if(r){const{hasDefinedName:m,sequenceString:d,definedNames:C}=r(s);o=m,c=d,l=C}if(o&&(this._resetCurrentLexerNode(),this._currentLexerNode.setToken(pt),a=this._nodeMaker(`=${c}`),a===h.VALUE))return a;const f=this._getTopNode(this._currentLexerNode);if(f&&(this._currentLexerNode=f),t){if(!this._suffixExpressionHandler(this._currentLexerNode))return h.VALUE;ms.set(e,this._currentLexerNode)}return o&&this._currentLexerNode.setDefinedNames(l),this._currentLexerNode}_suffixExpressionHandler(e){var o;const t=e.getChildren();if(!t)return!1;const r=t.length,n=[],s=[];let a=!0;for(let c=0;c<r;c++){const l=t[c];if(l instanceof ie)a=this._suffixExpressionHandler(l),n.push(l);else{const f=l.trim();if(f==="")continue;if(Rt.has(f)){if(f===Z.PLUS&&this._deletePlusForPreNode(t[c-1]))continue;if(f!==Z.PLUS&&f!==Z.MINUS&&this._deletePlusForPreNode(t[c-1]))return!1;for(;s.length>0;){const m=(o=s[s.length-1])==null?void 0:o.trim();if(!m||m===X.OPEN_BRACKET)break;const d=Br.get(m),C=Br.get(f);if(!d||!C)break;if(C>=d)n.push(s.pop());else break}s.push(l)}else if(f===X.OPEN_BRACKET)s.push(l);else if(f===X.CLOSE_BRACKET)this._processSuffixExpressionCloseBracket(n,s,t,c);else{if(this._checkCloseBracket(t[c-1]))return!1;n.push(l)}}}return a?this._processSuffixExpressionRemain(n,s,e):!1}_processSuffixExpressionRemain(e,t,r){const n=e.length,s=e[n-1];for(;t.length>0;){const a=t.pop();if(!(s instanceof ie)&&(a===X.OPEN_BRACKET||a===X.CLOSE_BRACKET))return!1;e.push(a)}return r.setChildren(e),!0}_processSuffixExpressionCloseBracket(e,t,r,n){var s;if(this._checkOpenBracket(r[n-1])||this._checkOperator(r[n-1]))return!1;for(;t.length>0;){const a=(s=t[t.length-1])==null?void 0:s.trim();if(!a)break;if(a===X.OPEN_BRACKET){t.pop();break}e.push(t.pop())}}_checkCloseBracket(e){return e===X.CLOSE_BRACKET||e instanceof ie}_checkOpenBracket(e){return e===X.OPEN_BRACKET}_checkOperator(e){return e==null||e instanceof ie?!1:Rt.has(e)}_deletePlusForPreNode(e){if(e==null)return!0;if(!(e instanceof ie)){const t=e.trim();if(Rt.has(t)||t===X.OPEN_BRACKET)return!0}return!1}_resetCurrentLexerNode(){this._currentLexerNode=new ie}_resetSegment(){this._segment=""}_openBracket(e=0){this._bracketState.push(e)}_closeBracket(){this._bracketState.pop()}_openSquareBracket(){this._squareBracketState+=1}_closeSquareBracket(){this._squareBracketState-=1}_getCurrentBracket(){const e=this._bracketState;return e[e.length-1]}_changeCurrentBracket(e){const t=this._bracketState;t[t.length-1]=e}_openBraces(){this._bracesState+=1}_closeBraces(){this._bracesState-=1}_openSingleQuotation(){this._singleQuotationState+=1}_closeSingleQuotation(){this._singleQuotationState-=1}_openDoubleQuotation(){this._doubleQuotationState+=1}_closeDoubleQuotation(){this._doubleQuotationState-=1}_openLambda(){this._lambdaState=!0}_closeLambda(){this._lambdaState=!1}_openColon(e){this._upLevel=e,this._colonState=!0}_closeColon(){this._upLevel=0,this._colonState=!1}_isTableBracket(){return this._tableBracketState}_openTableBracket(){this._tableBracketState=!0}_closeTableBracket(){this._tableBracketState=!1}_formalErrorOccurred(){this._formulaErrorCount+=1}_hasFormalError(){return this._formulaErrorCount>0}_getLastChildCurrentLexerNode(){const e=this._currentLexerNode.getChildren();if(e&&e.length>0){const t=e[e.length-1];if(t instanceof ie)return t}return!1}_getLastChildCurrent(){const e=this._currentLexerNode.getChildren();return e&&e.length>0?e[e.length-1]:!1}_setParentCurrentLexerNode(){const e=this._currentLexerNode.getParent();return e?(this._currentLexerNode=e,!0):!1}_setAncestorCurrentLexerNode(){var r,n,s,a,o,c;const e=(r=this._currentLexerNode)==null?void 0:r.getParent();let t=!1;if(e&&e.getToken()===Jt){if((n=e==null?void 0:e.getParent())!=null&&n.getParent()){const l=(a=(s=this._currentLexerNode.getParent())==null?void 0:s.getParent())==null?void 0:a.getParent();l&&(this._currentLexerNode=l),t=!0}}else if(e!=null&&e.getParent()){const l=(o=this._currentLexerNode.getParent())==null?void 0:o.getParent();l&&(this._currentLexerNode=l),t=!0}for(let l=0;l<this._upLevel;l++){const f=(c=this._currentLexerNode)==null?void 0:c.getParent();f&&(this._currentLexerNode=f),this._currentLexerNode?t=!0:t=!1}return t}_segmentCount(){return this._segment.trim().length}_pushSegment(e){this._segment+=e}_pushNodeToChildren(e,t=!1){let r=e;if(r!==""){const n=this._currentLexerNode.getChildren();if(!(r instanceof ie)&&this.isColonOpen()){const s=new ie;s.setToken(r),s.setParent(this._currentLexerNode),r=s}t?n.unshift(r):n.push(r)}this.isColonOpen()&&(this._setAncestorCurrentLexerNode(),this._closeColon())}_setCurrentLexerNode(e,t=!1){this._pushNodeToChildren(e,t),e.setParent(this._currentLexerNode),this._currentLexerNode=e}_newAndPushCurrentLexerNode(e,t,r=!1){const n=new ie;n.setToken(e),n.setIndex(t-e.length,t-1),this._setCurrentLexerNode(n,r)}_getTopNode(e){let t=e;for(;t!=null&&t.getParent();)t=t.getParent();return t}_removeLastChild(){this._currentLexerNode.getChildren().splice(-1)}_formulaErrorLastTokenCheck(e,t){const r=this._findPreviousToken(e,t)||"",n=e.length-1===t;if(!n&&this._isOperatorToken(r)||n&&tc(r))return!0;if(Jn.has(r)){const s=this._findSecondLastNonSpaceToken(e,t);if(s==null||nc(s))return!0}return!1}_findPreviousToken(e,t){let r=t;for(;r>=0;){const n=e[r];if(n!==" ")return n;r--}}_findSecondLastNonSpaceToken(e,t){let r=t,n=0;for(;r>=0;){const s=e[r];if(s!==" "&&(n++,n===2))return s;r--}return null}_findNextToken(e,t){let r=t;for(;r>=0;){const n=e[r];if(n!==" ")return n;r++}}_unexpectedEndingTokenExcludeOperator(e){return e===X.OPEN_BRACKET||e===X.COMMA||e===Z.EQUALS||e===""}_unexpectedEndingToken(e){return!!(this._isOperatorToken(e)||this._unexpectedEndingTokenExcludeOperator(e))}_isOperatorToken(e){return!!Rt.has(e)}_getSequenceArray(e){const t=[];return this._nodeMaker(e,t),t}_resetTemp(){this._currentLexerNode=new ie,this._upLevel=0,this._segment="",this._bracketState=[],this._bracesState=0,this._singleQuotationState=0,this._doubleQuotationState=0,this._lambdaState=!1,this._colonState=!1,this._formulaErrorCount=0}_checkErrorState(){return!!(this._bracketState.length>0||this._bracesState>0||this._singleQuotationState>0||this._doubleQuotationState>0||this._hasFormalError())}_checkSimilarErrorToken(e,t,r){let n=t;if(e!==qe.POUND)return!0;let s=r[++n];for(;s===" ";)s=r[++n];return!!gr(s)}_checkIfErrorObject(e,t){return!!this._findErrorObject(e,t)}_findErrorObject(e,t){for(let r=0;r<ja.length;r++){const n=ja[r],s=t.slice(e,e+n).join("").toUpperCase();if(xt.has(s))return s}}_nodeMaker(e,t,r){let n=e.replace(/\r\n$|\r|\n/g," ");n.substring(0,1)===Z.EQUALS&&(n=n.substring(1));const s=n.split(""),a=s.length;this._resetTemp(),this._formulaErrorLastTokenCheck(s,a-1)&&this._formalErrorOccurred();let o=0;for(;o<a;){const c=s[o];if(r===o)return[this._currentLexerNode,c];if(c===qe.POUND&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose()&&this.isBracesClose()&&this.isSquareBracketClose()&&this._checkIfErrorObject(o,s)){const l=this._findErrorObject(o,s);if(l==null)return h.VALUE;this._pushNodeToChildren(l);for(let f=0;f<l.length;f++){const m=s[o];this._pushSegment(m),this._addSequenceArray(t,m,o),o++}this._resetSegment();continue}else if(c===X.OPEN_BRACKET&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose())if(this._segmentCount()>0||this.isLambdaOpen()){this.isLambdaClose()&&(this._newAndPushCurrentLexerNode(this._segment,o),this._resetSegment()),this._openBracket(1),this._closeLambda();const l=s[o+1];if(l&&l===X.CLOSE_BRACKET){if(!this._setParentCurrentLexerNode()&&o!==a-1)return h.VALUE;this._addSequenceArray(t,c,o),o++,this._addSequenceArray(t,l,o),o++,this._closeBracket();continue}else l&&this._newAndPushCurrentLexerNode(at,o)}else this._pushNodeToChildren(c),this._openBracket(0),this._resetSegment();else if(c===X.CLOSE_BRACKET&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose()){this._formulaErrorLastTokenCheck(s,o-1)&&this._formalErrorOccurred(),this._pushNodeToChildren(this._segment),this._resetSegment();const l=this._getCurrentBracket();if(l===0)this._pushNodeToChildren(c);else if(l===1){const f=s[o+1];if(f&&f===X.OPEN_BRACKET){if(!this._setParentCurrentLexerNode()&&o!==a-1)return h.VALUE;this._newAndPushCurrentLexerNode(Jt,o,!0),this._openLambda()}else if(!this._setAncestorCurrentLexerNode()&&o!==a-1)return h.VALUE}else return h.VALUE;this._closeBracket()}else if(c===X.OPEN_BRACES&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose()){if(this._pushSegment(c),this._openBraces(),!this._formulaSpellCheck())return h.VALUE}else if(c===X.CLOSE_BRACES&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose())this._pushSegment(c),this._pushNodeToChildren(this._segment),this._resetSegment(),this._closeBraces();else if(c===X.OPEN_SQUARE_BRACKET&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose())this._segment.length>0&&this._openTableBracket(),this._pushSegment(c),this._openSquareBracket();else if(c===X.CLOSE_SQUARE_BRACKET&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose())this._closeSquareBracket(),this.isSquareBracketClose()?(this._pushSegment(c),this._isTableBracket()&&(this._pushNodeToChildren(this._segment),this._resetSegment()),this._closeTableBracket()):this._pushSegment(c);else if(c===X.DOUBLE_QUOTATION&&this.isSingleQuotationClose()&&this.isSquareBracketClose()){if(this.isDoubleQuotationClose())this._openDoubleQuotation();else{const l=s[o+1];l&&l===X.DOUBLE_QUOTATION?o++:this._closeDoubleQuotation()}this._pushSegment(c)}else if(c===X.SINGLE_QUOTATION&&this.isDoubleQuotationClose()){if(this.isSingleQuotationClose())this._openSingleQuotation(),this._segmentCount()===0&&this._resetSegment();else{const l=s[o+1];if(l&&l===X.SINGLE_QUOTATION){this._pushSegment(c),this._addSequenceArray(t,c,o),o++,this._pushSegment(l),this._addSequenceArray(t,l,o),o++;continue}else this._closeSingleQuotation()}this._pushSegment(c)}else if(c===X.COMMA&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose()&&this.isBracesClose()&&this.isSquareBracketClose()){this._formulaErrorLastTokenCheck(s,o-1)&&this._formalErrorOccurred();const l=this._getCurrentBracket();if(l===1||l==null){if(this._pushNodeToChildren(this._segment),this._resetSegment(),!this._setParentCurrentLexerNode()&&o!==a-1&&l!=null)return h.VALUE;this._newAndPushCurrentLexerNode(at,o)}else{const f=new ie;f.setToken(Mc);const m=new ie;m.setToken(at),m.changeToParent(f);const d=this._currentLexerNode.getParent();if(d&&d.getToken()===X.COLON){const C=d.getParent();if(!C)return h.VALUE;d.changeToParent(m),C.setChildren([]),f.changeToParent(C)}else return h.VALUE;this._changeCurrentBracket(1),this._pushNodeToChildren(this._segment),this._resetSegment(),this._currentLexerNode=f,this._newAndPushCurrentLexerNode(at,o)}}else if(c===X.COLON&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose()&&this.isBracesClose()&&this.isSquareBracketClose()){const l=new ie;l.setToken(c);const f=new ie;f.setToken(at),f.setParent(l);const m=new ie;m.setToken(at),m.setParent(l),l.getChildren().push(f,m);let d=l,C=0;if(this._segmentCount()>0){let _,E,b=0;const R=this._segment.trim(),N=R[0],V=R[1];if(N===Ve.MINUS&&(_=new ie,_.setToken(Ve.MINUS),b++),(N===Ve.AT||V===Ve.AT)&&(E=new ie,E.setToken(Ve.AT),_&&(_.addChildren(E),E.setParent(_)),b++),b>0&&(this._segment=R.slice(b)),C=b,E)if(E.addChildren(l),l.setParent(E),E.getParent()){const D=E.getParent();D&&(d=D)}else d=E;else _&&(d=_,_.addChildren(l),l.setParent(_));const M=new ie;M.setToken(this._segment),M.setParent(f),f.getChildren().push(M),this._resetSegment()}else{const _=this._getLastChildCurrentLexerNode();_&&_.changeToParent(f)}this._setCurrentLexerNode(d),this._currentLexerNode=m,this._openColon(C)}else if(Jn.has(c)&&this._checkSimilarErrorToken(c,o,s)&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose()&&this.isSquareBracketClose()&&this.isBracesClose()){this._pushNodeToChildren(this._segment);const l=new ie;l.setToken(c);const f=this._getLastChildCurrent();f instanceof ie?f.changeToParent(l):f!==!1&&(l.getChildren().push(f),this._removeLastChild()),this._pushNodeToChildren(l),l.setParent(this._currentLexerNode),this._resetSegment()}else if(Rt.has(c)&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose()&&this.isSquareBracketClose()&&this.isBracesClose()){let l=this._segment.trim();if(c===Z.MINUS&&l===""){const f=this._findPreviousToken(s,o-1)||"",m=this._findNextToken(s,o+1)||"";if(this._unexpectedEndingTokenExcludeOperator(f)&&this._isOperatorToken(m)){this._pushNodeToChildren("0"),this._pushNodeToChildren(Z.MINUS),this._addSequenceArray(t,c,o),this._resetSegment(),o++;continue}else if(this._unexpectedEndingToken(f))if(m===Z.PLUS){this._pushSegment(Z.MINUS),this._addSequenceArray(t,c,o),this._addSequenceArray(t,Z.PLUS,o+1),o+=2;continue}else{this._pushSegment(Z.MINUS),this._addSequenceArray(t,c,o),o++;continue}}else if(this._segment.length>0&&this._isScientificNotation(s,o,c)){this._pushSegment(c),this._addSequenceArray(t,c,o),o++;continue}else this._segment.length>0&&l===""?l=this._segment:(this._pushNodeToChildren(this._segment),l="");if(c===Z.LESS_THAN||c===Z.GREATER_THAN){const f=s[o+1];if(f&&Rt.has(c+f)){this._pushNodeToChildren(l+c+f),this._resetSegment(),this._addSequenceArray(t,c,o),o++,this._addSequenceArray(t,f,o),o++;continue}else this._pushNodeToChildren(l+c)}else this._pushNodeToChildren(l+c);this._resetSegment()}else(this._segment!==""||c!==" ")&&this._pushSegment(c);this._addSequenceArray(t,c,o),o++}if(this._pushNodeToChildren(this._segment),this._checkErrorState())return h.VALUE}_isScientificNotation(e,t,r){const n=e[t-2];if(n&&Number.isNaN(Number(n))||!(r===Z.MINUS||r===Z.PLUS))return!1;const s=e[t+1];if(s&&Number.isNaN(Number(s)))return!1;const a=e[t-1];return a&&a.toUpperCase()==="E"}_addSequenceArray(e,t,r){e==null||e.push({segment:this._segment,currentString:t,cur:r,currentLexerNode:this._currentLexerNode})}}function Lc(i,u,e,t,r,n,s){const a=(s==null?void 0:s.f)||"",o=(s==null?void 0:s.si)||"",c=S.isFormulaString(a),l=S.isFormulaId(o),f=i.getValue(r,n),m=(f==null?void 0:f.f)||"",d=(f==null?void 0:f.si)||"";function C(){var _;if(S.isFormulaString(m)&&S.isFormulaId(d)){const E=(_=e==null?void 0:e[d])==null?void 0:_.f;E?t.set(d,E):t.set(d,m)}}c&&l?(d!==o&&C(),i.setValue(r,n,{f:a,si:o}),e[o]={f:a,r,c:n},u.setValue(r,n,{f:a,si:o})):c&&!l?(m!==a&&C(),i.setValue(r,n,{f:a}),u.setValue(r,n,{f:a})):!c&&l?(d!==o&&C(),i.setValue(r,n,{f:"",si:o})):!c&&!l&&i.getValue(r,n)&&(C(),i.realDeleteValue(r,n),u.setValue(r,n,null))}function Pc(i,u,e,t){const r=i==null?void 0:i.getValue(e,t);if(r==null)return!0;const n=[];i.forValue((l,f,m)=>{l===e&&f===t||S.Rectangle.intersects(m,r)&&n.push(m)});const{startRow:s,startColumn:a,endRow:o,endColumn:c}=r;for(let l=s;l<=o;l++)for(let f=a;f<=c;f++){let m=!1;const d=S.cellToRange(l,f);n.some(C=>S.Rectangle.contains(C,d)?(m=!0,!0):!1),m||u.realDeleteValue(l,f)}}var jc=Object.getOwnPropertyDescriptor,xc=(i,u,e,t)=>{for(var r=t>1?void 0:t?jc(u,e):u,n=i.length-1,s;n>=0;n--)(s=i[n])&&(r=s(r)||r);return r},li=(i,u)=>(e,t)=>u(e,t,i);w.FormulaDataModel=class extends S.Disposable{constructor(e,t){super();A(this,"_arrayFormulaRange",{});A(this,"_arrayFormulaCellData",{});this._univerInstanceService=e,this._lexerTreeBuilder=t}dispose(){super.dispose(),this._arrayFormulaRange={},this._arrayFormulaCellData={}}clearPreviousArrayFormulaCellData(e){Object.keys(e).forEach(t=>{const r=e[t];if(r==null)return!0;Object.keys(r).forEach(n=>{var l,f,m,d;const s=r[n],a=(f=(l=this._arrayFormulaRange)==null?void 0:l[t])==null?void 0:f[n];if(a==null)return!0;const o=new S.ObjectMatrix(a);let c=new S.ObjectMatrix;((m=this._arrayFormulaCellData[t])==null?void 0:m[n])!=null&&(c=new S.ObjectMatrix((d=this._arrayFormulaCellData[t])==null?void 0:d[n])),s.forValue((C,_)=>{const E=o.getValue(C,_);if(E==null)return!0;const{startRow:b,startColumn:R,endRow:N,endColumn:V}=E;for(let M=b;M<=N;M++)for(let D=R;D<=V;D++)c.setValue(M,D,null);o.realDeleteValue(C,_)}),this._arrayFormulaCellData[t]&&(this._arrayFormulaCellData[t][n]=c.getData())})})}mergeArrayFormulaCellData(e){Object.keys(e).forEach(t=>{const r=e[t];if(r==null)return!0;this._arrayFormulaRange[t]==null&&(this._arrayFormulaRange[t]={}),this._arrayFormulaCellData[t]==null&&(this._arrayFormulaCellData[t]={}),Object.keys(r).forEach(n=>{var c,l;const s=r[n],a=new S.ObjectMatrix((c=this._arrayFormulaRange[t])==null?void 0:c[n]),o=new S.ObjectMatrix((l=this._arrayFormulaCellData[t])==null?void 0:l[n]);s.forValue((f,m)=>{const d=a==null?void 0:a.getValue(f,m);if(d==null)return!0;const{startRow:C,startColumn:_,endRow:E,endColumn:b}=d;for(let R=C;R<=E;R++)for(let N=_;N<=b;N++)o.setValue(R,N,null)}),s.forValue((f,m,d)=>{o.setValue(f,m,d)}),this._arrayFormulaCellData[t]&&(this._arrayFormulaCellData[t][n]=o.getData())})})}getFormulaData(){const e={},t=this._univerInstanceService.getAllUnitsForType(S.UniverInstanceType.UNIVER_SHEET);return t.length===0||t.forEach(r=>{const n=r.getUnitId();e[n]={},r.getSheets().forEach(a=>{const o=a.getCellMatrix(),c=a.getSheetId();gs(e,n,c,o)})}),e}getSheetFormulaData(e,t){const r={},n=this._univerInstanceService.getUnit(e);if(n==null)return{};r[e]={};const s=n.getSheetBySheetId(t);if(s==null)return{};const a=s.getCellMatrix();return gs(r,e,t,a),r[e][t]}getArrayFormulaRange(){return this._arrayFormulaRange}setArrayFormulaRange(e){this._arrayFormulaRange=e}getArrayFormulaCellData(){return this._arrayFormulaCellData}setArrayFormulaCellData(e){this._arrayFormulaCellData=e}mergeArrayFormulaRange(e){Object.keys(e).forEach(t=>{const r=e[t];if(r==null)return!0;this._arrayFormulaRange[t]||(this._arrayFormulaRange[t]={}),Object.keys(r).forEach(n=>{var o;const s=new S.ObjectMatrix(r[n]),a=new S.ObjectMatrix((o=this._arrayFormulaRange[t])==null?void 0:o[n]);s.forValue((c,l,f)=>{a.setValue(c,l,f)}),this._arrayFormulaRange[t]&&(this._arrayFormulaRange[t][n]=a.getData())})})}deleteArrayFormulaRange(e,t,r,n){var o;const s=(o=this._arrayFormulaRange[e])==null?void 0:o[t];if(s==null)return;const a=new S.ObjectMatrix(s);a.getValue(r,n)&&(a.realDeleteValue(r,n),this._arrayFormulaRange[e]&&(this._arrayFormulaRange[e][t]=a.getData()))}getCalculateData(){const e=this._univerInstanceService.getAllUnitsForType(S.UniverInstanceType.UNIVER_SHEET),t={},r={},n={};for(const s of e){const a=s.getUnitId(),o=s.getSheets(),c={},l={};for(const f of o){const m=f.getSheetId(),d=f.getConfig();c[m]={cellData:new S.ObjectMatrix(d.cellData),rowCount:d.rowCount,columnCount:d.columnCount,rowData:d.rowData,columnData:d.columnData,defaultRowHeight:d.defaultRowHeight,defaultColumnWidth:d.defaultColumnWidth},l[f.getName()]=f.getSheetId()}t[a]=c,r[a]=s.getStyles(),n[a]=l}return{allUnitData:t,unitStylesData:r,unitSheetNameMap:n}}getHiddenRowsFiltered(){const e=this._univerInstanceService.getAllUnitsForType(S.UniverInstanceType.UNIVER_SHEET),t={};for(const r of e){const n=r.getUnitId(),s=r.getSheets();t[n]={};for(const a of s){const o=a.getSheetId();t[n][o]={};const c=0,l=a.getRowCount()-1,f={};for(let m=c;m<=l;m++)a.getRowVisible(m)||(f[m]={hd:S.BooleanNumber.TRUE});t[n][o]=f}}return t}updateFormulaData(e,t,r){const n=new S.ObjectMatrix(r),s=this._getSheetFormulaIdMap(e,t),a=new Map,o=this.getFormulaData();o[e]==null&&(o[e]={});const c=o[e];c[t]==null&&(c[t]={});const l=new S.ObjectMatrix(c[t]||{}),f=new S.ObjectMatrix;return n.forValue((m,d,C)=>{Lc(l,f,s,a,m,d,C)}),l.forValue((m,d,C)=>{const _=(C==null?void 0:C.f)||"",E=(C==null?void 0:C.si)||"";if(S.isFormulaId(E)){const b=s==null?void 0:s[E],R=a.get(E);if(b&&!S.isFormulaString(_)){const N=b.f,V=d-b.c,M=m-b.r;l.setValue(m,d,{f:N,si:E,x:V,y:M}),f.setValue(m,d,{f:N,si:E,x:V,y:M})}else if(typeof R=="string"){const N=(C==null?void 0:C.x)||0,V=(C==null?void 0:C.y)||0,M=this._lexerTreeBuilder.moveFormulaRefOffset(R,N,V);a.set(E,{r:m,c:d,f:M}),l.setValue(m,d,{f:M,si:E}),f.setValue(m,d,{f:M,si:E})}else if(typeof R=="object"){const N=d-R.c,V=m-R.r;l.setValue(m,d,{f:R.f,si:E,x:N,y:V}),f.setValue(m,d,{f:R.f,si:E,x:N,y:V})}}}),f.getMatrix()}updateArrayFormulaRange(e,t,r){var o;const n=(o=this._arrayFormulaRange[e])==null?void 0:o[t];if(!n)return;const s=new S.ObjectMatrix(n);new S.ObjectMatrix(r).forValue((c,l,f)=>{s.realDeleteValue(c,l)})}updateArrayFormulaCellData(e,t,r){var l,f;const n=(l=this._arrayFormulaRange[e])==null?void 0:l[t];if(!n)return;const s=new S.ObjectMatrix(n),a=(f=this._arrayFormulaCellData[e])==null?void 0:f[t];if(!a)return;const o=new S.ObjectMatrix(a);new S.ObjectMatrix(r).forValue((m,d,C)=>{Pc(s,o,m,d)})}getFormulaStringByCell(e,t,r,n){const s=this._univerInstanceService.getUnit(n);if(s==null)return null;const a=s.getSheetBySheetId(r);if(a==null)return null;const o=a.getCellMatrix(),c=o.getValue(e,t);if(c==null)return null;const{f:l,si:f}=c;if(S.isFormulaString(l))return l;if(S.isFormulaId(f)){let m=null;return o.forValue((d,C,_)=>{if(_==null)return!0;const{f:E,si:b}=_;if(S.isFormulaString(E)&&f===b)return m=this._lexerTreeBuilder.moveFormulaRefOffset(E,t-C,e-d),!1}),m}return null}getFormulaDirtyRanges(){const e=this.getFormulaData(),t=[];for(const r in e){const n=e[r];if(!n)continue;const s=this._univerInstanceService.getUnit(r);if(s)for(const a in n){const o=n[a];if(!o)continue;const c=s.getSheetBySheetId(a);if(!c)continue;const l={};for(const f of Object.keys(o)){const m=Number(f);for(const d in o[m]){const C=Number(d),_=c.getCellRaw(m,C),E=S.isFormulaString(_==null?void 0:_.f)||S.isFormulaId(_==null?void 0:_.si),b=(_==null?void 0:_.v)===void 0;if(!(E&&b))continue;l[C]||(l[C]=[]);const R=l[C].slice(-1)[0];R&&R.endRow===m-1?R.endRow=m:l[C].push({startRow:m,endRow:m})}}for(const f in l){const m=l[f];for(let d=0;d<m.length;d++){const C=m[d];t.push({unitId:r,sheetId:a,range:{rangeType:S.RANGE_TYPE.NORMAL,startRow:C.startRow,endRow:C.endRow,startColumn:Number(f),endColumn:Number(f)}})}}}}return t}_getSheetFormulaIdMap(e,t){const r={},n=this._univerInstanceService.getUnit(e);if(n==null)return r;const s=n.getSheetBySheetId(t);return s==null||s.getCellMatrix().forValue((o,c,l)=>{if(l==null)return!0;const{f,si:m}=l;S.isFormulaString(f)&&S.isFormulaId(m)&&(r[m]={f,r:o,c})}),r}},w.FormulaDataModel=xc([li(0,S.IUniverInstanceService),li(1,S.Inject(Xr))],w.FormulaDataModel);function gs(i,u,e,t){i[u]||(i[u]={}),i[u][e]||(i[u][e]={});const r=new Map,n=new S.ObjectMatrix(i[u][e]);t.forValue((a,o,c)=>{const l=(c==null?void 0:c.f)||"",f=(c==null?void 0:c.si)||"",m=S.isFormulaString(l),d=S.isFormulaId(f);m&&d?(n.setValue(a,o,{f:l,si:f}),r.set(f,{f:l,r:a,c:o})):m&&!d?n.setValue(a,o,{f:l}):!m&&d&&n.setValue(a,o,{f:"",si:f})}),n.forValue((a,o,c)=>{const l=(c==null?void 0:c.f)||"",f=(c==null?void 0:c.si)||"";if(S.isFormulaId(f)&&!S.isFormulaString(l)){const m=r.get(f);if(m){const d=m.f,C=o-m.c,_=a-m.r;n.setValue(a,o,{f:d,si:f,x:C,y:_})}else n.realDeleteValue(a,o)}});const s=n.getMatrix();return{[u]:{[e]:s}}}const Uc=class La{constructor(u,e){this.low=u,this.high=e}clone(){return new La(this.low,this.high)}get max(){return this.clone()}less_than(u){return this.low<u.low||this.low===u.low&&this.high<u.high}equal_to(u){return this.low===u.low&&this.high===u.high}intersect(u){return!this.not_intersect(u)}not_intersect(u){return this.high<u.low||u.high<this.low}merge(u){return new La(this.low===void 0?u.low:this.low<u.low?this.low:u.low,this.high===void 0?u.high:this.high>u.high?this.high:u.high)}output(){return[this.low,this.high]}static comparable_max(u,e){return u.merge(e)}static comparable_less_than(u,e){return u<e}},Pe=0,Ae=1;class Bt{constructor(u=void 0,e=void 0,t=null,r=null,n=null,s=Ae){if(this.left=t,this.right=r,this.parent=n,this.color=s,this.item={key:u,value:e},u&&u instanceof Array&&u.length===2&&!Number.isNaN(u[0])&&!Number.isNaN(u[1])){let[a,o]=u;a>o&&([a,o]=[o,a]),this.item.key=new Uc(a,o)}this.max=this.item.key?this.item.key.max:void 0}isNil(){return this.item.key===void 0&&this.item.value===void 0&&this.left===null&&this.right===null&&this.color===Ae}_value_less_than(u){return this.item.value&&u.item.value&&this.item.value.less_than?this.item.value.less_than(u.item.value):this.item.value<u.item.value}less_than(u){return this.item.value===this.item.key&&u.item.value===u.item.key?this.item.key.less_than(u.item.key):this.item.key.less_than(u.item.key)||this.item.key.equal_to(u.item.key)&&this._value_less_than(u)}_value_equal(u){return this.item.value&&u.item.value&&this.item.value.equal_to?this.item.value.equal_to(u.item.value):this.item.value===u.item.value}equal_to(u){return this.item.value===this.item.key&&u.item.value===u.item.key?this.item.key.equal_to(u.item.key):this.item.key.equal_to(u.item.key)&&this._value_equal(u)}intersect(u){return this.item.key.intersect(u.item.key)}copy_data(u){this.item.key=u.item.key,this.item.value=u.item.value}update_max(){if(this.max=this.item.key?this.item.key.max:void 0,this.right&&this.right.max){const u=this.item.key.constructor.comparable_max;this.max=u(this.max,this.right.max)}if(this.left&&this.left.max){const u=this.item.key.constructor.comparable_max;this.max=u(this.max,this.left.max)}}not_intersect_left_subtree(u){const e=this.item.key.constructor.comparable_less_than;let t=this.left.max.high!==void 0?this.left.max.high:this.left.max;return e(t,u.item.key.low)}not_intersect_right_subtree(u){const e=this.item.key.constructor.comparable_less_than;let t=this.right.max.low!==void 0?this.right.max.low:this.right.item.key.low;return e(u.item.key.high,t)}}class ds{constructor(){this.root=null,this.nil_node=new Bt}get size(){let u=0;return this.tree_walk(this.root,()=>u++),u}get keys(){let u=[];return this.tree_walk(this.root,e=>u.push(e.item.key.output?e.item.key.output():e.item.key)),u}get values(){let u=[];return this.tree_walk(this.root,e=>u.push(e.item.value)),u}get items(){let u=[];return this.tree_walk(this.root,e=>u.push({key:e.item.key.output?e.item.key.output():e.item.key,value:e.item.value})),u}isEmpty(){return this.root==null||this.root===this.nil_node}clear(){this.root=null}insert(u,e=u){if(u===void 0)return;let t=new Bt(u,e,this.nil_node,this.nil_node,null,Pe);return this.tree_insert(t),this.recalc_max(t),t}exist(u,e=u){let t=new Bt(u,e);return!!this.tree_search(this.root,t)}remove(u,e=u){let t=new Bt(u,e),r=this.tree_search(this.root,t);return r&&this.tree_delete(r),r}search(u,e=(t,r)=>t===r?r.output():t){let t=new Bt(u),r=[];return this.tree_search_interval(this.root,t,r),r.map(n=>e(n.item.value,n.item.key))}intersect_any(u){let e=new Bt(u);return this.tree_find_any_interval(this.root,e)}forEach(u){this.tree_walk(this.root,e=>u(e.item.key,e.item.value))}map(u){const e=new ds;return this.tree_walk(this.root,t=>e.insert(t.item.key,u(t.item.value,t.item.key))),e}*iterate(u,e=(t,r)=>t===r?r.output():t){let t;for(u?t=this.tree_search_nearest_forward(this.root,new Bt(u)):this.root&&(t=this.local_minimum(this.root));t;)yield e(t.item.value,t.item.key),t=this.tree_successor(t)}recalc_max(u){let e=u;for(;e.parent!=null;)e.parent.update_max(),e=e.parent}tree_insert(u){let e=this.root,t=null;if(this.root==null||this.root===this.nil_node)this.root=u;else{for(;e!==this.nil_node;)t=e,u.less_than(e)?e=e.left:e=e.right;u.parent=t,u.less_than(t)?t.left=u:t.right=u}this.insert_fixup(u)}insert_fixup(u){let e,t;for(e=u;e!==this.root&&e.parent.color===Pe;)e.parent===e.parent.parent.left?(t=e.parent.parent.right,t.color===Pe?(e.parent.color=Ae,t.color=Ae,e.parent.parent.color=Pe,e=e.parent.parent):(e===e.parent.right&&(e=e.parent,this.rotate_left(e)),e.parent.color=Ae,e.parent.parent.color=Pe,this.rotate_right(e.parent.parent))):(t=e.parent.parent.left,t.color===Pe?(e.parent.color=Ae,t.color=Ae,e.parent.parent.color=Pe,e=e.parent.parent):(e===e.parent.left&&(e=e.parent,this.rotate_right(e)),e.parent.color=Ae,e.parent.parent.color=Pe,this.rotate_left(e.parent.parent)));this.root.color=Ae}tree_delete(u){let e,t;u.left===this.nil_node||u.right===this.nil_node?e=u:e=this.tree_successor(u),e.left!==this.nil_node?t=e.left:t=e.right,t.parent=e.parent,e===this.root?this.root=t:(e===e.parent.left?e.parent.left=t:e.parent.right=t,e.parent.update_max()),this.recalc_max(t),e!==u&&(u.copy_data(e),u.update_max(),this.recalc_max(u)),e.color===Ae&&this.delete_fixup(t)}delete_fixup(u){let e=u,t;for(;e!==this.root&&e.parent!=null&&e.color===Ae;)e===e.parent.left?(t=e.parent.right,t.color===Pe&&(t.color=Ae,e.parent.color=Pe,this.rotate_left(e.parent),t=e.parent.right),t.left.color===Ae&&t.right.color===Ae?(t.color=Pe,e=e.parent):(t.right.color===Ae&&(t.color=Pe,t.left.color=Ae,this.rotate_right(t),t=e.parent.right),t.color=e.parent.color,e.parent.color=Ae,t.right.color=Ae,this.rotate_left(e.parent),e=this.root)):(t=e.parent.left,t.color===Pe&&(t.color=Ae,e.parent.color=Pe,this.rotate_right(e.parent),t=e.parent.left),t.left.color===Ae&&t.right.color===Ae?(t.color=Pe,e=e.parent):(t.left.color===Ae&&(t.color=Pe,t.right.color=Ae,this.rotate_left(t),t=e.parent.left),t.color=e.parent.color,e.parent.color=Ae,t.left.color=Ae,this.rotate_right(e.parent),e=this.root));e.color=Ae}tree_search(u,e){if(!(u==null||u===this.nil_node))return e.equal_to(u)?u:e.less_than(u)?this.tree_search(u.left,e):this.tree_search(u.right,e)}tree_search_nearest_forward(u,e){let t,r=u;for(;r&&r!==this.nil_node;)r.less_than(e)?r.intersect(e)?(t=r,r=r.left):r=r.right:((!t||r.less_than(t))&&(t=r),r=r.left);return t||null}tree_search_interval(u,e,t){u!=null&&u!==this.nil_node&&(u.left!==this.nil_node&&!u.not_intersect_left_subtree(e)&&this.tree_search_interval(u.left,e,t),u.intersect(e)&&t.push(u),u.right!==this.nil_node&&!u.not_intersect_right_subtree(e)&&this.tree_search_interval(u.right,e,t))}tree_find_any_interval(u,e){let t=!1;return u!=null&&u!==this.nil_node&&(u.left!==this.nil_node&&!u.not_intersect_left_subtree(e)&&(t=this.tree_find_any_interval(u.left,e)),t||(t=u.intersect(e)),!t&&u.right!==this.nil_node&&!u.not_intersect_right_subtree(e)&&(t=this.tree_find_any_interval(u.right,e))),t}local_minimum(u){let e=u;for(;e.left!=null&&e.left!==this.nil_node;)e=e.left;return e}local_maximum(u){let e=u;for(;e.right!=null&&e.right!==this.nil_node;)e=e.right;return e}tree_successor(u){let e,t,r;if(u.right!==this.nil_node)e=this.local_minimum(u.right);else{for(t=u,r=u.parent;r!=null&&r.right===t;)t=r,r=r.parent;e=r}return e}rotate_left(u){let e=u.right;u.right=e.left,e.left!==this.nil_node&&(e.left.parent=u),e.parent=u.parent,u===this.root?this.root=e:u===u.parent.left?u.parent.left=e:u.parent.right=e,e.left=u,u.parent=e,u!=null&&u!==this.nil_node&&u.update_max(),e=u.parent,e!=null&&e!==this.nil_node&&e.update_max()}rotate_right(u){let e=u.left;u.left=e.right,e.right!==this.nil_node&&(e.right.parent=u),e.parent=u.parent,u===this.root?this.root=e:u===u.parent.left?u.parent.left=e:u.parent.right=e,e.right=u,u.parent=e,u!==null&&u!==this.nil_node&&u.update_max(),e=u.parent,e!=null&&e!==this.nil_node&&e.update_max()}tree_walk(u,e){u!=null&&u!==this.nil_node&&(this.tree_walk(u.left,e),e(u),this.tree_walk(u.right,e))}testRedBlackProperty(){let u=!0;return this.tree_walk(this.root,function(e){e.color===Pe&&(e.left.color===Ae&&e.right.color===Ae||(u=!1))}),u}testBlackHeightProperty(u){let e=0,t=0,r=0;if(u.color===Ae&&e++,u.left!==this.nil_node?t=this.testBlackHeightProperty(u.left):t=1,u.right!==this.nil_node?r=this.testBlackHeightProperty(u.right):r=1,t!==r)throw new Error("Red-black height property violated");return e+=t,e}}class vc{constructor(){A(this,"_cache",new Map);A(this,"_continueBuildingCache",new Map)}set(u,e,t,r,n,s=!1){if(!this.shouldContinueBuildingCache(u,e,t,n)&&!s)return;let a=this._cache.get(u);a==null&&(a=new Map,this._cache.set(u,a));let o=a.get(e);o==null&&(o=new Map,a.set(e,o));let c=o.get(t);if(c==null&&(c=new Map,o.set(t,c)),s){for(const[f,m]of c)if(m.has(n)){m.delete(n);break}}let l=c.get(r);l==null&&(l=new Set,c.set(r,l)),l.add(n)}getCellValuePositions(u,e,t){var r,n;return(n=(r=this._cache.get(u))==null?void 0:r.get(e))==null?void 0:n.get(t)}getCellPositions(u,e,t,r,n){var a,o,c;const s=(c=(o=(a=this._cache.get(u))==null?void 0:a.get(e))==null?void 0:o.get(t))==null?void 0:c.get(r);return s&&[...s].filter(l=>n.some(([f,m])=>l>=f&&l<=m))}setContinueBuildingCache(u,e,t,r,n){if(t===-1||r===-1||n===-1)return;let s=this._continueBuildingCache.get(u);s==null&&(s=new Map,this._continueBuildingCache.set(u,s));let a=s.get(e);a==null&&(a=new Map,s.set(e,a));let o=a.get(t);if(o==null){o=new ds,o.insert([r,n]),a.set(t,o);return}this._handleNewInterval(o,r,n)}shouldContinueBuildingCache(u,e,t,r){var a,o;if(t===-1||r===-1)return!1;const n=(o=(a=this._continueBuildingCache.get(u))==null?void 0:a.get(e))==null?void 0:o.get(t);return n?n.search([r,r]).length===0:!0}canUseCache(u,e,t,r,n){var f,m;const s=(m=(f=this._continueBuildingCache.get(u))==null?void 0:f.get(e))==null?void 0:m.get(t);if(t===-1||r===-1||n===-1||!s)return{rowsInCache:[],rowsNotInCache:[]};const a=s.search([r,n]);if(a.length===0)return{rowsInCache:[],rowsNotInCache:[]};a.sort((d,C)=>d[0]-C[0]);const o=[],c=[];let l=r;for(let d=0;d<a.length;d++){const[C,_]=a[d];if(l>=C){if(n<=_){o.push([l,n]);break}o.push([l,_]),l=_+1,d===a.length-1&&l<=n&&c.push([l,n])}else{if(n>_){o.push([C,_]),c.push([l,C-1]),l=_+1,d===a.length-1&&l<=n&&c.push([l,n]);continue}o.push([C,n]),c.push([l,C-1])}}return{rowsInCache:o,rowsNotInCache:c}}clear(){this._cache.clear(),this._continueBuildingCache.clear()}_handleNewInterval(u,e,t){let r=u.search([e,t]);if(r.length===0){const a=[e-1<0?0:e-1,t+1];if(r=u.search(a),r.length===0){u.insert([e,t]);return}}let n=e,s=t;for(const a of r)n=Math.min(n,a[0]),s=Math.max(s,a[1]),u.remove(a);u.insert([n,s])}}const Ye=new vc,Zr="engine-formula.config",fi=1,Tc="CYCLE_REFERENCE_COUNT",mi={};class hi extends S.Disposable{constructor(){super(...arguments);A(this,"_getRowFilteredCallback")}register(e){this._getRowFilteredCallback=e}getRowFiltered(e,t,r){var n;return this._getRowFilteredCallback&&(n=this._getRowFilteredCallback(e,t,r))!=null?n:!1}}const Cs=S.createIdentifier("univer.formula.sheet-row-filtered.service");var Bc=Object.getOwnPropertyDescriptor,Fc=(i,u,e,t)=>{for(var r=t>1?void 0:t?Bc(u,e):u,n=i.length-1,s;n>=0;n--)(s=i[n])&&(r=s(r)||r);return r},zr=(i,u)=>(e,t)=>u(e,t,i);w.FormulaCurrentConfigService=class extends S.Disposable{constructor(e,t,r,n){super();A(this,"_unitData",{});A(this,"_unitStylesData",{});A(this,"_arrayFormulaCellData",{});A(this,"_arrayFormulaRange",{});A(this,"_formulaData",{});A(this,"_sheetNameMap",{});A(this,"_forceCalculate",!1);A(this,"_clearDependencyTreeCache",{});A(this,"_dirtyRanges",[]);A(this,"_dirtyNameMap",{});A(this,"_dirtyDefinedNameMap",{});A(this,"_dirtyUnitFeatureMap",{});A(this,"_dirtyUnitOtherFormulaMap",{});A(this,"_excludedCell");A(this,"_sheetIdToNameMap",{});A(this,"_executeUnitId","");A(this,"_executeSubUnitId","");this._univerInstanceService=e,this._localeService=t,this._formulaDataModel=r,this._sheetRowFilteredService=n}dispose(){super.dispose(),this._unitData={},this._unitStylesData={},this._arrayFormulaCellData={},this._arrayFormulaRange={},this._formulaData={},this._sheetNameMap={},this._clearDependencyTreeCache={},this._dirtyRanges=[],this._dirtyNameMap={},this._dirtyDefinedNameMap={},this._dirtyUnitFeatureMap={},this._dirtyUnitOtherFormulaMap={},this._excludedCell={},this._sheetIdToNameMap={}}getExecuteUnitId(){return this._executeUnitId}getExecuteSubUnitId(){return this._executeSubUnitId}setExecuteUnitId(e){this._executeUnitId=e}setExecuteSubUnitId(e){this._executeSubUnitId=e}getExcludedRange(){return this._excludedCell}getUnitData(){return this._unitData}getUnitStylesData(){return this._unitStylesData}getFormulaData(){return this._formulaData}getArrayFormulaCellData(){return this._arrayFormulaCellData}getArrayFormulaRange(){return this._arrayFormulaRange}getSheetNameMap(){return this._sheetNameMap}isForceCalculate(){return this._forceCalculate}getDirtyRanges(){return this._dirtyRanges}getDirtyNameMap(){return this._dirtyNameMap}getDirtyDefinedNameMap(){return this._dirtyDefinedNameMap}getDirtyUnitFeatureMap(){return this._dirtyUnitFeatureMap}getDirtyUnitOtherFormulaMap(){return this._dirtyUnitOtherFormulaMap}getSheetName(e,t){return this._sheetIdToNameMap[e]==null?"":this._sheetIdToNameMap[e][t]||""}getClearDependencyTreeCache(){return this._clearDependencyTreeCache}getLocale(){return this._localeService.getCurrentLocale()}getSheetsInfo(){const e=this._univerInstanceService.getCurrentUnitForType(S.UniverInstanceType.UNIVER_SHEET),{id:t,sheetOrder:r}=e.getSnapshot();return{sheetOrder:r,sheetNameMap:this._sheetIdToNameMap[t]}}getSheetRowColumnCount(e,t){const r=this._univerInstanceService.getUnit(e),n=r==null?void 0:r.getSheetBySheetId(t),s=n==null?void 0:n.getSnapshot();if(!s)return{rowCount:0,columnCount:0};const{rowCount:a,columnCount:o}=s;return{rowCount:a,columnCount:o}}getFilteredOutRows(e,t,r,n){const s=[];for(let a=r;a<=n;a++)this._sheetRowFilteredService.getRowFiltered(e,t,a)&&s.push(a);return s}load(e){if(e.allUnitData&&e.unitSheetNameMap&&e.unitStylesData)this._unitData=e.allUnitData,this._unitStylesData=e.unitStylesData,this._sheetNameMap=e.unitSheetNameMap;else{const{allUnitData:t,unitSheetNameMap:r,unitStylesData:n}=this._loadSheetData();this._unitData=t,this._unitStylesData=n,this._sheetNameMap=r}e.rowData&&this._applyUnitRowData(e.rowData),this._formulaData=e.formulaData,this._arrayFormulaCellData=Ta(e.arrayFormulaCellData),this._arrayFormulaRange=e.arrayFormulaRange,this._forceCalculate=e.forceCalculate,this._clearDependencyTreeCache=e.clearDependencyTreeCache||{},this._dirtyRanges=e.dirtyRanges,this._dirtyNameMap=e.dirtyNameMap,this._dirtyDefinedNameMap=e.dirtyDefinedNameMap,this._dirtyUnitFeatureMap=e.dirtyUnitFeatureMap,this._dirtyUnitOtherFormulaMap=e.dirtyUnitOtherFormulaMap,this._excludedCell=e.excludedCell,this._mergeNameMap(this._sheetNameMap,this._dirtyNameMap)}getDirtyData(){return{forceCalculation:this._forceCalculate,dirtyRanges:this._dirtyRanges,dirtyNameMap:this._dirtyNameMap,dirtyDefinedNameMap:this._dirtyDefinedNameMap,dirtyUnitFeatureMap:this._dirtyUnitFeatureMap,dirtyUnitOtherFormulaMap:this._dirtyUnitOtherFormulaMap,clearDependencyTreeCache:this._clearDependencyTreeCache}}loadDirtyRangesAndExcludedCell(e,t){this._dirtyRanges=e,this._excludedCell=t,this._dirtyNameMap={}}registerUnitData(e){this._unitData=e}registerFormulaData(e){this._formulaData=e}registerSheetNameMap(e){this._sheetNameMap=e}_mergeNameMap(e,t){Object.keys(t).forEach(r=>{t[r]&&Object.keys(t[r]).forEach(n=>{e[r]==null&&(e[r]={}),e[r][t[r][n]]=n})}),this._sheetIdToNameMap={},Object.keys(e).forEach(r=>{Object.keys(e[r]).forEach(n=>{this._sheetIdToNameMap[r]==null&&(this._sheetIdToNameMap[r]={}),this._sheetIdToNameMap[r][e[r][n]]=n})})}_loadSheetData(){const e=this._univerInstanceService.getCurrentUnitForType(S.UniverInstanceType.UNIVER_SHEET),t=e==null?void 0:e.getActiveSheet();return this._executeUnitId=e==null?void 0:e.getUnitId(),this._executeSubUnitId=t==null?void 0:t.getSheetId(),this._formulaDataModel.getCalculateData()}_applyUnitRowData(e){for(const t in e)if(e[t]!=null)for(const r in e[t])e[t][r]!=null&&(this._unitData[t]==null&&(this._unitData[t]={}),this._unitData[t][r]==null&&(this._unitData[t][r]={cellData:new S.ObjectMatrix({}),rowCount:0,columnCount:0,rowData:{},columnData:{}}),this._unitData[t][r].rowData=e[t][r])}},w.FormulaCurrentConfigService=Fc([zr(0,S.IUniverInstanceService),zr(1,S.Inject(S.LocaleService)),zr(2,S.Inject(w.FormulaDataModel)),zr(3,S.Inject(Cs))],w.FormulaCurrentConfigService);const Ct=S.createIdentifier("univer.formula.current-data.service");var Ic=Object.getOwnPropertyDescriptor,kc=(i,u,e,t)=>{for(var r=t>1?void 0:t?Ic(u,e):u,n=i.length-1,s;n>=0;n--)(s=i[n])&&(r=s(r)||r);return r},_s=(i,u)=>(e,t)=>u(e,t,i);w.Lexer=class extends S.Disposable{constructor(u,e,t){super(),this._definedNamesService=u,this._lexerTreeBuilder=e,this._formulaCurrentConfigService=t}treeBuilder(u,e=!0){return this._lexerTreeBuilder.treeBuilder(u,e,this._injectDefinedName.bind(this),this._simpleCheckDefinedName.bind(this))}_simpleCheckDefinedName(u){const e=this._formulaCurrentConfigService.getDirtyDefinedNameMap(),t=this._formulaCurrentConfigService.getExecuteUnitId();if(t!=null&&e[t]!=null){const r=Object.keys(e[t]);for(let n=0,s=r.length;n<s;n++){const a=r[n];if(u.indexOf(a)>-1)return!0}}return!1}_checkDefinedNameDirty(u){const e=this._formulaCurrentConfigService.getDirtyDefinedNameMap(),t=this._formulaCurrentConfigService.getExecuteUnitId();if(t!=null&&e[t]!=null){const r=Object.keys(e[t]);for(let n=0,s=r.length;n<s;n++)if(r[n]===u)return!0}return!1}_injectDefinedName(u){const e=this._formulaCurrentConfigService.getExecuteUnitId();if(e==null)return{sequenceString:"",hasDefinedName:!1,definedNames:[]};const t=this._lexerTreeBuilder.getSequenceNode(u);let r="",n=!1;const s=[];for(let a=0,o=t.length;a<o;a++){const c=t[a];if(typeof c=="string"){r+=c;continue}const{nodeType:l,token:f}=c;if(l===Te.REFERENCE||l===Te.FUNCTION){const m=this._definedNamesService.getValueByName(e,f);if(m){let d=m.formulaOrRefString;d.substring(0,1)===Z.EQUALS&&(d=d.substring(1)),r+=d,s.push(m.name),n=!0}else this._checkDefinedNameDirty(f)?(r+=h.NAME,n=!0,s.push(f)):r+=f}else r+=f}return{sequenceString:r,hasDefinedName:n,definedNames:s}}},w.Lexer=kc([_s(0,vt),_s(1,S.Inject(Xr)),_s(2,Ct)],w.Lexer);function Jr(i){if(i==null)return!0;const{v:u,f:e,si:t,p:r}=i;return!(!(u==null||typeof u=="string"&&u.length===0)||e!=null&&e.length>0||t!=null&&t.length>0||r!=null)}function gi(i,u,e,t,r){var s;const n=Object.keys(r);for(const a of n){const o=r[a],c=(s=o==null?void 0:o[t])==null?void 0:s[e];if(c==null)continue;const l=c.getValue(i,u);if(l!=null)return l}}const $c=["$","£","¥","¤","֏","؋","৳","฿","៛","₡","₦","₩","₪","₫","€","₭","₮","₱","₲","₴","₸","₹","₺","₼","₽","₾","₿"],Yc={currency:2,date:4,datetime:5,error:11,fraction:7,general:0,grouped:11,number:1,percent:6,scientific:8,text:9,time:5,unknown:11};function Hc(i,u,e){var o,c;if(i==null||u==null)return u;const t=(e==null?void 0:e.getStyleByCell(i))||i.s,r=(e==null?void 0:e.getStyleByCell(u))||u.s;if(t==null||r==null||typeof t!="object"||typeof r!="object")return u;const n=(o=t==null?void 0:t.n)==null?void 0:o.pattern,s=(c=r==null?void 0:r.n)==null?void 0:c.pattern;if(n==null||s==null)return u;const a=n||s;return r.n.pattern=a,u}const As=new dt(1e5);function di(i){const u=As.get(i);if(u!==void 0)return u;const e=Wc(i);return As.set(i,e),e}function Gc(){As.clear()}function Wc(i){if(Qc(i))return 3;const u=S.numfmt.getInfo(i).type||"unknown";return Yc[u]}function Qc(i){return!!$c.find(u=>i.includes(u))&&i.startsWith("_(")}function en(i,u,e){if(i==="")return u;if(u==="")return i;const t=di(i),r=di(u);return e===Z.PLUS||e===Z.MINUS?t===4&&r===4||t===11&&r===11?"":u:e===Z.MULTIPLY||e===Z.DIVIDED?t===6&&r===6||t===7&&r===7||t===8&&r===8||t===9&&r===9?u:"":i||u}const qc=new Map([[S.LocaleType.EN_US,"$"],[S.LocaleType.RU_RU,"₽"],[S.LocaleType.VI_VN,"₫"],[S.LocaleType.ZH_CN,"¥"],[S.LocaleType.ZH_TW,"NT$"]]);function Ci(i){return qc.get(i)||"$"}function He(i,u=2){let e=u;u>127&&(e=127);let t="";return e>0&&(t=`.${"0".repeat(e)}`),`"${Ci(i)}"#,##0${t}_);[Red]("${Ci(i)}"#,##0${t})`}function Kc(i,u,e=2){return S.numfmt.format(He(i,e),u)}const Es=new dt(1e5);function Xc(i){let u=i;u.startsWith('"')&&u.endsWith('"')&&(u=u.slice(1,-1));const e=Es.get(u);if(e)return{isNumberPattern:!0,value:e.value,pattern:e.pattern};const t=S.numfmt.parseNumber(u);if(t&&t.z)return bs(u,t.v,t.z);const r=S.numfmt.parseDate(u);if(r&&r.z)return bs(u,r.v,r.z);const n=S.numfmt.parseTime(u);return n&&n.z?bs(u,n.v,n.z):{isNumberPattern:!1}}function bs(i,u,e){return Es.set(i,{value:u,pattern:e}),{isNumberPattern:!0,value:u,pattern:e}}function Zc(){Es.clear()}class tn{constructor(){A(this,"pattern","")}dispose(){}getPattern(){return this.pattern}setPattern(u){this.pattern=u}isError(){return!1}isAsyncObject(){return!1}isAsyncArrayObject(){return!1}isReferenceObject(){return!1}isArray(){return!1}isValueObject(){return!1}isEqualType(u){return!1}}class _t extends tn{constructor(e){super();A(this,"_customData");this._rawValue=e}isValueObject(){return!0}toUnitRange(){return{range:{startColumn:-1,startRow:-1,endRow:-1,endColumn:-1},sheetId:"",unitId:""}}getValue(){return 0}getArrayValue(){return[]}setValue(e){}setArrayValue(e){}withCustomData(e){return this._customData=e,this}getCustomData(){return this._customData}isCube(){return!1}isString(){return!1}isNumber(){return!1}isBoolean(){return!1}isLambda(){return!1}isError(){return!1}isNull(){return!1}sum(){return g.create(h.VALUE)}max(){return g.create(h.VALUE)}min(){return g.create(h.VALUE)}count(){return g.create(h.VALUE)}countA(){return g.create(h.VALUE)}countBlank(){return g.create(h.VALUE)}getNegative(){return g.create(h.VALUE)}getReciprocal(){return g.create(h.VALUE)}plus(e){return g.create(h.VALUE)}minus(e){return g.create(h.VALUE)}multiply(e){return g.create(h.VALUE)}divided(e){return g.create(h.VALUE)}mod(e){return g.create(h.VALUE)}map(e){return g.create(h.NAME)}mapValue(e){return g.create(h.NAME)}compare(e,t,r=!1){return g.create(h.NAME)}isEqual(e){return this.compare(e,H.EQUALS)}isNotEqual(e){return this.compare(e,H.NOT_EQUAL)}isGreaterThanOrEqual(e){return this.compare(e,H.GREATER_THAN_OR_EQUAL)}isLessThanOrEqual(e){return this.compare(e,H.LESS_THAN_OR_EQUAL)}isLessThan(e){return this.compare(e,H.LESS_THAN)}isGreaterThan(e){return this.compare(e,H.GREATER_THAN)}concatenateFront(e){return g.create(h.NAME)}concatenateBack(e){return g.create(h.NAME)}plusBy(e){return g.create(h.VALUE)}minusBy(e){return g.create(h.VALUE)}multiplyBy(e){return g.create(h.VALUE)}dividedBy(e){return g.create(h.VALUE)}modInverse(e){return g.create(h.VALUE)}compareBy(e,t){return g.create(h.NAME)}concatenate(e,t=et.FRONT){let r=this.getValue().toString();if(typeof e=="string")t===et.FRONT?r=e+r:r+=e;else if(typeof e=="number")t===et.FRONT?r=e.toString()+r:r+=e.toString();else if(typeof e=="boolean"){const n=e?"TRUE":"FALSE";t===et.FRONT?r=n+r:r+=n}return r}pow(e){return g.create(h.VALUE)}powInverse(e){return g.create(h.VALUE)}sqrt(){return g.create(h.VALUE)}cbrt(){return g.create(h.VALUE)}cos(){return g.create(h.VALUE)}cosh(){return g.create(h.VALUE)}acos(){return g.create(h.VALUE)}acosh(){return g.create(h.VALUE)}sin(){return g.create(h.VALUE)}sinh(){return g.create(h.VALUE)}asin(){return g.create(h.VALUE)}asinh(){return g.create(h.VALUE)}tan(){return g.create(h.VALUE)}tanh(){return g.create(h.VALUE)}atan(){return g.create(h.VALUE)}atan2(e){return g.create(h.VALUE)}atan2Inverse(e){return g.create(h.VALUE)}atanh(){return g.create(h.VALUE)}mean(){return this}median(){return this}var(){return this}std(){return this}log(){return g.create(h.VALUE)}log10(){return g.create(h.VALUE)}exp(){return g.create(h.VALUE)}abs(){return g.create(h.VALUE)}round(e){return g.create(h.VALUE)}roundInverse(e){return g.create(h.VALUE)}floor(e){return g.create(h.VALUE)}floorInverse(e){return g.create(h.VALUE)}ceil(e){return g.create(h.VALUE)}ceilInverse(e){return g.create(h.VALUE)}convertToNumberObjectValue(){return g.create(h.VALUE)}convertToBooleanObjectValue(){return g.create(h.VALUE)}}const zc=1e3,ys=new dt(zc);class g extends _t{constructor(u,e=""){super(u),this._errorType=u,this._errorContent=e}static create(u,e=""){const t=`${u}-${e}`,r=ys.get(t);if(r)return r;const n=new g(u,e);return ys.set(t,n),n}getValue(){return this._errorType}getErrorType(){return this._errorType}getErrorContent(){return this._errorContent}isEqualType(u){return u.getErrorType()===this.getErrorType()}isError(){return!0}}function Jc(i){var u;if(i===null)return 0;if(i!=null&&i.p){const e=i==null?void 0:i.p.body;if(e==null)return 0;const t=e.dataStream;return S.BuildTextUtils.transform.getPlainText(t)}return(u=i==null?void 0:i.v)!=null?u:0}var Ft=(i=>(i[i.MIN=0]="MIN",i[i.MAX=1]="MAX",i))(Ft||{}),Me=(i=>(i[i.NORMAL=0]="NORMAL",i[i.MIN=1]="MIN",i[i.MAX=2]="MAX",i))(Me||{});function rn(){return Intl&&Intl.Collator?new Intl.Collator(void 0,{numeric:!1}).compare:(i,u)=>i.localeCompare(u)}function el(i){return i.indexOf("*")>-1||i.indexOf("?")>-1}function Rs(i,u){const e=rl(u).replace(/~?[*?]/g,r=>r.startsWith("~")?`\\${r.substring(1)}`:r==="*"?".*":r==="?"?".":r);return new RegExp(`^${e}$`).test(i)}function _i(i){return i.replace(/~?[*?]/g,u=>u.startsWith("~")?u.substring(1):" ")}function tl(i,u,e){let t=!1;switch(e){case H.EQUALS:t=Rs(i,u);break;case H.NOT_EQUAL:t=!Rs(i,u);break;case H.GREATER_THAN:case H.GREATER_THAN_OR_EQUAL:t=Rs(i,u)||i>_i(u);break;case H.LESS_THAN:case H.LESS_THAN_OR_EQUAL:t=i<_i(u);break}return t}function rl(i){return i.replace(/[.+^${}()|[\]\\]/g,"\\$&")}function Ns(i){switch(i){case 1:return 2;case 0:return 0;case-1:return 1;default:return 0}}function ps(i){return i===-2?1:0}function Vs(i){let u;switch(i){case H.EQUALS:u=H.EQUALS;break;case H.GREATER_THAN:u=H.LESS_THAN;break;case H.GREATER_THAN_OR_EQUAL:u=H.LESS_THAN_OR_EQUAL;break;case H.LESS_THAN:u=H.GREATER_THAN;break;case H.LESS_THAN_OR_EQUAL:u=H.GREATER_THAN_OR_EQUAL;break;case H.NOT_EQUAL:u=H.NOT_EQUAL;break}return u}/*!
 *  decimal.js v10.5.0
 *  An arbitrary-precision Decimal type for JavaScript.
 *  https://github.com/MikeMcl/decimal.js
 *  Copyright (c) 2025 Michael Mclaughlin <M8ch88l@gmail.com>
 *  MIT Licence
 */var Os=9e15,Vt=1e9,Ss="0123456789abcdef",nn="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",sn="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",Ms={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-9e15,maxE:Os,crypto:!1},Ai,At,ue=!0,an="[DecimalError] ",Ot=an+"Invalid argument: ",Ei=an+"Precision limit exceeded",bi=an+"crypto unavailable",yi="[object Decimal]",xe=Math.floor,we=Math.pow,nl=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,sl=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,al=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,Ri=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,tt=1e7,re=7,il=9007199254740991,ol=nn.length-1,Ds=sn.length-1,I={toStringTag:yi};I.absoluteValue=I.abs=function(){var i=new this.constructor(this);return i.s<0&&(i.s=1),J(i)},I.ceil=function(){return J(new this.constructor(this),this.e+1,2)},I.clampedTo=I.clamp=function(i,u){var e,t=this,r=t.constructor;if(i=new r(i),u=new r(u),!i.s||!u.s)return new r(NaN);if(i.gt(u))throw Error(Ot+u);return e=t.cmp(i),e<0?i:t.cmp(u)>0?u:new r(t)},I.comparedTo=I.cmp=function(i){var u,e,t,r,n=this,s=n.d,a=(i=new n.constructor(i)).d,o=n.s,c=i.s;if(!s||!a)return!o||!c?NaN:o!==c?o:s===a?0:!s^o<0?1:-1;if(!s[0]||!a[0])return s[0]?o:a[0]?-c:0;if(o!==c)return o;if(n.e!==i.e)return n.e>i.e^o<0?1:-1;for(t=s.length,r=a.length,u=0,e=t<r?t:r;u<e;++u)if(s[u]!==a[u])return s[u]>a[u]^o<0?1:-1;return t===r?0:t>r^o<0?1:-1},I.cosine=I.cos=function(){var i,u,e=this,t=e.constructor;return e.d?e.d[0]?(i=t.precision,u=t.rounding,t.precision=i+Math.max(e.e,e.sd())+re,t.rounding=1,e=ul(t,Mi(t,e)),t.precision=i,t.rounding=u,J(At==2||At==3?e.neg():e,i,u,!0)):new t(1):new t(NaN)},I.cubeRoot=I.cbrt=function(){var i,u,e,t,r,n,s,a,o,c,l=this,f=l.constructor;if(!l.isFinite()||l.isZero())return new f(l);for(ue=!1,n=l.s*we(l.s*l,1/3),!n||Math.abs(n)==1/0?(e=je(l.d),i=l.e,(n=(i-e.length+1)%3)&&(e+=n==1||n==-2?"0":"00"),n=we(e,1/3),i=xe((i+1)/3)-(i%3==(i<0?-1:2)),n==1/0?e="5e"+i:(e=n.toExponential(),e=e.slice(0,e.indexOf("e")+1)+i),t=new f(e),t.s=l.s):t=new f(n.toString()),s=(i=f.precision)+3;;)if(a=t,o=a.times(a).times(a),c=o.plus(l),t=Re(c.plus(l).times(a),c.plus(o),s+2,1),je(a.d).slice(0,s)===(e=je(t.d)).slice(0,s))if(e=e.slice(s-3,s+1),e=="9999"||!r&&e=="4999"){if(!r&&(J(a,i+1,0),a.times(a).times(a).eq(l))){t=a;break}s+=4,r=1}else{(!+e||!+e.slice(1)&&e.charAt(0)=="5")&&(J(t,i+1,1),u=!t.times(t).times(t).eq(l));break}return ue=!0,J(t,i,f.rounding,u)},I.decimalPlaces=I.dp=function(){var i,u=this.d,e=NaN;if(u){if(i=u.length-1,e=(i-xe(this.e/re))*re,i=u[i],i)for(;i%10==0;i/=10)e--;e<0&&(e=0)}return e},I.dividedBy=I.div=function(i){return Re(this,new this.constructor(i))},I.dividedToIntegerBy=I.divToInt=function(i){var u=this,e=u.constructor;return J(Re(u,new e(i),0,1,1),e.precision,e.rounding)},I.equals=I.eq=function(i){return this.cmp(i)===0},I.floor=function(){return J(new this.constructor(this),this.e+1,3)},I.greaterThan=I.gt=function(i){return this.cmp(i)>0},I.greaterThanOrEqualTo=I.gte=function(i){var u=this.cmp(i);return u==1||u===0},I.hyperbolicCosine=I.cosh=function(){var i,u,e,t,r,n=this,s=n.constructor,a=new s(1);if(!n.isFinite())return new s(n.s?1/0:NaN);if(n.isZero())return a;e=s.precision,t=s.rounding,s.precision=e+Math.max(n.e,n.sd())+4,s.rounding=1,r=n.d.length,r<32?(i=Math.ceil(r/3),u=(1/fn(4,i)).toString()):(i=16,u="2.3283064365386962890625e-10"),n=er(s,1,n.times(u),new s(1),!0);for(var o,c=i,l=new s(8);c--;)o=n.times(n),n=a.minus(o.times(l.minus(o.times(l))));return J(n,s.precision=e,s.rounding=t,!0)},I.hyperbolicSine=I.sinh=function(){var i,u,e,t,r=this,n=r.constructor;if(!r.isFinite()||r.isZero())return new n(r);if(u=n.precision,e=n.rounding,n.precision=u+Math.max(r.e,r.sd())+4,n.rounding=1,t=r.d.length,t<3)r=er(n,2,r,r,!0);else{i=1.4*Math.sqrt(t),i=i>16?16:i|0,r=r.times(1/fn(5,i)),r=er(n,2,r,r,!0);for(var s,a=new n(5),o=new n(16),c=new n(20);i--;)s=r.times(r),r=r.times(a.plus(s.times(o.times(s).plus(c))))}return n.precision=u,n.rounding=e,J(r,u,e,!0)},I.hyperbolicTangent=I.tanh=function(){var i,u,e=this,t=e.constructor;return e.isFinite()?e.isZero()?new t(e):(i=t.precision,u=t.rounding,t.precision=i+7,t.rounding=1,Re(e.sinh(),e.cosh(),t.precision=i,t.rounding=u)):new t(e.s)},I.inverseCosine=I.acos=function(){var i=this,u=i.constructor,e=i.abs().cmp(1),t=u.precision,r=u.rounding;return e!==-1?e===0?i.isNeg()?ot(u,t,r):new u(0):new u(NaN):i.isZero()?ot(u,t+4,r).times(.5):(u.precision=t+6,u.rounding=1,i=new u(1).minus(i).div(i.plus(1)).sqrt().atan(),u.precision=t,u.rounding=r,i.times(2))},I.inverseHyperbolicCosine=I.acosh=function(){var i,u,e=this,t=e.constructor;return e.lte(1)?new t(e.eq(1)?0:NaN):e.isFinite()?(i=t.precision,u=t.rounding,t.precision=i+Math.max(Math.abs(e.e),e.sd())+4,t.rounding=1,ue=!1,e=e.times(e).minus(1).sqrt().plus(e),ue=!0,t.precision=i,t.rounding=u,e.ln()):new t(e)},I.inverseHyperbolicSine=I.asinh=function(){var i,u,e=this,t=e.constructor;return!e.isFinite()||e.isZero()?new t(e):(i=t.precision,u=t.rounding,t.precision=i+2*Math.max(Math.abs(e.e),e.sd())+6,t.rounding=1,ue=!1,e=e.times(e).plus(1).sqrt().plus(e),ue=!0,t.precision=i,t.rounding=u,e.ln())},I.inverseHyperbolicTangent=I.atanh=function(){var i,u,e,t,r=this,n=r.constructor;return r.isFinite()?r.e>=0?new n(r.abs().eq(1)?r.s/0:r.isZero()?r:NaN):(i=n.precision,u=n.rounding,t=r.sd(),Math.max(t,i)<2*-r.e-1?J(new n(r),i,u,!0):(n.precision=e=t-r.e,r=Re(r.plus(1),new n(1).minus(r),e+i,1),n.precision=i+4,n.rounding=1,r=r.ln(),n.precision=i,n.rounding=u,r.times(.5))):new n(NaN)},I.inverseSine=I.asin=function(){var i,u,e,t,r=this,n=r.constructor;return r.isZero()?new n(r):(u=r.abs().cmp(1),e=n.precision,t=n.rounding,u!==-1?u===0?(i=ot(n,e+4,t).times(.5),i.s=r.s,i):new n(NaN):(n.precision=e+6,n.rounding=1,r=r.div(new n(1).minus(r.times(r)).sqrt().plus(1)).atan(),n.precision=e,n.rounding=t,r.times(2)))},I.inverseTangent=I.atan=function(){var i,u,e,t,r,n,s,a,o,c=this,l=c.constructor,f=l.precision,m=l.rounding;if(c.isFinite()){if(c.isZero())return new l(c);if(c.abs().eq(1)&&f+4<=Ds)return s=ot(l,f+4,m).times(.25),s.s=c.s,s}else{if(!c.s)return new l(NaN);if(f+4<=Ds)return s=ot(l,f+4,m).times(.5),s.s=c.s,s}for(l.precision=a=f+10,l.rounding=1,e=Math.min(28,a/re+2|0),i=e;i;--i)c=c.div(c.times(c).plus(1).sqrt().plus(1));for(ue=!1,u=Math.ceil(a/re),t=1,o=c.times(c),s=new l(c),r=c;i!==-1;)if(r=r.times(o),n=s.minus(r.div(t+=2)),r=r.times(o),s=n.plus(r.div(t+=2)),s.d[u]!==void 0)for(i=u;s.d[i]===n.d[i]&&i--;);return e&&(s=s.times(2<<e-1)),ue=!0,J(s,l.precision=f,l.rounding=m,!0)},I.isFinite=function(){return!!this.d},I.isInteger=I.isInt=function(){return!!this.d&&xe(this.e/re)>this.d.length-2},I.isNaN=function(){return!this.s},I.isNegative=I.isNeg=function(){return this.s<0},I.isPositive=I.isPos=function(){return this.s>0},I.isZero=function(){return!!this.d&&this.d[0]===0},I.lessThan=I.lt=function(i){return this.cmp(i)<0},I.lessThanOrEqualTo=I.lte=function(i){return this.cmp(i)<1},I.logarithm=I.log=function(i){var u,e,t,r,n,s,a,o,c=this,l=c.constructor,f=l.precision,m=l.rounding,d=5;if(i==null)i=new l(10),u=!0;else{if(i=new l(i),e=i.d,i.s<0||!e||!e[0]||i.eq(1))return new l(NaN);u=i.eq(10)}if(e=c.d,c.s<0||!e||!e[0]||c.eq(1))return new l(e&&!e[0]?-1/0:c.s!=1?NaN:e?0:1/0);if(u)if(e.length>1)n=!0;else{for(r=e[0];r%10===0;)r/=10;n=r!==1}if(ue=!1,a=f+d,s=Mt(c,a),t=u?cn(l,a+10):Mt(i,a),o=Re(s,t,a,1),Rr(o.d,r=f,m))do if(a+=10,s=Mt(c,a),t=u?cn(l,a+10):Mt(i,a),o=Re(s,t,a,1),!n){+je(o.d).slice(r+1,r+15)+1==1e14&&(o=J(o,f+1,0));break}while(Rr(o.d,r+=10,m));return ue=!0,J(o,f,m)},I.minus=I.sub=function(i){var u,e,t,r,n,s,a,o,c,l,f,m,d=this,C=d.constructor;if(i=new C(i),!d.d||!i.d)return!d.s||!i.s?i=new C(NaN):d.d?i.s=-i.s:i=new C(i.d||d.s!==i.s?d:NaN),i;if(d.s!=i.s)return i.s=-i.s,d.plus(i);if(c=d.d,m=i.d,a=C.precision,o=C.rounding,!c[0]||!m[0]){if(m[0])i.s=-i.s;else if(c[0])i=new C(d);else return new C(o===3?-0:0);return ue?J(i,a,o):i}if(e=xe(i.e/re),l=xe(d.e/re),c=c.slice(),n=l-e,n){for(f=n<0,f?(u=c,n=-n,s=m.length):(u=m,e=l,s=c.length),t=Math.max(Math.ceil(a/re),s)+2,n>t&&(n=t,u.length=1),u.reverse(),t=n;t--;)u.push(0);u.reverse()}else{for(t=c.length,s=m.length,f=t<s,f&&(s=t),t=0;t<s;t++)if(c[t]!=m[t]){f=c[t]<m[t];break}n=0}for(f&&(u=c,c=m,m=u,i.s=-i.s),s=c.length,t=m.length-s;t>0;--t)c[s++]=0;for(t=m.length;t>n;){if(c[--t]<m[t]){for(r=t;r&&c[--r]===0;)c[r]=tt-1;--c[r],c[t]+=tt}c[t]-=m[t]}for(;c[--s]===0;)c.pop();for(;c[0]===0;c.shift())--e;return c[0]?(i.d=c,i.e=un(c,e),ue?J(i,a,o):i):new C(o===3?-0:0)},I.modulo=I.mod=function(i){var u,e=this,t=e.constructor;return i=new t(i),!e.d||!i.s||i.d&&!i.d[0]?new t(NaN):!i.d||e.d&&!e.d[0]?J(new t(e),t.precision,t.rounding):(ue=!1,t.modulo==9?(u=Re(e,i.abs(),0,3,1),u.s*=i.s):u=Re(e,i,0,t.modulo,1),u=u.times(i),ue=!0,e.minus(u))},I.naturalExponential=I.exp=function(){return ws(this)},I.naturalLogarithm=I.ln=function(){return Mt(this)},I.negated=I.neg=function(){var i=new this.constructor(this);return i.s=-i.s,J(i)},I.plus=I.add=function(i){var u,e,t,r,n,s,a,o,c,l,f=this,m=f.constructor;if(i=new m(i),!f.d||!i.d)return!f.s||!i.s?i=new m(NaN):f.d||(i=new m(i.d||f.s===i.s?f:NaN)),i;if(f.s!=i.s)return i.s=-i.s,f.minus(i);if(c=f.d,l=i.d,a=m.precision,o=m.rounding,!c[0]||!l[0])return l[0]||(i=new m(f)),ue?J(i,a,o):i;if(n=xe(f.e/re),t=xe(i.e/re),c=c.slice(),r=n-t,r){for(r<0?(e=c,r=-r,s=l.length):(e=l,t=n,s=c.length),n=Math.ceil(a/re),s=n>s?n+1:s+1,r>s&&(r=s,e.length=1),e.reverse();r--;)e.push(0);e.reverse()}for(s=c.length,r=l.length,s-r<0&&(r=s,e=l,l=c,c=e),u=0;r;)u=(c[--r]=c[r]+l[r]+u)/tt|0,c[r]%=tt;for(u&&(c.unshift(u),++t),s=c.length;c[--s]==0;)c.pop();return i.d=c,i.e=un(c,t),ue?J(i,a,o):i},I.precision=I.sd=function(i){var u,e=this;if(i!==void 0&&i!==!!i&&i!==1&&i!==0)throw Error(Ot+i);return e.d?(u=Ni(e.d),i&&e.e+1>u&&(u=e.e+1)):u=NaN,u},I.round=function(){var i=this,u=i.constructor;return J(new u(i),i.e+1,u.rounding)},I.sine=I.sin=function(){var i,u,e=this,t=e.constructor;return e.isFinite()?e.isZero()?new t(e):(i=t.precision,u=t.rounding,t.precision=i+Math.max(e.e,e.sd())+re,t.rounding=1,e=ll(t,Mi(t,e)),t.precision=i,t.rounding=u,J(At>2?e.neg():e,i,u,!0)):new t(NaN)},I.squareRoot=I.sqrt=function(){var i,u,e,t,r,n,s=this,a=s.d,o=s.e,c=s.s,l=s.constructor;if(c!==1||!a||!a[0])return new l(!c||c<0&&(!a||a[0])?NaN:a?s:1/0);for(ue=!1,c=Math.sqrt(+s),c==0||c==1/0?(u=je(a),(u.length+o)%2==0&&(u+="0"),c=Math.sqrt(u),o=xe((o+1)/2)-(o<0||o%2),c==1/0?u="5e"+o:(u=c.toExponential(),u=u.slice(0,u.indexOf("e")+1)+o),t=new l(u)):t=new l(c.toString()),e=(o=l.precision)+3;;)if(n=t,t=n.plus(Re(s,n,e+2,1)).times(.5),je(n.d).slice(0,e)===(u=je(t.d)).slice(0,e))if(u=u.slice(e-3,e+1),u=="9999"||!r&&u=="4999"){if(!r&&(J(n,o+1,0),n.times(n).eq(s))){t=n;break}e+=4,r=1}else{(!+u||!+u.slice(1)&&u.charAt(0)=="5")&&(J(t,o+1,1),i=!t.times(t).eq(s));break}return ue=!0,J(t,o,l.rounding,i)},I.tangent=I.tan=function(){var i,u,e=this,t=e.constructor;return e.isFinite()?e.isZero()?new t(e):(i=t.precision,u=t.rounding,t.precision=i+10,t.rounding=1,e=e.sin(),e.s=1,e=Re(e,new t(1).minus(e.times(e)).sqrt(),i+10,0),t.precision=i,t.rounding=u,J(At==2||At==4?e.neg():e,i,u,!0)):new t(NaN)},I.times=I.mul=function(i){var u,e,t,r,n,s,a,o,c,l=this,f=l.constructor,m=l.d,d=(i=new f(i)).d;if(i.s*=l.s,!m||!m[0]||!d||!d[0])return new f(!i.s||m&&!m[0]&&!d||d&&!d[0]&&!m?NaN:!m||!d?i.s/0:i.s*0);for(e=xe(l.e/re)+xe(i.e/re),o=m.length,c=d.length,o<c&&(n=m,m=d,d=n,s=o,o=c,c=s),n=[],s=o+c,t=s;t--;)n.push(0);for(t=c;--t>=0;){for(u=0,r=o+t;r>t;)a=n[r]+d[t]*m[r-t-1]+u,n[r--]=a%tt|0,u=a/tt|0;n[r]=(n[r]+u)%tt|0}for(;!n[--s];)n.pop();return u?++e:n.shift(),i.d=n,i.e=un(n,e),ue?J(i,f.precision,f.rounding):i},I.toBinary=function(i,u){return Ls(this,2,i,u)},I.toDecimalPlaces=I.toDP=function(i,u){var e=this,t=e.constructor;return e=new t(e),i===void 0?e:(Fe(i,0,Vt),u===void 0?u=t.rounding:Fe(u,0,8),J(e,i+e.e+1,u))},I.toExponential=function(i,u){var e,t=this,r=t.constructor;return i===void 0?e=it(t,!0):(Fe(i,0,Vt),u===void 0?u=r.rounding:Fe(u,0,8),t=J(new r(t),i+1,u),e=it(t,!0,i+1)),t.isNeg()&&!t.isZero()?"-"+e:e},I.toFixed=function(i,u){var e,t,r=this,n=r.constructor;return i===void 0?e=it(r):(Fe(i,0,Vt),u===void 0?u=n.rounding:Fe(u,0,8),t=J(new n(r),i+r.e+1,u),e=it(t,!1,i+t.e+1)),r.isNeg()&&!r.isZero()?"-"+e:e},I.toFraction=function(i){var u,e,t,r,n,s,a,o,c,l,f,m,d=this,C=d.d,_=d.constructor;if(!C)return new _(d);if(c=e=new _(1),t=o=new _(0),u=new _(t),n=u.e=Ni(C)-d.e-1,s=n%re,u.d[0]=we(10,s<0?re+s:s),i==null)i=n>0?u:c;else{if(a=new _(i),!a.isInt()||a.lt(c))throw Error(Ot+a);i=a.gt(u)?n>0?u:c:a}for(ue=!1,a=new _(je(C)),l=_.precision,_.precision=n=C.length*re*2;f=Re(a,u,0,1,1),r=e.plus(f.times(t)),r.cmp(i)!=1;)e=t,t=r,r=c,c=o.plus(f.times(r)),o=r,r=u,u=a.minus(f.times(r)),a=r;return r=Re(i.minus(e),t,0,1,1),o=o.plus(r.times(c)),e=e.plus(r.times(t)),o.s=c.s=d.s,m=Re(c,t,n,1).minus(d).abs().cmp(Re(o,e,n,1).minus(d).abs())<1?[c,t]:[o,e],_.precision=l,ue=!0,m},I.toHexadecimal=I.toHex=function(i,u){return Ls(this,16,i,u)},I.toNearest=function(i,u){var e=this,t=e.constructor;if(e=new t(e),i==null){if(!e.d)return e;i=new t(1),u=t.rounding}else{if(i=new t(i),u===void 0?u=t.rounding:Fe(u,0,8),!e.d)return i.s?e:i;if(!i.d)return i.s&&(i.s=e.s),i}return i.d[0]?(ue=!1,e=Re(e,i,0,u,1).times(i),ue=!0,J(e)):(i.s=e.s,e=i),e},I.toNumber=function(){return+this},I.toOctal=function(i,u){return Ls(this,8,i,u)},I.toPower=I.pow=function(i){var u,e,t,r,n,s,a=this,o=a.constructor,c=+(i=new o(i));if(!a.d||!i.d||!a.d[0]||!i.d[0])return new o(we(+a,c));if(a=new o(a),a.eq(1))return a;if(t=o.precision,n=o.rounding,i.eq(1))return J(a,t,n);if(u=xe(i.e/re),u>=i.d.length-1&&(e=c<0?-c:c)<=il)return r=pi(o,a,e,t),i.s<0?new o(1).div(r):J(r,t,n);if(s=a.s,s<0){if(u<i.d.length-1)return new o(NaN);if((i.d[u]&1)==0&&(s=1),a.e==0&&a.d[0]==1&&a.d.length==1)return a.s=s,a}return e=we(+a,c),u=e==0||!isFinite(e)?xe(c*(Math.log("0."+je(a.d))/Math.LN10+a.e+1)):new o(e+"").e,u>o.maxE+1||u<o.minE-1?new o(u>0?s/0:0):(ue=!1,o.rounding=a.s=1,e=Math.min(12,(u+"").length),r=ws(i.times(Mt(a,t+e)),t),r.d&&(r=J(r,t+5,1),Rr(r.d,t,n)&&(u=t+10,r=J(ws(i.times(Mt(a,u+e)),u),u+5,1),+je(r.d).slice(t+1,t+15)+1==1e14&&(r=J(r,t+1,0)))),r.s=s,ue=!0,o.rounding=n,J(r,t,n))},I.toPrecision=function(i,u){var e,t=this,r=t.constructor;return i===void 0?e=it(t,t.e<=r.toExpNeg||t.e>=r.toExpPos):(Fe(i,1,Vt),u===void 0?u=r.rounding:Fe(u,0,8),t=J(new r(t),i,u),e=it(t,i<=t.e||t.e<=r.toExpNeg,i)),t.isNeg()&&!t.isZero()?"-"+e:e},I.toSignificantDigits=I.toSD=function(i,u){var e=this,t=e.constructor;return i===void 0?(i=t.precision,u=t.rounding):(Fe(i,1,Vt),u===void 0?u=t.rounding:Fe(u,0,8)),J(new t(e),i,u)},I.toString=function(){var i=this,u=i.constructor,e=it(i,i.e<=u.toExpNeg||i.e>=u.toExpPos);return i.isNeg()&&!i.isZero()?"-"+e:e},I.truncated=I.trunc=function(){return J(new this.constructor(this),this.e+1,1)},I.valueOf=I.toJSON=function(){var i=this,u=i.constructor,e=it(i,i.e<=u.toExpNeg||i.e>=u.toExpPos);return i.isNeg()?"-"+e:e};function je(i){var u,e,t,r=i.length-1,n="",s=i[0];if(r>0){for(n+=s,u=1;u<r;u++)t=i[u]+"",e=re-t.length,e&&(n+=St(e)),n+=t;s=i[u],t=s+"",e=re-t.length,e&&(n+=St(e))}else if(s===0)return"0";for(;s%10===0;)s/=10;return n+s}function Fe(i,u,e){if(i!==~~i||i<u||i>e)throw Error(Ot+i)}function Rr(i,u,e,t){var r,n,s,a;for(n=i[0];n>=10;n/=10)--u;return--u<0?(u+=re,r=0):(r=Math.ceil((u+1)/re),u%=re),n=we(10,re-u),a=i[r]%n|0,t==null?u<3?(u==0?a=a/100|0:u==1&&(a=a/10|0),s=e<4&&a==99999||e>3&&a==49999||a==5e4||a==0):s=(e<4&&a+1==n||e>3&&a+1==n/2)&&(i[r+1]/n/100|0)==we(10,u-2)-1||(a==n/2||a==0)&&(i[r+1]/n/100|0)==0:u<4?(u==0?a=a/1e3|0:u==1?a=a/100|0:u==2&&(a=a/10|0),s=(t||e<4)&&a==9999||!t&&e>3&&a==4999):s=((t||e<4)&&a+1==n||!t&&e>3&&a+1==n/2)&&(i[r+1]/n/1e3|0)==we(10,u-3)-1,s}function on(i,u,e){for(var t,r=[0],n,s=0,a=i.length;s<a;){for(n=r.length;n--;)r[n]*=u;for(r[0]+=Ss.indexOf(i.charAt(s++)),t=0;t<r.length;t++)r[t]>e-1&&(r[t+1]===void 0&&(r[t+1]=0),r[t+1]+=r[t]/e|0,r[t]%=e)}return r.reverse()}function ul(i,u){var e,t,r;if(u.isZero())return u;t=u.d.length,t<32?(e=Math.ceil(t/3),r=(1/fn(4,e)).toString()):(e=16,r="2.3283064365386962890625e-10"),i.precision+=e,u=er(i,1,u.times(r),new i(1));for(var n=e;n--;){var s=u.times(u);u=s.times(s).minus(s).times(8).plus(1)}return i.precision-=e,u}var Re=function(){function i(t,r,n){var s,a=0,o=t.length;for(t=t.slice();o--;)s=t[o]*r+a,t[o]=s%n|0,a=s/n|0;return a&&t.unshift(a),t}function u(t,r,n,s){var a,o;if(n!=s)o=n>s?1:-1;else for(a=o=0;a<n;a++)if(t[a]!=r[a]){o=t[a]>r[a]?1:-1;break}return o}function e(t,r,n,s){for(var a=0;n--;)t[n]-=a,a=t[n]<r[n]?1:0,t[n]=a*s+t[n]-r[n];for(;!t[0]&&t.length>1;)t.shift()}return function(t,r,n,s,a,o){var c,l,f,m,d,C,_,E,b,R,N,V,M,D,L,P,j,F,v,Y,q=t.constructor,se=t.s==r.s?1:-1,te=t.d,Q=r.d;if(!te||!te[0]||!Q||!Q[0])return new q(!t.s||!r.s||(te?Q&&te[0]==Q[0]:!Q)?NaN:te&&te[0]==0||!Q?se*0:se/0);for(o?(d=1,l=t.e-r.e):(o=tt,d=re,l=xe(t.e/d)-xe(r.e/d)),v=Q.length,j=te.length,b=new q(se),R=b.d=[],f=0;Q[f]==(te[f]||0);f++);if(Q[f]>(te[f]||0)&&l--,n==null?(D=n=q.precision,s=q.rounding):a?D=n+(t.e-r.e)+1:D=n,D<0)R.push(1),C=!0;else{if(D=D/d+2|0,f=0,v==1){for(m=0,Q=Q[0],D++;(f<j||m)&&D--;f++)L=m*o+(te[f]||0),R[f]=L/Q|0,m=L%Q|0;C=m||f<j}else{for(m=o/(Q[0]+1)|0,m>1&&(Q=i(Q,m,o),te=i(te,m,o),v=Q.length,j=te.length),P=v,N=te.slice(0,v),V=N.length;V<v;)N[V++]=0;Y=Q.slice(),Y.unshift(0),F=Q[0],Q[1]>=o/2&&++F;do m=0,c=u(Q,N,v,V),c<0?(M=N[0],v!=V&&(M=M*o+(N[1]||0)),m=M/F|0,m>1?(m>=o&&(m=o-1),_=i(Q,m,o),E=_.length,V=N.length,c=u(_,N,E,V),c==1&&(m--,e(_,v<E?Y:Q,E,o))):(m==0&&(c=m=1),_=Q.slice()),E=_.length,E<V&&_.unshift(0),e(N,_,V,o),c==-1&&(V=N.length,c=u(Q,N,v,V),c<1&&(m++,e(N,v<V?Y:Q,V,o))),V=N.length):c===0&&(m++,N=[0]),R[f++]=m,c&&N[0]?N[V++]=te[P]||0:(N=[te[P]],V=1);while((P++<j||N[0]!==void 0)&&D--);C=N[0]!==void 0}R[0]||R.shift()}if(d==1)b.e=l,Ai=C;else{for(f=1,m=R[0];m>=10;m/=10)f++;b.e=f+l*d-1,J(b,a?n+b.e+1:n,s,C)}return b}}();function J(i,u,e,t){var r,n,s,a,o,c,l,f,m,d=i.constructor;e:if(u!=null){if(f=i.d,!f)return i;for(r=1,a=f[0];a>=10;a/=10)r++;if(n=u-r,n<0)n+=re,s=u,l=f[m=0],o=l/we(10,r-s-1)%10|0;else if(m=Math.ceil((n+1)/re),a=f.length,m>=a)if(t){for(;a++<=m;)f.push(0);l=o=0,r=1,n%=re,s=n-re+1}else break e;else{for(l=a=f[m],r=1;a>=10;a/=10)r++;n%=re,s=n-re+r,o=s<0?0:l/we(10,r-s-1)%10|0}if(t=t||u<0||f[m+1]!==void 0||(s<0?l:l%we(10,r-s-1)),c=e<4?(o||t)&&(e==0||e==(i.s<0?3:2)):o>5||o==5&&(e==4||t||e==6&&(n>0?s>0?l/we(10,r-s):0:f[m-1])%10&1||e==(i.s<0?8:7)),u<1||!f[0])return f.length=0,c?(u-=i.e+1,f[0]=we(10,(re-u%re)%re),i.e=-u||0):f[0]=i.e=0,i;if(n==0?(f.length=m,a=1,m--):(f.length=m+1,a=we(10,re-n),f[m]=s>0?(l/we(10,r-s)%we(10,s)|0)*a:0),c)for(;;)if(m==0){for(n=1,s=f[0];s>=10;s/=10)n++;for(s=f[0]+=a,a=1;s>=10;s/=10)a++;n!=a&&(i.e++,f[0]==tt&&(f[0]=1));break}else{if(f[m]+=a,f[m]!=tt)break;f[m--]=0,a=1}for(n=f.length;f[--n]===0;)f.pop()}return ue&&(i.e>d.maxE?(i.d=null,i.e=NaN):i.e<d.minE&&(i.e=0,i.d=[0])),i}function it(i,u,e){if(!i.isFinite())return Si(i);var t,r=i.e,n=je(i.d),s=n.length;return u?(e&&(t=e-s)>0?n=n.charAt(0)+"."+n.slice(1)+St(t):s>1&&(n=n.charAt(0)+"."+n.slice(1)),n=n+(i.e<0?"e":"e+")+i.e):r<0?(n="0."+St(-r-1)+n,e&&(t=e-s)>0&&(n+=St(t))):r>=s?(n+=St(r+1-s),e&&(t=e-r-1)>0&&(n=n+"."+St(t))):((t=r+1)<s&&(n=n.slice(0,t)+"."+n.slice(t)),e&&(t=e-s)>0&&(r+1===s&&(n+="."),n+=St(t))),n}function un(i,u){var e=i[0];for(u*=re;e>=10;e/=10)u++;return u}function cn(i,u,e){if(u>ol)throw ue=!0,e&&(i.precision=e),Error(Ei);return J(new i(nn),u,1,!0)}function ot(i,u,e){if(u>Ds)throw Error(Ei);return J(new i(sn),u,e,!0)}function Ni(i){var u=i.length-1,e=u*re+1;if(u=i[u],u){for(;u%10==0;u/=10)e--;for(u=i[0];u>=10;u/=10)e++}return e}function St(i){for(var u="";i--;)u+="0";return u}function pi(i,u,e,t){var r,n=new i(1),s=Math.ceil(t/re+4);for(ue=!1;;){if(e%2&&(n=n.times(u),Di(n.d,s)&&(r=!0)),e=xe(e/2),e===0){e=n.d.length-1,r&&n.d[e]===0&&++n.d[e];break}u=u.times(u),Di(u.d,s)}return ue=!0,n}function Vi(i){return i.d[i.d.length-1]&1}function Oi(i,u,e){for(var t,r,n=new i(u[0]),s=0;++s<u.length;){if(r=new i(u[s]),!r.s){n=r;break}t=n.cmp(r),(t===e||t===0&&n.s===e)&&(n=r)}return n}function ws(i,u){var e,t,r,n,s,a,o,c=0,l=0,f=0,m=i.constructor,d=m.rounding,C=m.precision;if(!i.d||!i.d[0]||i.e>17)return new m(i.d?i.d[0]?i.s<0?0:1/0:1:i.s?i.s<0?0:i:NaN);for(u==null?(ue=!1,o=C):o=u,a=new m(.03125);i.e>-2;)i=i.times(a),f+=5;for(t=Math.log(we(2,f))/Math.LN10*2+5|0,o+=t,e=n=s=new m(1),m.precision=o;;){if(n=J(n.times(i),o,1),e=e.times(++l),a=s.plus(Re(n,e,o,1)),je(a.d).slice(0,o)===je(s.d).slice(0,o)){for(r=f;r--;)s=J(s.times(s),o,1);if(u==null)if(c<3&&Rr(s.d,o-t,d,c))m.precision=o+=10,e=n=a=new m(1),l=0,c++;else return J(s,m.precision=C,d,ue=!0);else return m.precision=C,s}s=a}}function Mt(i,u){var e,t,r,n,s,a,o,c,l,f,m,d=1,C=10,_=i,E=_.d,b=_.constructor,R=b.rounding,N=b.precision;if(_.s<0||!E||!E[0]||!_.e&&E[0]==1&&E.length==1)return new b(E&&!E[0]?-1/0:_.s!=1?NaN:E?0:_);if(u==null?(ue=!1,l=N):l=u,b.precision=l+=C,e=je(E),t=e.charAt(0),Math.abs(n=_.e)<15e14){for(;t<7&&t!=1||t==1&&e.charAt(1)>3;)_=_.times(i),e=je(_.d),t=e.charAt(0),d++;n=_.e,t>1?(_=new b("0."+e),n++):_=new b(t+"."+e.slice(1))}else return c=cn(b,l+2,N).times(n+""),_=Mt(new b(t+"."+e.slice(1)),l-C).plus(c),b.precision=N,u==null?J(_,N,R,ue=!0):_;for(f=_,o=s=_=Re(_.minus(1),_.plus(1),l,1),m=J(_.times(_),l,1),r=3;;){if(s=J(s.times(m),l,1),c=o.plus(Re(s,new b(r),l,1)),je(c.d).slice(0,l)===je(o.d).slice(0,l))if(o=o.times(2),n!==0&&(o=o.plus(cn(b,l+2,N).times(n+""))),o=Re(o,new b(d),l,1),u==null)if(Rr(o.d,l-C,R,a))b.precision=l+=C,c=s=_=Re(f.minus(1),f.plus(1),l,1),m=J(_.times(_),l,1),r=a=1;else return J(o,b.precision=N,R,ue=!0);else return b.precision=N,o;o=c,r+=2}}function Si(i){return String(i.s*i.s/0)}function ln(i,u){var e,t,r;for((e=u.indexOf("."))>-1&&(u=u.replace(".","")),(t=u.search(/e/i))>0?(e<0&&(e=t),e+=+u.slice(t+1),u=u.substring(0,t)):e<0&&(e=u.length),t=0;u.charCodeAt(t)===48;t++);for(r=u.length;u.charCodeAt(r-1)===48;--r);if(u=u.slice(t,r),u){if(r-=t,i.e=e=e-t-1,i.d=[],t=(e+1)%re,e<0&&(t+=re),t<r){for(t&&i.d.push(+u.slice(0,t)),r-=re;t<r;)i.d.push(+u.slice(t,t+=re));u=u.slice(t),t=re-u.length}else t-=r;for(;t--;)u+="0";i.d.push(+u),ue&&(i.e>i.constructor.maxE?(i.d=null,i.e=NaN):i.e<i.constructor.minE&&(i.e=0,i.d=[0]))}else i.e=0,i.d=[0];return i}function cl(i,u){var e,t,r,n,s,a,o,c,l;if(u.indexOf("_")>-1){if(u=u.replace(/(\d)_(?=\d)/g,"$1"),Ri.test(u))return ln(i,u)}else if(u==="Infinity"||u==="NaN")return+u||(i.s=NaN),i.e=NaN,i.d=null,i;if(sl.test(u))e=16,u=u.toLowerCase();else if(nl.test(u))e=2;else if(al.test(u))e=8;else throw Error(Ot+u);for(n=u.search(/p/i),n>0?(o=+u.slice(n+1),u=u.substring(2,n)):u=u.slice(2),n=u.indexOf("."),s=n>=0,t=i.constructor,s&&(u=u.replace(".",""),a=u.length,n=a-n,r=pi(t,new t(e),n,n*2)),c=on(u,e,tt),l=c.length-1,n=l;c[n]===0;--n)c.pop();return n<0?new t(i.s*0):(i.e=un(c,l),i.d=c,ue=!1,s&&(i=Re(i,r,a*4)),o&&(i=i.times(Math.abs(o)<54?we(2,o):x.pow(2,o))),ue=!0,i)}function ll(i,u){var e,t=u.d.length;if(t<3)return u.isZero()?u:er(i,2,u,u);e=1.4*Math.sqrt(t),e=e>16?16:e|0,u=u.times(1/fn(5,e)),u=er(i,2,u,u);for(var r,n=new i(5),s=new i(16),a=new i(20);e--;)r=u.times(u),u=u.times(n.plus(r.times(s.times(r).minus(a))));return u}function er(i,u,e,t,r){var n,s,a,o,c=i.precision,l=Math.ceil(c/re);for(ue=!1,o=e.times(e),a=new i(t);;){if(s=Re(a.times(o),new i(u++*u++),c,1),a=r?t.plus(s):t.minus(s),t=Re(s.times(o),new i(u++*u++),c,1),s=a.plus(t),s.d[l]!==void 0){for(n=l;s.d[n]===a.d[n]&&n--;);if(n==-1)break}n=a,a=t,t=s,s=n}return ue=!0,s.d.length=l+1,s}function fn(i,u){for(var e=i;--u;)e*=i;return e}function Mi(i,u){var e,t=u.s<0,r=ot(i,i.precision,1),n=r.times(.5);if(u=u.abs(),u.lte(n))return At=t?4:1,u;if(e=u.divToInt(r),e.isZero())At=t?3:2;else{if(u=u.minus(e.times(r)),u.lte(n))return At=Vi(e)?t?2:3:t?4:1,u;At=Vi(e)?t?1:4:t?3:2}return u.minus(r).abs()}function Ls(i,u,e,t){var r,n,s,a,o,c,l,f,m,d=i.constructor,C=e!==void 0;if(C?(Fe(e,1,Vt),t===void 0?t=d.rounding:Fe(t,0,8)):(e=d.precision,t=d.rounding),!i.isFinite())l=Si(i);else{for(l=it(i),s=l.indexOf("."),C?(r=2,u==16?e=e*4-3:u==8&&(e=e*3-2)):r=u,s>=0&&(l=l.replace(".",""),m=new d(1),m.e=l.length-s,m.d=on(it(m),10,r),m.e=m.d.length),f=on(l,10,r),n=o=f.length;f[--o]==0;)f.pop();if(!f[0])l=C?"0p+0":"0";else{if(s<0?n--:(i=new d(i),i.d=f,i.e=n,i=Re(i,m,e,t,0,r),f=i.d,n=i.e,c=Ai),s=f[e],a=r/2,c=c||f[e+1]!==void 0,c=t<4?(s!==void 0||c)&&(t===0||t===(i.s<0?3:2)):s>a||s===a&&(t===4||c||t===6&&f[e-1]&1||t===(i.s<0?8:7)),f.length=e,c)for(;++f[--e]>r-1;)f[e]=0,e||(++n,f.unshift(1));for(o=f.length;!f[o-1];--o);for(s=0,l="";s<o;s++)l+=Ss.charAt(f[s]);if(C){if(o>1)if(u==16||u==8){for(s=u==16?4:3,--o;o%s;o++)l+="0";for(f=on(l,r,u),o=f.length;!f[o-1];--o);for(s=1,l="1.";s<o;s++)l+=Ss.charAt(f[s])}else l=l.charAt(0)+"."+l.slice(1);l=l+(n<0?"p":"p+")+n}else if(n<0){for(;++n;)l="0"+l;l="0."+l}else if(++n>o)for(n-=o;n--;)l+="0";else n<o&&(l=l.slice(0,n)+"."+l.slice(n))}l=(u==16?"0x":u==2?"0b":u==8?"0o":"")+l}return i.s<0?"-"+l:l}function Di(i,u){if(i.length>u)return i.length=u,!0}function fl(i){return new this(i).abs()}function ml(i){return new this(i).acos()}function hl(i){return new this(i).acosh()}function gl(i,u){return new this(i).plus(u)}function dl(i){return new this(i).asin()}function Cl(i){return new this(i).asinh()}function _l(i){return new this(i).atan()}function Al(i){return new this(i).atanh()}function El(i,u){i=new this(i),u=new this(u);var e,t=this.precision,r=this.rounding,n=t+4;return!i.s||!u.s?e=new this(NaN):!i.d&&!u.d?(e=ot(this,n,1).times(u.s>0?.25:.75),e.s=i.s):!u.d||i.isZero()?(e=u.s<0?ot(this,t,r):new this(0),e.s=i.s):!i.d||u.isZero()?(e=ot(this,n,1).times(.5),e.s=i.s):u.s<0?(this.precision=n,this.rounding=1,e=this.atan(Re(i,u,n,1)),u=ot(this,n,1),this.precision=t,this.rounding=r,e=i.s<0?e.minus(u):e.plus(u)):e=this.atan(Re(i,u,n,1)),e}function bl(i){return new this(i).cbrt()}function yl(i){return J(i=new this(i),i.e+1,2)}function Rl(i,u,e){return new this(i).clamp(u,e)}function Nl(i){if(!i||typeof i!="object")throw Error(an+"Object expected");var u,e,t,r=i.defaults===!0,n=["precision",1,Vt,"rounding",0,8,"toExpNeg",-9e15,0,"toExpPos",0,Os,"maxE",0,Os,"minE",-9e15,0,"modulo",0,9];for(u=0;u<n.length;u+=3)if(e=n[u],r&&(this[e]=Ms[e]),(t=i[e])!==void 0)if(xe(t)===t&&t>=n[u+1]&&t<=n[u+2])this[e]=t;else throw Error(Ot+e+": "+t);if(e="crypto",r&&(this[e]=Ms[e]),(t=i[e])!==void 0)if(t===!0||t===!1||t===0||t===1)if(t)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[e]=!0;else throw Error(bi);else this[e]=!1;else throw Error(Ot+e+": "+t);return this}function pl(i){return new this(i).cos()}function Vl(i){return new this(i).cosh()}function wi(i){var u,e,t;function r(n){var s,a,o,c=this;if(!(c instanceof r))return new r(n);if(c.constructor=r,Li(n)){c.s=n.s,ue?!n.d||n.e>r.maxE?(c.e=NaN,c.d=null):n.e<r.minE?(c.e=0,c.d=[0]):(c.e=n.e,c.d=n.d.slice()):(c.e=n.e,c.d=n.d?n.d.slice():n.d);return}if(o=typeof n,o==="number"){if(n===0){c.s=1/n<0?-1:1,c.e=0,c.d=[0];return}if(n<0?(n=-n,c.s=-1):c.s=1,n===~~n&&n<1e7){for(s=0,a=n;a>=10;a/=10)s++;ue?s>r.maxE?(c.e=NaN,c.d=null):s<r.minE?(c.e=0,c.d=[0]):(c.e=s,c.d=[n]):(c.e=s,c.d=[n]);return}if(n*0!==0){n||(c.s=NaN),c.e=NaN,c.d=null;return}return ln(c,n.toString())}if(o==="string")return(a=n.charCodeAt(0))===45?(n=n.slice(1),c.s=-1):(a===43&&(n=n.slice(1)),c.s=1),Ri.test(n)?ln(c,n):cl(c,n);if(o==="bigint")return n<0?(n=-n,c.s=-1):c.s=1,ln(c,n.toString());throw Error(Ot+n)}if(r.prototype=I,r.ROUND_UP=0,r.ROUND_DOWN=1,r.ROUND_CEIL=2,r.ROUND_FLOOR=3,r.ROUND_HALF_UP=4,r.ROUND_HALF_DOWN=5,r.ROUND_HALF_EVEN=6,r.ROUND_HALF_CEIL=7,r.ROUND_HALF_FLOOR=8,r.EUCLID=9,r.config=r.set=Nl,r.clone=wi,r.isDecimal=Li,r.abs=fl,r.acos=ml,r.acosh=hl,r.add=gl,r.asin=dl,r.asinh=Cl,r.atan=_l,r.atanh=Al,r.atan2=El,r.cbrt=bl,r.ceil=yl,r.clamp=Rl,r.cos=pl,r.cosh=Vl,r.div=Ol,r.exp=Sl,r.floor=Ml,r.hypot=Dl,r.ln=wl,r.log=Ll,r.log10=jl,r.log2=Pl,r.max=xl,r.min=Ul,r.mod=vl,r.mul=Tl,r.pow=Bl,r.random=Fl,r.round=Il,r.sign=kl,r.sin=$l,r.sinh=Yl,r.sqrt=Hl,r.sub=Gl,r.sum=Wl,r.tan=Ql,r.tanh=ql,r.trunc=Kl,i===void 0&&(i={}),i&&i.defaults!==!0)for(t=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],u=0;u<t.length;)i.hasOwnProperty(e=t[u++])||(i[e]=this[e]);return r.config(i),r}function Ol(i,u){return new this(i).div(u)}function Sl(i){return new this(i).exp()}function Ml(i){return J(i=new this(i),i.e+1,3)}function Dl(){var i,u,e=new this(0);for(ue=!1,i=0;i<arguments.length;)if(u=new this(arguments[i++]),u.d)e.d&&(e=e.plus(u.times(u)));else{if(u.s)return ue=!0,new this(1/0);e=u}return ue=!0,e.sqrt()}function Li(i){return i instanceof x||i&&i.toStringTag===yi||!1}function wl(i){return new this(i).ln()}function Ll(i,u){return new this(i).log(u)}function Pl(i){return new this(i).log(2)}function jl(i){return new this(i).log(10)}function xl(){return Oi(this,arguments,-1)}function Ul(){return Oi(this,arguments,1)}function vl(i,u){return new this(i).mod(u)}function Tl(i,u){return new this(i).mul(u)}function Bl(i,u){return new this(i).pow(u)}function Fl(i){var u,e,t,r,n=0,s=new this(1),a=[];if(i===void 0?i=this.precision:Fe(i,1,Vt),t=Math.ceil(i/re),this.crypto)if(crypto.getRandomValues)for(u=crypto.getRandomValues(new Uint32Array(t));n<t;)r=u[n],r>=429e7?u[n]=crypto.getRandomValues(new Uint32Array(1))[0]:a[n++]=r%1e7;else if(crypto.randomBytes){for(u=crypto.randomBytes(t*=4);n<t;)r=u[n]+(u[n+1]<<8)+(u[n+2]<<16)+((u[n+3]&127)<<24),r>=214e7?crypto.randomBytes(4).copy(u,n):(a.push(r%1e7),n+=4);n=t/4}else throw Error(bi);else for(;n<t;)a[n++]=Math.random()*1e7|0;for(t=a[--n],i%=re,t&&i&&(r=we(10,re-i),a[n]=(t/r|0)*r);a[n]===0;n--)a.pop();if(n<0)e=0,a=[0];else{for(e=-1;a[0]===0;e-=re)a.shift();for(t=1,r=a[0];r>=10;r/=10)t++;t<re&&(e-=re-t)}return s.e=e,s.d=a,s}function Il(i){return J(i=new this(i),i.e+1,this.rounding)}function kl(i){return i=new this(i),i.d?i.d[0]?i.s:0*i.s:i.s||NaN}function $l(i){return new this(i).sin()}function Yl(i){return new this(i).sinh()}function Hl(i){return new this(i).sqrt()}function Gl(i,u){return new this(i).sub(u)}function Wl(){var i=0,u=arguments,e=new this(u[i]);for(ue=!1;e.s&&++i<u.length;)e=e.plus(u[i]);return ue=!0,J(e,this.precision,this.rounding)}function Ql(i){return new this(i).tan()}function ql(i){return new this(i).tanh()}function Kl(i){return J(i=new this(i),i.e+1,1)}I[Symbol.for("nodejs.util.inspect.custom")]=I.toString,I[Symbol.toStringTag]="Decimal";var x=I.constructor=wi(Ms);nn=new x(nn),sn=new x(sn);function Xl(i,u){const e=i+u;return Number.isSafeInteger(e)?e:new x(i).add(u).toNumber()}function Zl(i,u){const e=i-u;return Number.isSafeInteger(e)?e:new x(i).sub(u).toNumber()}function tr(i,u){const e=i*u;return Number.isSafeInteger(e)?e:new x(i).mul(u).toNumber()}function zl(i,u){const e=i/u;return Number.isSafeInteger(e)?e:new x(i).div(u).toNumber()}function Dt(i,u){const e=10**Math.trunc(u),t=mn(i,e);return Math.round(tr(i,e)+t)/e}function Ge(i,u){const e=10**Math.trunc(u),t=mn(i,e);return Math.floor(tr(i,e)+t)/e}function Ie(i,u){const e=10**Math.trunc(u),t=mn(i,e);return Math.ceil(tr(i,e)-t)/e}function mn(i,u){return Number.EPSILON*Math.max(1,Math.abs(tr(i,u)))}function Pi(i,u){return i-u*Math.floor(i/u)}function Jl(i,u){return i**u}function ef(i){return Math.sqrt(i)}function ji(i,u){return i===u}function tf(i,u){return i>u}function rf(i,u){return i>=u}function nf(i,u){return i<u}function sf(i,u){return i<=u}function Ps(i,u=15){return Number.parseFloat(i.toPrecision(u))}function af(i,u,e=Number.EPSILON){return Math.abs(i-u)<e}function xi(i,u=12,e=1e-10){const t=Ps(i,u);return af(i,t,e)?t:Ps(i)}function of(i){return i-Math.trunc(i)}const Zn=class Zn extends _t{static create(){return this._instance=this._instance||new Zn(0),this._instance}isNull(){return!0}plus(u){return y.create(0).plus(u)}minus(u){return y.create(0).minus(u)}multiply(u){return y.create(0).multiply(u)}divided(u){return y.create(0).divided(u)}mod(u){return y.create(0).mod(u)}compare(u,e){return u.isString()?U.create("").compare(u,e):u.isBoolean()?T.create(!1).compare(u,e):y.create(0).compare(u,e)}concatenateFront(u){return u.isArray()?u.concatenateBack(U.create("")):U.create(this.concatenate(u.getValue(),et.FRONT))}concatenateBack(u){return u.isArray()?u.concatenateFront(U.create("")):U.create(this.concatenate(u.getValue(),et.BACK))}plusBy(u){return y.create(0).plusBy(u)}minusBy(u){return y.create(0).minusBy(u)}multiplyBy(u){return y.create(0).multiplyBy(u)}dividedBy(u){return y.create(0).dividedBy(u)}compareBy(u,e){return typeof u=="string"?U.create("").compareBy(u,e):typeof u=="boolean"?T.create(!1).compareBy(u,e):y.create(0).compareBy(u,e)}pow(u){return y.create(0).pow(u)}sqrt(){return y.create(0).sqrt()}cbrt(){return y.create(0).cbrt()}cos(){return y.create(0).cos()}cosh(){return y.create(0).cosh()}acos(){return y.create(0).acos()}acosh(){return y.create(0).acosh()}sin(){return y.create(0).sin()}sinh(){return y.create(0).sinh()}asin(){return y.create(0).asin()}asinh(){return y.create(0).asinh()}tan(){return y.create(0).tan()}tanh(){return y.create(0).tanh()}atan(){return y.create(0).atan()}atan2(u){return y.create(0).atan2(u)}atanh(){return y.create(0).atanh()}log(){return g.create(h.NUM)}log10(){return g.create(h.NUM)}exp(){return y.create(0).exp()}abs(){return y.create(0).abs()}round(u){return y.create(0).round(u)}floor(u){return y.create(0).floor(u)}ceil(u){return y.create(0).ceil(u)}convertToNumberObjectValue(){return y.create(0)}convertToBooleanObjectValue(){return T.create(!1)}};A(Zn,"_instance");let oe=Zn;const Zt=class Zt extends _t{constructor(e){super(e);A(this,"_value",!1);this._value=e}static create(e){return e?(this._instanceTrue=this._instanceTrue||new Zt(!0),this._instanceTrue):(this._instanceFalse=this._instanceFalse||new Zt(!1),this._instanceFalse)}getValue(){return this._value}isBoolean(){return!0}getNegative(){const e=this.getValue();let t=0;return e&&(t=1),y.create(-t)}getReciprocal(){return this.getValue()?y.create(1):g.create(h.DIV_BY_ZERO)}plus(e){return this._convertToNumber().plus(e)}minus(e){return this._convertToNumber().minus(e)}multiply(e){return this._convertToNumber().multiply(e)}divided(e){return this._convertToNumber().divided(e)}mod(e){return this._convertToNumber().mod(e)}compare(e,t){return e.isArray()?e.compare(this,Vs(t)):e.isNull()?this._convertToNumber().compare(e,t):this.compareBy(e.getValue(),t)}compareBy(e,t){let r=!1;if(typeof e=="string"||typeof e=="number")r=this._compareString(t);else if(typeof e=="boolean"){const n=y.create(e?1:0);return this._convertToNumber().compare(n,t)}return Zt.create(r)}_compareString(e){switch(e){case H.GREATER_THAN:case H.GREATER_THAN_OR_EQUAL:return!0;case H.EQUALS:case H.LESS_THAN:case H.LESS_THAN_OR_EQUAL:case H.NOT_EQUAL:return!1}}concatenateFront(e){return this._convertToNumber().concatenateFront(e)}concatenateBack(e){return this._convertToNumber().concatenateBack(e)}_convertToNumber(){const e=this.getValue();let t=0;return e&&(t=1),y.create(t)}pow(e){return this._convertToNumber().pow(e)}sqrt(){return this._convertToNumber().sqrt()}cbrt(){return this._convertToNumber().cbrt()}cos(){return this._convertToNumber().cos()}cosh(){return this._convertToNumber().cosh()}acos(){return this._convertToNumber().acos()}acosh(){return this._convertToNumber().acosh()}sin(){return this._convertToNumber().sin()}sinh(){return this._convertToNumber().sinh()}asin(){return this._convertToNumber().asin()}asinh(){return this._convertToNumber().asinh()}tan(){return this._convertToNumber().tan()}tanh(){return this._convertToNumber().tanh()}atan(){return this._convertToNumber().atan()}atan2(e){return this._convertToNumber().atan2(e)}atanh(){return this._convertToNumber().atanh()}log(){return this._convertToNumber().log()}log10(){return this._convertToNumber().log10()}exp(){return this._convertToNumber().exp()}abs(){return this._convertToNumber().abs()}round(e){return this._convertToNumber().round(e)}floor(e){return this._convertToNumber().floor(e)}ceil(e){return this._convertToNumber().ceil(e)}convertToNumberObjectValue(){return gn(this.getValue())}convertToBooleanObjectValue(){return this}};A(Zt,"_instanceTrue"),A(Zt,"_instanceFalse");let T=Zt;class y extends _t{constructor(e){super(e);A(this,"_value",0);this._value=Number(e)}static create(e,t=""){const r=new y(e);return t&&r.setPattern(t),r}getValue(){return this._value}setValue(e){this._value=e}isNumber(){return!0}getNegative(){return y.create(0).minus(this)}getReciprocal(){return y.create(1).divided(this)}plus(e){if(e.isArray())return e.plus(this);let t=this.plusBy(e.getValue());if(t.isError())return t;const r=en(this.getPattern(),e.getPattern(),Z.PLUS);return t=y.create(Number(t.getValue()),r),t}equalZero(){return this._value===0}minus(e){if(e.isArray()){const n=e.getNegative();return n.isError()?n:n.plus(this)}let t=this.minusBy(e.getValue());if(t.isError())return t;const r=en(this.getPattern(),e.getPattern(),Z.MINUS);return t=y.create(Number(t.getValue()),r),t}multiply(e){if(e.isArray())return e.multiply(this);let t=this.multiplyBy(e.getValue());if(t.isError())return t;const r=en(this.getPattern(),e.getPattern(),Z.MULTIPLY);return t=y.create(Number(t.getValue()),r),t}divided(e){if(e.isArray()){const n=e.getReciprocal();return n.isError()?n:n.multiply(this)}let t=this.dividedBy(e.getValue());if(t.isError())return t;const r=en(this.getPattern(),e.getPattern(),Z.DIVIDED);return t=y.create(Number(t.getValue()),r),t}mod(e){if(e.isArray())return e.modInverse(this);const t=this.getValue(),r=e.getValue();if(e.isNull())return g.create(h.DIV_BY_ZERO);if(typeof r=="string")return g.create(h.VALUE);if(typeof r=="number"){if(r===0)return g.create(h.DIV_BY_ZERO);if(!Number.isFinite(t)||!Number.isFinite(r)||Math.abs(r)*11259e8<=Math.abs(t))return g.create(h.NUM);const n=Pi(t,r);return Number.isFinite(n)?y.create(n):g.create(h.NUM)}if(typeof r=="boolean"){const n=r?1:0;return n===0?g.create(h.DIV_BY_ZERO):y.create(Pi(t,n))}return this}concatenateFront(e){return e.isArray()?e.concatenateBack(this):U.create(this.concatenate(e.getValue(),et.FRONT))}concatenateBack(e){return e.isArray()?e.concatenateFront(this):U.create(this.concatenate(e.getValue(),et.BACK))}compare(e,t){return e.isArray()?e.compare(this,Vs(t)):this.compareBy(e.getValue(),t)}plusBy(e){if(typeof e=="string"&&e.trim()==="")return g.create(h.VALUE);const t=+this.getValue(),r=+e;if(Number.isNaN(t)||Number.isNaN(r))return g.create(h.VALUE);if(!Number.isFinite(t)||!Number.isFinite(r))return g.create(h.NUM);const n=Xl(t,r);return Number.isFinite(n)?y.create(n):g.create(h.NUM)}minusBy(e){if(typeof e=="string"&&e.trim()==="")return g.create(h.VALUE);const t=+this.getValue(),r=+e;if(Number.isNaN(t)||Number.isNaN(r))return g.create(h.VALUE);if(!Number.isFinite(t)||!Number.isFinite(r))return g.create(h.NUM);const n=Zl(t,r);return Number.isFinite(n)?y.create(n):g.create(h.NUM)}multiplyBy(e){if(typeof e=="string"&&e.trim()==="")return g.create(h.VALUE);const t=+this.getValue(),r=+e;if(Number.isNaN(t)||Number.isNaN(r))return g.create(h.VALUE);if(!Number.isFinite(t)||!Number.isFinite(r))return g.create(h.NUM);const n=tr(t,r);return Number.isFinite(n)?y.create(n):g.create(h.NUM)}dividedBy(e){if(typeof e=="string"&&e.trim()==="")return g.create(h.VALUE);const t=+this.getValue(),r=+e;if(Number.isNaN(t)||Number.isNaN(r))return g.create(h.VALUE);if(!Number.isFinite(t)||!Number.isFinite(r))return g.create(h.NUM);if(r===0)return g.create(h.DIV_BY_ZERO);const n=zl(t,r);return Number.isFinite(n)?y.create(n):g.create(h.NUM)}compareBy(e,t){const r=this.getValue();let n=!1;return typeof e=="string"?n=this._compareString(t):typeof e=="number"?n=this._compareNumber(r,e,t):typeof e=="boolean"&&(n=this._compareBoolean(t)),T.create(n)}_compareString(e){switch(e){case H.EQUALS:case H.GREATER_THAN:case H.GREATER_THAN_OR_EQUAL:return!1;case H.LESS_THAN:case H.LESS_THAN_OR_EQUAL:case H.NOT_EQUAL:return!0}}_compareNumber(e,t,r){return!Number.isFinite(e)||!Number.isFinite(t)?this._compareInfinity(e,t,r):this._compareFiniteNumber(e,t,r)}_compareFiniteNumber(e,t,r){switch(r){case H.EQUALS:return ji(e,t);case H.GREATER_THAN:return tf(e,t);case H.GREATER_THAN_OR_EQUAL:return rf(e,t);case H.LESS_THAN:return nf(e,t);case H.LESS_THAN_OR_EQUAL:return sf(e,t);case H.NOT_EQUAL:return!ji(e,t)}}_compareBoolean(e){switch(e){case H.EQUALS:case H.GREATER_THAN:case H.GREATER_THAN_OR_EQUAL:return!1;case H.LESS_THAN:case H.LESS_THAN_OR_EQUAL:case H.NOT_EQUAL:return!0}}pow(e){if(e.isArray())return e.powInverse(this);if(this.isError())return this;const t=this.getValue();let r=e;if(e.isString()&&(r=e.convertToNumberObjectValue()),r.isError())return r;const n=+r.getValue();if(Number.isNaN(n))return g.create(h.VALUE);if(!Number.isFinite(t)||!Number.isFinite(n))return g.create(h.NUM);if(t===0)return n<0?g.create(h.DIV_BY_ZERO):n===0?g.create(h.NUM):y.create(0);const s=Jl(t,n);return Number.isFinite(s)?y.create(s):g.create(h.NUM)}sqrt(){const e=this.getValue();if(!Number.isFinite(e))return g.create(h.NUM);const t=ef(e);return Number.isFinite(t)?y.create(t):g.create(h.NUM)}cbrt(){const e=this.getValue();if(!Number.isFinite(e))return g.create(h.NUM);const t=Math.cbrt(e);return Number.isFinite(t)?y.create(t):g.create(h.NUM)}cos(){const e=this.getValue();if(!Number.isFinite(e))return g.create(h.NUM);const t=Math.cos(e);return Number.isFinite(t)?y.create(t):g.create(h.NUM)}cosh(){const e=this.getValue();if(!Number.isFinite(e))return g.create(h.NUM);const t=Math.cosh(e);return Number.isFinite(t)?y.create(t):g.create(h.NUM)}acos(){const e=this.getValue();if(!Number.isFinite(e))return g.create(h.NUM);const t=Math.acos(e);return Number.isNaN(t)?g.create(h.NUM):y.create(t)}acosh(){const e=this.getValue();if(!Number.isFinite(e))return g.create(h.NUM);const t=Math.acosh(e);return Number.isNaN(t)?g.create(h.NUM):y.create(t)}sin(){const e=this.getValue();if(!Number.isFinite(e))return g.create(h.NUM);const t=Math.sin(e);return Number.isFinite(t)?y.create(t):g.create(h.NUM)}sinh(){const e=this.getValue();if(!Number.isFinite(e))return g.create(h.NUM);const t=Math.sinh(e);return Number.isFinite(t)?y.create(t):g.create(h.NUM)}asin(){const e=this.getValue();if(!Number.isFinite(e))return g.create(h.NUM);const t=Math.asin(e);return Number.isNaN(t)?g.create(h.NUM):y.create(t)}asinh(){const e=this.getValue();if(!Number.isFinite(e))return g.create(h.NUM);const t=Math.asinh(e);return Number.isNaN(t)?g.create(h.NUM):y.create(t)}tan(){const e=this.getValue();if(!Number.isFinite(e))return g.create(h.NUM);const t=Math.tan(e);return Number.isFinite(t)?y.create(t):g.create(h.NUM)}tanh(){const e=this.getValue();if(!Number.isFinite(e))return g.create(h.NUM);const t=Math.tanh(e);return Number.isFinite(t)?y.create(t):g.create(h.NUM)}atan(){const e=this.getValue();if(!Number.isFinite(e))return g.create(h.NUM);const t=Math.atan(e);return Number.isFinite(t)?y.create(t):g.create(h.NUM)}atan2(e){if(e.isArray())return e.atan2Inverse(this);const t=this.getValue(),r=e.getValue();if(typeof r=="string")return g.create(h.VALUE);if(typeof r=="number"){if(!Number.isFinite(t)||!Number.isFinite(r))return g.create(h.NUM);if(t===0&&r===0)return g.create(h.DIV_BY_ZERO);const n=Math.atan2(t,r);return Number.isFinite(n)?y.create(n):g.create(h.NUM)}return typeof r=="boolean"?y.create(Math.atan2(t,r?1:0)):this}atanh(){const e=this.getValue();if(!Number.isFinite(e))return g.create(h.NUM);const t=Math.atanh(e);return Number.isFinite(t)?y.create(t):g.create(h.NUM)}log(){const e=this.getValue();if(typeof e=="number"&&e<=0||!Number.isFinite(e))return g.create(h.NUM);const t=Math.log(e);return Number.isFinite(t)?y.create(t):g.create(h.NUM)}log10(){const e=this.getValue();if(typeof e=="number"&&e<=0||!Number.isFinite(e))return g.create(h.NUM);const t=Math.log10(e);return Number.isFinite(t)?y.create(t):g.create(h.NUM)}exp(){const e=this.getValue();if(!Number.isFinite(e))return g.create(h.NUM);const t=Math.exp(e);return Number.isFinite(t)?y.create(t):g.create(h.NUM)}abs(){const e=this.getValue();if(!Number.isFinite(e))return g.create(h.NUM);const t=Math.abs(e);return Number.isFinite(t)?y.create(t):g.create(h.NUM)}round(e){if(e.isArray())return e.roundInverse(this);const t=this.getValue(),r=e.getValue();if(typeof r=="string")return g.create(h.VALUE);if(typeof r=="number"){if(!Number.isFinite(t)||!Number.isFinite(r))return g.create(h.NUM);const n=t<0?-Dt(Math.abs(t),r):Dt(t,r);return Number.isFinite(n)?y.create(n):g.create(h.NUM)}return typeof r=="boolean"?y.create(Dt(t,r?1:0)):this}floor(e){if(e.isArray())return e.floorInverse(this);const t=this.getValue(),r=e.getValue();if(typeof r=="string")return g.create(h.VALUE);if(typeof r=="number"){if(!Number.isFinite(t)||!Number.isFinite(r))return g.create(h.NUM);const n=t<0?-Ge(Math.abs(t),r):Ge(t,r);return Number.isFinite(n)?y.create(n):g.create(h.NUM)}return typeof r=="boolean"?y.create(Ge(t,r?1:0)):this}ceil(e){if(e.isArray())return e.ceilInverse(this);const t=this.getValue(),r=e.getValue();if(typeof r=="string")return g.create(h.VALUE);if(typeof r=="number"){if(!Number.isFinite(t)||!Number.isFinite(r))return g.create(h.NUM);const n=t<0?-Ie(Math.abs(t),r):Ie(t,r);return Number.isFinite(n)?y.create(n):g.create(h.NUM)}return typeof r=="boolean"?y.create(Ie(t,r?1:0)):this}convertToNumberObjectValue(){return this}convertToBooleanObjectValue(){return hn(!0)}_compareInfinity(e,t,r){let n=!1;switch(r){case H.EQUALS:n=e===t;break;case H.GREATER_THAN:n=e>t;break;case H.GREATER_THAN_OR_EQUAL:n=e>=t;break;case H.LESS_THAN:n=e<t;break;case H.LESS_THAN_OR_EQUAL:n=e<=t;break;case H.NOT_EQUAL:n=e!==t;break}return n}}const uf=1e5,js=new dt(uf);class U extends _t{constructor(e){super(e);A(this,"_value");this._value=e}static create(e){const t=js.get(e);if(t)return t;const r=new U(e);return js.set(e,r),r}getValue(){return this._value}isString(){return!0}concatenateFront(e){return e.isArray()?e.concatenateBack(this):U.create(this.concatenate(e.getValue(),et.FRONT))}concatenateBack(e){return e.isArray()?e.concatenateFront(this):U.create(this.concatenate(e.getValue(),et.BACK))}plus(e){return this.convertToNumberObjectValue().plus(e)}minus(e){return this.convertToNumberObjectValue().minus(e)}multiply(e){return this.convertToNumberObjectValue().multiply(e)}divided(e){return this.convertToNumberObjectValue().divided(e)}compare(e,t,r){return e.isArray()?e.compare(this,Vs(t),r):this.compareBy(e.getValue(),t,r)}compareBy(e,t,r=!1){let n=this.getValue(),s=!1;if(typeof e=="string"){let a=e;if(r||(n=n.toLocaleLowerCase(),a=a.toLocaleLowerCase()),el(a))return this._checkWildcard(a,t);s=this._compareString(n,a,t)}else typeof e=="number"?s=this._compareNumber(t):typeof e=="boolean"&&(s=this._compareBoolean(t));return T.create(s)}_compareString(e,t,r){switch(r){case H.EQUALS:return e===t;case H.GREATER_THAN:return e>t;case H.GREATER_THAN_OR_EQUAL:return e>=t;case H.LESS_THAN:return e<t;case H.LESS_THAN_OR_EQUAL:return e<=t;case H.NOT_EQUAL:return e!==t}}_compareNumber(e){switch(e){case H.NOT_EQUAL:case H.GREATER_THAN:case H.GREATER_THAN_OR_EQUAL:return!0;case H.EQUALS:case H.LESS_THAN:case H.LESS_THAN_OR_EQUAL:return!1}}_compareBoolean(e){switch(e){case H.EQUALS:case H.GREATER_THAN:case H.GREATER_THAN_OR_EQUAL:return!1;case H.LESS_THAN:case H.LESS_THAN_OR_EQUAL:case H.NOT_EQUAL:return!0}}convertToNumberObjectValue(){return gn(this.getValue())}convertToBooleanObjectValue(){return T.create(!0)}_checkWildcard(e,t){const r=this.getValue().toLocaleLowerCase(),n=tl(r,e,t);return T.create(n)}}function hn(i){if(typeof i=="boolean")return T.create(i);let u=!1;if(typeof i=="string"){const e=i.toLocaleUpperCase();e===bt.TRUE?u=!0:e===bt.FALSE&&(u=!1)}else i===1?u=!0:u=!1;return T.create(u)}function cf(i){let u=i.toString();return u.charAt(0)==='"'&&u.charAt(u.length-1)==='"'&&(u=u.slice(1,-1),u=u.replace(/""/g,'"')),U.create(u)}function gn(i,u=""){if(typeof i=="boolean"){let e=0;return i&&(e=1),y.create(e,u)}else{if(typeof i=="number")return Number.isFinite(i)?y.create(i,u):g.create(h.NUM);if(S.isRealNum(i))return y.create(Number(i),u)}return g.create(h.VALUE)}function lf(i){return""}function Ui(i=[]){const u=[];for(let e=0;e<i.length;e++){const t=i[e];u[e]==null&&(u[e]=[]);for(let r=0;r<t.length;r++){const n=t[r];u[e][r]=ut.create(n)}}return u}function ff(i=[]){const u=[];for(let e=0;e<i.length;e++){const t=i[e];u[e]==null&&(u[e]=[]);for(let r=0;r<t.length;r++){const n=t[r];n==null?u[e][r]=null:n.isError()?u[e][r]=n.getErrorType():u[e][r]=n.getValue()}}return u}class K extends _t{constructor(e){super(typeof e=="string"?e:lf());A(this,"_values",[]);A(this,"_rowCount",-1);A(this,"_columnCount",-1);A(this,"_unitId","");A(this,"_sheetId","");A(this,"_currentRow",-1);A(this,"_currentColumn",-1);A(this,"_sliceCache",new Map);A(this,"_flattenCache");A(this,"_defaultValue",null);A(this,"_flattenPosition");this._values=this._formatValue(e)}static create(e){return new K(e)}static createByArray(e){const r={calculateValueList:Ui(e),rowCount:e.length,columnCount:e[0].length||0,unitId:"",sheetId:"",row:-1,column:-1};return new K(r)}dispose(){this._values=[],this._defaultValue=null,this._flattenPosition=null,this._clearCache()}clone(){return this.map(e=>e)}getRowCount(){return this._rowCount}setRowCount(e){this._rowCount=e}getColumnCount(){return this._columnCount}setColumnCount(e){this._columnCount=e}setCurrent(e,t){this._currentRow=e,this._currentColumn=t}setUnitId(e){this._unitId=e}getUnitId(){return this._unitId}setSheetId(e){this._sheetId=e}getSheetId(){return this._sheetId}getCurrentRow(){return this._currentRow}getCurrentColumn(){return this._currentColumn}getArrayValue(){return this._values}setArrayValue(e){this._clearCache(),this._values=e}isArray(){return!0}setDefaultValue(e){this._defaultValue=e}get(e,t){var r;return((r=this._values[e])==null?void 0:r[t])||this._defaultValue}getRealValue(e,t){const r=this._values[e];if(r==null)return null;const n=r[t];return n==null?null:n}getValueOrDefault(e,t){return this.get(e,t)||this._defaultValue}set(e,t,r){if(e>=this._rowCount||t>=this._columnCount)throw new Error("Exceeding array bounds.");this._clearCache(),this._values[e][t]=r}getRangePosition(){const t=this.getRowCount(),r=0,n=this.getColumnCount();return{startRow:0,endRow:t-1,startColumn:r,endColumn:n-1}}iterator(e){var o;const{startRow:t,endRow:r,startColumn:n,endColumn:s}=this.getRangePosition(),a=this.getArrayValue();for(let c=t;c<=r;c++)for(let l=n;l<=s;l++)if(e(((o=a[c])==null?void 0:o[l])||this._defaultValue,c,l)===!1)return}iteratorReverse(e){var o;const{startRow:t,endRow:r,startColumn:n,endColumn:s}=this.getRangePosition(),a=this.getArrayValue();for(let c=r;c>=t;c--)for(let l=s;l>=n;l--)if(e(((o=a[c])==null?void 0:o[l])||this._defaultValue,c,l)===!1)return}getLastTruePosition(){let e;return this.iteratorReverse((t,r,n)=>{if(t!=null&&t.isBoolean()&&t.getValue()===!0)return e={row:r,column:n},!1}),e}getFirstTruePosition(){let e;return this.iterator((t,r,n)=>{if(t!=null&&t.isBoolean()&&t.getValue()===!0)return e={row:r,column:n},!1}),e}getFirstCell(){const{startRow:e,startColumn:t}=this.getRangePosition();return this.get(e,t)||this._defaultValue||oe.create()}getLastCell(){const{endRow:e,endColumn:t}=this.getRangePosition();return this.get(e,t)||this._defaultValue||oe.create()}pick(e){const t=this.pickRaw(e);return this._createNewArray(t,1,t[0].length)}pickRaw(e){const t=e.getRowCount(),r=e.getColumnCount();if(t!==this._rowCount||r!==this._columnCount)return[[oe.create()]];const n=[];n[0]=[];for(let s=0;s<t;s++)for(let a=0;a<r;a++){const o=e.get(s,a);if(!(o==null||o.isError())&&o.getValue()===!0){const c=this.get(s,a);n[0].push(c)}}return n}flatten(){if(this._flattenCache!=null)return this._flattenCache;const e=[];e[0]=[];for(let r=0;r<this._rowCount;r++)for(let n=0;n<this._columnCount;n++){const s=this.get(r,n);e[0].push(s)}const t=this._createNewArray(e,1,e[0].length);return t.setDefaultValue(this._defaultValue),this._flattenCache=t,t}flattenPosition(){if(this._flattenPosition!=null)return this._flattenPosition;const e=[],t=[],r=[],n=[];let s=0;for(let o=0;o<this._rowCount;o++)for(let c=0;c<this._columnCount;c++){const l=this.get(o,c);if(l==null||l.isError()||l.isNull()){s++;continue}l.isString()?(e.push(l),r.push(s++)):(t.push(l),n.push(s++))}const a={stringArray:e,numberArray:t,stringPosition:r,numberPosition:n};return this._flattenPosition=a,a}slice(e,t){let r=0,n=this._rowCount,s=1,a=0,o=this._columnCount,c=1;if(e!=null&&(r=e[0]||0,n=e[1]||this._rowCount,s=e[2]||1),t!=null&&(a=t[0]||0,o=t[1]||this._columnCount,c=t[2]||1),r>=this._rowCount||a>=this._columnCount)return;const l=`${r}_${n}_${s}_${a}_${o}_${c}`,f=this._sliceCache.get(l);if(f!=null)return f;const m=[],d=this._values;let C=0,_=0;for(let N=r;N<n;N+=s){_=0,m[C]==null&&(m[C]=[]);for(let V=a;V<o;V+=c){if(!d[N])return;let M=d[N][V]||this._defaultValue;M==null&&(M=oe.create()),m[C][_]=M,_++}C++}if(m.length===0||m[0].length===0)return;const E=s>1?-1:r+this._currentRow,b=c>1?-1:a+this._currentColumn,R=this._createNewArray(m,m.length,m[0].length,E,b);return R.setDefaultValue(this._defaultValue),this._sliceCache.set(l,R),R}sortByRow(e){const t=this._transposeArray(this._values);t.sort(this._sort(e)),this._clearCache(),this._values=this._transposeArray(t)}sortByColumn(e){this._clearCache(),this._values.sort(this._sort(e))}transpose(){const e=this._transposeArray(this._values),t=this._rowCount,r=this._columnCount,n=this._createNewArray(e,r,t);return n.setDefaultValue(this._defaultValue),n}orderSearch(e,t=Me.MIN,r=!1,n=!1){let s,a,o,c;const l=(f,m,d)=>{if(f==null)return!0;let C;if(n===!0?C=f.compare(e,H.EQUALS):C=f.isEqual(e),(C==null?void 0:C.getValue())===!0)return s=f,o={row:m,column:d},!1;t===Me.MAX?f.isGreaterThan(e).getValue()===!0&&(a==null||f.minus(e).abs().isLessThanOrEqual(a.minus(e).abs()).getValue()===!0)&&(a=f,c={row:m,column:d}):t===Me.MIN&&f.isLessThan(e).getValue()===!0&&(a==null||f.minus(e).abs().isLessThanOrEqual(a.minus(e).abs()).getValue()===!0)&&(a=f,c={row:m,column:d})};if(r?this.iteratorReverse((f,m,d)=>l(f,m,d)):this.iterator((f,m,d)=>l(f,m,d)),s!=null)return o;if(a!=null)return c}binarySearch(e,t=Ft.MIN,r=Me.MIN){if(e.isError())return;const{stringArray:n,stringPosition:s,numberArray:a,numberPosition:o}=this.flattenPosition();return e.isString()?this._binarySearch(e,n,s,t,r):this._binarySearch(e,a,o,t,r)}_binarySearch(e,t,r,n=Ft.MIN,s=Me.MIN){const a=rn(),o=Number(e.getValue()),c=!Number.isNaN(o);let l=0,f=t.length-1,m=-1,d=-1,C=-1;for(;l<=f;){const _=Math.floor((l+f)/2),E=t[_];let b;if(E.isNull())b=n===Ft.MIN?1:-1;else{const R=E.getValue();if(c){const N=Number(R);b=Number.isNaN(N)?1:Math.sign(N-o)}else b=a(R.toString().toLocaleLowerCase(),e.getValue().toString().toLocaleLowerCase())}if(n===Ft.MAX&&(b=-b),b===0){m=_;break}b<0?(d=_,l=_+1):(C=_,f=_-1)}if(s===Me.NORMAL)return m!==-1?r[m]:void 0;if(s===Me.MIN)return m!==-1?r[m]:n===Ft.MIN?r[d]:r[C];if(s===Me.MAX)return m!==-1?r[m]:n===Ft.MIN?r[C]:r[d]}sum(){let e=y.create(0);return this.iterator(t=>{if(t==null||t.isString()||t.isBoolean()||t.isNull())return!0;if(t.isError())return e=t,!1;e=e.plus(t)}),e}max(){let e=y.create(Number.NEGATIVE_INFINITY);return this.iterator(t=>{if(t==null)return!0;if(t.isError())return e=t,!1;if(t.isString()||t.isNull()||t.isBoolean())return!0;e.isLessThan(t).getValue()&&(e=t)}),e}min(){let e=y.create(Number.POSITIVE_INFINITY);return this.iterator(t=>{if(t==null)return!0;if(t.isError())return e=t,!1;if(t.isString()||t.isNull()||t.isBoolean())return!0;e.isGreaterThan(t).getValue()&&(e=t)}),e}count(){let e=y.create(0);return this.iterator(t=>{if(t==null||t.isError()||t.isString()||t.isNull()||t.isBoolean())return!0;e=e.plusBy(1)}),e}countA(){let e=y.create(0);return this.iterator(t=>{if(t==null||t.isNull())return!0;e=e.plusBy(1)}),e}countBlank(){let e=y.create(0);return this.iterator(t=>{(t==null||t.isNull()||t.getValue()==="")&&(e=e.plusBy(1))}),e}getNegative(){return K.create("{0}").minus(this)}getReciprocal(){return K.create("{1}").divided(this)}plus(e){return this._batchOperator(e,1)}minus(e){return this._batchOperator(e,0)}multiply(e){return this._batchOperator(e,2)}divided(e){return this._batchOperator(e,3)}mod(e){return this._batchOperator(e,4)}modInverse(e){return this.map(t=>t.isError()?t:e.mod(t))}compare(e,t,r){return this._batchOperator(e,5,t,r)}concatenateFront(e){return this._batchOperator(e,6)}concatenateBack(e){return this._batchOperator(e,7)}map(e){const t=(r,n,s)=>r==null?oe.create():r.isError()?r:e(r,n,s);return this.mapValue(t)}mapValue(e){var s;const t=this._rowCount,r=this._columnCount,n=[];for(let a=0;a<t;a++){const o=[];for(let c=0;c<r;c++){const l=(s=this._values)==null?void 0:s[a];if(l==null)o[c]=g.create(h.VALUE);else{const f=l[c]||this._defaultValue;f?o[c]=e(f,a,c):o[c]=oe.create()}}n.push(o)}return this._createNewArray(n,t,r)}pow(e){return this._batchOperator(e,8)}powInverse(e){return this.map(t=>t.isError()?t:e.pow(t))}sqrt(){return this.map(e=>e.isError()?e:e.sqrt())}cbrt(){return this.map(e=>e.isError()?e:e.cbrt())}cos(){return this.map(e=>e.isError()?e:e.cos())}cosh(){return this.map(e=>e.isError()?e:e.cosh())}acos(){return this.map(e=>e.isError()?e:e.acos())}acosh(){return this.map(e=>e.isError()?e:e.acosh())}sin(){return this.map(e=>e.isError()?e:e.sin())}sinh(){return this.map(e=>e.isError()?e:e.sinh())}asin(){return this.map(e=>e.isError()?e:e.asin())}asinh(){return this.map(e=>e.isError()?e:e.asinh())}tan(){return this.map(e=>e.isError()?e:e.tan())}tanh(){return this.map(e=>e.isError()?e:e.tanh())}atan(){return this.map(e=>e.isError()?e:e.atan())}atanh(){return this.map(e=>e.isError()?e:e.atanh())}atan2(e){return this._batchOperator(e,12)}atan2Inverse(e){return this.map(t=>t.isError()?t:e.atan2(t))}mean(e=0){const t=this.sum(),r=this.count();return t.divided(e===0?r:r.minusBy(1))}median(){const e=this.flattenPosition().numberArray,t=this._createNewArray([e],1,e.length),r=t.getColumnCount();if(r<=1)return t.get(0,0)||oe.create();if(t.sortByRow(0),r%2===0){const n=t.get(0,r/2)||oe.create(),s=t.get(0,r/2-1)||oe.create();return n.plus(s).divided(y.create(2))}return t.get(0,(r-1)/2)||oe.create()}var(e=0){const t=this.mean(),r=[[]];this.iterator(l=>{if(l==null||l.isError()||l.isString()||l.isBoolean()||l.isNull())return;const f=l.minus(t).pow(y.create(2));f.isError()||r[0].push(f)});const{_unitId:n,_sheetId:s,_currentRow:a,_currentColumn:o}=this;return K.create({calculateValueList:r,rowCount:1,columnCount:r[0].length,unitId:n,sheetId:s,row:a,column:o}).mean(e)}std(e=0){const t=this.var(e);return t.isError()?t:t.sqrt()}log(){return this.map(e=>e.isError()?e:e.log())}log10(){return this.map(e=>e.isError()?e:e.log10())}exp(){return this.map(e=>e.isError()?e:e.exp())}abs(){return this.map(e=>e.isError()?e:e.abs())}round(e){return this._batchOperator(e,9)}roundInverse(e){return this.map(t=>t.isError()?t:e.round(t))}floor(e){return this._batchOperator(e,10)}floorInverse(e){return this.map(t=>t.isError()?t:e.floor(t))}ceil(e){return this._batchOperator(e,11)}ceilInverse(e){return this.map(t=>t.isError()?t:e.ceil(t))}toValue(){return ff(this._values)}_clearCache(){this._flattenCache=null,this._sliceCache.clear()}_sort(e){const t=rn();return(r,n)=>{const s=r[e],a=n[e];return s==null?1:a==null?-1:s.isError()&&s.isError()?0:s.isError()?1:a.isError()?-1:t(s.getValue(),a.getValue())}}_transposeArray(e){const t=e.length,r=e[0].length,n=[];for(let s=0;s<r;s++){n[s]=[];for(let a=0;a<t;a++)n[s][a]=e[a][s]}return n}_batchOperator(e,t,r,n){const s=[];let a=this._rowCount,o=this._columnCount;if(e.isArray()){const f=e.getRowCount(),m=e.getColumnCount();if(a=Math.max(f,a),o=Math.max(m,o),f===1&&m===1){const d=e.getFirstCell();for(let C=0;C<o;C++)s.push(d)}else if(f===1&&this._columnCount>1){const d=e.getArrayValue();for(let C=0;C<o;C++)s.push(d[0][C])}else return this._batchOperatorArray(e,t,r,n)}else for(let f=0;f<o;f++)s.push(e);const c=[];for(let f=0;f<o;f++){const m=s[f];this._batchOperatorValue(m,f,c,t,r,n)}const l=this._createNewArray(c,a,o);return l.setDefaultValue(T.create(!1)),l}_batchOperatorValue(e,t,r,n,s,a){const o=this._rowCount,c=this.getUnitId(),l=this.getSheetId(),f=this.getCurrentRow(),m=this.getCurrentColumn();if(n===5){const{rowsInCache:d,rowsNotInCache:C}=Ye.canUseCache(c,l,t+m,f,f+o-1);if(d.length>0){if(s===H.EQUALS){const _=Ye.getCellPositions(c,l,t+m,e.getValue(),d);_!=null&&_.forEach(E=>{if(E<f||E>f+o-1)return;const b=E-f;r[b]==null&&(r[b]=[]),r[b][t]=T.create(!0)})}else{const _=Ye.getCellValuePositions(c,l,t+m);_!=null&&_.forEach((E,b)=>{let R=oe.create();xt.has(b)?R=g.create(b):typeof b=="string"?R=U.create(b):typeof b=="number"?R=y.create(b):typeof b=="boolean"&&(R=T.create(b));let N;R.isError()?N=R:e.isError()?N=e:N=R.compare(e,s,a),(N.isError()||N.getValue()===!0)&&E.forEach(V=>{V>=f&&V<=f+o-1&&(r[V-f]==null&&(r[V-f]=[]),r[V-f][t]=N)})})}if(C.length>0)for(const _ of C){const[E,b]=_;for(let R=E;R<=b;R++)this.__batchOperatorRowValue(e,t,r,n,R-f,c,l,f,m,s,a);Ye.setContinueBuildingCache(c,l,t+m,E,b)}return}}for(let d=0;d<o;d++)this.__batchOperatorRowValue(e,t,r,n,d,c,l,f,m,s,a);Ye.setContinueBuildingCache(c,l,t+m,f,f+o-1)}__batchOperatorRowValue(e,t,r,n,s,a,o,c,l,f,m){const d=this.getValueOrDefault(s,t);if(r[s]==null&&(r[s]=[]),d&&e)if(d.isError())r[s][t]=d;else if(e.isError())r[s][t]=e;else switch(n){case 1:r[s][t]=d.plus(e);break;case 0:r[s][t]=d.minus(e);break;case 2:r[s][t]=d.multiply(e);break;case 3:r[s][t]=d.divided(e);break;case 4:r[s][t]=d.mod(e);break;case 5:f?r[s][t]=d.compare(e,f,m):r[s][t]=g.create(h.VALUE);break;case 6:r[s][t]=d.concatenateFront(e);break;case 7:r[s][t]=d.concatenateBack(e);break;case 8:r[s][t]=d.pow(e);break;case 9:r[s][t]=d.round(e);break;case 10:r[s][t]=d.floor(e);break;case 12:r[s][t]=d.atan2(e);break;case 11:r[s][t]=d.ceil(e);break}else r[s][t]=g.create(h.NA);d!=null&&(d.isError()?Ye.set(a,o,t+l,d.getErrorType(),s+c):Ye.set(a,o,t+l,d.getValue(),s+c))}_batchOperatorArray(e,t,r,n){let s=e.getRowCount(),a=e.getColumnCount();s<this._rowCount&&(s=this._rowCount),a<this._columnCount&&(a=this._columnCount);const o=[],c=this._checkArrayCalculateType(this),l=this._checkArrayCalculateType(e);for(let f=0;f<s;f++){const m=[];for(let d=0;d<a;d++){let C;c===3?C=this.getValueOrDefault(0,0):c===1?C=this.getValueOrDefault(0,d):c===2?C=this.getValueOrDefault(f,0):C=this.getValueOrDefault(f,d);let _;if(l===3?_=e.getValueOrDefault(0,0):l===1?_=e.getValueOrDefault(0,d):l===2?_=e.getValueOrDefault(f,0):_=e.getValueOrDefault(f,d),C&&_)if(C.isError())m[d]=C;else if(_.isError())m[d]=_;else switch(t){case 1:m[d]=C.plus(_);break;case 0:m[d]=C.minus(_);break;case 2:m[d]=C.multiply(_);break;case 3:m[d]=C.divided(_);break;case 4:m[d]=C.mod(_);break;case 5:r?m[d]=C.compare(_,r,n):m[d]=g.create(h.VALUE);break;case 6:m[d]=C.concatenateFront(_);break;case 7:m[d]=C.concatenateBack(_);break;case 8:m[d]=C.pow(_);break;case 9:m[d]=C.round(_);break;case 12:m[d]=C.atan2(_);break;case 10:m[d]=C.floor(_);break;case 11:m[d]=C.ceil(_);break}else m[d]=g.create(h.NA)}o.push(m)}return this._createNewArray(o,s,a)}_checkArrayCalculateType(e){return e.getRowCount()===1&&e.getColumnCount()===1?3:e.getRowCount()===1?1:e.getColumnCount()===1?2:0}_formatValue(e){if(typeof e!="string")return e=e,this._rowCount=e.rowCount,this._columnCount=e.columnCount,this._unitId=e.unitId,this._sheetId=e.sheetId,this._currentRow=e.row,this._currentColumn=e.column,e.calculateValueList;e=e.slice(1,-1);const t=e.split(";"),r=t.length,n=[];let s=0;for(let a=0;a<r;a++){const c=t[a].split(","),l=c.length;s<l&&(s=l);const f=[];for(let m=0;m<l;m++){const d=c[m].trim();f.push(ut.create(d))}n.push(f)}return this._rowCount=r,this._columnCount=s,n}_createNewArray(e,t,r,n=-1,s=-1){(this._currentColumn===-1||this._currentRow===-1)&&(n=-1,s=-1);const a={calculateValueList:e,rowCount:t,columnCount:r,unitId:this.getUnitId(),sheetId:this.getSheetId(),row:n,column:s};return K.create(a)}}class ut{static create(u){if(u==null)return oe.create();if(typeof u=="boolean")return T.create(u);if(typeof u=="string"){const e=u.toLocaleUpperCase().trim();if(xt.has(e))return g.create(e);if(e===bt.TRUE||e===bt.FALSE)return hn(u);if(S.isRealNum(u))return y.create(Number(u));const{isNumberPattern:t,value:r,pattern:n}=Xc(u);if(t)return y.create(r,n);const s=u.replace(/\n/g,"").replace(/\r/g,"");return!mf(s)&&gc(s)?K.create(s):cf(u)}return typeof u=="number"?gn(u):g.create(h.VALUE)}}function mf(i){const u=i.trim();return u.startsWith('"')&&u.endsWith('"')}const hf=1e4,dn=new dt(hf);class Nr extends tn{constructor(e){super();A(this,"_forcedSheetId","");A(this,"_forcedSheetName","");A(this,"_defaultSheetId","");A(this,"_rangeData",{startColumn:-1,startRow:-1,endRow:-1,endColumn:-1});A(this,"_unitData",{});A(this,"_unitStylesData",{});A(this,"_filteredOutRows",[]);A(this,"_defaultUnitId","");A(this,"_forcedUnitId","");A(this,"_runtimeData",{});A(this,"_arrayFormulaCellData",{});A(this,"_runtimeArrayFormulaCellData",{});A(this,"_runtimeFeatureCellData",{});A(this,"_refOffsetX",0);A(this,"_refOffsetY",0);this._token=e}dispose(){this._unitData={},this._unitStylesData={},this._runtimeData={}}getToken(){return this._token}setToken(e){this._token=e}isExceedRange(){const{startRow:e,endRow:t,startColumn:r,endColumn:n}=this.getRangePosition();return e<0||r<0||t>=this.getActiveSheetRowCount()||n>=this.getActiveSheetColumnCount()}setRefOffset(e=0,t=0){this._refOffsetX=e,this._refOffsetY=t}getRefOffset(){return{x:this._refOffsetX,y:this._refOffsetY}}getRangePosition(){let{startRow:e,startColumn:t,endRow:r,endColumn:n}=S.moveRangeByOffset(this._rangeData,this._refOffsetX,this._refOffsetY);return Number.isNaN(e)&&(e=0),Number.isNaN(t)&&(t=0),Number.isNaN(r)&&(r=this.getActiveSheetRowCount()-1),Number.isNaN(n)&&(n=this.getActiveSheetColumnCount()-1),{...this._rangeData,startRow:e,endRow:r,startColumn:t,endColumn:n}}isReferenceObject(){return!0}iterator(e){const{startRow:t,endRow:r,startColumn:n,endColumn:s}=this.getRangePosition();if(this._checkIfWorksheetMiss())return e(g.create(h.VALUE),t,n);const a=this._forcedUnitId||this._defaultUnitId,o=this._forcedSheetId||this._defaultSheetId;for(let c=t;c<=r;c++)for(let l=n;l<=s;l++){if(c<0||l<0)return e(g.create(h.REF),c,l);const f=this.getCellData(c,l);let m=!1;if(Jr(f)){m=e(null,c,l);continue}let d=this.getCellValueObject(f);if(c===t&&l===n){const C=this.getCellPattern(a,o,c,l);if(C&&d.isNumber()){const _=Number(d.getValue());d=y.create(_,C)}}if(m=e(d,c,l),m===!1)return}}getFirstCell(){const{startRow:e,startColumn:t}=this.getRangePosition(),r=this.getCellData(e,t);if(!r)return y.create(0);let n=this.getCellValueObject(r);const s=this._forcedUnitId||this._defaultUnitId,a=this._forcedSheetId||this._defaultSheetId,o=this.getCellPattern(s,a,e,t);if(o&&n.isNumber()){const c=Number(n.getValue());n=y.create(c,o)}return n}getRangeData(){return this._rangeData}setRangeData(e){this._rangeData=e}getUnitId(){return this._forcedUnitId&&this._forcedUnitId.length>0?this._forcedUnitId:this._defaultUnitId}getSheetId(){return this._forcedSheetId&&this._forcedSheetId.length>0?this._forcedSheetId:this._defaultSheetId}setForcedUnitIdDirect(e){e.length>0&&(this._forcedUnitId=e)}getForcedUnitId(){return this._forcedUnitId}setForcedSheetId(e){var t;this._forcedSheetId=(t=e[this.getUnitId()])==null?void 0:t[this._forcedSheetName]}setForcedSheetIdDirect(e){this._forcedSheetId=e}getForcedSheetId(){return this._forcedSheetId}setForcedSheetName(e){e.length>0&&(this._forcedSheetName=e)}getForcedSheetName(){return this._forcedSheetName}setDefaultSheetId(e){this._defaultSheetId=e}getDefaultSheetId(){return this._defaultSheetId}setDefaultUnitId(e){this._defaultUnitId=e}getDefaultUnitId(){return this._defaultUnitId}getUnitData(){return this._unitData}setUnitData(e){this._unitData=e}getUnitStylesData(){return this._unitStylesData}setUnitStylesData(e){this._unitStylesData=e}getFilteredOutRows(){return this._filteredOutRows}setFilteredOutRows(e){this._filteredOutRows=e}getRuntimeData(){return this._runtimeData}setRuntimeData(e){this._runtimeData=e}getArrayFormulaCellData(){return this._arrayFormulaCellData}setArrayFormulaCellData(e){this._arrayFormulaCellData=e}getRuntimeArrayFormulaCellData(){return this._runtimeArrayFormulaCellData}setRuntimeArrayFormulaCellData(e){this._runtimeArrayFormulaCellData=e}getRuntimeFeatureCellData(){return this._runtimeFeatureCellData}setRuntimeFeatureCellData(e){this._runtimeFeatureCellData=e}getActiveSheetRowCount(){var e;return((e=this.getCurrentActiveSheetData())==null?void 0:e.rowCount)||0}getActiveSheetColumnCount(){var e;return((e=this.getCurrentActiveSheetData())==null?void 0:e.columnCount)||0}getRowCount(){return this._rangeData.endRow-this._rangeData.startRow+1}getColumnCount(){return this._rangeData.endColumn-this._rangeData.startColumn+1}getRowData(){var e;return((e=this.getCurrentActiveSheetData())==null?void 0:e.rowData)||{}}getColumnData(){var e;return((e=this.getCurrentActiveSheetData())==null?void 0:e.columnData)||{}}isCell(){return!1}isColumn(){return!1}isRow(){return!1}isRange(){return!1}isTable(){return!1}unionBy(e){return g.create(h.REF)}unionRange(e,t){return{startRow:-1,startColumn:-1,endRow:-1,endColumn:-1}}getCellValueObject(e){const t=Jc(e);if(xt.has(t))return g.create(t);if(e.t===S.CellValueType.NUMBER){const r=this._getPatternByCell(e);return Wu.isTextFormat(r)?U.create(t.toString()):gn(t,r)}return e.t===S.CellValueType.STRING||e.t===S.CellValueType.FORCE_STRING?U.create(t.toString()):e.t===S.CellValueType.BOOLEAN?hn(t):ut.create(t)}_getPatternByCell(e){var n;const t=this._unitStylesData[this.getUnitId()];if(!t)return"";const r=t.getStyleByCell(e);return((n=r==null?void 0:r.n)==null?void 0:n.pattern)||""}getCellByRow(e){return this.getCellByPosition(e)}getCellByColumn(e){return this.getCellByPosition(void 0,e)}getCurrentActiveSheetData(){var e;return(e=this._unitData[this.getUnitId()])==null?void 0:e[this.getSheetId()]}getCurrentStylesData(){return this._unitStylesData[this.getUnitId()]}getCurrentRuntimeSheetData(){var e,t;return(t=(e=this._runtimeData)==null?void 0:e[this.getUnitId()])==null?void 0:t[this.getSheetId()]}getCurrentActiveArrayFormulaCellData(){var e,t;return(t=(e=this._arrayFormulaCellData)==null?void 0:e[this.getUnitId()])==null?void 0:t[this.getSheetId()]}getCurrentRuntimeActiveArrayFormulaCellData(){var e,t;return(t=(e=this._runtimeArrayFormulaCellData)==null?void 0:e[this.getUnitId()])==null?void 0:t[this.getSheetId()]}getCellData(e,t){const r=this.getCurrentActiveSheetData(),n=this.getCurrentRuntimeSheetData(),s=this.getCurrentActiveArrayFormulaCellData(),a=this.getCurrentRuntimeActiveArrayFormulaCellData();return(n==null?void 0:n.getValue(e,t))||(a==null?void 0:a.getValue(e,t))||this.getRuntimeFeatureCellValue(e,t)||(s==null?void 0:s.getValue(e,t))||(r==null?void 0:r.cellData.getValue(e,t))}getRuntimeFeatureCellValue(e,t){return gi(e,t,this.getSheetId(),this.getUnitId(),this._runtimeFeatureCellData)}getCellByPosition(e,t){let r=e,n=t;r||(r=this._rangeData.startRow),n||(n=this._rangeData.startColumn);const s=this.getCellData(r,n);return s?this.getCellValueObject(s):g.create(h.VALUE)}getCellPattern(e,t,r,n){var c,l,f,m;const s=this._unitStylesData[e];if(!s)return"";const a=(f=(l=(c=this._unitData[e])==null?void 0:c[t])==null?void 0:l.cellData)==null?void 0:f.getValue(r,n);if(!a)return"";const o=s.getStyleByCell(a);return((m=o==null?void 0:o.n)==null?void 0:m.pattern)||""}toArrayValueObject(e=!0){var C;const{startRow:t,endRow:r,startColumn:n,endColumn:s}=this.getRangePosition(),a=`${this.getUnitId()}_${this.getSheetId()}_${t}_${r}_${n}_${s}`,o=dn.get(a);if(o&&e)return o;const c=r-t+1,l=s-n+1;if(c<0||l<0)return this._getBlankArrayValueObject();const f=new Array(c);this.iterator((_,E,b)=>{const R=E-t,N=b-n;f[R]||(f[R]=new Array(l)),_==null&&(_=oe.create()),f[R][N]=_});const m={calculateValueList:f,rowCount:f.length,columnCount:((C=f[0])==null?void 0:C.length)||0,unitId:this.getUnitId(),sheetId:this.getSheetId(),row:t,column:n},d=K.create(m);return e&&dn.set(a,d),d}toUnitRange(){return{range:this.getRangePosition(),sheetId:this.getSheetId(),unitId:this.getUnitId()}}_checkIfWorksheetMiss(){return(this._forcedSheetId==null||this._forcedSheetId.length===0)&&this._forcedSheetName.length>0}_getBlankArrayValueObject(){const e={calculateValueList:[],rowCount:0,columnCount:0,unitId:this.getUnitId(),sheetId:this.getSheetId(),row:0,column:0};return K.create(e)}}class vi extends tn{constructor(u){super(),this._promise=u}isAsyncObject(){return!0}async getValue(){return this._promise}}class Ti extends tn{constructor(u){super(),this._promiseList=u}isAsyncArrayObject(){return!0}async getValue(){var t;const u=[];for(let r=0;r<this._promiseList.length;r++){const n=this._promiseList[r];u[r]==null&&(u[r]=[]);for(let s=0;s<n.length;s++){const a=n[s];a.isAsyncObject()?u[r][s]=await a.getValue():u[r][s]=a}}const e={calculateValueList:u,rowCount:u.length,columnCount:((t=u[0])==null?void 0:t.length)||0,unitId:"",sheetId:"",row:0,column:0};return K.create(e)}}class pr extends Nr{constructor(u,e,t){super(""),this.setRangeData(u),e&&this.setForcedSheetIdDirect(e),t&&this.setForcedUnitIdDirect(t)}isRange(){return!0}}class xs extends Nr{constructor(u){super(u);const e=Tt(u);this.setForcedUnitIdDirect(e.unitId),this.setForcedSheetName(e.sheetName),this.setRangeData(e.range)}isCell(){return!0}unionBy(u){if(!u.isCell())return g.create(h.REF);const e=u,t=this.unionRange(this.getRangeData(),e.getRangeData());return this._createRange(t)}unionRange(u,e){const t=u.startRow,r=u.startColumn,n=e.startRow,s=e.startColumn,a={startRow:-1,startColumn:-1,endRow:-1,endColumn:-1};return t>n?(a.startRow=n,a.endRow=t):(a.startRow=t,a.endRow=n),r>s?(a.startColumn=s,a.endColumn=r):(a.startColumn=r,a.endColumn=s),u.startAbsoluteRefType&&(a.startAbsoluteRefType=u.startAbsoluteRefType),e.startAbsoluteRefType&&(a.endAbsoluteRefType=e.startAbsoluteRefType),a}_createRange(u){const e=new pr(u,this.getForcedSheetId(),this.getForcedUnitId());e.setUnitData(this.getUnitData()),e.setDefaultSheetId(this.getDefaultSheetId()),e.setDefaultUnitId(this.getDefaultUnitId()),e.setRuntimeData(this.getRuntimeData()),e.setUnitStylesData(this.getUnitStylesData()),e.setArrayFormulaCellData(this.getArrayFormulaCellData()),e.setRuntimeArrayFormulaCellData(this.getRuntimeArrayFormulaCellData()),e.setRuntimeFeatureCellData(this.getRuntimeFeatureCellData());const{x:t,y:r}=this.getRefOffset();e.setRefOffset(t,r);const n=this.getForcedSheetId();e.setForcedSheetName(this.getForcedSheetName()),n!=null&&e.setForcedSheetIdDirect(n);const s=this.getForcedUnitId();return s&&e.setForcedUnitIdDirect(s),e}}class Us extends Nr{constructor(u){super(u);const e=Tt(u);this.setForcedUnitIdDirect(e.unitId),this.setForcedSheetName(e.sheetName);const t={...e.range,startColumn:e.range.startColumn,startRow:Number.NaN,endColumn:e.range.endColumn,endRow:Number.NaN,rangeType:S.RANGE_TYPE.COLUMN};this.setRangeData(t)}isColumn(){return!0}unionBy(u){if(!u.isColumn())return g.create(h.REF);const e=u;if(e.getForcedSheetName()!==void 0&&e.getForcedSheetName()!=="")return g.create(h.REF);const t=this.getRangeData(),r=e.getRangeData(),n=r.startColumn;if(n>=t.startColumn&&n<=t.endColumn)return this;const s=t.startColumn;return n>s?t.endColumn=n:(t.startColumn=n,t.endColumn=s),r.startAbsoluteRefType&&(t.endAbsoluteRefType=r.startAbsoluteRefType),t.rangeType=S.RANGE_TYPE.COLUMN,this.setToken(`${this.getToken()}${X.COLON}${e.getToken()}`),this}}class vs extends Nr{constructor(u){super(u);const e=Tt(u);this.setForcedUnitIdDirect(e.unitId),this.setForcedSheetName(e.sheetName);const t={...e.range,startColumn:Number.NaN,startRow:e.range.startRow,endColumn:Number.NaN,endRow:e.range.endRow,rangeType:S.RANGE_TYPE.ROW};this.setRangeData(t)}isRow(){return!0}unionBy(u){if(!u.isRow())return g.create(h.REF);const e=u;if(e.getForcedSheetName()!==void 0&&e.getForcedSheetName()!=="")return g.create(h.REF);const t=this.getRangeData(),r=e.getRangeData(),n=r.startRow;if(n>=t.startRow&&n<=t.endRow)return this;const s=t.startRow;return n>s?t.endRow=n:(t.startRow=n,t.endRow=s),r.startAbsoluteRefType&&(t.endAbsoluteRefType=r.startAbsoluteRefType),t.rangeType=S.RANGE_TYPE.ROW,this.setToken(`${this.getToken()}${X.COLON}${e.getToken()}`),this}}function O(i,u,e,t){const r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,s=[];for(let a=0;a<i;a++){const o=[];for(let c=0;c<u;c++){if(r===1&&n===1){const f=e.isArray()?e.get(0,0):e;o.push(f);continue}if(r===1&&c<n){const f=e.get(0,c);o.push(f);continue}if(n===1&&a<r){const f=e.get(a,0);o.push(f);continue}if(a>=r||c>=n){o.push(t!=null?t:oe.create());continue}const l=e.get(a,c);o.push(l)}s.push(o)}return rr(s,i,u)}function rr(i,u,e,t="",r=""){const n={calculateValueList:i,rowCount:u,columnCount:e,unitId:t,sheetId:r,row:-1,column:-1};return K.create(n)}function Ts(i){const u=[H.EQUALS,H.NOT_EQUAL,H.GREATER_THAN_OR_EQUAL,H.GREATER_THAN,H.LESS_THAN_OR_EQUAL,H.LESS_THAN];for(const e of u)if(i.startsWith(e)){const t=i.substring(e.length);return[e,ut.create(t)]}return[H.EQUALS,ut.create(i)]}function Cn(i,u,e,t){if(!e)if(u.isString()){const r=`${u.getValue()}`,[n,s]=Ts(r);e=n,u=s}else e=H.EQUALS;return i.compare(u,e,t)}function gf(i,u){const e=Math.max(i.isArray()?i.getRowCount():1,u.isArray()?u.getRowCount():1),t=Math.max(i.isArray()?i.getColumnCount():1,u.isArray()?u.getColumnCount():1),r=O(e,t,i),n=O(e,t,u);return r.mapValue((s,a,o)=>{const c=n.get(a,o);return s!=null&&s.isError()?s:c!=null&&c.isError()?c:s!=null&&s.isBoolean()&&(c!=null&&c.isBoolean())?hn(s.getValue()&&c.getValue()):T.create(!1)})}function df(i){const u=i.getValue();let e=0;return u&&(e=1),y.create(e)}function Bi(i){return i.isArray()&&i.getRowCount()===1&&i.getColumnCount()===1?!0:i.isReferenceObject()?!!(i.isCell()||i.getRowCount()===1&&i.getColumnCount()===1):(i=i,!!(i.isString()||i.isNumber()||i.isBoolean()||i.isError()||i.isNull()))}function It(i){const u=i==null?void 0:i.getPattern();let e={},t={};if(u&&(e={s:{n:{pattern:u}}}),i!=null&&i.getCustomData()&&(t={custom:i.getCustomData()}),i==null)return{v:null,...e};if(i.isError())return{v:i.getErrorType(),t:S.CellValueType.STRING,...e,...t};if(i.isValueObject()){const r=i,n=r.getValue();return r.isNumber()?{v:n,t:S.CellValueType.NUMBER,...e,...t}:r.isBoolean()?{v:n?1:0,t:S.CellValueType.BOOLEAN,...e,...t}:r.isString()?{v:n,t:S.CellValueType.STRING,...e,...t}:r.isNull()?{v:null,...e,...t}:{v:n,t:S.CellValueType.STRING,...e,...t}}}function nr(i){let u=0,e=0;return i.forEach((t,r)=>{if(r%2===1)if(t.isArray()){const n=t;u=Math.max(u,n.getRowCount()),e=Math.max(e,n.getColumnCount())}else u=Math.max(u,1),e=Math.max(e,1)}),{maxRowLength:u,maxColumnLength:e}}function Vr(i,u,e,t){const r=u.getRowCount(),n=u.getColumnCount();for(let s=0;s<i.length;s++){if(s%2===1)continue;const a=i[s],o=a.getRowCount(),c=a.getColumnCount();if(o!==r||c!==n)return O(e,t,g.create(h.VALUE))}return null}function Or(i,u,e,t=!1){const r=[];for(let n=0;n<i.length;n++){if(n%2===1)continue;const s=i[n],a=i[n+1];O(u,e,a,g.create(h.NA)).iterator((c,l,f)=>{if(!c)return;let m=Cn(s,c);if(t&&(m=_n(m,s,c)),r[l]===void 0&&(r[l]=[]),r[l][f]===void 0){r[l][f]=m;return}r[l][f]=gf(r[l][f],m)})}return r}function _n(i,u,e){const[t,r]=Ts(`${e.getValue()}`);return i.mapValue((n,s,a)=>{const o=u.get(s,a);if(o&&Cf(o,r))return n;if(o!=null&&o.isNumber()){if(r.isString()){const c=r.convertToNumberObjectValue();if(c.isNumber())return o.compare(c,t)}return T.create(!1)}else if(r.isNumber()){if(o!=null&&o.isString()){const c=o.convertToNumberObjectValue();if(c.isNumber())return c.compare(r,t)}return T.create(!1)}else return o!=null&&o.isError()&&r.isError()&&o.getValue()===r.getValue()?T.create(!0):T.create(!1)})}function Cf(i,u){if(i.isNumber()&&u.isNumber()||i.isBoolean()&&u.isBoolean())return!0;const e=i.isString()&&i.getValue()==="",t=u.isString()&&u.getValue()==="";return!!((e||i.isNull())&&(t||u.isNull())||i.isString()&&!e&&u.isString()&&!t)}var An=(i=>(i[i.CELL=0]="CELL",i[i.COLUMN=1]="COLUMN",i[i.ROW=2]="ROW",i))(An||{});function _f(i,u){let e;switch(u){case 0:e=new xs(i);break;case 1:e=new Us(i);break;case 2:e=new vs(i);break;default:throw new Error("Unknown reference object type")}return e}function Af(i,u){let e;return i.isCell()&&u.isCell()||i.isRow()&&u.isRow()||i.isColumn()&&u.isColumn()?e=i.unionBy(u):e=g.create(h.NAME),e}var Ef=Object.getOwnPropertyDescriptor,bf=(i,u,e,t)=>{for(var r=t>1?void 0:t?Ef(u,e):u,n=i.length-1,s;n>=0;n--)(s=i[n])&&(r=s(r)||r);return r},yf=(i,u)=>(e,t)=>u(e,t,i),We=(i=>(i[i.IDLE=0]="IDLE",i[i.START=1]="START",i[i.START_DEPENDENCY=2]="START_DEPENDENCY",i[i.START_CALCULATION=3]="START_CALCULATION",i[i.CURRENTLY_CALCULATING=4]="CURRENTLY_CALCULATING",i[i.START_DEPENDENCY_ARRAY_FORMULA=5]="START_DEPENDENCY_ARRAY_FORMULA",i[i.START_CALCULATION_ARRAY_FORMULA=6]="START_CALCULATION_ARRAY_FORMULA",i[i.CURRENTLY_CALCULATING_ARRAY_FORMULA=7]="CURRENTLY_CALCULATING_ARRAY_FORMULA",i[i.CALCULATION_COMPLETED=8]="CALCULATION_COMPLETED",i))(We||{}),sr=(i=>(i[i.INITIAL=0]="INITIAL",i[i.STOP_EXECUTION=1]="STOP_EXECUTION",i[i.NOT_EXECUTED=2]="NOT_EXECUTED",i[i.SUCCESS=3]="SUCCESS",i))(sr||{});w.FormulaRuntimeService=class extends S.Disposable{constructor(e){super();A(this,"_formulaExecuteStage",0);A(this,"_stopState",!1);A(this,"_currentRow",-1);A(this,"_currentColumn",-1);A(this,"_currentRowCount",Number.NEGATIVE_INFINITY);A(this,"_currentColumnCount",Number.NEGATIVE_INFINITY);A(this,"_currentSubUnitId","");A(this,"_currentUnitId","");A(this,"_runtimeData",{});A(this,"_runtimeOtherData",{});A(this,"_unitArrayFormulaRange",{});A(this,"_runtimeArrayFormulaCellData",{});A(this,"_runtimeClearArrayFormulaCellData",{});A(this,"_runtimeFeatureRange",{});A(this,"_runtimeFeatureCellData",{});A(this,"_functionsExecutedState",0);A(this,"_functionDefinitionPrivacyVar",new Map);A(this,"_totalFormulasToCalculate",0);A(this,"_completedFormulasCount",0);A(this,"_totalArrayFormulasToCalculate",0);A(this,"_completedArrayFormulasCount",0);A(this,"_formulaCycleIndex",0);A(this,"_isCycleDependency",!1);this._currentConfigService=e}get currentRow(){return this._currentRow}get currentColumn(){return this._currentColumn}get currentRowCount(){return this._currentRowCount}get currentColumnCount(){return this._currentColumnCount}get currentSubUnitId(){return this._currentSubUnitId}get currentUnitId(){return this._currentUnitId}dispose(){super.dispose(),this.reset(),this._runtimeFeatureCellData={},this._runtimeFeatureRange={},this.clearReferenceAndNumberformatCache()}enableCycleDependency(){this._isCycleDependency=!0}disableCycleDependency(){this._isCycleDependency=!1}isCycleDependency(){return this._isCycleDependency}setFormulaCycleIndex(e){this._formulaCycleIndex=e}getFormulaCycleIndex(){return this._formulaCycleIndex}setTotalArrayFormulasToCalculate(e){this._totalArrayFormulasToCalculate=e}getTotalArrayFormulasToCalculate(){return this._totalArrayFormulasToCalculate}setCompletedArrayFormulasCount(e){this._completedArrayFormulasCount=e}getCompletedArrayFormulasCount(){return this._completedArrayFormulasCount}setTotalFormulasToCalculate(e){this._totalFormulasToCalculate=e}getTotalFormulasToCalculate(){return this._totalFormulasToCalculate}setCompletedFormulasCount(e){this._completedFormulasCount=e}getCompletedFormulasCount(){return this._completedFormulasCount}markedAsSuccessfullyExecuted(){this._functionsExecutedState=3}markedAsNoFunctionsExecuted(){this._functionsExecutedState=2}markedAsStopFunctionsExecuted(){this._functionsExecutedState=1}markedAsInitialFunctionsExecuted(){this._functionsExecutedState=0}stopExecution(){this._stopState=!0,this.setFormulaExecuteStage(0)}isStopExecution(){return this._stopState}setFormulaExecuteStage(e){this._formulaExecuteStage=e}getFormulaExecuteStage(){return this._formulaExecuteStage}reset(){this._formulaExecuteStage=0,this._runtimeData={},this._runtimeOtherData={},this._unitArrayFormulaRange={},this._runtimeArrayFormulaCellData={},this._runtimeClearArrayFormulaCellData={},this._functionDefinitionPrivacyVar.clear(),this.markedAsInitialFunctionsExecuted(),this._stopState=!1,this._isCycleDependency=!1,this._totalFormulasToCalculate=0,this._completedFormulasCount=0,this.clearReferenceAndNumberformatCache()}clearReferenceAndNumberformatCache(){Gc(),Zc(),wc()}setCurrent(e,t,r,n,s,a){this._currentRow=e,this._currentColumn=t,this._currentRowCount=r,this._currentColumnCount=n,this._currentSubUnitId=s,this._currentUnitId=a}clearFunctionDefinitionPrivacyVar(){this._functionDefinitionPrivacyVar.clear()}registerFunctionDefinitionPrivacyVar(e,t){this._functionDefinitionPrivacyVar.set(e,t)}getFunctionDefinitionPrivacyVar(e){return this._functionDefinitionPrivacyVar.get(e)}setRuntimeOtherData(e,t,r,n){const s=this._currentSubUnitId,a=this._currentUnitId;this._runtimeOtherData[a]===void 0&&(this._runtimeOtherData[a]={});const o=this._runtimeOtherData[a];(o[s]===void 0||o[s]===null)&&(o[s]={});const c=o[s];let l=[];if(n.isReferenceObject()||n.isValueObject()&&n.isArray()){const f=n,{startRow:m,startColumn:d}=f.getRangePosition();f.iterator((C,_,E)=>{const b=It(C),R=_-m,N=E-d;l[R]==null&&(l[R]=[]),l[R][N]=b})}else l=[[It(n)]];(c[e]===void 0||c[e]===null)&&(c[e]={}),(c[e][r]===void 0||c[e][r]===null)&&(c[e][r]={}),c[e][r][t]=l}setRuntimeData(e){const t=this._currentRow,r=this._currentColumn,n=this._currentRowCount,s=this.currentColumnCount,a=this._currentSubUnitId,o=this._currentUnitId;this._runtimeData[o]==null&&(this._runtimeData[o]={});const c=this._runtimeData[o];c[a]==null&&(c[a]=new S.ObjectMatrix),this._unitArrayFormulaRange[o]==null&&(this._unitArrayFormulaRange[o]={});const l=this._unitArrayFormulaRange[o];(l[a]===null||l[a]===void 0)&&(l[a]={});const f=new S.ObjectMatrix(l[a]);this._runtimeArrayFormulaCellData[o]===void 0&&(this._runtimeArrayFormulaCellData[o]={});const m=this._runtimeArrayFormulaCellData[o];m[a]==null&&(m[a]=new S.ObjectMatrix),this._runtimeClearArrayFormulaCellData[o]===void 0&&(this._runtimeClearArrayFormulaCellData[o]={});const d=this._runtimeClearArrayFormulaCellData[o];d[a]==null&&(d[a]=new S.ObjectMatrix);const C=c[a],_=m[a],E=d[a];if(e.isReferenceObject()||e.isValueObject()&&e.isArray()){const b=e,{startRow:R,startColumn:N,endRow:V,endColumn:M}=b.getRangePosition();if(R===V&&N===M){const L=b.getFirstCell(),P=It(L);C.setValue(t,r,P),E.setValue(t,r,P),Ye.set(o,a,r,L.getValue(),t,!0);return}const D={startRow:t,startColumn:r,endRow:V-R+t,endColumn:M-N+r};if(f.setValue(t,r,D),this._checkIfArrayFormulaRangeHasData(o,a,t,r,D)||this._checkIfArrayFormulaExceeded(n,s,D)){const L=It(g.create(h.SPILL));C.setValue(t,r,L),E.setValue(t,r,L),Ye.set(o,a,r,h.SPILL,t,!0);const P=this._currentConfigService.getUnitData();b.iterator((j,F,v)=>{var te,Q;const Y=F-R+t,q=v-N+r,se=(Q=(te=P[o])==null?void 0:te[a])==null?void 0:Q.cellData.getValue(Y,q);if(F===R&&v===N)_.setValue(t,r,L);else if(se!=null)se.v==null&&(se.v=""),_.setValue(Y,q,se);else{if(this._isInOtherArrayFormulaRange(o,a,t,r,Y,q))return!0;_.setValue(Y,q,{v:""})}})}else{const L=g.create(h.SPILL);b.iterator((P,j,F)=>{Ye.set(o,a,r-N+F,P?P.getValue():0,t-R+j,!0);const v=It(P);if(j===R&&F===N){if(P!=null&&P.isError()&&P.isEqualType(L))return E.setValue(t,r,{}),C.setValue(t,r,{...It(L)}),!1;C.setValue(t,r,{...v})}const Y=j-R+t,q=F-N+r;_.setValue(Y,q,v)})}}else{const b=It(e);C.setValue(t,r,b),Ye.set(o,a,r,e.getValue(),t,!0),E.setValue(t,r,b)}}getUnitData(){return this._runtimeData}getUnitArrayFormula(){return this._unitArrayFormulaRange}getRuntimeOtherData(){return this._runtimeOtherData}getRuntimeArrayFormulaCellData(){return this._runtimeArrayFormulaCellData}getRuntimeClearArrayFormulaCellData(){return this._runtimeClearArrayFormulaCellData}getRuntimeFeatureRange(){return this._runtimeFeatureRange}setRuntimeFeatureRange(e,t){this._runtimeFeatureRange[e]=t}getRuntimeFeatureCellData(){return this._runtimeFeatureCellData}setRuntimeFeatureCellData(e,t){this._runtimeFeatureCellData[e]=t}getAllRuntimeData(){return{unitData:this.getUnitData(),arrayFormulaRange:this.getUnitArrayFormula(),unitOtherData:this.getRuntimeOtherData(),functionsExecutedState:this._functionsExecutedState,arrayFormulaCellData:this.getRuntimeArrayFormulaCellData(),clearArrayFormulaCellData:this.getRuntimeClearArrayFormulaCellData(),runtimeFeatureRange:this.getRuntimeFeatureRange(),runtimeFeatureCellData:this.getRuntimeFeatureCellData()}}getRuntimeState(){return{totalFormulasToCalculate:this.getTotalFormulasToCalculate(),completedFormulasCount:this.getCompletedFormulasCount(),totalArrayFormulasToCalculate:this.getTotalArrayFormulasToCalculate(),completedArrayFormulasCount:this.getCompletedArrayFormulasCount(),stage:this.getFormulaExecuteStage(),formulaCycleIndex:this.getFormulaCycleIndex()}}_checkIfArrayFormulaRangeHasData(e,t,r,n,s){var d,C,_,E,b,R,N,V,M,D,L;const{startRow:a,startColumn:o,endRow:c,endColumn:l}=s,f=this._currentConfigService.getUnitData(),m=this._currentConfigService.getArrayFormulaCellData();(_=(C=(d=this._unitArrayFormulaRange[e])==null?void 0:d[t])==null?void 0:C[r])==null||_[n];for(let P=a;P<=c;P++)for(let j=o;j<=l;j++){if(P===r&&n===j)continue;const F=(R=(b=(E=this._runtimeData)==null?void 0:E[e])==null?void 0:b[t])==null?void 0:R.getValue(P,j);(V=(N=m==null?void 0:m[e])==null?void 0:N[t])==null||V.getValue(P,j);const v=(L=(D=(M=f==null?void 0:f[e])==null?void 0:M[t])==null?void 0:D.cellData)==null?void 0:L.getValue(P,j),Y=this._getRuntimeFeatureCellValue(P,j,t,e);if(!Jr(F)||this._isInOtherArrayFormulaRange(e,t,r,n,P,j)||!Jr(v)||!Jr(Y))return!0}return!1}_getRuntimeFeatureCellValue(e,t,r,n){return gi(e,t,r,n,this._runtimeFeatureCellData)}_arrayCellHasData(e){return e==null?!1:e.v!==void 0}_isInOtherArrayFormulaRange(e,t,r,n,s,a){var f;const o=(f=this._currentConfigService.getArrayFormulaRange()[e])==null?void 0:f[t];if(o==null)return!1;let c=!1;return new S.ObjectMatrix(o).forValue((m,d,C)=>{var b,R;if(m===r&&d===n)return;const _=this._isInArrayFormulaRange(C,s,a),E=(R=(b=this._runtimeData[e])==null?void 0:b[t])==null?void 0:R.getValue(m,d);_&&(E==null?void 0:E.v)!==h.SPILL&&(c=!0)}),c}_isInArrayFormulaRange(e,t,r){if(e==null)return!1;const{startRow:n,startColumn:s,endRow:a,endColumn:o}=e;return t>=n&&t<=a&&r>=s&&r<=o}_checkIfArrayFormulaExceeded(e,t,r){return r.endRow>=e||r.endColumn>=t}_isInDirtyRange(e,t,r,n){const s=this._currentConfigService.getDirtyRanges();return s.length===0?!0:Pa(s,e,t,r,n)}},w.FormulaRuntimeService=bf([yf(0,Ct)],w.FormulaRuntimeService);const ct=S.createIdentifier("univer.formula.runtime.service");var ce=(i=>(i[i.REFERENCE=1]="REFERENCE",i[i.VALUE=2]="VALUE",i[i.OPERATOR=3]="OPERATOR",i[i.FUNCTION=4]="FUNCTION",i[i.LAMBDA=5]="LAMBDA",i[i.LAMBDA_PARAMETER=6]="LAMBDA_PARAMETER",i[i.ERROR=7]="ERROR",i[i.BASE=8]="BASE",i[i.ROOT=9]="ROOT",i[i.UNION=10]="UNION",i[i.PREFIX=11]="PREFIX",i[i.SUFFIX=12]="SUFFIX",i[i.NULL=13]="NULL",i))(ce||{});const lt=new Map([[1,7],[2,9],[3,8],[4,6],[5,1],[6,2],[9,10],[10,3],[11,4],[12,5]]);class ke{constructor(u){A(this,"_children",[]);A(this,"_definedNames");A(this,"_parent");A(this,"_valueObject");A(this,"_calculateState",!1);A(this,"_async",!1);A(this,"_address",!1);A(this,"_isForcedCalculateFunction",!1);this._token=u}dispose(){var u;this._children.forEach(e=>{e.dispose()}),(u=this._valueObject)==null||u.dispose(),this._valueObject=null,this._children=[],this._definedNames=null,this._parent=null}get nodeType(){return ce.BASE}isAsync(){return this._async}isAddress(){return this._address}isForcedCalculateFunction(){return this._isForcedCalculateFunction}setAsync(){this._async=!0}setAddress(){this._address=!0}getParent(){return this._parent}setParent(u){this._parent=u,u.addChildren(this)}setForcedCalculateFunction(){this._isForcedCalculateFunction=!0}getChildren(){return this._children}addChildren(...u){this._children.push(...u)}getToken(){return this._token}setValue(u){this._valueObject=u}getValue(){return this._valueObject}isCalculated(){return this._calculateState}setCalculated(){this._calculateState=!0}execute(){}setNotEmpty(u=!0){}async executeAsync(){return Promise.resolve(yt.SUCCESS)}serialize(){const u=this.getToken(),e=this.getChildren(),t=[],r=e.length;for(let s=0;s<r;s++){const a=e[s];t.push(a.serialize())}const n={token:u,nodeType:this.nodeType};return r>0&&(n.children=t),n}hasDefinedName(u){var e;return((e=this._definedNames)==null?void 0:e.includes(u))||!1}setDefinedNames(u){this._definedNames=u}getDefinedNames(){return this._definedNames}}class Le extends ke{constructor(e){super(e);A(this,"_errorValueObject");this._errorValueObject=g.create(e)}get nodeType(){return ce.ERROR}static create(e){return new Le(e)}getValue(){return this._errorValueObject}}const ft=100;class mt{get zIndex(){return 0}dispose(){}create(u,e,t){let r;return u instanceof ie?r=u.getToken():r=u,new ke(r)}}class Bs extends ke{get nodeType(){return ce.ROOT}execute(){const u=this.getChildren();if(u.length>1){this.setValue(g.create(h.VALUE));return}const e=u[0];e==null?this.setValue(g.create(h.VALUE)):this.setValue(e.getValue())}}class Fs extends mt{get zIndex(){return lt.get(ce.ROOT)||ft}checkAndCreateNodeType(u){if(!(u instanceof ie))return;if(u.getToken()===pt)return new Bs(pt)}}const Rf=5e3,Sr=new dt(Rf);function Is(i,u,e,t,r){let n=Sr.get(`${i}${u}`);if(n&&!Fi(n,r))return n;const s=e.treeBuilder(u);if(xt.has(s))return Le.create(s);if(n=t.parse(s),n==null)throw new Error("astNode is null");return Sr.set(`${i}${u}`,n),n}function Fi(i,u){const e=u.getDirtyDefinedNameMap(),t=u.getExecuteUnitId();if(t!=null&&e[t]!=null){const r=Object.keys(e[t]);for(let n=0,s=r.length;n<s;n++){const a=r[n];if(i.hasDefinedName(a))return!0}}return!1}function Nf(i,u,e){return!!(u!=null&&Fi(u,e))}const Et=S.createIdentifier("univer.formula-function.service");class Ii extends S.Disposable{constructor(){super(...arguments);A(this,"_functionExecutors",new Map);A(this,"_functionDescriptions",new Map)}dispose(){super.dispose(),this._functionExecutors.clear(),this._functionDescriptions.clear()}registerExecutors(...e){for(let t=0;t<e.length;t++){const r=e[t];this._functionExecutors.set(r.name,r)}}getExecutors(){return this._functionExecutors}getExecutor(e){return this._functionExecutors.get(e)}hasExecutor(e){return this._functionExecutors.has(e)}unregisterExecutors(...e){for(let t=0;t<e.length;t++){const r=e[t];this._functionExecutors.delete(r)}}registerDescriptions(...e){for(let t=0;t<e.length;t++){const r=e[t];this._functionDescriptions.set(r.functionName,r)}return S.toDisposable(()=>{for(let t=0;t<e.length;t++){const r=e[t];this._functionDescriptions.delete(r.functionName)}})}getDescriptions(){return this._functionDescriptions}getDescription(e){return this._functionDescriptions.get(e)}hasDescription(e){return this._functionDescriptions.has(e)}unregisterDescriptions(...e){for(let t=0;t<e.length;t++){const r=e[t];this._functionDescriptions.delete(r)}}deleteFormulaAstCacheKey(...e){Sr.forEach((t,r)=>{e.forEach(n=>{r.includes(n)&&Sr.delete(r)})})}}var Ue=(i=>(i.COMPARE="COMPARE",i.DIVIDED="DIVIDED",i.MINUS="MINUS",i.MULTIPLY="MULTIPLY",i.PLUS="PLUS",i.UNION="UNION",i.CUBE="CUBE",i))(Ue||{}),pf=Object.getOwnPropertyDescriptor,Vf=(i,u,e,t)=>{for(var r=t>1?void 0:t?pf(u,e):u,n=i.length-1,s;n>=0;n--)(s=i[n])&&(r=s(r)||r);return r},ki=(i,u)=>(e,t)=>u(e,t,i);class En extends ke{constructor(u,e,t){super(e),this._runtimeService=u,this._operatorString=e,this._functionExecutor=t}get nodeType(){return ce.PREFIX}execute(){let e=this.getChildren()[0].getValue(),t;if(e==null)throw new Error("object is null");this._operatorString===Ve.MINUS?(e.isReferenceObject()&&(e=e.toArrayValueObject()),t=this._functionExecutor.calculate(y.create(0),e)):this._operatorString===Ve.AT?t=this._handlerAT(e):t=g.create(h.VALUE),this.setValue(t)}_handlerAT(u){if(!u.isReferenceObject())return g.create(h.VALUE);const e=u;if(e.isCell())return g.create(h.VALUE);const t=this._runtimeService,r=t.currentRow||0,n=t.currentColumn||0,s=e.getRangePosition(),{startRow:a,startColumn:o,endRow:c,endColumn:l}=s;return l!==o&&c!==a||a===c&&o===l?g.create(h.VALUE):c===a&&n>=o&&n<=l?e.getCellByColumn(n):o===l&&r>=a&&r<=c?e.getCellByRow(r):e.isTable()?e.getCellByPosition(r):g.create(h.VALUE)}}w.PrefixNodeFactory=class extends mt{constructor(u,e){super(),this._functionService=u,this._runtimeService=e}get zIndex(){return lt.get(ce.PREFIX)||ft}checkAndCreateNodeType(u){if(!(u instanceof ie))return;const e=u.getToken(),t=e.trim();if(t.charAt(0)==='"'&&t.charAt(t.length-1)==='"')return;let r="";if(t===Ve.MINUS)r=Ue.MINUS;else return t===Ve.AT?new En(this._runtimeService,t):void 0;const n=this._functionService.getExecutor(r);return n?new En(this._runtimeService,t,n):(console.error(`No function ${e}`),Le.create(h.NAME))}},w.PrefixNodeFactory=Vf([ki(0,Et),ki(1,ct)],w.PrefixNodeFactory),new RegExp(Ve.MINUS,"g"),new RegExp(Ve.AT,"g");function $i(i,u,e){let t,r,n=i;const s=n.slice(0,2);let a=0;if(s[0]===Ve.MINUS){const o=u.getExecutor(Ue.MINUS);t=new En(e,Ve.MINUS,o),a++}return s[0]===Ve.AT&&(r=new En(e,Ve.AT),t&&r.setParent(t),a++),a>0&&(n=n.slice(a)),{tokenTrim:n,minusPrefixNode:t,atPrefixNode:r}}var Of=Object.getOwnPropertyDescriptor,Sf=(i,u,e,t)=>{for(var r=t>1?void 0:t?Of(u,e):u,n=i.length-1,s;n>=0;n--)(s=i[n])&&(r=s(r)||r);return r},ar=(i,u)=>(e,t)=>u(e,t,i);class Mf extends ke{constructor(u,e,t,r,n,s){super(u),this._functionExecutor=e,this._currentConfigService=t,this._runtimeService=r,this._definedNamesService=n,this._formulaDataModel=s,this._functionExecutor.isAsync()&&this.setAsync(),this._functionExecutor.isAddress()&&this.setAddress(),this._functionExecutor.needsLocale&&this._setLocale(),this._functionExecutor.needsSheetsInfo&&this._setSheetsInfo(),this._functionExecutor.needsFormulaDataModel&&this._functionExecutor.setFormulaDataModel(this._formulaDataModel)}get nodeType(){return ce.FUNCTION}async executeAsync(){const u=[],e=this.getChildren(),t=e.length;this._compatibility();for(let s=0;s<t;s++){const o=e[s].getValue();o!=null&&(o.isReferenceObject()&&!this._functionExecutor.needsReferenceObject?u.push(o.toArrayValueObject()):u.push(o))}const r=await this._calculateAsync(u);let n;return r.isAsyncObject()||r.isAsyncArrayObject()?n=await r.getValue():n=r,this._setRefData(n),this.setValue(n),Promise.resolve(yt.SUCCESS)}execute(){const u=[],e=this.getChildren(),t=e.length;this._compatibility();for(let n=0;n<t;n++){const a=e[n].getValue();a!=null&&(a.isReferenceObject()&&this._functionExecutor.needsFilteredOutRows&&this._setFilteredOutRows(a),a.isReferenceObject()&&!this._functionExecutor.needsReferenceObject?u.push(a.toArrayValueObject()):u.push(a))}const r=this._calculate(u);this._setRefData(r),this.setValue(r)}_compatibility(){this._lookupCompatibility()}_lookupCompatibility(){const u=this.getChildren(),e=u.length;if(!this._functionExecutor.needsExpandParams||e!==3)return;const t=u[1].getValue(),r=u[2].getValue();if(!(t!=null&&t.isReferenceObject())&&!(r!=null&&r.isReferenceObject()))return;let n,s;if(t!=null&&t.isReferenceObject()){const C=t.getRangeData(),{startRow:_,startColumn:E,endRow:b,endColumn:R}=C;n=b-_+1,s=R-E+1}else n=t!=null&&t.isArray()?t.getRowCount():1,s=t!=null&&t.isArray()?t.getColumnCount():1;const a=r.getRangeData(),{startRow:o,startColumn:c,endRow:l,endColumn:f}=a,m=l-o+1,d=f-c+1;n!==m&&(a.endRow+=n-m),s!==d&&(a.endColumn+=s-d)}_handleCustomResult(u){var t;if(typeof u!="object"||u==null)return ut.create(u);const e=Ui(u);return K.create({calculateValueList:e,rowCount:e.length,columnCount:((t=e[0])==null?void 0:t.length)||0,unitId:"",sheetId:"",row:-1,column:-1})}_handleAddressFunction(){this._functionExecutor.isAddress()&&this._setDefinedNamesForFunction()}_mapVariantsToValues(u){return u.map(e=>e.isArray()?e.toValue():e.isLambda()?e:e.getValue())}_calculate(u){const{minParams:e,maxParams:t}=this._functionExecutor;if(e!==-1&&t!==-1&&(u.length<e||u.length>t))return g.create(h.NA);let r;if(this._setRefInfo(),this._functionExecutor.isCustom()){const n=this._functionExecutor.calculateCustom(...this._mapVariantsToValues(u));r=this._handleCustomResult(n)}else this._handleAddressFunction(),r=this._functionExecutor.calculate(...u);return r}async _calculateAsync(u){const{minParams:e,maxParams:t}=this._functionExecutor;if(e!==-1&&t!==-1&&(u.length<e||u.length>t))return g.create(h.NA);let r;if(this._setRefInfo(),this._functionExecutor.isCustom()){const n=await this._functionExecutor.calculateCustom(...this._mapVariantsToValues(u));r=this._handleCustomResult(n)}else this._handleAddressFunction(),r=this._functionExecutor.calculate(...u);return r}_setDefinedNamesForFunction(){const u=this._currentConfigService.getExecuteUnitId();if(u==null)return;const e=this._definedNamesService.getDefinedNameMap(u);e!=null&&this._functionExecutor.setDefinedNames(e)}_setRefInfo(){const{currentUnitId:u,currentSubUnitId:e,currentRow:t,currentColumn:r}=this._runtimeService;if(this._functionExecutor.setRefInfo(u,e,t,r),this._functionExecutor.needsSheetRowColumnCount){const{rowCount:n,columnCount:s}=this._currentConfigService.getSheetRowColumnCount(u,e);this._functionExecutor.setSheetRowColumnCount(n,s)}}_setRefData(u){if(!u.isReferenceObject())return;const e=u;e.setForcedSheetId(this._currentConfigService.getSheetNameMap()),e.setUnitData(this._currentConfigService.getUnitData()),e.setArrayFormulaCellData(this._currentConfigService.getArrayFormulaCellData()),e.setRuntimeData(this._runtimeService.getUnitData()),e.setRuntimeArrayFormulaCellData(this._runtimeService.getRuntimeArrayFormulaCellData()),e.setRuntimeFeatureCellData(this._runtimeService.getRuntimeFeatureCellData())}_setLocale(){this._functionExecutor.setLocale(this._currentConfigService.getLocale())}_setSheetsInfo(){this._functionExecutor.setSheetsInfo(this._currentConfigService.getSheetsInfo())}_setFilteredOutRows(u){const{startRow:e,endRow:t}=u.getRangePosition(),r=this._currentConfigService.getFilteredOutRows(u.getUnitId(),u.getSheetId(),e,t);u.setFilteredOutRows(r)}}class Df extends ke{constructor(u="Error"){super(u)}get nodeType(){return ce.FUNCTION}async executeAsync(){return this.setValue(g.create(h.NAME)),Promise.resolve(yt.SUCCESS)}execute(){this.setValue(g.create(h.NAME))}}w.FunctionNodeFactory=class extends mt{constructor(u,e,t,r,n,s){super(),this._functionService=u,this._currentConfigService=e,this._runtimeService=t,this._definedNamesService=r,this._injector=n,this._formulaDataModel=s}get zIndex(){return lt.get(ce.FUNCTION)||ft}create(u){const e=this._functionService.getExecutor(u);return e?new Mf(u,e,this._currentConfigService,this._runtimeService,this._definedNamesService,this._formulaDataModel):(console.error(`No function ${u}`),Le.create(h.NAME))}checkAndCreateNodeType(u){if(typeof u=="string")return;const e=u.getToken(),{tokenTrim:t,minusPrefixNode:r,atPrefixNode:n}=$i(e.trim(),this._functionService,this._runtimeService);if(!Number.isNaN(Number(t))&&!this._isParentUnionNode(u))return Le.create(h.VALUE);const s=t.toUpperCase();if(this._functionService.hasExecutor(s)){const a=this.create(s);return n?a.setParent(n):r&&a.setParent(r),a}}_isParentUnionNode(u){var e,t;return((t=(e=u.getParent())==null?void 0:e.getParent())==null?void 0:t.getToken())===X.COLON}},w.FunctionNodeFactory=Sf([ar(0,Et),ar(1,Ct),ar(2,ct),ar(3,vt),ar(4,S.Inject(S.Injector)),ar(5,S.Inject(w.FormulaDataModel))],w.FunctionNodeFactory);var wf=Object.getOwnPropertyDescriptor,Lf=(i,u,e,t)=>{for(var r=t>1?void 0:t?wf(u,e):u,n=i.length-1,s;n>=0;n--)(s=i[n])&&(r=s(r)||r);return r},Pf=(i,u)=>(e,t)=>u(e,t,i);w.Interpreter=class extends S.Disposable{constructor(u){super(),this._runtimeService=u}async executeAsync(u){if(!u||!u.node)return Promise.resolve(g.create(h.VALUE));const e=u.node,t=u.refOffsetX,r=u.refOffsetY;await this._executeAsync(e,t,r);const n=e.getValue();return n==null?Promise.resolve(g.create(h.VALUE)):Promise.resolve(n)}execute(u){if(!u||!u.node)return g.create(h.VALUE);const e=u.node,t=u.refOffsetX,r=u.refOffsetY;this._execute(e,t,r);const n=e.getValue();return n==null?g.create(h.VALUE):n}executePreCalculateNode(u){return u.execute(),u.getValue()}checkAsyncNode(u){if(u==null)return!1;const e=[];this._checkAsyncNode(u,e);for(let t=0,r=e.length;t<r;t++)if(e[t]===!0)return!0;return!1}_checkAsyncNode(u,e){const t=u.getChildren(),r=t.length;for(let n=0;n<r;n++){const s=t[n];e.push(s.isAsync()),this._checkAsyncNode(s,e)}}async _executeAsync(u,e=0,t=0){if(this._runtimeService.isStopExecution())return Promise.resolve(yt.ERROR);const r=u.getChildren(),n=r.length;for(let s=0;s<n;s++){const a=r[s];if(a.getToken().toUpperCase()===yr&&a.isEmptyParamFunction()){a.execute();continue}await this._executeAsync(a,e,t)}return u.nodeType===ce.REFERENCE&&u.setRefOffset(e,t),u.nodeType===ce.FUNCTION&&u.isAsync()?await u.executeAsync():u.execute(),Promise.resolve(yt.SUCCESS)}_execute(u,e=0,t=0){if(this._runtimeService.isStopExecution())return yt.ERROR;const r=u.getChildren(),n=r.length;for(let s=0;s<n;s++){const a=r[s];if(a.getToken().toUpperCase()===yr&&a.isEmptyParamFunction()){a.execute();continue}this._execute(a,e,t)}return u.nodeType===ce.REFERENCE&&u.setRefOffset(e,t),u.execute(),yt.SUCCESS}},w.Interpreter=Lf([Pf(0,ct)],w.Interpreter);function Yi(i){return i instanceof ie?i.getToken()===Jt:!1}function jf(i){return i instanceof ie?i.getToken()===ui:!1}function ks(i,u,e){const t=i.getChildren(),r=t.length,n=t[0];for(let s=0;s<r;s++){const a=t[s];if(!(Yi(n)&&s!==0))if(a instanceof ie)ks(a,u,e);else{const o=a.trim();if(e.has(o)){const c=new ie;c.setToken(br),c.setLambdaId(u),c.setLambdaPrivacyVar(e),c.setLambdaParameter(o),t[s]=c}}}}function Hi(i){if(!i)return;if(i.getToken()!==br)return i;const u=i,e=u.getCurrentLambdaPrivacyVar(),t=u.getLambdaParameter();if(!e)return;const r=e.get(t);return r==null&&i.getValue()?i:Hi(r)}class bn extends _t{constructor(e,t,r){super(0);A(this,"_lambdaPrivacyValueMap",new Map);this._lambdaNode=e,this._interpreter=t,this._lambdaPrivacyVarKeys=r,this._lambdaPrivacyValueMap.clear()}static create(e,t,r){return new bn(e,t,r)}dispose(){this._lambdaPrivacyValueMap.clear(),this._lambdaPrivacyValueMap=new Map,this._lambdaNode=null,this._interpreter=null,this._lambdaPrivacyVarKeys=[]}isLambda(){return!0}execute(...e){const t=this._lambdaPrivacyVarKeys.length;if(e.length!==t||!this._interpreter||!this._lambdaNode)return g.create(h.VALUE);this._setLambdaPrivacyValueMap(e),this._setLambdaNodeValue(this._lambdaNode),this._lambdaNode.setNotEmpty(!1);let r;if(this._interpreter.checkAsyncNode(this._lambdaNode))r=new vi(this._interpreter.executeAsync(zn(this._lambdaNode)));else{const n=this._interpreter.execute(zn(this._lambdaNode));n.isReferenceObject()?r=n.toArrayValueObject():r=n}return this._lambdaNode.setNotEmpty(!0),r}executeCustom(...e){const t=e.map(r=>ut.create(r));return this.execute(...t)}_setLambdaNodeValue(e){if(!e)return;const t=e.getChildren(),r=t.length;for(let n=0;n<r;n++){const s=t[n];if(s.getToken()===br){const o=s.getLambdaParameter(),c=this._lambdaPrivacyValueMap.get(o);if(c)s.setValue(c);else{const l=s.getCurrentLambdaPrivacyVar(),f=Hi(l.get(o));f!=null&&s.setValue(f.getValue())}continue}this._setLambdaNodeValue(s)}}_setLambdaPrivacyValueMap(e){for(let t=0;t<e.length;t++){const r=e[t],n=this._lambdaPrivacyVarKeys[t];this._lambdaPrivacyValueMap.set(n,r)}}getLambdaPrivacyVarKeys(){return this._lambdaPrivacyVarKeys}}var xf=Object.getOwnPropertyDescriptor,Uf=(i,u,e,t)=>{for(var r=t>1?void 0:t?xf(u,e):u,n=i.length-1,s;n>=0;n--)(s=i[n])&&(r=s(r)||r);return r},Gi=(i,u)=>(e,t)=>u(e,t,i);class vf extends ke{constructor(e,t,r,n){super(e);A(this,"_isNotEmpty",!0);this._lambdaId=t,this._interpreter=r,this._lambdaPrivacyVarKeys=n}get nodeType(){return ce.LAMBDA}setNotEmpty(e=!1){this._isNotEmpty=e}isEmptyParamFunction(){return this.getChildren().length<2&&this._isNotEmpty}isFunctionParameter(){return this._lambdaId===null}getLambdaId(){return this._lambdaId}execute(){if(this.isEmptyParamFunction())this.setValue(bn.create(this,this._interpreter,this._lambdaPrivacyVarKeys));else{const e=this.getChildren(),t=e.length;this.setValue(e[t-1].getValue())}}}w.LambdaNodeFactory=class extends mt{constructor(u,e){super(),this._runtimeService=u,this._interpreter=e}get zIndex(){return lt.get(ce.LAMBDA)||ft}create(u){const e=u.getChildren(),t=e[0];let r=e.slice(1,-1);const n=e[e.length-1];if(!(t instanceof ie&&n instanceof ie))return Le.create(h.NAME);if(t.getToken()===Jt){const o=t.getChildren();if(r.length!==o.length)return Le.create(h.VALUE)}else r=e.slice(0,-1);const s=S.Tools.generateRandomId(8),a=new Map;for(let o=0;o<r.length;o++){const c=r[o];if(c instanceof ie){const l=c.getChildren()[0];c.setToken(ui),a.set(l.trim(),void 0)}else return Le.create(h.VALUE)}return this._runtimeService.registerFunctionDefinitionPrivacyVar(s,a),this._updateLambdaStatement(n,s,a),new vf(u.getToken(),s,this._interpreter,[...a.keys()])}checkAndCreateNodeType(u){if(!(!(u instanceof ie)||u.getToken().trim().toUpperCase()!==yr))return this.create(u)}_updateLambdaStatement(u,e,t){ks(u,e,t)}},w.LambdaNodeFactory=Uf([Gi(0,ct),Gi(1,S.Inject(w.Interpreter))],w.LambdaNodeFactory);function Wi(i){if(!i)return;if(i.getToken()!==br)return i;const u=i,e=u.getCurrentLambdaPrivacyVar(),t=u.getLambdaParameter();if(e)return Wi(e.get(t))}class Tf extends ke{constructor(u,e,t){super(u),this._lambdaParameter=e,this._currentLambdaPrivacyVar=t}getLambdaParameter(){return this._lambdaParameter}getCurrentLambdaPrivacyVar(){return this._currentLambdaPrivacyVar}get nodeType(){return ce.LAMBDA_PARAMETER}execute(){const u=Wi(this._currentLambdaPrivacyVar.get(this._lambdaParameter));if(u)this.setValue(u.getValue());else{const e=this.getValue();(e==null||e.isError())&&this.setValue(g.create(h.NAME))}}}class $s extends mt{get zIndex(){return lt.get(ce.LAMBDA_PARAMETER)||ft}create(u){const e=u.getFunctionDefinitionPrivacyVar(),t=u.getLambdaParameter();return e?new Tf(u.getToken(),t,e):new Le(h.NAME)}checkAndCreateNodeType(u){if(!(!(u instanceof ie)||u.getToken().trim()!==br))return this.create(u)}}class Bf extends ke{constructor(u){super(u),this._operatorString=u}get nodeType(){return ce.NULL}execute(){this.setValue(oe.create())}}var G=(i=>(i.ABS="ABS",i.ACOS="ACOS",i.ACOSH="ACOSH",i.ACOT="ACOT",i.ACOTH="ACOTH",i.AGGREGATE="AGGREGATE",i.ARABIC="ARABIC",i.ASIN="ASIN",i.ASINH="ASINH",i.ATAN="ATAN",i.ATAN2="ATAN2",i.ATANH="ATANH",i.BASE="BASE",i.CEILING="CEILING",i.CEILING_MATH="CEILING.MATH",i.CEILING_PRECISE="CEILING.PRECISE",i.COMBIN="COMBIN",i.COMBINA="COMBINA",i.COS="COS",i.COSH="COSH",i.COT="COT",i.COTH="COTH",i.CSC="CSC",i.CSCH="CSCH",i.DECIMAL="DECIMAL",i.DEGREES="DEGREES",i.EVEN="EVEN",i.EXP="EXP",i.FACT="FACT",i.FACTDOUBLE="FACTDOUBLE",i.FLOOR="FLOOR",i.FLOOR_MATH="FLOOR.MATH",i.FLOOR_PRECISE="FLOOR.PRECISE",i.GCD="GCD",i.INT="INT",i.ISO_CEILING="ISO.CEILING",i.LCM="LCM",i.LET="LET",i.LN="LN",i.LOG="LOG",i.LOG10="LOG10",i.MDETERM="MDETERM",i.MINVERSE="MINVERSE",i.MMULT="MMULT",i.MOD="MOD",i.MROUND="MROUND",i.MULTINOMIAL="MULTINOMIAL",i.MUNIT="MUNIT",i.ODD="ODD",i.PI="PI",i.POWER="POWER",i.PRODUCT="PRODUCT",i.QUOTIENT="QUOTIENT",i.RADIANS="RADIANS",i.RAND="RAND",i.RANDARRAY="RANDARRAY",i.RANDBETWEEN="RANDBETWEEN",i.ROMAN="ROMAN",i.ROUND="ROUND",i.ROUNDBANK="ROUNDBANK",i.ROUNDDOWN="ROUNDDOWN",i.ROUNDUP="ROUNDUP",i.SEC="SEC",i.SECH="SECH",i.SERIESSUM="SERIESSUM",i.SEQUENCE="SEQUENCE",i.SIGN="SIGN",i.SIN="SIN",i.SINH="SINH",i.SQRT="SQRT",i.SQRTPI="SQRTPI",i.SUBTOTAL="SUBTOTAL",i.SUM="SUM",i.SUMIF="SUMIF",i.SUMIFS="SUMIFS",i.SUMPRODUCT="SUMPRODUCT",i.SUMSQ="SUMSQ",i.SUMX2MY2="SUMX2MY2",i.SUMX2PY2="SUMX2PY2",i.SUMXMY2="SUMXMY2",i.TAN="TAN",i.TANH="TANH",i.TRUNC="TRUNC",i))(G||{}),ae=(i=>(i.ASC="ASC",i.ARRAYTOTEXT="ARRAYTOTEXT",i.BAHTTEXT="BAHTTEXT",i.CHAR="CHAR",i.CLEAN="CLEAN",i.CODE="CODE",i.CONCAT="CONCAT",i.CONCATENATE="CONCATENATE",i.DBCS="DBCS",i.DOLLAR="DOLLAR",i.EXACT="EXACT",i.FIND="FIND",i.FINDB="FINDB",i.FIXED="FIXED",i.LEFT="LEFT",i.LEFTB="LEFTB",i.LEN="LEN",i.LENB="LENB",i.LOWER="LOWER",i.MID="MID",i.MIDB="MIDB",i.NUMBERSTRING="NUMBERSTRING",i.NUMBERVALUE="NUMBERVALUE",i.PHONETIC="PHONETIC",i.PROPER="PROPER",i.REGEXEXTRACT="REGEXEXTRACT",i.REGEXMATCH="REGEXMATCH",i.REGEXREPLACE="REGEXREPLACE",i.REPLACE="REPLACE",i.REPLACEB="REPLACEB",i.REPT="REPT",i.RIGHT="RIGHT",i.RIGHTB="RIGHTB",i.SEARCH="SEARCH",i.SEARCHB="SEARCHB",i.SUBSTITUTE="SUBSTITUTE",i.T="T",i.TEXT="TEXT",i.TEXTAFTER="TEXTAFTER",i.TEXTBEFORE="TEXTBEFORE",i.TEXTJOIN="TEXTJOIN",i.TEXTSPLIT="TEXTSPLIT",i.TRIM="TRIM",i.UNICHAR="UNICHAR",i.UNICODE="UNICODE",i.UPPER="UPPER",i.VALUE="VALUE",i.VALUETOTEXT="VALUETOTEXT",i.CALL="CALL",i.EUROCONVERT="EUROCONVERT",i.REGISTER_ID="REGISTER.ID",i))(ae||{}),Ff=Object.getOwnPropertyDescriptor,If=(i,u,e,t)=>{for(var r=t>1?void 0:t?Ff(u,e):u,n=i.length-1,s;n>=0;n--)(s=i[n])&&(r=s(r)||r);return r},kf=(i,u)=>(e,t)=>u(e,t,i);class $f extends ke{constructor(u,e){super(u),this._functionExecutor=e}get nodeType(){return ce.OPERATOR}execute(){const u=this.getChildren();this._functionExecutor.name===Ue.COMPARE&&this._functionExecutor.setCompareType(this.getToken());const e=u[0],t=u[1];let r=e==null?void 0:e.getValue(),n=t==null?void 0:t.getValue();const s=this.getToken();if((r==null||n==null)&&s!==Z.MINUS&&s!==Z.PLUS){this.setValue(g.create(h.VALUE));return}r==null&&(r=oe.create()),n==null&&(n=oe.create()),r.isReferenceObject()&&(r=r.toArrayValueObject()),n.isReferenceObject()&&(n=n.toArrayValueObject()),this.setValue(this._functionExecutor.calculate(r,n))}}w.OperatorNodeFactory=class extends mt{constructor(u){super(),this._functionService=u}get zIndex(){return lt.get(ce.OPERATOR)||ft}create(u){let e="";const t=u;t===Z.PLUS?e=Ue.PLUS:t===Z.MINUS?e=Ue.MINUS:t===Z.MULTIPLY?e=Ue.MULTIPLY:t===Z.DIVIDED?e=Ue.DIVIDED:t===Z.CONCATENATE?e=ae.CONCATENATE:t===Z.POWER?e=G.POWER:Xu.has(t)&&(e=Ue.COMPARE);const r=this._functionService.getExecutor(e);return r?new $f(t,r):(console.error(`No function ${u}`),Le.create(h.NAME))}checkAndCreateNodeType(u){if(u instanceof ie)return;const e=u.trim();if(!(e.charAt(0)==='"'&&e.charAt(e.length-1)==='"')&&Rt.has(e))return this.create(e)}},w.OperatorNodeFactory=If([kf(0,Et)],w.OperatorNodeFactory);var Yf=Object.getOwnPropertyDescriptor,Hf=(i,u,e,t)=>{for(var r=t>1?void 0:t?Yf(u,e):u,n=i.length-1,s;n>=0;n--)(s=i[n])&&(r=s(r)||r);return r},Ys=(i,u)=>(e,t)=>u(e,t,i);class Hs extends ke{constructor(e,t,r,n,s=!1){super(r);A(this,"_refOffsetX",0);A(this,"_refOffsetY",0);this._currentConfigService=e,this._runtimeService=t,this._referenceObjectType=n,this._isPrepareMerge=s}get nodeType(){return ce.REFERENCE}execute(){const e=this._currentConfigService,t=this._runtimeService,r=_f(this.getToken(),this._referenceObjectType);r.setDefaultUnitId(t.currentUnitId),r.setDefaultSheetId(t.currentSubUnitId),r.setForcedSheetId(e.getSheetNameMap()),r.setUnitData(e.getUnitData()),r.setArrayFormulaCellData(e.getArrayFormulaCellData()),r.setRuntimeData(t.getUnitData()),r.setUnitStylesData(e.getUnitStylesData()),r.setRuntimeArrayFormulaCellData(t.getRuntimeArrayFormulaCellData()),r.setRuntimeFeatureCellData(t.getRuntimeFeatureCellData());const{x:n,y:s}=this.getRefOffset();r.setRefOffset(n,s),!this._isPrepareMerge&&r.isExceedRange()?this.setValue(g.create(h.NAME)):this.setValue(r)}setRefOffset(e=0,t=0){this._refOffsetX=e,this._refOffsetY=t}getRefOffset(){return{x:this._refOffsetX,y:this._refOffsetY}}}w.ReferenceNodeFactory=class extends mt{constructor(u,e,t){super(),this._currentConfigService=u,this._formulaRuntimeService=e,this._functionService=t}get zIndex(){return lt.get(ce.REFERENCE)||ft}checkAndCreateNodeType(u){var f,m;let e=!1,t,r=!1;u instanceof ie?(e=!0,t=u.getToken().trim(),((m=(f=u.getParent())==null?void 0:f.getParent())==null?void 0:m.getToken().trim())===X.COLON&&(r=!0)):t=u.trim();const n=this._currentConfigService,s=this._formulaRuntimeService,{tokenTrim:a,minusPrefixNode:o,atPrefixNode:c}=$i(t,this._functionService,s);if(!e&&a.charAt(0)==='"'&&a.charAt(a.length-1)==='"')return;let l;if(dr(a)?l=new Hs(n,s,a,An.CELL,r):e&&this._checkParentIsUnionOperator(u)&&(Ka(a)?l=new Hs(n,s,a,An.ROW,r):Xa(a)&&(l=new Hs(n,s,a,An.COLUMN,r))),l)return c?l.setParent(c):o&&l.setParent(o),l}_checkParentIsUnionOperator(u){var e,t;return((t=(e=u.getParent())==null?void 0:e.getParent())==null?void 0:t.getToken().trim())===X.COLON}},w.ReferenceNodeFactory=Hf([Ys(0,Ct),Ys(1,ct),Ys(2,Et)],w.ReferenceNodeFactory);var Gf=Object.getOwnPropertyDescriptor,Wf=(i,u,e,t)=>{for(var r=t>1?void 0:t?Gf(u,e):u,n=i.length-1,s;n>=0;n--)(s=i[n])&&(r=s(r)||r);return r},Gs=(i,u)=>(e,t)=>u(e,t,i);class Qi extends ke{constructor(u,e,t,r){super(t),this._currentConfigService=u,this._lexer=e,this._operatorString=t,this._functionExecutor=r}get nodeType(){return ce.SUFFIX}execute(){let e=this.getChildren()[0].getValue(),t;if(e==null)throw new Error("object is null");if(this._operatorString===qe.PERCENTAGE){if(e.isReferenceObject()&&(e=e.toArrayValueObject()),t=this._functionExecutor.calculate(e,y.create(100)),t.isNumber()){const r=Number(t.getValue());t=y.create(r,"0.00%")}}else this._operatorString===qe.POUND?t=this._handlerPound(e):t=g.create(h.VALUE);this.setValue(t)}_handlerPound(u){var o,c,l,f;if(!u.isReferenceObject()||!u.isCell())return g.create(h.VALUE);const e=u,t=e.getRangePosition(),r=e.getUnitId(),n=e.getSheetId(),s=this._currentConfigService.getFormulaData(),a=(f=(l=(c=(o=s==null?void 0:s[r])==null?void 0:o[n])==null?void 0:c[t.startRow])==null?void 0:l[t.startColumn])==null?void 0:f.f;return a&&this._lexer.treeBuilder(a),g.create(h.VALUE)}}w.SuffixNodeFactory=class extends mt{constructor(u,e,t){super(),this._functionService=u,this._lexer=e,this._currentConfigService=t}get zIndex(){return lt.get(ce.SUFFIX)||ft}checkAndCreateNodeType(u){if(!(u instanceof ie))return;const e=u.getToken().trim();if(e.charAt(0)==='"'&&e.charAt(e.length-1)==='"')return;let t="";if(e===qe.PERCENTAGE)t=Ue.DIVIDED;else return e===qe.POUND?new Qi(this._currentConfigService,this._lexer,e):void 0;const r=this._functionService.getExecutor(t);return r?new Qi(this._currentConfigService,this._lexer,e,r):(console.error(`No function ${u}`),Le.create(h.NAME))}},w.SuffixNodeFactory=Wf([Gs(0,Et),Gs(1,S.Inject(w.Lexer)),Gs(2,Ct)],w.SuffixNodeFactory);var Qf=Object.getOwnPropertyDescriptor,qf=(i,u,e,t)=>{for(var r=t>1?void 0:t?Qf(u,e):u,n=i.length-1,s;n>=0;n--)(s=i[n])&&(r=s(r)||r);return r},Kf=(i,u)=>(e,t)=>u(e,t,i);class Xf extends ke{constructor(u){super(u)}get nodeType(){return ce.UNION}execute(){const u=this.getChildren(),e=u[0],t=u[1],r=e.getValue(),n=t.getValue();if(r==null||n==null)throw new Error("leftNode and rightNode");let s;this.getToken()===X.COLON?s=this._unionFunction(r,n):s=g.create(h.NAME),this.setValue(s)}_unionFunction(u,e){return u.isError()||e.isError()||!u.isReferenceObject()||!e.isReferenceObject()?g.create(h.REF):(u=u,e=e,Af(u,e))}}w.UnionNodeFactory=class extends mt{constructor(u){super(),this._functionService=u}get zIndex(){return lt.get(ce.UNION)||ft}create(u){return new Xf(u)}checkAndCreateNodeType(u){if(!(u instanceof ie))return;const t=u.getToken().trim();if(!(t.charAt(0)==='"'&&t.charAt(t.length-1)==='"')&&t===X.COLON)return this.create(t)}},w.UnionNodeFactory=qf([Kf(0,Et)],w.UnionNodeFactory);class Zf extends ke{constructor(u){super(u)}get nodeType(){return ce.VALUE}execute(){this.setValue(ut.create(this.getToken()))}}class Ws extends mt{get zIndex(){return lt.get(ce.VALUE)||ft}_checkValueNode(u){if(Number.isNaN(Number(u))){const e=u.trim(),t=e.charAt(0),r=e.charAt(e.length-1);if(xt.has(e))return this.create(e);if(t==='"'&&r==='"')return this.create(e);if(t==="{"&&r==="}")return this.create(e);const n=e.toUpperCase();if(n===bt.TRUE||n===bt.FALSE)return this.create(n)}else return this.create(u)}create(u){return new Zf(u)}checkAndCreateNodeType(u){if(!(u instanceof ie))return this._checkValueNode(u)}}var zf=Object.getOwnPropertyDescriptor,Jf=(i,u,e,t)=>{for(var r=t>1?void 0:t?zf(u,e):u,n=i.length-1,s;n>=0;n--)(s=i[n])&&(r=s(r)||r);return r},rt=(i,u)=>(e,t)=>u(e,t,i);w.AstTreeBuilder=class extends S.Disposable{constructor(e,t,r,n,s,a,o,c,l,f,m){super();A(this,"_astNodeFactoryList",[]);this._runtimeService=e,this._astRootNodeFactory=t,this._functionNodeFactory=r,this._lambdaNodeFactory=n,this._lambdaParameterNodeFactory=s,this._operatorNodeFactory=a,this._prefixNodeFactory=o,this._referenceNodeFactory=c,this._suffixNodeFactory=l,this._unionNodeFactory=f,this._valueNodeFactory=m,this._initializeAstNode()}dispose(){this._astNodeFactoryList.forEach(e=>{e.dispose()}),this._astNodeFactoryList=[]}parse(e){const t=new Bs(pt),r=this._parse(e,t);return e.hasDefinedNames()&&(r==null||r.setDefinedNames(e.getDefinedNames())),r}_lambdaParameterHandler(e,t){if(t.getLambdaId==null)return Le.create(h.VALUE);const r=t.getLambdaId(),n=new Bs(pt),s=this._runtimeService.getFunctionDefinitionPrivacyVar(r);if(!s)return!1;const a=[...s.keys()],o=e.getChildren(),c=o.length;for(let l=0;l<c;l++){const f=o[l];if(f instanceof ie){ks(f,r,s),this._parse(f,n);const d=n.getChildren()[l];d!=null&&s.set(a[l],d)}else return!1}return n.setParent(t),t}_changeLetToLambda(e){const t=e.getChildren(),r=t.length;if(r%2!==1||r===0)return;const n=new ie;n.setToken(yr);const s=new ie;s.setToken(Jt);const a=[...t];for(let c=0;c<r;c++){const l=a[c];if(!(l instanceof ie))return;c%2===0?l.changeToParent(n):l.changeToParent(s)}n.addChildrenFirst(s),s.setParent(n);const o=e.getParent();return o==null||o.replaceChild(e,n),n}_parse(e,t){var f;const r=e.getChildren(),n=r.length,s=[];let a=null;const o=e.getToken().trim().toUpperCase();if(o===Sc){const m=this._changeLetToLambda(e);return m!=null?this._parse(m,t):Le.create(h.ERROR)}if(o===at){if(a=t,n===0)return new Bf(pt).setParent(t),a}else{if(o===Jt){let m=this._lambdaParameterHandler(e,t);return m===!1&&(m=Le.create(h.ERROR)),m}if(a=this._checkAstNode(e),a==null)return Le.create(h.NAME)}const c=r[0];for(let m=0;m<n;m++){const d=r[m];if(Yi(c)){if(m!==0&&m!==n-1)continue}else if(jf(d)&&m!==n-1)continue;let C=null;if(d instanceof ie){if(d.getToken()===at&&d.getChildren().length===0){const _=(f=d.getParent())==null?void 0:f.getChildren();if(_&&_.length===1)return Le.create(h.NAME)}if(C=this._parse(d,a),C===a)continue}else C=this._checkAstNode(d);if(C==null)return Le.create(h.NAME);if(C=qu(C),C==null||(C==null?void 0:C.nodeType)===ce.ERROR)return C;switch(C.nodeType){case ce.FUNCTION:{const _=C.getToken().trim().toUpperCase();Dc.has(_)&&C.setForcedCalculateFunction(),s.push(C);break}case ce.LAMBDA:s.push(C);break;case ce.LAMBDA_PARAMETER:s.push(C);break;case ce.OPERATOR:{const _=s.pop(),E=s.pop();E&&E.setParent(C),_&&_.setParent(C),s.push(C);break}case ce.REFERENCE:s.push(C);break;case ce.ROOT:s.push(C);break;case ce.UNION:s.push(C);break;case ce.VALUE:s.push(C);break;case ce.PREFIX:s.push(C);break;case ce.SUFFIX:s.push(C);break}}const l=s.length;for(let m=0;m<l;m++)s[m].setParent(a);return a}_checkAstNode(e){let t=null;const r=this._astNodeFactoryList.length;for(let n=0;n<r&&(t=this._astNodeFactoryList[n].checkAndCreateNodeType(e),t==null);n++);return t==null?new Df:t}_initializeAstNode(){this._astNodeFactoryList=[this._astRootNodeFactory,this._functionNodeFactory,this._lambdaNodeFactory,this._lambdaParameterNodeFactory,this._operatorNodeFactory,this._prefixNodeFactory,this._referenceNodeFactory,this._suffixNodeFactory,this._unionNodeFactory,this._valueNodeFactory].sort(S.sortRules)}},w.AstTreeBuilder=Jf([rt(0,ct),rt(1,S.Inject(Fs)),rt(2,S.Inject(w.FunctionNodeFactory)),rt(3,S.Inject(w.LambdaNodeFactory)),rt(4,S.Inject($s)),rt(5,S.Inject(w.OperatorNodeFactory)),rt(6,S.Inject(w.PrefixNodeFactory)),rt(7,S.Inject(w.ReferenceNodeFactory)),rt(8,S.Inject(w.SuffixNodeFactory)),rt(9,S.Inject(w.UnionNodeFactory)),rt(10,S.Inject(Ws))],w.AstTreeBuilder);class qi extends S.Disposable{constructor(){super(...arguments);A(this,"_otherFormulaData",new Map);A(this,"_featureFormulaData",new Map);A(this,"_formulaData",new Map);A(this,"_definedNameMap",new Map);A(this,"_otherFormulaDataMainData",new Set);A(this,"_dependencyRTreeCache",new S.RTree);A(this,"_dependencyTreeIdLast",0)}buildDependencyTree(e,t){throw new Error("Method not implemented.")}getTreeById(e){throw new Error("Method not implemented.")}getAllTree(){throw new Error("Method not implemented.")}reset(){throw new Error("Method not implemented.")}addOtherFormulaDependency(e,t,r,n){throw new Error("Method not implemented.")}removeOtherFormulaDependency(e,t,r){throw new Error("Method not implemented.")}clearOtherFormulaDependency(e,t){throw new Error("Method not implemented.")}addFeatureFormulaDependency(e,t,r,n){throw new Error("Method not implemented.")}removeFeatureFormulaDependency(e,t,r){throw new Error("Method not implemented.")}clearFeatureFormulaDependency(e,t){throw new Error("Method not implemented.")}addFormulaDependency(e,t,r,n,s){throw new Error("Method not implemented.")}removeFormulaDependency(e,t,r,n){throw new Error("Method not implemented.")}clearFormulaDependency(e,t){throw new Error("Method not implemented.")}removeFormulaDependencyByDefinedName(e,t){throw new Error("Method not implemented.")}searchDependency(e,t){return this._dependencyRTreeCache.bulkSearch(e,t)}_restDependencyTreeId(){this._dependencyTreeIdLast=0}getOtherFormulaDependency(e,t,r){var n,s;return(s=(n=this._otherFormulaData.get(e))==null?void 0:n.get(t))==null?void 0:s.get(r)}addOtherFormulaDependencyMainData(e){this._otherFormulaDataMainData.add(e)}hasOtherFormulaDataMainData(e){return this._otherFormulaDataMainData.has(e)}_removeDependencyRTreeCacheById(e,t){this._dependencyRTreeCache.removeById(e,t)}getFeatureFormulaDependency(e,t,r){var n,s;return(s=(n=this._featureFormulaData.get(e))==null?void 0:n.get(t))==null?void 0:s.get(r)}getFormulaDependency(e,t,r,n){var s,a;return(a=(s=this._formulaData.get(e))==null?void 0:s.get(t))==null?void 0:a.getValue(r,n)}addDependencyRTreeCache(e){const t=[];for(let r=0;r<e.rangeList.length;r++){const n=e.rangeList[r],{unitId:s,sheetId:a,range:o}=n;t.push({unitId:s,sheetId:a,range:o,id:e.treeId})}this._dependencyRTreeCache.bulkInsert(t),this._addAllTreeMap(e)}getLastTreeId(){const e=this._dependencyTreeIdLast;return this._dependencyTreeIdLast++,e}_addAllTreeMap(e){throw new Error("Method not implemented.")}_addDefinedName(e,t,r){this._definedNameMap.has(e)||this._definedNameMap.set(e,new Map);const n=this._definedNameMap.get(e);n.has(t)||n.set(t,new Set),n.get(t).add(r)}addFormulaDependencyByDefinedName(e,t){const r=e.treeId,n=(t==null?void 0:t.getDefinedNames())||[];for(const s of n)this._addDefinedName(e.unitId,s,r)}}class Ki extends qi{constructor(){super(...arguments);A(this,"_allTreeMap",new Map)}dispose(){super.dispose(),this.reset()}buildDependencyTree(e,t=[]){const r=this.getAllTree();return e.length===0?(this._buildReverseDependency(r,t),r):(this._buildDependencyTree(r,e),this._buildReverseDependency(r,e),r)}_buildDependencyTree(e,t){const r=new Map;for(let n=0;n<t.length;n++){const s=t[n];r.set(s.treeId,s)}for(let n=0;n<e.length;n++){const s=e[n],a=s.toRTreeItem(),o=this._dependencyRTreeCache.bulkSearch(a);for(const c of o){const l=r.get(c);l&&s!==l&&!l.hasChildren(s.treeId)&&l.pushChildren(s)}}r.clear()}_buildReverseDependency(e,t){const r=new Map;for(let n=0;n<e.length;n++){const s=e[n];r.set(s.treeId,s)}for(let n=0;n<t.length;n++){const s=t[n],a=s.toRTreeItem(),o=this._dependencyRTreeCache.bulkSearch(a);for(const c of o){const l=r.get(c);l&&s!==l&&!l.hasChildren(s.treeId)&&l.pushChildren(s)}}r.clear()}getAllTree(){const e=[];return this._allTreeMap.forEach(t=>{t.resetState(),e.push(t)}),e}getTreeById(e){return this._allTreeMap.get(e)}reset(){this._otherFormulaData.clear(),this._featureFormulaData.clear(),this._formulaData.clear(),this._definedNameMap.clear(),this._otherFormulaDataMainData.clear(),this._dependencyRTreeCache.clear(),this._allTreeMap.clear(),this._restDependencyTreeId()}addOtherFormulaDependency(e,t,r,n){this._otherFormulaData.has(e)||this._otherFormulaData.set(e,new Map);const s=this._otherFormulaData.get(e);s.has(t)||s.set(t,new Map);const a=s.get(t);a.has(r)||a.set(r,new S.ObjectMatrix),a.get(r).setValue(n.refOffsetX,n.refOffsetY,n.treeId),this._addAllTreeMap(n)}removeOtherFormulaDependency(e,t,r){const n=this._otherFormulaData.get(e);if(n&&n.has(t)){const s=n.get(t);r.forEach(a=>{const o=s.get(a);o!=null&&(o.forValue((c,l,f)=>{this._removeDependencyRTreeCache(f),this.clearDependencyForTree(this._allTreeMap.get(f)),this._removeAllTreeMap(f)}),s.delete(a),this._otherFormulaDataMainData.delete(a))}),s.size===0&&n.delete(t),n.size===0&&this._otherFormulaData.delete(e)}}clearOtherFormulaDependency(e,t){const r=this._otherFormulaData.get(e);if(t&&r&&r.has(t)){const n=r.get(t);this._removeDependencyRTreeCacheById(e,t);for(const s of n.keys()){const a=n.get(s);a!=null&&(a.forValue((o,c,l)=>{const f=this._allTreeMap.get(l);f&&(this.clearDependencyForTree(f),this._removeAllTreeMap(l))}),this._otherFormulaDataMainData.delete(s))}n.clear()}else if(r){for(const n of r.keys()){const s=r.get(n);this._removeDependencyRTreeCacheById(e,n);for(const a of s.keys()){const o=s.get(a);o!=null&&(o.forValue((c,l,f)=>{const m=this._allTreeMap.get(f);m&&(this.clearDependencyForTree(m),this._removeAllTreeMap(f))}),this._otherFormulaDataMainData.delete(a))}}this._otherFormulaData.delete(e)}}addFeatureFormulaDependency(e,t,r,n){this._featureFormulaData.has(e)||this._featureFormulaData.set(e,new Map);const s=this._featureFormulaData.get(e);s.has(t)||s.set(t,new Map),s.get(t).set(r,n.treeId),this._addAllTreeMap(n)}removeFeatureFormulaDependency(e,t,r){const n=this._featureFormulaData.get(e);if(n&&n.has(t)){const s=n.get(t);r.forEach(a=>{const o=s.get(a);o!=null&&(this._removeDependencyRTreeCache(o),s.delete(a),this.clearDependencyForTree(this._allTreeMap.get(o)),this._removeAllTreeMap(o))})}}clearFeatureFormulaDependency(e,t){const r=this._featureFormulaData.get(e);if(t&&r&&r.has(t)){const n=r.get(t);this._removeDependencyRTreeCacheById(e,t),n.forEach(s=>{s!=null&&(this.clearDependencyForTree(this._allTreeMap.get(s)),this._removeAllTreeMap(s))}),n.clear()}else r&&(r.forEach((n,s)=>{this._removeDependencyRTreeCacheById(e,s),n.forEach(a=>{a!=null&&(this.clearDependencyForTree(this._allTreeMap.get(a)),this._removeAllTreeMap(a))})}),this._featureFormulaData.delete(e))}addFormulaDependency(e,t,r,n,s){this._formulaData.has(e)||this._formulaData.set(e,new Map);const a=this._formulaData.get(e);a.has(t)||a.set(t,new S.ObjectMatrix),a.get(t).setValue(r,n,s.treeId),this._addAllTreeMap(s)}removeFormulaDependency(e,t,r,n){const s=this._formulaData.get(e);if(s&&s.has(t)){const a=s.get(t),o=a.getValue(r,n);if(o==null)return;this._removeDependencyRTreeCache(o),a.realDeleteValue(r,n),this.clearDependencyForTree(this._allTreeMap.get(o)),this._removeAllTreeMap(o)}}clearFormulaDependency(e,t){const r=this._formulaData.get(e);if(t&&r&&r.has(t)){const n=r.get(t);this._removeDependencyRTreeCacheById(e,t),n.forValue((s,a,o)=>{if(o==null)return!0;this.clearDependencyForTree(this._allTreeMap.get(o)),this._removeAllTreeMap(o)}),n.reset()}else r&&(r.forEach((n,s)=>{this._removeDependencyRTreeCacheById(e,s),n.forValue((a,o,c)=>{if(c==null)return!0;this.clearDependencyForTree(this._allTreeMap.get(c)),this._removeAllTreeMap(c)})}),this._formulaData.delete(e))}clearDependencyForTree(e){if(e==null)return;const t=e.parents,r=e.children,n=this._allTreeMap;for(const s of t){const a=n.get(s);a==null||a.children.delete(e.treeId)}for(const s of r){const a=n.get(s);a==null||a.parents.delete(e.treeId)}e.dispose()}_removeDependencyRTreeCache(e){if(e==null)return;const t=this._allTreeMap.get(e);if(t){const r=[];for(let n=0;n<t.rangeList.length;n++){const s=t.rangeList[n],{unitId:a,sheetId:o,range:c}=s;r.push({unitId:a,sheetId:o,range:c,id:e})}this._dependencyRTreeCache.bulkRemove(r)}}removeFormulaDependencyByDefinedName(e,t){const r=this._definedNameMap.get(e);if(r){const n=r.get(t);if(n){for(const s of n)this._removeDependencyRTreeCache(s),this.clearDependencyForTree(this._allTreeMap.get(s)),this._removeAllTreeMap(s);n.clear()}}}_removeAllTreeMap(e){e!=null&&this._allTreeMap.delete(e)}_addAllTreeMap(e){this._allTreeMap.set(e.treeId,e)}}const Mr=S.createIdentifier("univer.formula.dependency-manager.service");class Xi extends S.Disposable{constructor(){super(...arguments);A(this,"_referenceExecutorMap",new Map);A(this,"_onChanged$",new De.Subject);A(this,"onChanged$",this._onChanged$.asObservable())}dispose(){super.dispose(),this._referenceExecutorMap.clear(),this._onChanged$.complete()}remove(e,t,r){r.forEach(n=>{var s,a;(a=(s=this._referenceExecutorMap.get(e))==null?void 0:s.get(t))==null||a.delete(n)}),this._onChanged$.next({unitId:e,subUnitId:t,featureIds:r})}get(e,t,r){var n,s;return(s=(n=this._referenceExecutorMap.get(e))==null?void 0:n.get(t))==null?void 0:s.get(r)}has(e,t,r){var n,s;return!!((s=(n=this._referenceExecutorMap.get(e))==null?void 0:n.get(t))!=null&&s.has(r))}register(e,t,r,n){let s=this._referenceExecutorMap.get(e);s||(s=new Map,this._referenceExecutorMap.set(e,s));let a=s.get(t);a||(a=new Map,s.set(t,a)),this._onChanged$.next({unitId:e,subUnitId:t,featureIds:[r]}),a.set(r,n)}getReferenceExecutorMap(){return this._referenceExecutorMap}}const ir=S.createIdentifier("univer.formula.feature-calculation-manager.service");class Zi extends S.Disposable{constructor(){super(...arguments);A(this,"_otherFormulaData",{})}dispose(){super.dispose(),this._otherFormulaData={}}remove(e){var s,a,o;const{unitId:t,subUnitId:r,formulaId:n}=e;(o=(a=(s=this._otherFormulaData)==null?void 0:s[t])==null?void 0:a[r])==null||delete o[n]}get(e){var s,a;const{unitId:t,subUnitId:r,formulaId:n}=e;return(a=(s=this._otherFormulaData[t])==null?void 0:s[r])==null?void 0:a[n]}has(e){var s,a;const{unitId:t,subUnitId:r,formulaId:n}=e;return((a=(s=this._otherFormulaData[t])==null?void 0:s[r])==null?void 0:a[n])!=null}register(e){const{unitId:t,subUnitId:r,formulaId:n,item:s}=e;this._otherFormulaData[t]||(this._otherFormulaData[t]={}),this._otherFormulaData[t][r]||(this._otherFormulaData[t][r]={}),this._otherFormulaData[t][r][n]=s}batchRegister(e){Object.keys(e).forEach(t=>{const r=e[t];if(r==null)return!0;Object.keys(r).forEach(n=>{const s=r[n];if(s==null)return!0;Object.keys(s).forEach(a=>{const o=s[a];if(o==null)return!0;this.register({unitId:t,subUnitId:n,formulaId:a,item:o})})})})}batchRemove(e){Object.keys(e).forEach(t=>{const r=e[t];if(r==null)return!0;Object.keys(r).forEach(n=>{const s=r[n];if(s==null)return!0;Object.keys(s).forEach(a=>{this.remove({unitId:t,subUnitId:n,formulaId:a})})})})}getOtherFormulaData(){return this._otherFormulaData}}const yn=S.createIdentifier("univer.formula.other-formula-manager.service");var Rn=(i=>(i[i.NORMAL_FORMULA=0]="NORMAL_FORMULA",i[i.OTHER_FORMULA=1]="OTHER_FORMULA",i[i.FEATURE_FORMULA=2]="FEATURE_FORMULA",i))(Rn||{});class zi{constructor(){A(this,"_state",0);A(this,"treeId");A(this,"children",new Set);A(this,"parents",new Set)}resetState(){this._state=0}setAdded(){this._state=1}isAdded(){return this._state===1}setSkip(){this._state=2}isSkip(){return this._state===2}pushChildren(u){this.children.add(u.treeId),u._pushParent(this)}hasChildren(u){return this.children.has(u)}_pushParent(u){this.parents.add(u.treeId)}}class Qs extends zi{constructor(){super(...arguments);A(this,"refTree");A(this,"refOffsetX",-1);A(this,"refOffsetY",-1);A(this,"isCache",!1);A(this,"isDirty",!1);A(this,"addressFunctionNodes",[]);A(this,"getDirtyData");A(this,"featureId")}get isVirtual(){return!0}get row(){return this.refTree==null?-1:this.refTree.row+this.refOffsetY}get column(){return this.refTree==null?-1:this.refTree.column+this.refOffsetX}get rowCount(){return this.refTree==null?0:this.refTree.rowCount}get columnCount(){return this.refTree==null?0:this.refTree.columnCount}get unitId(){return this.refTree==null?"":this.refTree.unitId}get subUnitId(){return this.refTree==null?"":this.refTree.subUnitId}get formula(){var e,t;return(t=(e=this.refTree)==null?void 0:e.formula)!=null?t:""}get nodeData(){return{node:this.node,refOffsetX:this.refOffsetX,refOffsetY:this.refOffsetY}}get node(){var e;return(e=this.refTree)==null?void 0:e.node}dispose(){this.refTree=null}get rangeList(){const e=[];if(this.refTree==null)return[];for(let t=0;t<this.refTree.rangeList.length;t++){const r=this.refTree.rangeList[t];e.push({unitId:r.unitId,sheetId:r.sheetId,range:S.moveRangeByOffset(r.range,this.refOffsetX,this.refOffsetY)})}return e}toRTreeItem(){const e=this.row,t=this.column;return[{unitId:this.unitId,sheetId:this.subUnitId,range:{startRow:e,startColumn:t,endRow:e,endColumn:t}}]}inRangeData(e){const t=e.startRow,r=e.startColumn,n=e.endRow,s=e.endColumn,a=this.row,o=this.column;return!(a<t||a>n||o<r||o>s)}dependencySheetName(e){return this.refTree==null?!1:this.refTree.dependencySheetName(e)}isExcludeRange(e){var r;const t=this.rangeList;if(t.length===0)return!1;for(let n=0,s=t.length;n<s;n++){const a=t[n],{unitId:o,sheetId:c,range:l}=a,f=(r=e==null?void 0:e[o])==null?void 0:r[c];let{startRow:m,endRow:d,startColumn:C,endColumn:_}=l;Number.isNaN(m)&&(m=0),Number.isNaN(C)&&(C=0),Number.isNaN(d)&&(d=Number.POSITIVE_INFINITY),Number.isNaN(_)&&(_=Number.POSITIVE_INFINITY);let E=!1;if(f==null||f.forValue((b,R)=>{if(b>=m&&b<=d&&R>=C&&R<=_)return E=!0,!1}),E)return!0}return!1}get formulaId(){return this.refTree==null?"":this.refTree.formulaId}}class Nn extends zi{constructor(e){super();A(this,"isCache",!1);A(this,"featureId");A(this,"featureDirtyRanges",[]);A(this,"refOffsetX",0);A(this,"refOffsetY",0);A(this,"type",0);A(this,"formulaId");A(this,"subUnitId","");A(this,"unitId","");A(this,"rangeList",[]);A(this,"formula","");A(this,"row",-1);A(this,"column",-1);A(this,"rowCount",Number.NEGATIVE_INFINITY);A(this,"columnCount",Number.NEGATIVE_INFINITY);A(this,"isDirty",!1);A(this,"node");A(this,"addressFunctionNodes",[]);A(this,"getDirtyData");this.treeId=e}get isVirtual(){return!1}get nodeData(){return{node:this.node,refOffsetX:0,refOffsetY:0}}toJson(){return{formula:this.formula,refOffsetX:this.refOffsetX,refOffsetY:this.refOffsetY}}dispose(){this.featureDirtyRanges=[],this.rangeList=[],this.addressFunctionNodes=[],this.getDirtyData=null}inRangeData(e){const t=e.startRow,r=e.startColumn,n=e.endRow,s=e.endColumn,a=this.row,o=this.column;return!(a<t||a>n||o<r||o>s)}dependencySheetName(e){var r;const t=this.rangeList;if(t.length===0||e==null)return!1;for(let n=0,s=t.length;n<s;n++){const a=t[n],{unitId:o,sheetId:c}=a;if(((r=e[o])==null?void 0:r[c])!=null)return!0}return!1}isExcludeRange(e){var r;const t=this.rangeList;if(t.length===0)return!1;for(let n=0,s=t.length;n<s;n++){const a=t[n],{unitId:o,sheetId:c,range:l}=a,f=(r=e==null?void 0:e[o])==null?void 0:r[c];let{startRow:m,endRow:d,startColumn:C,endColumn:_}=l;Number.isNaN(m)&&(m=0),Number.isNaN(C)&&(C=0),Number.isNaN(d)&&(d=Number.POSITIVE_INFINITY),Number.isNaN(_)&&(_=Number.POSITIVE_INFINITY);let E=!1;if(f==null||f.forValue((b,R)=>{if(b>=m&&b<=d&&R>=C&&R<=_)return E=!0,!1}),E)return!0}return!1}pushRangeList(e){this.rangeList.push(...e)}shouldBePushRangeList(){return this.rangeList.length===0&&this.type!==2}toRTreeItem(){if(this.featureId!=null)return this.featureDirtyRanges;const e=this.row,t=this.column;return[{unitId:this.unitId,sheetId:this.subUnitId,range:{startRow:e,startColumn:t,endRow:e,endColumn:t}}]}}var em=Object.getOwnPropertyDescriptor,tm=(i,u,e,t)=>{for(var r=t>1?void 0:t?em(u,e):u,n=i.length-1,s;n>=0;n--)(s=i[n])&&(r=s(r)||r);return r},wt=(i,u)=>(e,t)=>u(e,t,i);function kt(i){return i.getLastTreeId()||0}const pn=S.createIdentifier("engine-formula.dependency-generator");w.FormulaDependencyGenerator=class extends S.Disposable{constructor(e,t,r,n,s,a,o,c){super();A(this,"_updateRangeFlattenCache",new Map);A(this,"_dependencyRTreeCacheForAddressFunction",new S.RTree);A(this,"_executedAddressFunctionNodeIds",new Set);this._currentConfigService=e,this._runtimeService=t,this._otherFormulaManagerService=r,this._featureCalculationManagerService=n,this._interpreter=s,this._astTreeBuilder=a,this._lexer=o,this._dependencyManagerService=c}dispose(){this._updateRangeFlattenCache.clear(),this._dependencyRTreeCacheForAddressFunction.clear(),Sr.clear()}async generate(){this._updateRangeFlatten();const e=this._currentConfigService.getFormulaData(),t=this._otherFormulaManagerService.getOtherFormulaData(),r=this._currentConfigService.getClearDependencyTreeCache();r!=null&&Object.keys(r).forEach(f=>{f!=null&&Object.keys(r[f]).forEach(m=>{m!=null&&(this._dependencyManagerService.clearOtherFormulaDependency(f,m),this._dependencyManagerService.clearFeatureFormulaDependency(f,m),this._dependencyManagerService.clearFormulaDependency(f,m))})});const n=this._currentConfigService.getUnitData(),s=await this._generateTreeList(e,t,n),a=this._getUpdateTreeListAndMakeDependency(s);let o=this._calculateRunList(a);return this._dependencyFeatureCalculation(o)&&(o.forEach(f=>{f.resetState()}),o=this._calculateRunList(o)),this._checkIsCycleDependency(o)&&this._runtimeService.enableCycleDependency(),this._dependencyRTreeCacheForAddressFunction.clear(),Promise.resolve(o)}_dependencyFeatureCalculation(e){const t=this._featureCalculationManagerService.getReferenceExecutorMap();if(t.size===0)return;this._clearFeatureCalculationNode(e);let r=!1;return t.forEach((n,s)=>{n.forEach((a,o)=>{a.forEach((c,l)=>{const{unitId:f,subUnitId:m,getDirtyData:d}=c,C=d(this._currentConfigService.getDirtyData(),this._runtimeService.getAllRuntimeData()),_=this._convertDirtyRangesToUnitRange(C.dirtyRanges),E=this._intersectFeatureCalculation(_,e,{unitId:f,subUnitId:m,featureId:l});if(E.length>0){let b=this._getExistTreeList({unitId:f,subUnitId:m,featureId:l},e);b==null&&(b=this._getFeatureFormulaTree(l,kt(this._dependencyManagerService),c),e.push(b)),b.parents=new Set,E.forEach(R=>{R.hasChildren(b.treeId)||R.pushChildren(b)}),r=!0}})})}),r}_clearFeatureCalculationNode(e){const t=this._featureCalculationManagerService.getReferenceExecutorMap();e.forEach(r=>{var a,o,c,l;const n=new Set;for(const f of r.children){const m=this._dependencyManagerService.getTreeById(f);m&&(m.featureId&&(o=(a=t.get(r.unitId))==null?void 0:a.get(r.subUnitId))!=null&&o.has(m.featureId)||n.add(f))}r.children=n;const s=new Set;for(const f of r.parents){const m=this._dependencyManagerService.getTreeById(f);m&&(m.featureId&&(l=(c=t.get(r.unitId))==null?void 0:c.get(r.subUnitId))!=null&&l.has(m.featureId)||s.add(f))}r.parents=s})}_convertDirtyRangesToUnitRange(e){const t=[];for(const r in e){const n=e[r];for(const s in n){const a=n[s];for(const o of a)t.push({unitId:r,sheetId:s,range:o})}}return t}_intersectFeatureCalculation(e,t,r){const n=[],s=this._dependencyManagerService.searchDependency(e);for(let a=0,o=t.length;a<o;a++){const c=t[a];if(c.unitId===r.unitId&&c.subUnitId===r.subUnitId&&c.featureId===r.featureId)continue;s.has(c.treeId)&&n.push(c)}return n}_getExistTreeList(e,t){const{unitId:r,subUnitId:n,featureId:s}=e;for(let a=0,o=t.length;a<o;a++){const c=t[a];if(c.unitId===r&&c.subUnitId===n&&c.featureId===s)return c}}_isCyclicUtil(e,t,r){const n=this._dependencyManagerService.getTreeById(e);if(n==null)return!1;if(!t.has(n.treeId)){t.add(n.treeId),r.add(n.treeId);for(const s of n.children)if(!t.has(s)&&this._isCyclicUtil(s,t,r)||r.has(s))return!0}return r.delete(n.treeId),!1}_checkIsCycleDependency(e){const t=new Set,r=new Set;for(let n=0,s=e.length;n<s;n++){const a=e[n];if(this._isCyclicUtil(a.treeId,t,r)===!0)return!0}return!1}async _generateTreeList(e,t,r){const n=Object.keys(e),s=Object.keys(t),a=[];this._currentConfigService.isForceCalculate()&&this._dependencyManagerService.reset(),this._registerFormulas(n,e,r,a),this._registerOtherFormulas(t,s,a),this._registerFeatureFormulas(a);for(let c=0,l=a.length;c<l;c++){const f=a[c];if(!f.formula)continue;const m=this._getTreeNode(f);f.isDirty=this._includeTree(f,m);const d=this._getAddressFunctionNodeList(m);if(d.length>0&&(f.addressFunctionNodes=d),f.isVirtual)continue;this._runtimeService.setCurrent(f.row,f.column,f.rowCount,f.columnCount,f.subUnitId,f.unitId);const C=await this._getRangeListByNode({node:m,refOffsetX:f.refOffsetX,refOffsetY:f.refOffsetY});f.pushRangeList(C)}for(let c=0,l=a.length;c<l;c++){const f=a[c];f.isCache||this._dependencyManagerService.addDependencyRTreeCache(f)}return await this._calculateListByFunctionRefNode(a),a}_registerFeatureFormulas(e){this._featureCalculationManagerService.getReferenceExecutorMap().forEach((r,n)=>{r.forEach((s,a)=>{s.forEach((o,c)=>{const l=this._dependencyManagerService.getFeatureFormulaDependency(o.unitId,o.subUnitId,c);e.push(this._getFeatureFormulaTree(c,l,o))})})})}_getFeatureFormulaTree(e,t,r){const{unitId:n,subUnitId:s,dependencyRanges:a,getDirtyData:o}=r,c=t||kt(this._dependencyManagerService),l=new Nn(c);l.unitId=n,l.subUnitId=s,l.rangeList=a,l.getDirtyData=o;const f=o(this._currentConfigService.getDirtyData(),this._runtimeService.getAllRuntimeData()),m=this._convertDirtyRangesToUnitRange(f.dirtyRanges);return l.featureDirtyRanges=m,l.featureId=e,l.type=Rn.FEATURE_FORMULA,this._dependencyManagerService.addFeatureFormulaDependency(n,s,e,l),this._dependencyManagerService.getFeatureFormulaDependency(r.unitId,r.subUnitId,e)&&(l.isCache=!0),l}_registerOtherFormulas(e,t,r){for(const n of t){const s=e[n];if(s==null)continue;const a=Object.keys(s);for(const o of a){const c=s[o];if(c==null)continue;const l=Object.keys(c);for(const f of l){const m=this._dependencyManagerService.hasOtherFormulaDataMainData(f),d=c[f],{f:C,ranges:_}=d;let E=!1;m&&(E=!0);const b=Is(n,C,this._lexer,this._astTreeBuilder,this._currentConfigService),{firstRow:R,firstColumn:N}=this._getFirstCellOfRange(_),V=this._dependencyManagerService.getOtherFormulaDependency(n,o,f),M=(V==null?void 0:V.getValue(0,0))||kt(this._dependencyManagerService),D=new Nn(M);for(let L=0;L<_.length;L++){const P=_[L],{startRow:j,startColumn:F,endRow:v,endColumn:Y}=P;for(let q=j;q<=v;q++)for(let se=F;se<=Y;se++){const te=se-N,Q=q-R;if(te===0&&Q===0){D.node=b,D.formula=C,D.unitId=n,D.subUnitId=o,D.formulaId=f,D.type=Rn.OTHER_FORMULA,D.isCache=E,r.push(D),this._dependencyManagerService.addOtherFormulaDependency(n,o,f,D),this._dependencyManagerService.addFormulaDependencyByDefinedName(D);continue}const le=new Qs;le.treeId=(V==null?void 0:V.getValue(te,Q))||kt(this._dependencyManagerService),le.refTree=D,le.refOffsetX=te,le.refOffsetY=Q,le.isCache=E,this._dependencyManagerService.addOtherFormulaDependency(n,o,f,le),this._dependencyManagerService.addFormulaDependencyByDefinedName(le),r.push(le)}}this._dependencyManagerService.addOtherFormulaDependencyMainData(f)}}}}_getFirstCellOfRange(e){const t=e[0];return{firstRow:t.startRow,firstColumn:t.startColumn}}_registerFormulas(e,t,r,n){for(const s of e){const a=t[s];if(a==null)continue;const o=Object.keys(a);for(const c of o){const l=new S.ObjectMatrix(a[c]||{}),f=new Map;l.forValue((m,d,C)=>{if(C==null)return!0;const{x:_=0,y:E=0,si:b}=C;if(!(_===0&&E===0&&b!=null))return!0;const R=this._createFDtree(s,c,m,d,r,C),N=this._dependencyManagerService.getFormulaDependency(s,c,m,d);N!=null?R.treeId=N:(this._dependencyManagerService.addFormulaDependency(s,c,m,d,R),this._dependencyManagerService.addFormulaDependencyByDefinedName(R)),f.set(b,R),n.push(R)}),l.forValue((m,d,C)=>{if(C==null)return!0;const{x:_=0,y:E=0,si:b}=C;if(_===0&&E===0&&b!=null)return!0;let R;if(b&&f.has(b)){const V=f.get(b);R=this._createVirtualFDtree(V,C)}else R=this._createFDtree(s,c,m,d,r,C);const N=this._dependencyManagerService.getFormulaDependency(s,c,m,d);N!=null?R.treeId=N:(this._dependencyManagerService.addFormulaDependency(s,c,m,d,R),this._dependencyManagerService.addFormulaDependencyByDefinedName(R)),n.push(R)}),f.clear()}}}_createFDtree(e,t,r,n,s,a){const{f:o,x:c=0,y:l=0}=a,f=new Nn(kt(this._dependencyManagerService)),m=s[e][t],d=Is(e,o,this._lexer,this._astTreeBuilder,this._currentConfigService);return f.node=d,f.formula=o,f.unitId=e,f.subUnitId=t,f.row=r,f.column=n,f.rowCount=m.rowCount,f.columnCount=m.columnCount,f}_createVirtualFDtree(e,t){const{x:r=0,y:n=0}=t,s=new Qs;return s.treeId=kt(this._dependencyManagerService),s.refTree=e,s.refOffsetX=r,s.refOffsetY=n,s}_updateRangeFlatten(){const e=this._currentConfigService.isForceCalculate(),t=this._currentConfigService.getDirtyRanges();if(!e){this._updateRangeFlattenCache.clear();for(let r=0;r<t.length;r++){const n=t[r],s=n.range,a=n.sheetId,o=n.unitId;this._addFlattenCache(o,a,s)}}}_addFlattenCache(e,t,r){let n=this._updateRangeFlattenCache.get(e);n==null&&(n=new Map,this._updateRangeFlattenCache.set(e,n));let s=n.get(t);s==null&&(s=[],n.set(t,s)),s.push(r)}_isPreCalculateNode(e){return e.nodeType===ce.UNION||e.nodeType===ce.PREFIX&&e.getToken()===Ve.AT||e.nodeType===ce.SUFFIX&&e.getToken()===qe.POUND}_nodeTraversalRef(e,t){const r=e.getChildren(),n=r.length;for(let s=0;s<n;s++){const a=r[s];if(this._isPreCalculateNode(a)){if(t.push(a),a.nodeType===ce.UNION)for(const o of a.getChildren())o.nodeType===ce.FUNCTION&&o.isAddress()&&this._nodeTraversalRef(o,t);continue}else a.nodeType===ce.REFERENCE&&t.push(a);this._nodeTraversalRef(a,t)}}_nodeTraversalReferenceFunction(e,t){const r=e.getChildren(),n=r.length;for(let s=0;s<n;s++){const a=r[s];if(a.nodeType===ce.FUNCTION&&a.isAddress()){t.push(a);continue}this._nodeTraversalReferenceFunction(a,t)}}async _executeNode(e,t=0,r=0){let n;const s={node:e,refOffsetX:t,refOffsetY:r};return this._interpreter.checkAsyncNode(e)?n=await this._interpreter.executeAsync(s):n=this._interpreter.execute(s),n}async _getRangeListByNode(e){const t=[],r=e.refOffsetX,n=e.refOffsetY,s=e.node;if(s==null)return[];this._nodeTraversalRef(s,t);const a=[];for(let o=0,c=t.length;o<c;o++){const l=t[o],m=(await this._executeNode(l,r,n)).toUnitRange();a.push(m),l.setValue(null)}return a}_getAddressFunctionNodeList(e){const t=[];return e==null?[]:(this._nodeTraversalReferenceFunction(e,t),t)}_getTreeNode(e){return e.node}async _buildDirtyRangesByAddressFunction(e,t){const r=t.addressFunctionNodes;if(r.length===0)return;const n=t.refOffsetX,s=t.refOffsetY,a=await this._getRangeListByFunctionRefNode(r,n,s);t.addressFunctionNodes=[],this._addDependencyTreeByAddressFunction(t,a);const o=e.bulkSearch(a),c=this._buildTreeNodeById(o);c.length!==0&&await this._calculateAddressFunctionRuntimeData(e,c)}async _calculateListByFunctionRefNode(e){const t=new S.RTree;for(let r=0,n=e.length;r<n;r++){const s=e[r];t.insert({unitId:s.unitId,sheetId:s.subUnitId,range:{startRow:s.row,startColumn:s.column,endRow:s.row,endColumn:s.column},id:s.treeId})}this._executedAddressFunctionNodeIds.clear();for(let r=0,n=e.length;r<n;r++){const s=e[r];await this._calculateAddressFunction(t,s)}}async _calculateAddressFunction(e,t){const r=t.addressFunctionNodes;if(r.length===0)return;const n=t.refOffsetX,s=t.refOffsetY;this._runtimeService.setCurrent(t.row,t.column,t.rowCount,t.columnCount,t.subUnitId,t.unitId);const a=[];for(let l=0,f=r.length;l<f;l++){const m=await this._getRangeListByNode({node:r[l],refOffsetX:n,refOffsetY:s});a.push(...m)}const o=new Set;this._searchDependencyByAddressFunction(e,a,o);const c=this._buildTreeNodeById(o);if(c.length===0){await this._buildDirtyRangesByAddressFunction(e,t);return}await this._calculateAddressFunctionRuntimeData(e,c),await this._buildDirtyRangesByAddressFunction(e,t)}async _calculateAddressFunctionRuntimeData(e,t){for(;t.length>0;){const r=t.pop(),s={node:this._getTreeNode(r),refOffsetX:r.refOffsetX,refOffsetY:r.refOffsetY};await this._calculateAddressFunction(e,r),this._runtimeService.setCurrent(r.row,r.column,r.rowCount,r.columnCount,r.subUnitId,r.unitId);let a;this._interpreter.checkAsyncNode(s.node)?a=await this._interpreter.executeAsync(s):a=this._interpreter.execute(s),r.formulaId!=null?this._runtimeService.setRuntimeOtherData(r.formulaId,r.refOffsetX,r.refOffsetY,a):this._runtimeService.setRuntimeData(a)}}_buildTreeNodeById(e){const t=[];for(const r of e){const n=this._getTreeById(r);!n||this._executedAddressFunctionNodeIds.has(r)||(this._executedAddressFunctionNodeIds.add(r),t.push(n))}return t}_searchDependencyByAddressFunction(e,t,r){const n=e.bulkSearch(t),s=this._dependencyRTreeCacheForAddressFunction.bulkSearch(t);for(const o of s)r.has(o)||r.add(o);const a=[];for(const o of n){const c=this._getTreeById(o);c&&!r.has(o)&&(a.push(...c.rangeList),r.add(o))}return a.length>0&&this._searchDependencyByAddressFunction(e,a,r),r}_getTreeById(e){return this._dependencyManagerService.getTreeById(e)}_addDependencyTreeByAddressFunction(e,t){const r=[];for(let n=0;n<t.length;n++){const s=t[n],{unitId:a,sheetId:o,range:c}=s;r.push({unitId:a,sheetId:o,range:c,id:e.treeId})}this._dependencyRTreeCacheForAddressFunction.bulkInsert(r)}async _getRangeListByFunctionRefNode(e,t,r){const n=[];for(let s=0,a=e.length;s<a;s++){const o=e[s],l=(await this._executeNode(o,t,r)).toUnitRange();n.push(l),o.setValue(null)}return n}_getUpdateTreeListAndMakeDependency(e){const t=[],r=new Set,n=this._currentConfigService.isForceCalculate(),s=this._currentConfigService.getDirtyRanges(),a=this._dependencyManagerService.searchDependency(s),o=this._dependencyRTreeCacheForAddressFunction.bulkSearch(s);for(const l of o)a.add(l);const c=this._dependencyManagerService.buildDependencyTree(e);for(const l of c){const f=l.treeId;(n||l.isDirty||l.dependencySheetName(this._currentConfigService.getDirtyNameMap())||a.has(f)&&!l.isExcludeRange(this._currentConfigService.getExcludedRange()))&&!r.has(f)&&(t.push(l),r.add(f))}return t}_includeTreeFeature(e){var s,a;const t=e.unitId,r=e.subUnitId,n=e.featureId;if(n!=null){const o=this._currentConfigService.getDirtyUnitFeatureMap();if(((a=(s=o==null?void 0:o[t])==null?void 0:s[r])==null?void 0:a[n])!=null)return!0}return!1}_includeOtherFormula(e){var s,a;const t=e.unitId,r=e.subUnitId,n=e.formulaId;if(n!=null){const o=this._currentConfigService.getDirtyUnitOtherFormulaMap();if(((a=(s=o==null?void 0:o[t])==null?void 0:s[r])==null?void 0:a[n])!=null)return!0}return!1}_detectForcedRecalculationNode(e,t){return t==null?!1:this._detectForcedRecalculationNodeRecursion(t)}_detectForcedRecalculationNodeRecursion(e){if(e.isForcedCalculateFunction())return!0;const t=e.getChildren();for(let r=0,n=t.length;r<n;r++){const s=t[r];if(this._detectForcedRecalculationNodeRecursion(s))return!0}return!1}_includeTree(e,t){var l,f,m;const r=e.unitId,n=e.subUnitId;if(this._detectForcedRecalculationNode(e,t)===!0||this._includeTreeFeature(e)===!0||this._includeOtherFormula(e)===!0||Nf(e,t,this._currentConfigService)===!0)return!0;const s=(f=(l=this._currentConfigService.getExcludedRange())==null?void 0:l[r])==null?void 0:f[n];if((s==null?void 0:s.getValue(e.row,e.column))!=null)return!1;if(((m=this._currentConfigService.getDirtyNameMap()[r])==null?void 0:m[n])!=null)return!0;if(!this._updateRangeFlattenCache.has(r))return!1;const o=this._updateRangeFlattenCache.get(r);if(!o.has(n))return!1;const c=o.get(n);for(const d of c)if(e.inRangeData(d))return!0;return!1}_calculateRunList(e){e.length;const t=e,r=[],n=[];for(;t.length>0;){const s=t.pop();if(s===void 0||s.isSkip())continue;if(s.isAdded()){r.push(s),s.setSkip();continue}n.length=0;for(const o of s.parents){const c=this._dependencyManagerService.getTreeById(o);if(!c)throw new Error("ParentDependencyTree object is null");c.isAdded()||s.isSkip()||n.push(c)}const a=this._dependencyRTreeCacheForAddressFunction.bulkSearch(s.toRTreeItem());for(const o of a){const c=this._dependencyManagerService.getTreeById(o);if(!c)throw new Error("ParentDependencyTree object is null");c.isAdded()||s.isSkip()||n.push(c)}n.length===0?(r.push(s),s.setSkip()):(s.setAdded(),t.push(s,...n))}return r}},w.FormulaDependencyGenerator=tm([wt(0,Ct),wt(1,ct),wt(2,yn),wt(3,ir),wt(4,S.Inject(w.Interpreter)),wt(5,S.Inject(w.AstTreeBuilder)),wt(6,S.Inject(w.Lexer)),wt(7,Mr)],w.FormulaDependencyGenerator);var rm=Object.getOwnPropertyDescriptor,nm=(i,u,e,t)=>{for(var r=t>1?void 0:t?rm(u,e):u,n=i.length-1,s;n>=0;n--)(s=i[n])&&(r=s(r)||r);return r},$t=(i,u)=>(e,t)=>u(e,t,i);const Ji=500,Vn=S.createIdentifier("engine-formula.calculate-formula.service");w.CalculateFormulaService=class extends S.Disposable{constructor(e,t,r,n,s,a,o){super();A(this,"_executionInProgressListener$",new De.Subject);A(this,"executionInProgressListener$",this._executionInProgressListener$.asObservable());A(this,"_executionCompleteListener$",new De.Subject);A(this,"executionCompleteListener$",this._executionCompleteListener$.asObservable());A(this,"_executeLock",new S.AsyncLock);this._configService=e,this._lexer=t,this._currentConfigService=r,this._runtimeService=n,this._formulaDependencyGenerator=s,this._interpreter=a,this._astTreeBuilder=o}dispose(){super.dispose(),this._executionInProgressListener$.complete(),this._executionCompleteListener$.complete(),dn.clear(),Ye.clear(),ys.clear(),js.clear()}stopFormulaExecution(){this._runtimeService.stopExecution()}setRuntimeFeatureCellData(e,t){this._runtimeService.setRuntimeFeatureCellData(e,t)}setRuntimeFeatureRange(e,t){this._runtimeService.setRuntimeFeatureRange(e,t)}async execute(e){this._runtimeService.setFormulaExecuteStage(We.START),this._executionInProgressListener$.next(this._runtimeService.getRuntimeState()),this._currentConfigService.load(e),this._runtimeService.reset();const t=e.maxIteration||fi;this._executeLock.acquire("FORMULA_EXECUTION_LOCK",async()=>{for(let r=0;r<t&&(this._runtimeService.setFormulaCycleIndex(r),await this._executeStep(),dn.clear(),!!this._runtimeService.isCycleDependency());r++);this._runtimeService.setFormulaExecuteStage(We.CALCULATION_COMPLETED),this._executionInProgressListener$.next(this._runtimeService.getRuntimeState()),this._executionCompleteListener$.next(this._runtimeService.getAllRuntimeData()),Ye.clear(),this._runtimeService.reset()})}async _executeStep(){const e=await this._apply();if(e==null)return;const{arrayFormulaRange:t,runtimeFeatureRange:r}=e,{dirtyRanges:n,excludedCell:s}=this._getArrayFormulaDirtyRangeAndExcludedRange(t,r);return n==null||n.length===0||(this._currentConfigService.loadDirtyRangesAndExcludedCell(n,s),await this._apply(!0)),!0}_getArrayFormulaDirtyRangeAndExcludedRange(e,t){const r=[],n={};return Object.keys(e).forEach(s=>{const a=e[s];if(a==null)return!0;Object.keys(a).forEach(o=>{const c=new S.ObjectMatrix(a[o]);if(c==null)return!0;const l=new S.ObjectMatrix;c.forValue((f,m,d)=>{l.setValue(f,m,!0),r.push({unitId:s,sheetId:o,range:d})}),n[s]==null&&(n[s]={}),n[s][o]=l})}),Object.keys(t).forEach(s=>{const a=t[s];Object.keys(a).forEach(o=>{const c=a[o];if(c==null)return!0;Object.keys(c).forEach(l=>{const f=c[l];if(f==null)return!0;for(const m of f)r.push({unitId:o,sheetId:l,range:m})})})}),{dirtyRanges:r,excludedCell:n}}async _apply(e=!1){e?this._runtimeService.setFormulaExecuteStage(We.START_DEPENDENCY_ARRAY_FORMULA):this._runtimeService.setFormulaExecuteStage(We.START_DEPENDENCY),this._executionInProgressListener$.next(this._runtimeService.getRuntimeState());const t=(await this._formulaDependencyGenerator.generate()).reverse(),r=this._interpreter;e?(this._runtimeService.setFormulaExecuteStage(We.START_CALCULATION_ARRAY_FORMULA),this._runtimeService.setTotalArrayFormulasToCalculate(t.length)):(this._runtimeService.setFormulaExecuteStage(We.START_CALCULATION),this._runtimeService.setTotalFormulasToCalculate(t.length)),this._executionInProgressListener$.next(this._runtimeService.getRuntimeState());let n=[];const s=this._configService.getConfig(Zr),a=(s==null?void 0:s.intervalCount)||Ji,o=t.length;for(let c=0;c<o;c++){const l=t[c],f=l.nodeData,m=l.getDirtyData;if(c%a===0&&(await new Promise(C=>{const _=S.requestImmediateMacroTask(C);n.push(_)}),e?(this._runtimeService.setFormulaExecuteStage(We.CURRENTLY_CALCULATING_ARRAY_FORMULA),this._runtimeService.setCompletedArrayFormulasCount(c+1)):(this._runtimeService.setFormulaExecuteStage(We.CURRENTLY_CALCULATING),this._runtimeService.setCompletedFormulasCount(c+1)),this._executionInProgressListener$.next(this._runtimeService.getRuntimeState()),this._runtimeService.isStopExecution()||f==null&&m==null)){this._runtimeService.setFormulaExecuteStage(We.IDLE),this._runtimeService.markedAsStopFunctionsExecuted(),this._executionCompleteListener$.next(this._runtimeService.getAllRuntimeData());return}this._runtimeService.setCurrent(l.row,l.column,l.rowCount,l.columnCount,l.subUnitId,l.unitId);let d;if(m!=null&&l.featureId!=null){const{runtimeCellData:C,dirtyRanges:_}=m(this._currentConfigService.getDirtyData(),this._runtimeService.getAllRuntimeData());this._runtimeService.setRuntimeFeatureCellData(l.featureId,C),this._runtimeService.setRuntimeFeatureRange(l.featureId,_)}else f!=null&&(r.checkAsyncNode(f.node)?d=await r.executeAsync(f):d=r.execute(f),l.formulaId!=null?this._runtimeService.setRuntimeOtherData(l.formulaId,l.refOffsetX,l.refOffsetY,d):this._runtimeService.setRuntimeData(d))}return n.forEach(c=>c()),n=[],o>0?this._runtimeService.markedAsSuccessfullyExecuted():e||this._runtimeService.markedAsNoFunctionsExecuted(),this._runtimeService.getAllRuntimeData()}calculate(e,t=!0){const r=this._lexer.treeBuilder(e,t);if(Object.values(h).includes(r))return Le.create(r);const n=this._astTreeBuilder.parse(r);n==null||n.serialize()}},w.CalculateFormulaService=nm([$t(0,S.IConfigService),$t(1,S.Inject(w.Lexer)),$t(2,Ct),$t(3,ct),$t(4,pn),$t(5,S.Inject(w.Interpreter)),$t(6,S.Inject(w.AstTreeBuilder))],w.CalculateFormulaService);var sm=Object.getOwnPropertyDescriptor,am=(i,u,e,t)=>{for(var r=t>1?void 0:t?sm(u,e):u,n=i.length-1,s;n>=0;n--)(s=i[n])&&(r=s(r)||r);return r},qs=(i,u)=>(e,t)=>u(e,t,i);w.CalculateController=class extends S.Disposable{constructor(u,e,t){super(),this._commandService=u,this._calculateFormulaService=e,this._formulaDataModel=t,this._initialize()}_initialize(){this._commandExecutedListener(),this._initialExecuteFormulaListener()}_commandExecutedListener(){this.disposeWithMe(this._commandService.onCommandExecuted(u=>{if(u.id===is.id)this._calculateFormulaService.stopFormulaExecution();else if(u.id===as.id)this._calculate(u.params);else if(u.id===kr.id){const e=u.params;if(e==null)return;const{arrayFormulaRange:t,arrayFormulaCellData:r}=e;this._formulaDataModel.setArrayFormulaRange(t),this._formulaDataModel.setArrayFormulaCellData(r)}}))}async _calculate(u){const{forceCalculation:e=!1,dirtyRanges:t=[],dirtyNameMap:r={},dirtyDefinedNameMap:n={},dirtyUnitFeatureMap:s={},dirtyUnitOtherFormulaMap:a={},clearDependencyTreeCache:o={},maxIteration:c=fi,rowData:l}=u,f=this._formulaDataModel.getFormulaData(),m=this._formulaDataModel.getArrayFormulaCellData(),d=this._formulaDataModel.getArrayFormulaRange();this._calculateFormulaService.execute({formulaData:f,arrayFormulaCellData:m,arrayFormulaRange:d,forceCalculate:e,dirtyRanges:t,dirtyNameMap:r,dirtyDefinedNameMap:n,dirtyUnitFeatureMap:s,dirtyUnitOtherFormulaMap:a,clearDependencyTreeCache:o,maxIteration:c,rowData:l})}_initialExecuteFormulaListener(){this._calculateFormulaService.executionCompleteListener$.subscribe(u=>{const e=u.functionsExecutedState;switch(e){case sr.NOT_EXECUTED:break;case sr.STOP_EXECUTION:break;case sr.SUCCESS:this._applyResult(u);break;case sr.INITIAL:break}this._commandService.executeCommand(Er.id,{functionsExecutedState:e},{onlyLocal:!0})}),this._calculateFormulaService.executionInProgressListener$.subscribe(u=>{this._commandService.executeCommand(Er.id,{stageInfo:u},{onlyLocal:!0})})}async _applyResult(u){const{unitData:e,unitOtherData:t,arrayFormulaRange:r,arrayFormulaCellData:n,clearArrayFormulaCellData:s}=u;if(!e){console.error("No sheetData from Formula Engine!");return}r&&(this._formulaDataModel.clearPreviousArrayFormulaCellData(s),this._formulaDataModel.mergeArrayFormulaCellData(n),this._formulaDataModel.mergeArrayFormulaRange(r),this._commandService.executeCommand(kr.id,{arrayFormulaRange:this._formulaDataModel.getArrayFormulaRange(),arrayFormulaCellData:this._formulaDataModel.getArrayFormulaCellData()},{onlyLocal:!0})),this._commandService.executeCommand(os.id,{unitData:sc(e),unitOtherData:t},{onlyLocal:!0})}},w.CalculateController=am([qs(0,S.ICommandService),qs(1,Vn),qs(2,S.Inject(w.FormulaDataModel))],w.CalculateController);const eo=/[\[\]]/g;function to(i,u){if(eo.test(i)){const e=Number(i.replace(eo,""));return u+e}return Number(i)-1}function Ks(i,u=0,e=0){i=i.toLocaleUpperCase();const t=i.split(/[RC]/),r=t[1],n=t[2],s=to(r,u),a=to(n,e);return{row:s,column:a,absoluteRefType:S.AbsoluteRefType.NONE}}function ro(i,u=0,e=0){const{refBody:t,sheetName:r,unitId:n}=Hr(i),s=t.indexOf(":");if(s===-1){const _=Ks(t,u,e),E=_.row,b=_.column,R=_.absoluteRefType;return{unitId:n,sheetName:r,range:{startRow:E,startColumn:b,endRow:E,endColumn:b,startAbsoluteRefType:R,endAbsoluteRefType:R}}}const a=t.substring(0,s),o=t.substring(s+1),c=Ks(a,u,e),l=Ks(o,u,e),f=c.row,m=c.column,d=l.row,C=l.column;return{unitId:n,sheetName:r,range:{startRow:f,startColumn:m,endRow:d,endColumn:C,startAbsoluteRefType:c.absoluteRefType,endAbsoluteRefType:l.absoluteRefType}}}function im(i){const u=On(i.startRow,i.startAbsoluteRefType,!0),e=On(i.startColumn,i.startAbsoluteRefType,!1),t=On(i.endRow,i.endAbsoluteRefType,!0),r=On(i.endColumn,i.endAbsoluteRefType,!1);return u===t&&e===r?`R${u}C${e}`:`R${u}C${e}:R${t}C${r}`}function On(i,u=S.AbsoluteRefType.ALL,e){switch(i+=1,u){case S.AbsoluteRefType.ALL:return`${i}`;case S.AbsoluteRefType.ROW:return e?`${i}`:`[${i}]`;case S.AbsoluteRefType.COLUMN:return e?`[${i}]`:`${i}`;case S.AbsoluteRefType.NONE:return`[${i}]`}}function Yt(i){let u=i;if(i.isArray()){const e=i.getRowCount(),t=i.getColumnCount();if(e>1||t>1)return g.create(h.VALUE);u=i.get(0,0)}return u.isError(),u}function Dr(...i){for(let u=0;u<i.length;u++){const e=Yt(i[u]);if(e.isError())return{isError:!0,errorObject:e};i[u]=e}return{isError:!1,variants:i}}function W(...i){for(let u=0;u<i.length;u++){const e=Yt(i[u]);if(e.isError())return{isError:!0,errorObject:e};if(e.isBoolean())return{isError:!0,errorObject:g.create(h.VALUE)};i[u]=e}return{isError:!1,variants:i}}function ve(...i){for(let u=0;u<i.length;u++){let e=i[u];if(e.isError())return{isError:!0,errorObject:e};if(e.isNull())return{isError:!0,errorObject:g.create(h.NA)};if(e=Yt(i[u]),e.isError())return{isError:!0,errorObject:e};if(e.isBoolean())return{isError:!0,errorObject:g.create(h.VALUE)};i[u]=e}return{isError:!1,variants:i}}function k(...i){for(let u=0;u<i.length;u++){let e=i[u];if(e.isString()&&(e=e.convertToNumberObjectValue()),e.isError())return{isError:!0,errorObject:e};i[u]=e}return{isError:!1,variants:i}}class p{constructor(u){A(this,"_unitId");A(this,"_subUnitId");A(this,"_row",-1);A(this,"_column",-1);A(this,"_definedNames");A(this,"_locale");A(this,"_sheetOrder");A(this,"_sheetNameMap");A(this,"_formulaDataModel");A(this,"_rowCount",-1);A(this,"_columnCount",-1);A(this,"needsExpandParams",!1);A(this,"needsReferenceObject",!1);A(this,"needsLocale",!1);A(this,"needsSheetsInfo",!1);A(this,"needsFormulaDataModel",!1);A(this,"needsSheetRowColumnCount",!1);A(this,"needsFilteredOutRows",!1);A(this,"minParams",-1);A(this,"maxParams",-1);this._name=u}get name(){return this._name}get unitId(){return this._unitId}get subUnitId(){return this._subUnitId}get row(){return this._row}get column(){return this._column}dispose(){}getDefinedName(u){var t;const e=this._definedNames;return e==null?null:(t=Array.from(Object.values(e)).filter(r=>r.name===u))==null?void 0:t[0]}setDefinedNames(u){this._definedNames=u}getLocale(){return this._locale}setLocale(u){this._locale=u}getSheetsInfo(){return{sheetOrder:this._sheetOrder,sheetNameMap:this._sheetNameMap}}setSheetsInfo({sheetOrder:u,sheetNameMap:e}){this._sheetOrder=u,this._sheetNameMap=e}setFormulaDataModel(u){this._formulaDataModel=u}setSheetRowColumnCount(u,e){this._rowCount=u,this._columnCount=e}isAsync(){return!1}isAddress(){return!1}isCustom(){return!1}setRefInfo(u,e,t,r){this._unitId=u,this._subUnitId=e,this._row=t,this._column=r}calculateCustom(...u){return null}calculate(...u){return g.create(h.VALUE)}checkArrayType(u){return u.isReferenceObject()||u.isValueObject()&&u.isArray()}getIndexNumValue(u,e=1){let t=u;if(t.isArray()&&(t=t.getFirstCell()),t.isBoolean())return t.getValue()===!1?g.create(h.VALUE):e;if(t.isString()){const r=Number(t.getValue());return Number.isNaN(r)?g.create(h.REF):r}else if(t.isNumber())return t.getValue();return g.create(h.VALUE)}getZeroOrOneByOneDefault(u){if(u==null)return 1;let e=1;if(u.isArray()&&(u=u.getFirstCell()),u.isBoolean())u.getValue()===!1&&(e=0);else{if(u.isString())return;u.isNumber()&&u.getValue()===0&&(e=0)}return e}getMatchTypeValue(u){if(u==null)return 1;let e=1;if(u.isArray()&&(u=u.getFirstCell()),u.isBoolean())u.getValue()===!1&&(e=0);else{if(u.isString())return;if(u.isNumber()){const t=u.getValue();t<=0&&(e=t)}}return e}binarySearch(u,e,t,r,n){const s=e.binarySearch(u,r,n);if(s==null)return g.create(h.NA);let a;return t.getRowCount()===1?a=t.get(0,s)||oe.create():a=t.get(s,0)||oe.create(),a.isNull()?y.create(0):a}_getOneFirstByRaw(u){return u.length===0?g.create(h.NA):u[0][0]||g.create(h.NA)}_getOneLastByRaw(u){return u.length===0?g.create(h.NA):u[u.length-1][u[0].length-1]||g.create(h.NA)}equalSearch(u,e,t,r=!0){const n=t.pickRaw(e.isEqual(u));return r?this._getOneFirstByRaw(n):this._getOneLastByRaw(n)}fuzzySearch(u,e,t,r=!0){const n=t.pickRaw(e.compare(u,H.EQUALS));return r?this._getOneFirstByRaw(n):this._getOneLastByRaw(n)}orderSearch(u,e,t,r=Me.MIN,n=!1){const s=e.orderSearch(u,r,n);if(s==null)return g.create(h.NA);const a=t.get(s.row,s.column)||oe.create();return a.isNull()?g.create(h.NA):a}binarySearchExpand(u,e,t,r=0,n,s){const a=e.binarySearch(u,n,s);return a==null?g.create(h.NA):r===0?t.slice([a,a+1]):t.slice(void 0,[a,a+1])}equalSearchExpand(u,e,t,r=!0,n=0){const s=e.isEqual(u);let a;return r?a=s.getFirstTruePosition():a=s.getLastTruePosition(),a==null?g.create(h.NA):n===0?t.slice([a.row,a.row+1]):t.slice(void 0,[a.column,a.column+1])}fuzzySearchExpand(u,e,t,r=!0,n=0){const s=e.compare(u,H.EQUALS);let a;return r?a=s.getFirstTruePosition():a=s.getLastTruePosition(),a==null?g.create(h.NA):n===0?t.slice([a.row,a.row+1]):t.slice(void 0,[a.column,a.column+1])}orderSearchExpand(u,e,t,r=Me.MIN,n=!1,s=0){const a=e.orderSearch(u,r,n);return a==null?g.create(h.NA):s===0?t.slice([a.row,a.row+1]):t.slice(void 0,[a.column,a.column+1])}flattenArray(u,e=!0){const t=[];t[0]=[];for(let r=0;r<u.length;r++){let n=u[r];if((n.isString()||n.isBoolean()||n.isNull())&&(n=n.convertToNumberObjectValue()),n.isError())return n;if(n.isArray()){let s;if(n.iterator(a=>{if(a==null||a.isNull()||e&&(a.isString()||a.isBoolean()))return!0;if(a=this._includingLogicalValuesAndText(a),a.isError())return s=a,!1;t[0].push(a)}),s!=null&&s.isError())return s}else t[0].push(n)}return rr(t,1,t[0].length)}_includingLogicalValuesAndText(u){if(u.isBoolean()&&(u=df(u)),u.isString()){const e=Number(u.getValue());u=y.create(Number.isNaN(e)?0:e)}return u}createReferenceObject(u,e){const t=u.getForcedUnitId(),r=u.getForcedSheetId()||"",n=u.getForcedSheetName(),a=$r({unitId:t,sheetName:n,range:e});let o;return dr(a)?o=new xs(a):Ka(a)?o=new vs(a):Xa(a)?o=new Us(a):o=new pr(e,r,t),this._setReferenceDefault(u,o)}_setReferenceDefault(u,e){return this.unitId==null||this.subUnitId==null?g.create(h.REF):(e.setDefaultUnitId(this.unitId),e.setDefaultSheetId(this.subUnitId),e.setUnitData(u.getUnitData()),e.setRuntimeData(u.getRuntimeData()),e.setArrayFormulaCellData(u.getArrayFormulaCellData()),e.setRuntimeArrayFormulaCellData(u.getRuntimeArrayFormulaCellData()),e)}}class om extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){if(e.isError())return e;const{isError:n,errorObject:s,variants:a}=Dr(t,r);if(n)return s;const{isError:o,errorObject:c,variants:l}=k(...a);if(o)return c;const[f,m]=l,d=Math.floor(+f.getValue()),C=Math.floor(+m.getValue());if(d<0||C<0)return g.create(h.NUM);if(d===0||C===0)return g.create(h.REF);const _=e.isArray()?e.getRowCount():1,E=e.isArray()?e.getColumnCount():1;if(_===1&&E===1)return e.isArray()?e.get(0,0):e;const b=d>_?_:d,R=C>E?E:C;return e.slice([0,b],[0,R])}}class um extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){const t=[];for(let r=0;r<e.length;r++){const n=e[r],s=n.isArray()?n.getRowCount():1,a=n.isArray()?n.getColumnCount():1;for(let o=0;o<s;o++)for(let c=0;c<a;c++){const l=n.isArray()?n.get(o,c):n;t.push([l])}}return K.create({calculateValueList:t,rowCount:t.length,columnCount:1,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}}var Sn=(i=>(i.ARRAY_CONSTRAIN="ARRAY_CONSTRAIN",i.FLATTEN="FLATTEN",i))(Sn||{});const no=[[om,Sn.ARRAY_CONSTRAIN],[um,Sn.FLATTEN]];var or;(i=>{const u=.636619772;function e(n,s){let a=0;for(let o=0;o<n.length;++o)a=s*a+n[o];return a}function t(n,s,a,o,c){if(s===0)return a;if(s===1)return o;const l=2/n;let f=a,m=o,d=o;for(let C=1;C<s;++C)d=m*C*l+c*f,f=m,m=d;return d}function r(n,s,a,o){return function(l,f){if(a){if(l===0)return a===1?-1/0:1/0;if(l<0)return Number.NaN}if(f===0)return n(l);if(f===1)return s(l);if(f<0)return Number.NaN;const m=f|0,d=n(l),C=s(l);return t(l,m,d,C,o)}}i.besselj=(()=>{const n=[-184.9052456,77392.33017,-1121442418e-2,6516196407e-1,-13362590354,57568490574],s=[1,267.8532712,59272.64853,9494680718e-3,1029532985,57568490411],a=[2093887211e-16,-2073370639e-15,2734510407e-14,-.001098628627,1],o=[-934935152e-16,7621095161e-16,-6911147651e-15,.0001430488765,-.01562499995];function c(_){let E=0,b=0,R=0,N=_*_;if(_<8)b=e(n,N),R=e(s,N),E=b/R;else{const V=_-.785398164;N=64/N,b=e(a,N),R=e(o,N),E=Math.sqrt(u/_)*(Math.cos(V)*b-Math.sin(V)*R*8/_)}return E}const l=[-30.16036606,15704.4826,-2972611439e-3,2423968531e-1,-7895059235,72362614232],f=[1,376.9991397,99447.43394,1858330474e-2,2300535178,144725228442],m=[-240337019e-15,2457520174e-15,-3516396496e-14,.00183105,1],d=[105787412e-15,-88228987e-14,8449199096e-15,-.0002002690873,.04687499995];function C(_){let E=0,b=0,R=0,N=_*_;const V=Math.abs(_)-2.356194491;return Math.abs(_)<8?(b=_*e(l,N),R=e(f,N),E=b/R):(N=64/N,b=e(m,N),R=e(d,N),E=Math.sqrt(u/Math.abs(_))*(Math.cos(V)*b-Math.sin(V)*R*8/Math.abs(_)),_<0&&(E=-E)),E}return function _(E,b){const R=Math.round(b);if(!Number.isFinite(E))return Number.isNaN(E)?E:0;if(R<0)return(R%2?-1:1)*_(E,-R);if(E<0)return(R%2?-1:1)*_(-E,R);if(R===0)return c(E);if(R===1)return C(E);if(E===0)return 0;let N=0;if(E>R)N=t(E,R,c(E),C(E),-1);else{const V=2*Math.floor((R+Math.floor(Math.sqrt(40*R)))/2);let M=!1,D=0,L=0,P=1,j=0;const F=2/E;for(let v=V;v>0;v--)if(j=v*F*P-D,D=P,P=j,Math.abs(P)>1e10&&(P*=1e-10,D*=1e-10,N*=1e-10,L*=1e-10),M&&(L+=P),M=!M,v===R&&(N=D),V-v>100&&N===0)return Number.NaN;L=2*L-P,N/=L}return N}})(),i.bessely=(()=>{const n=[228.4622733,-86327.92757,1087988129e-2,-5123598036e-1,7062834065,-2957821389],s=[1,226.1030244,47447.2647,7189466438e-3,7452499648e-1,40076544269],a=[2093887211e-16,-2073370639e-15,2734510407e-14,-.001098628627,1],o=[-934945152e-16,7621095161e-16,-6911147651e-15,.0001430488765,-.01562499995];function c(_){let E=0,b=0,R=0,N=_*_;const V=_-.785398164;return _<8?(b=e(n,N),R=e(s,N),E=b/R+u*(0,i.besselj)(_,0)*Math.log(_)):(N=64/N,b=e(a,N),R=e(o,N),E=Math.sqrt(u/_)*(Math.sin(V)*b+Math.cos(V)*R*8/_)),E}const l=[8511.937935,-4237922726e-3,7349264551e-1,-51534381390,127527439e4,-4900604943e3],f=[1,354.9632885,102042.605,2245904002e-2,3733650367,424441966400,249958057e5],m=[-240337019e-15,2457520174e-15,-3516396496e-14,.00183105,1],d=[105787412e-15,-88228987e-14,8449199096e-15,-.0002002690873,.04687499995];function C(_){let E=0,b=0,R=0,N=_*_;const V=_-2.356194491;return _<8?(b=_*e(l,N),R=e(f,N),E=b/R+u*((0,i.besselj)(_,1)*Math.log(_)-1/_)):(N=64/N,b=e(m,N),R=e(d,N),E=Math.sqrt(u/_)*(Math.sin(V)*b+Math.cos(V)*R*8/_)),E}return r(c,C,1,-1)})(),i.besseli=(()=>{const n=[.0045813,.0360768,.2659732,1.2067492,3.0899424,3.5156229,1],s=[.00392377,-.01647633,.02635537,-.02057706,.00916281,-.00157565,.00225319,.01328592,.39894228];function a(f){return f<=3.75?e(n,f*f/(3.75*3.75)):Math.exp(Math.abs(f))/Math.sqrt(Math.abs(f))*e(s,3.75/Math.abs(f))}const o=[32411e-8,.00301532,.02658733,.15084934,.51498869,.87890594,.5],c=[-.00420059,.01787654,-.02895312,.02282967,-.01031555,.00163801,-.00362018,-.03988024,.39894228];function l(f){return f<3.75?f*e(o,f*f/(3.75*3.75)):(f<0?-1:1)*Math.exp(Math.abs(f))/Math.sqrt(Math.abs(f))*e(c,3.75/Math.abs(f))}return function f(m,d){const C=Math.round(d);if(C===0)return a(m);if(C===1)return l(m);if(C<0)return Number.NaN;if(Math.abs(m)===0)return 0;if(m===1/0)return 1/0;let _=0,E;const b=2/Math.abs(m);let R=0,N=1,V=0;const M=2*Math.round((C+Math.round(Math.sqrt(40*C)))/2);for(E=M;E>0;E--)if(V=E*b*N+R,R=N,N=V,Math.abs(N)>1e10&&(N*=1e-10,R*=1e-10,_*=1e-10),E===C&&(_=R),M-E>100&&_===0)return Number.NaN;return _*=f(m,0)/N,m<0&&C%2?-_:_}})(),i.besselk=(()=>{const n=[74e-7,1075e-7,.00262698,.0348859,.23069756,.4227842,-.57721566],s=[53208e-8,-.0025154,.00587872,-.01062446,.02189568,-.07832358,1.25331414];function a(f){return f<=2?-Math.log(f/2)*(0,i.besseli)(f,0)+e(n,f*f/4):Math.exp(-f)/Math.sqrt(f)*e(s,2/f)}const o=[-4686e-8,-.00110404,-.01919402,-.18156897,-.67278579,.15443144,1],c=[-68245e-8,.00325614,-.00780353,.01504268,-.0365562,.23498619,1.25331414];function l(f){return f<=2?Math.log(f/2)*(0,i.besseli)(f,1)+1/f*e(o,f*f/4):Math.exp(-f)/Math.sqrt(f)*e(c,2/f)}return r(a,l,2,1)})()})(or||(or={}));function Xs(i){return/^[01]{1,10}$/.test(i)}function Zs(i){return/^[0-7]{1,10}$/.test(i)}function zs(i){return/^[0-9A-Fa-f]{1,10}$/.test(i)}function Ht(i){if(i===0)return 0;const u=[-1.3026537197817094,.6419697923564902,.019476473204185836,-.00956151478680863,-.000946595344482036,.000366839497852761,42523324806907e-18,-20278578112534e-18,-1624290004647e-18,130365583558e-17,15626441722e-18,-85238095915e-18,6529054439e-18,5059343495e-18,-991364156e-18,-227365122e-18,96467911e-18,2394038e-18,-6886027e-18,894487e-18,313092e-18,-112708e-18,381e-18,7106e-18,-1523e-18,-94e-18,121e-18,-28e-18];let e=i,t=!1;e<0&&(e=-e,t=!0);const r=2/(2+e),n=4*r-2;let s=0,a=0,o;for(let l=u.length-1;l>0;l--)o=s,s=n*s-a+u[l],a=o;const c=r*Math.exp(-e*e+.5*(u[0]+n*s)-a);return t?c-1:1-c}function Js(i){return 1-Ht(i)}function cm(i){if(i>=2)return-100;if(i<=0)return 100;const u=i<1?i:2-i,e=Math.sqrt(-2*Math.log(u/2));let t=-.70711*((2.30753+e*.27061)/(1+e*(.99229+e*.04481))-e);for(let r=0;r<2;r++){const n=Js(t)-u;t+=n/(1.1283791670955126*Math.exp(-t*t)-t*n)}return i<1?t:-t}function ur(i,u=1){let e=Math.floor(i);if(i<0)return Number.NaN;let t=1;for(;e>1&&Number.isFinite(t);)t*=e,e-=u;return t}function Gt(i,u){const e=Math.min(i-u,u);let t=1;for(let r=1;r<=e&&Number.isFinite(t);r++)t*=i-r+1,t/=r;return t}function ea(i,u){let e=Math.floor(i),t=Math.floor(u);for(;t!==0;){const r=t;t=e%t,e=r}return e}function so(i,u){const e=ea(i,u);return e===0?0:Math.abs(i*u)/e}function ta(i){const u=i.length;if(u===1)return i[0][0];if(u===2)return i[0][0]*i[1][1]-i[0][1]*i[1][0];const{rowSwap:e,smallPivotDetected:t,luMatrix:r,permutation:n}=ao(i);if(t)return 0;let s=e?1:-1;for(let a=0;a<n.length;a++)s*=r[a][a];return s===0?0:s}function lm(i){const u=ta(i);return u===0?null:i.length===1?[[1/u]]:mm(i).map(r=>r.map(n=>n/u))}function fm(i,u,e){return i.filter((t,r)=>r!==u).map(t=>t.filter((r,n)=>n!==e))}function mm(i){const u=i.length,e=Array.from({length:u},()=>new Array(u).fill(0));for(let t=0;t<u;t++)for(let r=0;r<u;r++){const s=((t+r)%2===0?1:-1)*ta(fm(i,t,r));e[r][t]=s===0?0:s}return e}function cr(i,u){return i.map(e=>u[0].map((t,r)=>e.reduce((n,s,a)=>n+s*u[a][r],0)))}function ht(i){return i[0].map((u,e)=>i.map(t=>t[e]))}function hm(i){const{smallPivotDetected:u,luMatrix:e,permutation:t}=ao(i);return u?null:gm(e,t)}function ao(i){const u=ht(i),e=u.length,t=u[0].length;let r=!0,n=!1;const s=ra(e,t,0),a=new Array(t).fill(0).map((o,c)=>c);for(let o=0;o<t;o++){for(let m=0;m<o;m++){let d=u[m][o];for(let C=0;C<m;C++)d-=s[m][C]*s[C][o];s[m][o]=d}let c=-1/0,l=o;for(let m=o;m<e;m++){let d=u[m][o];for(let _=0;_<o;_++)d-=s[m][_]*s[_][o];s[m][o]=d;const C=Math.abs(d);C>c&&(c=C,l=m)}if(Math.abs(s[l][o])<1e-11){n=!0;break}l!==o&&([s[o],s[l]]=[s[l],s[o]],[u[o],u[l]]=[u[l],u[o]],[a[o],a[l]]=[a[l],a[o]],r=!r);const f=s[o][o];for(let m=o+1;m<e;m++)s[m][o]/=f}return{rowSwap:r,smallPivotDetected:n,luMatrix:s,permutation:a}}function gm(i,u){const e=u.length,t=ra(e,e,0);for(let n=0;n<e;n++)t[n][n]=1;const r=ra(e,e,0);for(let n=0;n<e;n++){const s=u[n];for(let a=0;a<e;a++)r[n][a]=t[s][a]}for(let n=0;n<e;n++){const s=r[n];for(let a=n+1;a<e;a++){const o=i[a][n];for(let c=0;c<e;c++)r[a][c]-=s[c]*o}}for(let n=e-1;n>=0;n--){const s=r[n],a=i[n][n];for(let o=0;o<e;o++)s[o]/=a;for(let o=0;o<n;o++){const c=i[o][n];for(let l=0;l<e;l++)r[o][l]-=s[l]*c}}return r}function ra(i,u,e){const t=[];for(let r=0;r<i;r++){t[r]=[];for(let n=0;n<u;n++)t[r].push(e)}return t}function dm(i){const u=Cm(i);if(!u)return null;const{matrixU:e,matrixS:t,matrixV:r}=u,n=ht(e),s=Array.from({length:t.length},()=>new Array(i[0].length).fill(0)),a=Math.max(i.length,i[0].length)*Number.EPSILON*t[0];for(let o=0;o<t.length;o++)Math.abs(t[o])>a&&(s[o][o]=1/t[o]);return cr(r,cr(s,n))}function Cm(i){const u=ht(i),e=u.length,t=u[0].length;if(e<t)return null;const r=new Array(t).fill(0),n=new Array(t).fill(0),s=Array.from({length:t},()=>new Array(t).fill(0));let a=Number.EPSILON,o=0,c=0,l=0;for(let _=0;_<t;_++){if(r[_]=o,c=na(u,_,e,_,_),c<=1e-64/a)o=0;else{o=Math.sqrt(c),u[_][_]>=0&&(o=-o);const b=u[_][_]*o-c;u[_][_]-=o;for(let R=_+1;R<t;R++){c=na(u,_,e,_,R);for(let N=_;N<e;N++)u[N][R]+=c/b*u[N][_]}}if(n[_]=o,c=io(u,_+1,t,_,_),c<=1e-64/a)o=0;else{o=Math.sqrt(c),u[_][_+1]>=0&&(o=-o);const b=u[_][_+1]*o-c;u[_][_+1]-=o;for(let R=_+1;R<t;R++)r[R]=u[_][R]/b;for(let R=_+1;R<e;R++){c=io(u,_+1,t,R,_);for(let N=_+1;N<t;N++)u[R][N]+=c*r[N]}}const E=Math.abs(n[_])+Math.abs(r[_]);E>l&&(l=E)}let f=0;for(let _=t-1;_>=0;_--){if(o!==0){for(let E=f;E<t;E++)s[E][_]=u[_][E]/(o*u[_][_+1]);for(let E=f;E<t;E++){c=0;for(let b=f;b<t;b++)c+=u[_][b]*s[b][E];for(let b=f;b<t;b++)s[b][E]+=c*s[b][_]}}for(let E=f;E<t;E++)s[_][E]=0,s[E][_]=0;s[_][_]=1,o=r[_],f=_}for(let _=t-1;_>=0;_--){o=n[_];for(let E=_+1;E<t;E++)u[_][E]=0;if(o!==0){for(let E=_+1;E<t;E++){c=na(u,_+1,e,_,E);for(let b=_;b<e;b++)u[b][E]+=c/(u[_][_]*o)*u[b][_]}for(let E=_;E<e;E++)u[E][_]/=o}else for(let E=_;E<e;E++)u[E][_]=0;u[_][_]+=1}a*=l;let m=0,d=0,C=0;for(let _=t-1;_>=0;_--)for(let E=0;E<50;E++){let b=!1,R=_;for(;R>=0;R--){if(Math.abs(r[R])<=a){b=!0;break}if(Math.abs(n[R-1])<=a)break}if(!b){let D=0,L=1;for(let P=R;P<_+1&&(m=L*r[P],d=n[P],r[P]*=D,!(Math.abs(m)<=a));P++){C=Mn(m,d),n[P]=C,D=d/C,L=-m/C;for(let j=0;j<e;j++){const F=u[j][R-1],v=u[j][P];u[j][R-1]=F*D+v*L,u[j][P]=-F*L+v*D}}}if(R===_){if(n[_]<0){n[_]=-n[_];for(let D=0;D<t;D++)s[D][_]=-s[D][_]}break}if(E>=49)return null;let N=n[R];m=((n[_-1]-n[_])*(n[_-1]+n[_])+(r[_-1]-r[_])*(r[_-1]+r[_]))/(2*r[_]*n[_-1]),C=Mn(m,1),m<0?m=((N-n[_])*(N+n[_])+r[_]*(n[_-1]/(m-C)-r[_]))/N:m=((N-n[_])*(N+n[_])+r[_]*(n[_-1]/(m+C)-r[_]))/N;let V=1,M=1;for(let D=R+1;D<_+1;D++){let L=r[D],P=n[D];d=M*L,L*=V,C=Mn(m,d),r[D-1]=C,V=m/C,M=d/C,m=N*V+L*M,d=P*M,L=-N*M+L*V,P*=V;for(let j=0;j<t;j++){const F=s[j][D-1],v=s[j][D];s[j][D-1]=F*V+v*M,s[j][D]=-F*M+v*V}C=Mn(m,d),n[D-1]=C,V=m/C,M=d/C,m=V*L+M*P,N=-M*L+V*P;for(let j=0;j<e;j++){const F=u[j][D-1],v=u[j][D];u[j][D-1]=F*V+v*M,u[j][D]=-F*M+v*V}}r[R]=0,r[_]=m,n[_]=N}for(let _=0;_<n.length;_++)n[_]<a&&(n[_]=0);for(let _=0;_<t;_++)for(let E=_-1;E>=0;E--)if(n[E]<n[_]){const b=n[E];n[E]=n[_],n[_]=b;for(let R=0;R<u.length;R++){const N=u[R][_];u[R][_]=u[R][E],u[R][E]=N}for(let R=0;R<s.length;R++){const N=s[R][_];s[R][_]=s[R][E],s[R][E]=N}_=E}return{matrixU:u,matrixS:n,matrixV:s}}function Mn(i,u){let e=0;return Math.abs(i)>Math.abs(u)?(e=u/i,Math.abs(i)*Math.sqrt(1+e*e)):u!==0?(e=i/u,Math.abs(u)*Math.sqrt(1+e*e)):0}function na(i,u,e,t,r){let n=0;for(let s=u;s<e;s++)n+=i[s][t]*i[s][r];return n}function io(i,u,e,t,r){let n=0;for(let s=u;s<e;s++)n+=i[t][s]*i[r][s];return n}const Dn=new Map([["I",1],["V",5],["X",10],["L",50],["C",100],["D",500],["M",1e3]]),_m=new Map([[1,"I"],[4,"IV"],[5,"V"],[9,"IX"],[10,"X"],[40,"XL"],[45,"VL"],[49,"IL"],[50,"L"],[90,"XC"],[95,"VC"],[99,"IC"],[100,"C"],[400,"CD"],[450,"LD"],[490,"XD"],[495,"VD"],[499,"ID"],[500,"D"],[900,"CM"],[950,"LM"],[990,"XM"],[995,"VM"],[999,"IM"],[1e3,"M"]]),Am=[[1,4,5,9,10,40,50,90,100,400,500,900,1e3,4e3],[1,4,5,9,10,40,45,50,90,95,100,400,450,500,900,950,1e3,4e3],[1,4,5,9,10,40,45,49,50,90,95,99,100,400,450,490,500,900,950,990,1e3,4e3],[1,4,5,9,10,40,45,49,50,90,95,99,100,400,450,490,495,500,900,950,990,995,1e3,4e3],[1,4,5,9,10,40,45,49,50,90,95,99,100,400,450,490,495,499,500,900,950,990,995,999,1e3,4e3]];function oo(i,u,e){return i<=0?0:i>=1?1:wn(i,u,e)}function Em(i,u,e){return i<=0||i>=1?0:u===1&&e===1?1:u<512&&e<512?i**(u-1)*(1-i)**(e-1)/aa(u,e):Math.exp((u-1)*Math.log(i)+(e-1)*Math.log(1-i)-ia(u,e))}function sa(i,u,e){if(i<=0)return 0;if(i>=1)return 1;const t=1e-8;let r;if(u>=1&&e>=1){const c=i<.5?i:1-i,l=Math.sqrt(-2*Math.log(c));r=(2.30753+l*.27061)/(1+l*(.99229+l*.04481))-l,i<.5&&(r=-r);const f=(r*r-3)/6,m=2/(1/(2*u-1)+1/(2*e-1)),d=r*Math.sqrt(f+m)/m-(1/(2*e-1)-1/(2*u-1))*(f+5/6-2/(3*m));r=u/(u+e*Math.exp(2*d))}else{const c=Math.exp(u*Math.log(u/(u+e)))/u,l=Math.exp(e*Math.log(e/(u+e)))/e,f=c+l;i<c/f?r=(u*f*i)**(1/u):r=1-(e*f*(1-i))**(1/e)}const n=-ia(u,e);let s,a,o;for(let c=0;c<10;c++){if(r===0||r===1)return r;if(s=wn(r,u,e)-i,a=Math.exp((u-1)*Math.log(r)+(e-1)*Math.log(1-r)+n),o=s/a,r-=a=o/(1-.5*Math.min(1,o*((u-1)/r-(e-1)/(1-r)))),r<=0&&(r=.5*(r+a)),r>=1&&(r=.5*(r+a+1)),Math.abs(a)<t*r&&c>0)break}return r}function wn(i,u,e){const t=i===0||i===1?0:Math.exp(nt(u+e)-nt(u)-nt(e)+u*Math.log(i)+e*Math.log(1-i));return i<(u+1)/(u+e+2)?t*uo(i,u,e)/u:1-t*uo(1-i,e,u)/e}function uo(i,u,e){let n=1-(u+e)*i/(u+1);Math.abs(n)<1e-8&&(n=1e-8),n=1/n;let s=1,a=n;for(let o=1;o<=100;o++){let c=o*(e-o)*i/((u-1+o*2)*(u+o*2));if(n=1+c*n,Math.abs(n)<1e-8&&(n=1e-8),s=1+c/s,Math.abs(s)<1e-8&&(s=1e-8),n=1/n,a*=n*s,c=-(u+o)*(u+e+o)*i/((u+o*2)*(u+1+o*2)),n=1+c*n,Math.abs(n)<1e-8&&(n=1e-8),s=1+c/s,Math.abs(s)<1e-8&&(s=1e-8),n=1/n,a*=n*s,Math.abs(n*s-1)<1e-8)break}return a}function aa(i,u){return i+u>170?Math.exp(ia(i,u)):Ln(i)*Ln(u)/Ln(i+u)}function ia(i,u){return nt(i)+nt(u)-nt(i+u)}function co(i,u,e){if(i<0)return 0;if(i>=u)return 1;if(e<0||e>1||u<=0)return Number.NaN;let t=0;for(let r=0;r<=i;r++)t+=oa(r,u,e);return t}function oa(i,u,e){return e===0||e===1?u*e===i?1:0:Gt(u,i)*e**i*(1-e)**(u-i)}function ua(i,u){return i<=0?0:la(u/2,i/2)}function bm(i,u){return i<0?0:i===0&&u===2?.5:Math.exp((u/2-1)*Math.log(i)-i/2-u/2*Math.log(2)-nt(u/2))}function lo(i,u){return i<=0?0:i>=1?1/0:2*ho(i,u/2)}function ca(i,u,e){return i<0?0:wn(u*i/(u*i+e),u/2,e/2)}function ym(i,u,e){if(i<0)return 0;if(i===0&&u<2)return 1/0;if(i===0&&u===2)return 1;let t=1/aa(u/2,e/2);return t*=(u/e)**(u/2),t*=i**(u/2-1),t*=(1+u/e*i)**(-(u+e)/2),t}function fo(i,u,e){return i<=0?0:i>=1?1/0:e/(u*(1/sa(i,u/2,e/2)-1))}function Rm(i,u){return i<0?0:1-Math.exp(-u*i)}function Nm(i,u){return i<0?0:u*Math.exp(-u*i)}function mo(i,u,e){const t=u.length;let r=0,n=0;for(let m=0;m<t;m++)r+=u[m],n+=e[m];const s=r/t,a=n/t;let o=0,c=0;for(let m=0;m<t;m++)o+=(u[m]-s)*(e[m]-a),c+=(e[m]-a)**2;if(c===0)return 1/0;const l=o/c;return s-l*a+l*i}function Ln(i){const u=[-1.716185138865495,24.76565080557592,-379.80425647094563,629.3311553128184,866.9662027904133,-31451.272968848367,-36144.413418691176,66456.14382024054],e=[-30.8402300119739,315.35062697960416,-1015.1563674902192,-3107.771671572311,22538.11842098015,4755.846277527881,-134659.9598649693,-115132.2596755535];let t=0,r=i;if(i>171.6243769536076)return 1/0;if(r<=0){const f=r%1+36e-17;if(f)t=(r&1?-1:1)*Math.PI/Math.sin(Math.PI*f),r=1-r;else return 1/0}const n=r;let s=0,a;r<1?a=r++:a=(r-=s=(r|0)-1)-1;let o=0,c=0;for(let f=0;f<8;++f)o=(o+u[f])*a,c=c*a+e[f];let l=o/c+1;if(n<r)l/=n;else if(n>r)for(let f=0;f<s;++f)l*=r,r++;return t&&(l=t/l),l}function pm(i,u,e){return i<=0?0:la(u,i/e)}function Vm(i,u,e){return i<0?0:i===0&&u===1?1/e:Math.exp((u-1)*Math.log(i)-i/e-nt(u)-u*Math.log(e))}function Om(i,u,e){return i<=0?0:i>=1?1/0:e*ho(i,u)}function nt(i){const u=[76.18009172947146,-86.50532032941678,24.01409824083091,-1.231739572450155,.001208650973866179,-5395239384953e-18];let e=i,t=i+5.5;t-=(i+.5)*Math.log(t);let r=1.000000000190015;for(let n=0;n<6;n++)r+=u[n]/++e;return-t+Math.log(2.5066282746310007*r/i)}function la(i,u){if(u<0||i<=0)return Number.NaN;const e=1e-30,t=-~(Math.log(i>=1?i:1/i)*8.5+i*.4+17),r=nt(i),n=Math.exp(-u+i*Math.log(u)-r);let s=i,a=1/i,o=a;if(u<i+1){if(n===0)return 0;for(let d=1;d<=t&&(a+=o*=u/++s,!(Math.abs(o)<Math.abs(a)*e));d++);return a*n}if(n===0)return 1;let c=u+1-i,l=1/e,f=1/c,m=f;for(let d=1;d<=t;d++){const C=-d*(d-i);if(c+=2,f=C*f+c,Math.abs(f)<e&&(f=e),l=c+C/l,Math.abs(l)<e&&(l=e),f=1/f,m*=f*l,Math.abs(f*l-1)<e)break}return 1-m*n}function ho(i,u){if(i<=0)return 0;if(i>=1)return Math.max(100,u+100*Math.sqrt(u));let e;if(u>1){const a=i<.5?i:1-i,o=Math.sqrt(-2*Math.log(a));e=(2.30753+o*.27061)/(1+o*(.99229+o*.04481))-o,i<.5&&(e=-e),e=Math.max(.001,u*(1-1/(9*u)-e/(3*Math.sqrt(u)))**3)}else{const a=1-u*(.253+u*.12);i<a?e=(i/a)**(1/u):e=1-Math.log(1-(i-a)/(1-a))}const t=1e-8,r=nt(u);let n,s;for(let a=0;a<12;a++){if(e<=0)return 0;if(n=la(u,e)-i,u>1?s=Math.exp((u-1)*(Math.log(u-1)-1)-r)*Math.exp(-(e-(u-1))+(u-1)*(Math.log(e)-Math.log(u-1))):s=Math.exp(-e+(u-1)*Math.log(e)-r),s!==0&&(s=n/s/(1-.5*Math.min(1,n/s*((u-1)/e-1)))),e-=s,e<=0&&(e=.5*(e+s)),Math.abs(s)<t*e)break}return e}function Sm(i,u,e,t){let r=0;for(let n=0;n<=i;n++)r+=fa(n,u,e,t);return r}function fa(i,u,e,t){return u-i>t-e?0:Gt(e,i)*Gt(t-e,u-i)/Gt(t,u)}function go(i,u,e){return i<0?0:.5+.5*Ht((Math.log(i)-u)/Math.sqrt(2*e*e))}function Mm(i,u,e){return i<=0?0:Math.exp(-Math.log(i)-.5*Math.log(2*Math.PI)-Math.log(e)-(Math.log(i)-u)**2/(2*e*e))}function Dm(i,u,e){return Math.exp(Pn(i,u,e))}function wm(i,u,e){if(i<0)return 0;let t=0;for(let r=0;r<=i;r++)t+=ma(r,u,e);return t}function ma(i,u,e){return i<0?0:Gt(i+u-1,u-1)*e**u*(1-e)**i}function wr(i,u,e){return .5*(1+Ht((i-u)/Math.sqrt(2*e*e)))}function Co(i,u,e){return Math.exp(-.5*Math.log(2*Math.PI)-Math.log(e)-(i-u)**2/(2*e*e))}function Pn(i,u,e){return-1.4142135623730951*e*cm(2*i)+u}function Lm(i,u){let e=0;for(let t=0;t<=i;t++)e+=_o(t,u);return e}function _o(i,u){return Math.exp(-u)*u**i/ur(i)}function Lr(i,u){const e=.5*wn(u/(i**2+u),u/2,.5);return i<0?e:1-e}function Pm(i,u){const e=(1+i**2/u)**(-(u+1)/2);return 1/(Math.sqrt(u)*aa(.5,u/2))*e}function jn(i,u){let e=sa(2*Math.min(i,1-i),.5*u,.5);return e=Math.sqrt(u*(1-e)/e),i>.5?e:-e}function Ke(i,u,e,t,r){const n=[],s=[];let a=!0;for(let o=0;o<e;o++){const c=Math.floor(o/t),l=o%t,f=Math.floor(o/r),m=o%r,d=i.isArray()?i.get(c,l):i,C=u.isArray()?u.get(f,m):u;if(d.isError())return{isError:!0,errorObject:d,array1Values:n,array2Values:s,noCalculate:a};if(C.isError())return{isError:!0,errorObject:C,array1Values:n,array2Values:s,noCalculate:a};if(d.isNull()||C.isNull()||d.isBoolean()||C.isBoolean())continue;const _=d.getValue(),E=C.getValue();!S.isRealNum(_)||!S.isRealNum(E)||(n.push(+_),s.push(+E),a=!1)}return{isError:!1,errorObject:null,array1Values:n,array2Values:s,noCalculate:a}}function xn(i,u,e){const t=i.isArray()?i.getRowCount():1,r=i.isArray()?i.getColumnCount():1;let n=t,s=r;if(u&&!u.isNull()&&(n=u.isArray()?u.getRowCount():1,s=u.isArray()?u.getColumnCount():1,t===1&&s!==r||r===1&&n!==t||t!==1&&r!==1&&(n!==t||s!==r)))return{isError:!0,errorObject:g.create(h.REF)};if(e&&!e.isNull()){const a=e.isArray()?e.getRowCount():1,o=e.isArray()?e.getColumnCount():1;if(t===1&&n>1&&a!==n||r===1&&s>1&&o!==s)return{isError:!0,errorObject:g.create(h.REF)}}return{isError:!1,errorObject:null}}function gt(i){const u=i.isArray()?i.getRowCount():1,e=i.isArray()?i.getColumnCount():1,t=[];for(let r=0;r<u;r++){t[r]=[];for(let n=0;n<e;n++){const s=i.isArray()?i.get(r,n):i;if(s.isError()||s.isNull()||s.isBoolean()||s.isString())return g.create(h.VALUE);t[r].push(+s.getValue())}}return t}function Un(i,u){const e=[];let t=1;for(let r=0;r<i;r++){e[r]=[];for(let n=0;n<u;n++)e[r].push(t++)}return e}function vn(i,u,e,t){let r=u;t&&(r=u.map(a=>Math.log(a)));let n,s;return e?{slope:n,intercept:s}=jm(i,r):{slope:n,intercept:s}=xm(i,r),t&&(n=Math.exp(n),s=Math.exp(s)),Number.isNaN(n)&&!e&&(n=0),{slope:n,intercept:s,Y:r}}function jm(i,u){const e=u.length;let t=0,r=0,n=0,s=0;for(let l=0;l<e;l++)t+=i[l],r+=u[l],n+=i[l]*i[l],s+=i[l]*u[l];const o=(e*s-t*r)/(e*n-t*t),c=1/e*r-o*(1/e)*t;return{slope:o,intercept:c}}function xm(i,u){const e=[[...i]],t=[...u];let r=e.length,n=e[0].length,s=Math.min(r,n);const a=new Array(s).fill(0);for(let c=0;c<s;c++){const l=e[c];let f=0;for(let d=0;d<n;d++)f+=l[d]**2;const m=l[c]<0?Math.sqrt(f):-Math.sqrt(f);if(a[c]=m,m!==0){l[c]-=m;for(let d=c+1;d<r;d++){let C=0;for(let _=c;_<n;_++)C-=e[d][_]*l[_];C/=m*l[c];for(let _=c;_<n;_++)e[d][_]-=C*l[_]}}}r=e.length,n=e[0].length,s=Math.min(r,n);const o=new Array(r).fill(0);for(let c=0;c<s;c++){const l=e[c];let f=0;for(let m=0;m<n;m++)f+=t[m]*l[m];f/=a[c]*l[c];for(let m=0;m<n;m++)t[m]+=f*l[m]}for(let c=a.length-1;c>=0;c--){t[c]/=a[c];const l=t[c],f=e[c];o[c]=l;for(let m=0;m<c;m++)t[m]-=l*f[m]}return{slope:o[0],intercept:0}}function Tn(i,u,e,t,r){const n=i.length===1&&i[0].length>1;let s=i;r&&(s=i.map(_=>_.map(E=>Math.log(E))));let a=u,o=e;n&&(s=ht(s),a=ht(a),o=ht(o)),t&&(a=a.map(_=>[..._,1]));const c=ht(a),l=cr(c,a),f=cr(c,s);let m=hm(l);if(!m&&(m=dm(l),!m))return g.create(h.NA);let d=cr(m,f);t||d.push([0]),d=ht(d);const C=d[0].pop();if(d[0].reverse(),d[0].push(C),r)for(let _=0;_<d[0].length;_++)d[0][_]=Math.exp(d[0][_]);return{coefficients:d,Y:s,X:a,newX:o,XTXInverse:m}}class Ao extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",5)}calculate(e,t,r,n,s){let a=n!=null?n:y.create(0),o=s!=null?s:y.create(1);a.isNull()&&(a=y.create(0)),o.isNull()&&(o=y.create(1));const c=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,a.isArray()?a.getRowCount():1,o.isArray()?o.getRowCount():1),l=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,a.isArray()?a.getColumnCount():1,o.isArray()?o.getColumnCount():1),f=O(c,l,e,g.create(h.NA)),m=O(c,l,t,g.create(h.NA)),d=O(c,l,r,g.create(h.NA)),C=O(c,l,a,g.create(h.NA)),_=O(c,l,o,g.create(h.NA)),E=f.mapValue((b,R,N)=>{const V=m.get(R,N),M=d.get(R,N),D=C.get(R,N),L=_.get(R,N);return this._handleSignleObject(b,V,M,D,L)});return c===1&&l===1?E.get(0,0):E}_handleSignleObject(e,t,r,n,s){if(e.isError())return e;if(t.isError())return t;if(r.isError())return r;if(n.isError())return n;if(s.isError())return s;const{isError:a,errorObject:o,variants:c}=k(e,t,r,n,s);if(a)return o;const[l,f,m,d,C]=c,_=+l.getValue(),E=+f.getValue(),b=+m.getValue(),R=+d.getValue(),N=+C.getValue();if(E<=0||b<=0||_<=0||_>=1||R>=N)return g.create(h.NUM);const V=sa(_,E,b)*(N-R)+R;return y.create(V)}}class Eo extends p{constructor(){super(...arguments);A(this,"minParams",4);A(this,"maxParams",4)}calculate(e,t,r,n){const s=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1),o=O(s,a,e,g.create(h.NA)),c=O(s,a,t,g.create(h.NA)),l=O(s,a,r,g.create(h.NA)),f=O(s,a,n,g.create(h.NA)),m=o.mapValue((d,C,_)=>{const E=c.get(C,_),b=l.get(C,_),R=f.get(C,_);return d.isError()?d:E.isError()?E:b.isError()?b:R.isError()?R:this._handleSignleObject(d,E,b,R)});return s===1&&a===1?m.get(0,0):m}_handleSignleObject(e,t,r,n){const{isError:s,errorObject:a,variants:o}=k(e,t,r,n);if(s)return a;const[c,l,f,m]=o,d=Math.floor(+c.getValue()),C=Math.floor(+l.getValue()),_=+f.getValue(),E=+m.getValue();if(d<0||d>C||_<0||_>1)return g.create(h.NUM);let b;return E?b=co(d,C,_):b=oa(d,C,_),y.create(b)}}class bo extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),o=O(n,s,t,g.create(h.NA)),c=O(n,s,r,g.create(h.NA)),l=a.mapValue((f,m,d)=>{const C=o.get(m,d),_=c.get(m,d);return f.isError()?f:C.isError()?C:_.isError()?_:this._handleSignleObject(f,C,_)});return n===1&&s===1?l.get(0,0):l}_handleSignleObject(e,t,r){const{isError:n,errorObject:s,variants:a}=k(e,t,r);if(n)return s;const[o,c,l]=a,f=Math.floor(+o.getValue()),m=+c.getValue(),d=+l.getValue();if(f<0||m<=0||m>=1||d<=0||d>=1)return g.create(h.NUM);let C=0;for(;C<=f&&!(co(C,f,m)>=d);)C++;return y.create(C)}}class yo extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=O(r,n,e,g.create(h.NA)),a=O(r,n,t,g.create(h.NA)),o=s.mapValue((c,l,f)=>{const m=a.get(l,f);return c.isError()?c:m.isError()?m:this._handleSignleObject(c,m)});return r===1&&n===1?o.get(0,0):o}_handleSignleObject(e,t){const{isError:r,errorObject:n,variants:s}=k(e,t);if(r)return n;const[a,o]=s,c=+a.getValue(),l=Math.floor(+o.getValue());if(c<0||l<1||l>10**10)return g.create(h.NUM);const f=1-ua(c,l);return y.create(f)}}class Ro extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=O(r,n,e,g.create(h.NA)),a=O(r,n,t,g.create(h.NA)),o=s.mapValue((c,l,f)=>{const m=a.get(l,f);return c.isError()?c:m.isError()?m:this._handleSignleObject(c,m)});return r===1&&n===1?o.get(0,0):o}_handleSignleObject(e,t){const{isError:r,errorObject:n,variants:s}=k(e,t);if(r)return n;const[a,o]=s,c=+a.getValue(),l=Math.floor(+o.getValue());if(c<0||c>1||l<1||l>10**10)return g.create(h.NUM);const f=lo(1-c,l);return Number.isNaN(f)||!Number.isFinite(f)?g.create(h.NUM):y.create(f)}}class No extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,s=t.isArray()?t.getRowCount():1,a=t.isArray()?t.getColumnCount():1;let o=e;if(e.isArray()&&r===1&&n===1&&(o=e.get(0,0)),o.isError())return o;let c=t;if(t.isArray()&&s===1&&a===1&&(c=t.get(0,0)),c.isError())return c;if(r*n===1||s*a===1)return o.isNull()||c.isNull()?g.create(h.VALUE):g.create(h.NA);if(r*n!==s*a)return g.create(h.NA);const{isError:l,errorObject:f,array1Values:m,array2Values:d,noCalculate:C}=Ke(e,t,r*n,n,a);return l?f:C?g.create(h.DIV_BY_ZERO):this._getResult(m,d,r,n)}_getResult(e,t,r,n){let s=0;for(let c=0;c<e.length;c++){if(t[c]===0)return g.create(h.DIV_BY_ZERO);s+=(e[c]-t[c])**2/t[c]}let a=(r-1)*(n-1);r===1?a=n-1:n===1&&(a=r-1);const o=1-ua(s,a);return y.create(o)}}class po extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),o=O(n,s,t,g.create(h.NA)),c=O(n,s,r,g.create(h.NA)),l=a.mapValue((f,m,d)=>{const C=o.get(m,d),_=c.get(m,d);if(f.isError())return f;if(C.isError())return C;if(_.isError())return _;const{isError:E,errorObject:b,variants:R}=k(f,C,_);if(E)return b;const[N,V,M]=R,D=+N.getValue(),L=+V.getValue(),P=Math.floor(+M.getValue());if(D<=0||D>=1||L<=0||P<1)return g.create(h.NUM);const j=Math.abs(Pn(D/2,0,1)*L/Math.sqrt(P));return y.create(j)});return n===1&&s===1?l.get(0,0):l}}class Vo extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,s=t.isArray()?t.getRowCount():1,a=t.isArray()?t.getColumnCount():1;let o=e;if(e.isArray()&&r===1&&n===1&&(o=e.get(0,0)),o.isError())return o;let c=t;if(t.isArray()&&s===1&&a===1&&(c=t.get(0,0)),c.isError())return c;if((r*n===1||s*a===1)&&(o.isNull()||c.isNull()))return g.create(h.VALUE);if(r*n!==s*a)return g.create(h.NA);const{isError:l,errorObject:f,array1Values:m,array2Values:d,noCalculate:C}=Ke(e,t,r*n,n,a);return l?f:C?g.create(h.DIV_BY_ZERO):this._getResult(m,d)}_getResult(e,t){if(e.length===0)return g.create(h.DIV_BY_ZERO);const r=e.length;let n=0,s=0;for(let l=0;l<r;l++)n+=e[l],s+=t[l];const a=n/r,o=s/r;let c=0;for(let l=0;l<r;l++){const f=e[l]-a,m=t[l]-o;c+=f*m}return y.create(c/r)}}class Oo extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),o=O(n,s,t,g.create(h.NA)),c=O(n,s,r,g.create(h.NA)),l=a.mapValue((f,m,d)=>{const C=o.get(m,d),_=c.get(m,d);return f.isError()?f:C.isError()?C:_.isError()?_:this._handleSignleObject(f,C,_)});return n===1&&s===1?l.get(0,0):l}_handleSignleObject(e,t,r){const{isError:n,errorObject:s,variants:a}=k(e,t,r);if(n)return s;const[o,c,l]=a,f=+o.getValue(),m=+c.getValue(),d=+l.getValue();if(f<0||m<=0)return g.create(h.NUM);let C;return d?C=Rm(f,m):C=Nm(f,m),y.create(C)}}class So extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),o=O(n,s,t,g.create(h.NA)),c=O(n,s,r,g.create(h.NA)),l=a.mapValue((f,m,d)=>{const C=o.get(m,d),_=c.get(m,d);return f.isError()?f:C.isError()?C:_.isError()?_:this._handleSignleObject(f,C,_)});return n===1&&s===1?l.get(0,0):l}_handleSignleObject(e,t,r){const{isError:n,errorObject:s,variants:a}=k(e,t,r);if(n)return s;const[o,c,l]=a,f=+o.getValue(),m=Math.floor(+c.getValue()),d=Math.floor(+l.getValue());if(f<0||m<1||m>10**10||d<1||d>10**10)return g.create(h.NUM);const C=1-ca(f,m,d);return y.create(C)}}class Mo extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),o=O(n,s,t,g.create(h.NA)),c=O(n,s,r,g.create(h.NA)),l=a.mapValue((f,m,d)=>{const C=o.get(m,d),_=c.get(m,d);return f.isError()?f:C.isError()?C:_.isError()?_:this._handleSignleObject(f,C,_)});return n===1&&s===1?l.get(0,0):l}_handleSignleObject(e,t,r){const{isError:n,errorObject:s,variants:a}=k(e,t,r);if(n)return s;const[o,c,l]=a,f=+o.getValue(),m=Math.floor(+c.getValue()),d=Math.floor(+l.getValue());if(f<0||f>1||m<1||m>10**10||d<1||d>10**10)return g.create(h.NUM);const C=fo(1-f,m,d);return Number.isNaN(C)||!Number.isFinite(C)?g.create(h.NUM):y.create(C)}}class Do extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const{isError:r,errorObject:n,variance:s,ns1:a}=this._getValues(e);if(r)return n;const{isError:o,errorObject:c,variance:l,ns1:f}=this._getValues(t);if(o)return c;let m=2*(1-ca(s/l,a,f));return m>1&&(m=2-m),y.create(m)}_getValues(e){let t=0,r=0;const n=e.isArray()?e.getRowCount():1,s=e.isArray()?e.getColumnCount():1;if(n===1&&s===1){const f=e.isArray()?e.get(0,0):e;return f.isError()?{isError:!0,errorObject:f,variance:t,ns1:r}:f.isNull()?{isError:!0,errorObject:g.create(h.VALUE),variance:t,ns1:r}:{isError:!0,errorObject:g.create(h.DIV_BY_ZERO),variance:t,ns1:r}}const a=[];let o=0;for(let f=0;f<n;f++)for(let m=0;m<s;m++){const d=e.isArray()?e.get(f,m):e;if(d.isError())return{isError:!0,errorObject:d,variance:t,ns1:r};if(d.isNull()||d.isBoolean())continue;const C=d.getValue();S.isRealNum(C)&&(a.push(+C),o+=+C)}if(a.length<=1)return{isError:!0,errorObject:g.create(h.DIV_BY_ZERO),variance:t,ns1:r};const c=o/a.length;let l=0;for(let f=0;f<a.length;f++)l+=(a[f]-c)**2;return r=a.length-1,t=l/r,t===0?{isError:!0,errorObject:g.create(h.DIV_BY_ZERO),variance:t,ns1:r}:{isError:!1,errorObject:null,variance:t,ns1:r}}}class wo extends p{constructor(){super(...arguments);A(this,"minParams",4);A(this,"maxParams",4)}calculate(e,t,r,n){const s=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1),o=O(s,a,e,g.create(h.NA)),c=O(s,a,t,g.create(h.NA)),l=O(s,a,r,g.create(h.NA)),f=O(s,a,n,g.create(h.NA)),m=o.mapValue((d,C,_)=>{const E=c.get(C,_),b=l.get(C,_),R=f.get(C,_);return d.isError()?d:E.isError()?E:b.isError()?b:R.isError()?R:this._handleSignleObject(d,E,b,R)});return s===1&&a===1?m.get(0,0):m}_handleSignleObject(e,t,r,n){const{isError:s,errorObject:a,variants:o}=k(e,t,r,n);if(s)return a;const[c,l,f,m]=o,d=+c.getValue(),C=+l.getValue(),_=+f.getValue(),E=+m.getValue();if(d<0||C<=0||_<=0)return g.create(h.NUM);let b;return E?b=pm(d,C,_):b=Vm(d,C,_),y.create(b)}}class Lo extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),o=O(n,s,t,g.create(h.NA)),c=O(n,s,r,g.create(h.NA)),l=a.mapValue((f,m,d)=>{const C=o.get(m,d),_=c.get(m,d);return f.isError()?f:C.isError()?C:_.isError()?_:this._handleSignleObject(f,C,_)});return n===1&&s===1?l.get(0,0):l}_handleSignleObject(e,t,r){const{isError:n,errorObject:s,variants:a}=k(e,t,r);if(n)return s;const[o,c,l]=a,f=+o.getValue(),m=+c.getValue(),d=+l.getValue();if(f<0||f>1||m<=0||d<=0)return g.create(h.NUM);const C=Om(f,m,d);return Number.isNaN(C)||!Number.isFinite(C)?g.create(h.NUM):y.create(C)}}class Po extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),o=O(n,s,t,g.create(h.NA)),c=O(n,s,r,g.create(h.NA)),l=a.mapValue((f,m,d)=>{const C=o.get(m,d),_=c.get(m,d);return f.isError()?f:C.isError()?C:_.isError()?_:this._handleSignleObject(f,C,_)});return n===1&&s===1?l.get(0,0):l}_handleSignleObject(e,t,r){const{isError:n,errorObject:s,variants:a}=k(e,t,r);if(n)return s;const[o,c,l]=a,f=+o.getValue(),m=+c.getValue(),d=+l.getValue();if(f<=0||f>=1||d<=0)return g.create(h.NUM);const C=Dm(f,m,d);return Number.isNaN(C)||!Number.isFinite(C)?g.create(h.NUM):y.create(C)}}class jo extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){const t={};let r=0,n=1;for(let s=0;s<e.length;s++){const a=e[s];if(a.isError())return a;if(a.isString()){const l=a.convertToNumberObjectValue();if(l.isError())return l}const o=a.isArray()?a.getRowCount():1,c=a.isArray()?a.getColumnCount():1;for(let l=0;l<o;l++)for(let f=0;f<c;f++){const m=a.isArray()?a.get(l,f):a;if(m.isError())return m;if(m.isNull()||m.isBoolean()||m.isString())continue;const d=m.getValue();S.isRealNum(d)&&(t[+d]?(t[+d].count++,t[+d].count>n&&(n=t[+d].count)):t[+d]={count:1,order:r++})}}return r===0||n===1?new g(h.NA):this._getResult(t,n)}_getResult(e,t){const r=Object.entries(e).filter(([n,{count:s}])=>s===t).sort((n,s)=>n[1].order-s[1].order).map(([n])=>+n);return y.create(r[0])}}class xo extends p{constructor(){super(...arguments);A(this,"minParams",4);A(this,"maxParams",4)}calculate(e,t,r,n){const s=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1),o=O(s,a,e,g.create(h.NA)),c=O(s,a,t,g.create(h.NA)),l=O(s,a,r,g.create(h.NA)),f=O(s,a,n,g.create(h.NA)),m=o.mapValue((d,C,_)=>{const E=c.get(C,_),b=l.get(C,_),R=f.get(C,_);return d.isError()?d:E.isError()?E:b.isError()?b:R.isError()?R:this._handleSignleObject(d,E,b,R)});return s===1&&a===1?m.get(0,0):m}_handleSignleObject(e,t,r,n){const{isError:s,errorObject:a,variants:o}=k(e,t,r,n);if(s)return a;const[c,l,f,m]=o,d=+c.getValue(),C=+l.getValue(),_=+f.getValue(),E=+m.getValue();if(_<=0)return g.create(h.NUM);let b;return E?b=wr(d,C,_):b=Co(d,C,_),y.create(b)}}class Uo extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),o=O(n,s,t,g.create(h.NA)),c=O(n,s,r,g.create(h.NA)),l=a.mapValue((f,m,d)=>{const C=o.get(m,d),_=c.get(m,d);return f.isError()?f:C.isError()?C:_.isError()?_:this._handleSignleObject(f,C,_)});return n===1&&s===1?l.get(0,0):l}_handleSignleObject(e,t,r){const{isError:n,errorObject:s,variants:a}=k(e,t,r);if(n)return s;const[o,c,l]=a,f=+o.getValue(),m=+c.getValue(),d=+l.getValue();if(f<=0||f>=1||d<=0)return g.create(h.NUM);const C=Pn(f,m,d);return y.create(C)}}class vo extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.mapValue(r=>this._handleSignleObject(r));return e.getRowCount()===1&&e.getColumnCount()===1?t.get(0,0):t}return this._handleSignleObject(e)}_handleSignleObject(e){const{isError:t,errorObject:r,variants:n}=k(e);if(t)return r;const[s]=n,a=+s.getValue();if(a<=0||a>=1)return g.create(h.NUM);const o=Pn(a,0,1);return y.create(o)}}class To extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=this._getValues(e);if(t.isArray()){const n=t.mapValue(s=>this._handleSingleObject(r,s));return n.getRowCount()===1&&n.getColumnCount()===1?n.get(0,0):n}return this._handleSingleObject(r,t)}_handleSingleObject(e,t){if(e instanceof g)return e;const{isError:r,errorObject:n,variants:s}=k(t);if(r)return n;const[a]=s,o=+a.getValue(),c=e.length;if(o<0||o>1)return g.create(h.NUM);const l=o*(c-1),f=Math.floor(l),m=l-f;if(m===0)return y.create(e[f]);const d=e[f]+m*(e[f+1]-e[f]);return y.create(d)}_getValues(e){const t=e.isArray()?e.getRowCount():1,r=e.isArray()?e.getColumnCount():1,n=[];for(let s=0;s<t;s++)for(let a=0;a<r;a++){const o=e.isArray()?e.get(s,a):e;if(o.isError())return o;if(o.isNull()||o.isBoolean()||o.isString())continue;const c=o.getValue();S.isRealNum(c)&&n.push(+c)}return n.length===0?g.create(h.NUM):n.sort((s,a)=>s-a)}}class Bo extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",3)}calculate(e,t,r){const n=this._getValues(e);let s=r!=null?r:y.create(3);s.isNull()&&(s=y.create(3));const a=Math.max(t.isArray()?t.getRowCount():1,s.isArray()?s.getRowCount():1),o=Math.max(t.isArray()?t.getColumnCount():1,s.isArray()?s.getColumnCount():1),c=O(a,o,t,g.create(h.NA)),l=O(a,o,s,g.create(h.NA)),f=c.mapValue((m,d,C)=>{const _=l.get(d,C);return m.isError()?m:_.isError()?_:this._handleSingleObject(n,m,_)});return a===1&&o===1?f.get(0,0):f}_handleSingleObject(e,t,r){if(e instanceof g)return e;const{isError:n,errorObject:s,variants:a}=k(t,r);if(n)return s;const[o,c]=a,l=+o.getValue(),f=Math.floor(+c.getValue()),m=e.length;if(m===0||l<e[0]||l>e[m-1])return g.create(h.NA);if(m===1)return l===e[0]?y.create(1):g.create(h.NA);let d=0,C=!1,_=0;for(;!C&&_<m;)l===e[_]?(d=_/(m-1),C=!0):l>e[_]&&_+1<m&&l<e[_+1]&&(d=(_+(l-e[_])/(e[_+1]-e[_]))/(m-1),C=!0),_++;return C?f<1?g.create(h.NUM):(d=Ge(d,f),y.create(d)):g.create(h.NA)}_getValues(e){const t=e.isArray()?e.getRowCount():1,r=e.isArray()?e.getColumnCount():1,n=[];for(let s=0;s<t;s++)for(let a=0;a<r;a++){const o=e.isArray()?e.get(s,a):e;if(o.isError())return o;if(o.isNull()||o.isBoolean())continue;const c=o.getValue();S.isRealNum(c)&&n.push(+c)}return n.sort((s,a)=>s-a)}}class Fo extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),o=O(n,s,t,g.create(h.NA)),c=O(n,s,r,g.create(h.NA)),l=a.mapValue((f,m,d)=>{const C=o.get(m,d),_=c.get(m,d);return f.isError()?f:C.isError()?C:_.isError()?_:this._handleSignleObject(f,C,_)});return n===1&&s===1?l.get(0,0):l}_handleSignleObject(e,t,r){const{isError:n,errorObject:s,variants:a}=k(e,t,r);if(n)return s;const[o,c,l]=a,f=Math.floor(+o.getValue()),m=+c.getValue(),d=+l.getValue();if(f<0||m<0)return g.create(h.NUM);let C;return d?C=Lm(f,m):C=_o(f,m),y.create(C)}}class Io extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=this._getValues(e);if(t.isArray()){const n=t.mapValue(s=>this._handleSingleObject(r,s));return n.getRowCount()===1&&n.getColumnCount()===1?n.get(0,0):n}return this._handleSingleObject(r,t)}_handleSingleObject(e,t){if(e instanceof g)return e;const{isError:r,errorObject:n,variants:s}=k(t);if(r)return n;const[a]=s,o=Math.floor(+a.getValue());if(o<0||o>4)return g.create(h.NUM);const c=o/4,l=e.length,f=c*(l-1),m=Math.floor(f),d=f-m;if(d===0)return y.create(e[m]);const C=e[m]+d*(e[m+1]-e[m]);return y.create(C)}_getValues(e){const t=e.isArray()?e.getRowCount():1,r=e.isArray()?e.getColumnCount():1,n=[];for(let s=0;s<t;s++)for(let a=0;a<r;a++){const o=e.isArray()?e.get(s,a):e;if(o.isError())return o;if(o.isNull()||o.isBoolean())continue;const c=o.getValue();S.isRealNum(c)&&n.push(+c)}return n.length===0?g.create(h.NUM):n.sort((s,a)=>s-a)}}class ko extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){const t=this.flattenArray(e);return t.isError()?t:t.std()}}class $o extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){const t=this.flattenArray(e);return t.isError()?t:t.std(1)}}class Yo extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=O(r,n,e,g.create(h.NA)),a=O(r,n,t,g.create(h.NA)),o=s.mapValue((c,l,f)=>{const m=a.get(l,f);return c.isError()?c:m.isError()?m:this._handleSignleObject(c,m)});return r===1&&n===1?o.get(0,0):o}_handleSignleObject(e,t){const{isError:r,errorObject:n,variants:s}=k(e,t);if(r)return n;const[a,o]=s,c=+a.getValue(),l=Math.floor(+o.getValue());if(c<=0||c>1||l<1||l>10**10)return g.create(h.NUM);const f=Math.abs(jn(c/2,l));return Number.isNaN(f)||!Number.isFinite(f)?g.create(h.NUM):y.create(f)}}class Ho extends p{constructor(){super(...arguments);A(this,"minParams",4);A(this,"maxParams",4)}calculate(e,t,r,n){const{isError:s,errorObject:a,array1Values:o,array2Values:c}=this._handleArray1AndArray2(e,t),l=this._getArrayValues(e),f=this._getArrayValues(t),m=Math.max(r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1),d=Math.max(r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1),C=O(m,d,r,g.create(h.NA)),_=O(m,d,n,g.create(h.NA)),E=C.mapValue((b,R,N)=>{const V=_.get(R,N);if(e.isError())return e;if(t.isError())return t;if(b.isError())return b;if(V.isError())return V;const{isError:M,errorObject:D,variants:L}=k(b,V);if(M)return D;const[P,j]=L,F=Math.floor(+P.getValue()),v=Math.floor(+j.getValue());return![1,2].includes(F)||![1,2,3].includes(v)?g.create(h.NUM):v===1&&s?a:v!==1&&l instanceof g?l:v!==1&&f instanceof g?f:this._handleSignleObject(v===1?o:l,v===1?c:f,F,v)});return m===1&&d===1?E.get(0,0):E}_handleSignleObject(e,t,r,n){if(e.length<2||t.length<2)return g.create(h.DIV_BY_ZERO);const{isError:s,errorObject:a,x:o,degFreedom:c}=this._getTDistParamByArrayValues(e,t,n);if(s)return a;let l=Lr(-o,c);return r===2&&(l*=2),Number.isNaN(l)||!Number.isFinite(l)?g.create(h.NUM):y.create(l)}_getArrayValues(e){const t=e.isArray()?e.getRowCount():1,r=e.isArray()?e.getColumnCount():1,n=[];for(let s=0;s<t;s++)for(let a=0;a<r;a++){const o=e.isArray()?e.get(s,a):e;if(o.isError())return o;if(o.isNull()){if(t*r===1)return g.create(h.VALUE);continue}o.isBoolean()||o.isString()||n.push(+o.getValue())}return n}_handleArray1AndArray2(e,t){const r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,s=t.isArray()?t.getRowCount():1,a=t.isArray()?t.getColumnCount():1;let o=e;if(e.isArray()&&r===1&&n===1&&(o=e.get(0,0)),o.isError())return{isError:!0,errorObject:o,array1Values:[],array2Values:[]};let c=t;if(t.isArray()&&s===1&&a===1&&(c=t.get(0,0)),c.isError())return{isError:!0,errorObject:c,array1Values:[],array2Values:[]};if((r*n===1||s*a===1)&&(o.isNull()||c.isNull()))return{isError:!0,errorObject:g.create(h.VALUE),array1Values:[],array2Values:[]};if(r*n!==s*a)return{isError:!0,errorObject:g.create(h.NA),array1Values:[],array2Values:[]};const{isError:l,errorObject:f,array1Values:m,array2Values:d,noCalculate:C}=Ke(e,t,r*n,n,a);return l?{isError:!0,errorObject:f,array1Values:[],array2Values:[]}:C||m.length<2?{isError:!0,errorObject:g.create(h.DIV_BY_ZERO),array1Values:[],array2Values:[]}:{isError:!1,errorObject:null,array1Values:m,array2Values:d}}_getTDistParamByArrayValues(e,t,r){return r===1?this._getTDistParamByType1(e,t):r===2?this._getTDistParamByType2(e,t):this._getTDistParamByType3(e,t)}_getTDistParamByType1(e,t){const r=e.length;let n=0,s=0,a=0;for(let m=0;m<r;m++)n+=e[m],s+=t[m],a+=(e[m]-t[m])**2;const o=n-s,c=r*a-o**2,l=r-1;return c===0?{isError:!0,errorObject:g.create(h.DIV_BY_ZERO),x:0,degFreedom:l}:{isError:!1,errorObject:null,x:Math.abs(o)*Math.sqrt(l/c),degFreedom:l}}_getTDistParamByType2(e,t){const r=e.length,n=t.length;let s=0,a=0;for(let E=0;E<r;E++)s+=e[E],a+=e[E]**2;let o=0,c=0;for(let E=0;E<n;E++)o+=t[E],c+=t[E]**2;const l=a-s**2/r,f=c-o**2/n,m=Math.sqrt(l+f);if(m===0)return{isError:!0,errorObject:g.create(h.DIV_BY_ZERO),x:0,degFreedom:0};const d=r-1+n-1,C=Math.sqrt(r*n*d/(r+n));return{isError:!1,errorObject:null,x:Math.abs(s/r-o/n)/m*C,degFreedom:d}}_getTDistParamByType3(e,t){const r=e.length,n=t.length;let s=0,a=0;for(let _=0;_<r;_++)s+=e[_],a+=e[_]**2;let o=0,c=0;for(let _=0;_<n;_++)o+=t[_],c+=t[_]**2;const l=(a-s**2/r)/(r*(r-1)),f=(c-o**2/n)/(n*(n-1));if(l+f===0)return{isError:!0,errorObject:g.create(h.DIV_BY_ZERO),x:0,degFreedom:0};const m=l/(l+f),d=Math.abs(s/r-o/n)/Math.sqrt(l+f),C=1/(m**2/(r-1)+(1-m)**2/(n-1));return{isError:!1,errorObject:null,x:d,degFreedom:C}}}class Go extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){const t=this.flattenArray(e);return t.isError()?t:t.var()}}class Wo extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){const t=this.flattenArray(e);return t.isError()?t:t.var(1)}}class Qo extends p{constructor(){super(...arguments);A(this,"minParams",4);A(this,"maxParams",4)}calculate(e,t,r,n){const s=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1),o=O(s,a,e,g.create(h.NA)),c=O(s,a,t,g.create(h.NA)),l=O(s,a,r,g.create(h.NA)),f=O(s,a,n,g.create(h.NA)),m=o.mapValue((d,C,_)=>{const E=c.get(C,_),b=l.get(C,_),R=f.get(C,_);return d.isError()?d:E.isError()?E:b.isError()?b:R.isError()?R:this._handleSignleObject(d,E,b,R)});return s===1&&a===1?m.get(0,0):m}_handleSignleObject(e,t,r,n){const{isError:s,errorObject:a,variants:o}=k(e,t,r,n);if(s)return a;const[c,l,f,m]=o,d=+c.getValue(),C=+l.getValue(),_=+f.getValue(),E=+m.getValue();if(d<0||C<=0||_<=0)return g.create(h.NUM);const b=Math.exp(-((d/_)**C));let R;return E?R=1-b:R=C/_**C*d**(C-1)*b,Number.isNaN(R)||!Number.isFinite(R)?g.create(h.NUM):y.create(R)}}class qo extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",3)}calculate(e,t,r){const n=this._getArrayValues(e),s=Math.max(t.isArray()?t.getRowCount():1,r!=null&&r.isArray()?r.getRowCount():1),a=Math.max(t.isArray()?t.getColumnCount():1,r!=null&&r.isArray()?r.getColumnCount():1),o=O(s,a,t,g.create(h.NA)),c=r?O(s,a,r,g.create(h.NA)):void 0,l=o.mapValue((f,m,d)=>{if(n instanceof g)return n;if(f.isError())return f;const C=r?c.get(m,d):void 0;return C!=null&&C.isError()?C:n.length===0?g.create(h.NA):n.length===1?g.create(h.DIV_BY_ZERO):this._handleSignleObject(n,f,C)});return s===1&&a===1?l.get(0,0):l}_handleSignleObject(e,t,r){const{isError:n,errorObject:s,variants:a}=k(t);if(n)return s;const[o]=a,c=+o.getValue(),l=e.length;let f=0,m=0;for(let E=0;E<l;E++)f+=e[E],m+=e[E]**2;let d=0;if(r!==void 0){const{isError:E,errorObject:b,variants:R}=k(r);if(E)return b;const[N]=R;d=+N.getValue()}else{const E=f/l;d=Math.sqrt((m-2*E*f+l*E**2)/(l-1))}if(d<=0)return g.create(h.NUM);const C=(f/l-c)/(d/Math.sqrt(l)),_=1-wr(C,0,1);return Number.isNaN(_)||!Number.isFinite(_)?g.create(h.NUM):y.create(_)}_getArrayValues(e){const t=[],r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1;for(let s=0;s<r;s++)for(let a=0;a<n;a++){const o=e.isArray()?e.get(s,a):e;if(o.isError())return o;if(o.isNull()||o.isBoolean()||o.isString())continue;const c=o.getValue();S.isRealNum(c)&&t.push(+c)}return t}}class Um extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",5)}calculate(e,t,r,n,s){let a=n!=null?n:y.create(0),o=s!=null?s:y.create(1);a.isNull()&&(a=y.create(0)),o.isNull()&&(o=y.create(1));const c=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,a.isArray()?a.getRowCount():1,o.isArray()?o.getRowCount():1),l=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,a.isArray()?a.getColumnCount():1,o.isArray()?o.getColumnCount():1),f=O(c,l,e,g.create(h.NA)),m=O(c,l,t,g.create(h.NA)),d=O(c,l,r,g.create(h.NA)),C=O(c,l,a,g.create(h.NA)),_=O(c,l,o,g.create(h.NA)),E=f.mapValue((b,R,N)=>{const V=m.get(R,N),M=d.get(R,N),D=C.get(R,N),L=_.get(R,N);return this._handleSignleObject(b,V,M,D,L)});return c===1&&l===1?E.get(0,0):E}_handleSignleObject(e,t,r,n,s){if(e.isError())return e;if(t.isError())return t;if(r.isError())return r;if(n.isError())return n;if(s.isError())return s;const{isError:a,errorObject:o,variants:c}=k(e,t,r,n,s);if(a)return o;const[l,f,m,d,C]=c,_=+l.getValue(),E=+f.getValue(),b=+m.getValue(),R=+d.getValue(),N=+C.getValue();if(E<=0||b<=0||_<R||_>N||R===N)return g.create(h.NUM);const V=oo((_-R)/(N-R),E,b);return y.create(V)}}var me=(i=>(i.BETADIST="BETADIST",i.BETAINV="BETAINV",i.BINOMDIST="BINOMDIST",i.CHIDIST="CHIDIST",i.CHIINV="CHIINV",i.CHITEST="CHITEST",i.CONFIDENCE="CONFIDENCE",i.COVAR="COVAR",i.CRITBINOM="CRITBINOM",i.EXPONDIST="EXPONDIST",i.FDIST="FDIST",i.FINV="FINV",i.FTEST="FTEST",i.GAMMADIST="GAMMADIST",i.GAMMAINV="GAMMAINV",i.HYPGEOMDIST="HYPGEOMDIST",i.LOGINV="LOGINV",i.LOGNORMDIST="LOGNORMDIST",i.MODE="MODE",i.NEGBINOMDIST="NEGBINOMDIST",i.NORMDIST="NORMDIST",i.NORMINV="NORMINV",i.NORMSDIST="NORMSDIST",i.NORMSINV="NORMSINV",i.PERCENTILE="PERCENTILE",i.PERCENTRANK="PERCENTRANK",i.POISSON="POISSON",i.QUARTILE="QUARTILE",i.RANK="RANK",i.STDEV="STDEV",i.STDEVP="STDEVP",i.TDIST="TDIST",i.TINV="TINV",i.TTEST="TTEST",i.VAR="VAR",i.VARP="VARP",i.WEIBULL="WEIBULL",i.ZTEST="ZTEST",i))(me||{});class vm extends p{constructor(){super(...arguments);A(this,"minParams",4);A(this,"maxParams",4)}calculate(e,t,r,n){const s=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1),o=O(s,a,e,g.create(h.NA)),c=O(s,a,t,g.create(h.NA)),l=O(s,a,r,g.create(h.NA)),f=O(s,a,n,g.create(h.NA)),m=o.mapValue((d,C,_)=>{const E=c.get(C,_),b=l.get(C,_),R=f.get(C,_);return d.isError()?d:E.isError()?E:b.isError()?b:R.isError()?R:this._handleSignleObject(d,E,b,R)});return s===1&&a===1?m.get(0,0):m}_handleSignleObject(e,t,r,n){const{isError:s,errorObject:a,variants:o}=k(e,t,r,n);if(s)return a;const[c,l,f,m]=o,d=Math.floor(+c.getValue()),C=Math.floor(+l.getValue()),_=Math.floor(+f.getValue()),E=Math.floor(+m.getValue());if(d<0||d>C||d>_||d<C-E+_||C<=0||C>E||_<=0||_>E||E<=0)return g.create(h.NUM);let b=fa(d,C,_,E);return Number.isNaN(b)&&(b=0),y.create(b)}}class Tm extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),o=O(n,s,t,g.create(h.NA)),c=O(n,s,r,g.create(h.NA)),l=a.mapValue((f,m,d)=>{const C=o.get(m,d),_=c.get(m,d);return f.isError()?f:C.isError()?C:_.isError()?_:this._handleSignleObject(f,C,_)});return n===1&&s===1?l.get(0,0):l}_handleSignleObject(e,t,r){const{isError:n,errorObject:s,variants:a}=k(e,t,r);if(n)return s;const[o,c,l]=a,f=+o.getValue(),m=+c.getValue(),d=+l.getValue();if(f<=0||d<=0)return g.create(h.NUM);const C=go(f,m,d);return y.create(C)}}class Bm extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),o=O(n,s,t,g.create(h.NA)),c=O(n,s,r,g.create(h.NA)),l=a.mapValue((f,m,d)=>{const C=o.get(m,d),_=c.get(m,d);return f.isError()?f:C.isError()?C:_.isError()?_:this._handleSignleObject(f,C,_)});return n===1&&s===1?l.get(0,0):l}_handleSignleObject(e,t,r){const{isError:n,errorObject:s,variants:a}=k(e,t,r);if(n)return s;const[o,c,l]=a,f=Math.floor(+o.getValue()),m=Math.floor(+c.getValue()),d=+l.getValue();if(f<0||m<1||d<=0||d>=1)return g.create(h.NUM);const C=ma(f,m,d);return y.create(C)}}class Fm extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.mapValue(r=>this._handleSignleObject(r));return e.getRowCount()===1&&e.getColumnCount()===1?t.get(0,0):t}return this._handleSignleObject(e)}_handleSignleObject(e){const{isError:t,errorObject:r,variants:n}=k(e);if(t)return r;const[s]=n,a=+s.getValue(),o=wr(a,0,1);return y.create(o)}}class Im extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",3);A(this,"needsReferenceObject",!0)}calculate(e,t,r){let n=e;n.isReferenceObject()&&(n=n.toArrayValueObject());const{refHasError:s,refErrorObject:a,refNumbers:o}=this._checkRefReferenceObject(t);let c=r!=null?r:y.create(0);c.isReferenceObject()&&(c=c.toArrayValueObject());const l=Math.max(n.isArray()?n.getRowCount():1,c.isArray()?c.getRowCount():1),f=Math.max(n.isArray()?n.getColumnCount():1,c.isArray()?c.getColumnCount():1),m=O(l,f,n,g.create(h.NA)),d=O(l,f,c,g.create(h.NA)),C=m.map((_,E,b)=>{const R=d.get(E,b);if(!e.isReferenceObject()&&e.isNull())return g.create(h.NA);if(s)return a;if(R.isError())return R;const N=+_.getValue(),V=+R.getValue();if(Number.isNaN(N)||Number.isNaN(V))return g.create(h.VALUE);const D=o.sort((L,P)=>V?L-P:P-L).indexOf(N);return D===-1?g.create(h.NA):y.create(D+1)});return l===1&&f===1?C.get(0,0):C}_checkRefReferenceObject(e){let t=!1,r=g.create(h.NA);const n=[];return e.isReferenceObject()?(e.toArrayValueObject().iterator(a=>{const o=a;if(o.isError())return t=!0,r=o,!1;if(o.isNull()||o.isBoolean())return!0;const c=+o.getValue();if(Number.isNaN(c))return!0;n.push(c)}),{refHasError:t,refErrorObject:r,refNumbers:n}):{refHasError:!0,refErrorObject:r,refNumbers:n}}}class km extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),o=O(n,s,t,g.create(h.NA)),c=O(n,s,r,g.create(h.NA)),l=a.mapValue((f,m,d)=>{const C=o.get(m,d),_=c.get(m,d);return f.isError()?f:C.isError()?C:_.isError()?_:this._handleSignleObject(f,C,_)});return n===1&&s===1?l.get(0,0):l}_handleSignleObject(e,t,r){const{isError:n,errorObject:s,variants:a}=k(e,t,r);if(n)return s;const[o,c,l]=a,f=+o.getValue(),m=Math.floor(+c.getValue()),d=Math.floor(+l.getValue());if(f<0||m<1||m>10**10||d<1||d>2)return g.create(h.NUM);let C=Lr(-f,m);return d===2&&(C*=2),Number.isNaN(C)||!Number.isFinite(C)?g.create(h.NUM):y.create(C)}}const Ko=[[Um,me.BETADIST],[Ao,me.BETAINV],[Eo,me.BINOMDIST],[yo,me.CHIDIST],[Ro,me.CHIINV],[No,me.CHITEST],[po,me.CONFIDENCE],[Vo,me.COVAR],[bo,me.CRITBINOM],[Oo,me.EXPONDIST],[So,me.FDIST],[Mo,me.FINV],[Do,me.FTEST],[wo,me.GAMMADIST],[Lo,me.GAMMAINV],[vm,me.HYPGEOMDIST],[Tm,me.LOGNORMDIST],[Po,me.LOGINV],[jo,me.MODE],[Bm,me.NEGBINOMDIST],[xo,me.NORMDIST],[Uo,me.NORMINV],[Fm,me.NORMSDIST],[vo,me.NORMSINV],[To,me.PERCENTILE],[Bo,me.PERCENTRANK],[Fo,me.POISSON],[Io,me.QUARTILE],[Im,me.RANK],[$o,me.STDEV],[ko,me.STDEVP],[km,me.TDIST],[Yo,me.TINV],[Ho,me.TTEST],[Wo,me.VAR],[Go,me.VARP],[Qo,me.WEIBULL],[qo,me.ZTEST]],Xo=[];var Zo=(i=>(i.CUBEKPIMEMBER="CUBEKPIMEMBER",i.CUBEMEMBER="CUBEMEMBER",i.CUBEMEMBERPROPERTY="CUBEMEMBERPROPERTY",i.CUBERANKEDMEMBER="CUBERANKEDMEMBER",i.CUBESET="CUBESET",i.CUBESETCOUNT="CUBESETCOUNT",i.CUBEVALUE="CUBEVALUE",i))(Zo||{});class zo extends p{isCustom(){return!0}}class $m extends zo{isAsync(){return!0}}function Xe(i){const u=[];if(i.isError())return{isError:!0,errorObject:i,databaseValues:u};const e=i.isArray()?i.getRowCount():1,t=i.isArray()?i.getColumnCount():1;if(e<2)return{isError:!0,errorObject:g.create(h.VALUE),databaseValues:u};for(let r=0;r<e;r++){const n=[];for(let s=0;s<t;s++){const a=i.get(r,s);if(a.isNull()){n.push(null);continue}let o=`${a.getValue()}`;if(a.isBoolean()&&(o=o.toLocaleUpperCase()),a.isNumber()||S.isRealNum(o)){n.push(+o);continue}n.push(o)}u.push(n)}return{isError:!1,errorObject:null,databaseValues:u}}function Ze(i,u){let e=-1;if(i.isError())return{isError:!0,errorObject:i,fieldIndex:e};const t=i.isArray()?i.getRowCount():1,r=i.isArray()?i.getColumnCount():1;if(t>1||r>1)return{isError:!0,errorObject:g.create(h.VALUE),fieldIndex:e};const n=i.isArray()?i.get(0,0):i;let s=`${n.getValue()}`;if(n.isNull()?s=0:n.isBoolean()?s=n.getValue()?1:0:(n.isNumber()||S.isRealNum(s))&&(s=Math.floor(+s)),typeof s=="number"){if(s<1||s>u[0].length)return{isError:!0,errorObject:g.create(h.VALUE),fieldIndex:e};e=s-1}else if(e=u[0].findIndex(a=>a===null?!1:`${a}`.toLocaleLowerCase()===s.toLocaleLowerCase()),e===-1)return{isError:!0,errorObject:g.create(h.VALUE),fieldIndex:e};return{isError:!1,errorObject:null,fieldIndex:e}}function ze(i){const u=[];if(i.isError())return{isError:!0,errorObject:i,criteriaValues:u};const e=i.isArray()?i.getRowCount():1,t=i.isArray()?i.getColumnCount():1;if(e<2)return{isError:!0,errorObject:g.create(h.VALUE),criteriaValues:u};for(let r=0;r<e;r++){const n=[];for(let s=0;s<t;s++){const a=i.get(r,s);if(a.isNull()){n.push(null);continue}const o=`${a.getValue()}`;if(a.isBoolean()){n.push(a.getValue()?1:0);continue}if(a.isNumber()||S.isRealNum(o)){n.push(+o);continue}n.push(o)}u.push(n)}return{isError:!1,errorObject:null,criteriaValues:u}}function Je(i,u,e){const t=i.length,r=i[0].length,n={};let s=!1;for(let a=1;a<t;a++){let o=!0;for(let c=0;c<r;c++){const l=i[a][c];if(l===null)continue;let f=n[c];if(f===void 0){const m=i[0][c];f=u[0].findIndex(d=>d===null||m===null?!1:`${d}`.toLocaleLowerCase()===`${m}`.toLocaleLowerCase()),n[c]=f}if(f===-1&&(typeof l=="string"||l===0)){o=!1;break}else if(f>-1){const m=u[e][f];if(m===null){o=!1;break}const[d,C]=Ts(`${l}`);if(!ut.create(`${m}`).compare(C,d).getValue()){o=!1;break}}}if(o){s=!0;break}}return s}class Ym extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const{isError:n,errorObject:s,databaseValues:a}=Xe(e);if(n)return s;const{isError:o,errorObject:c,fieldIndex:l}=Ze(t,a);if(o)return c;const{isError:f,errorObject:m,criteriaValues:d}=ze(r);if(f)return m;let C=0,_=0;for(let E=1;E<a.length;E++){const b=a[E][l];typeof b=="number"&&Je(d,a,E)&&(C+=b,_++)}return _===0?g.create(h.DIV_BY_ZERO):y.create(C/_)}}class Hm extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const{isError:n,errorObject:s,databaseValues:a}=Xe(e);if(n)return s;const{isError:o,errorObject:c,fieldIndex:l}=Ze(t,a);if(o)return c;const{isError:f,errorObject:m,criteriaValues:d}=ze(r);if(f)return m;let C=0;for(let _=1;_<a.length;_++)typeof a[_][l]=="number"&&Je(d,a,_)&&C++;return y.create(C)}}class Gm extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const{isError:n,errorObject:s,databaseValues:a}=Xe(e);if(n)return s;const{isError:o,errorObject:c,fieldIndex:l}=Ze(t,a);if(o)return c;const{isError:f,errorObject:m,criteriaValues:d}=ze(r);if(f)return m;let C=0;for(let _=1;_<a.length;_++){const E=a[_][l];E!=null&&Je(d,a,_)&&C++}return y.create(C)}}class Wm extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const{isError:n,errorObject:s,databaseValues:a}=Xe(e);if(n)return s;const{isError:o,errorObject:c,fieldIndex:l}=Ze(t,a);if(o)return c;const{isError:f,errorObject:m,criteriaValues:d}=ze(r);if(f)return m;let C=0,_=0;for(let E=1;E<a.length;E++){const b=a[E][l];b!=null&&Je(d,a,E)&&(C++,_=E)}return C===0?g.create(h.VALUE):C>1?g.create(h.NUM):e.get(_,l)}}class Qm extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const{isError:n,errorObject:s,databaseValues:a}=Xe(e);if(n)return s;const{isError:o,errorObject:c,fieldIndex:l}=Ze(t,a);if(o)return c;const{isError:f,errorObject:m,criteriaValues:d}=ze(r);if(f)return m;let C=-1/0,_=0;for(let E=1;E<a.length;E++){const b=a[E][l];typeof b=="number"&&Je(d,a,E)&&(C=Math.max(C,b),_++)}return _===0?y.create(0):y.create(C)}}class qm extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const{isError:n,errorObject:s,databaseValues:a}=Xe(e);if(n)return s;const{isError:o,errorObject:c,fieldIndex:l}=Ze(t,a);if(o)return c;const{isError:f,errorObject:m,criteriaValues:d}=ze(r);if(f)return m;let C=1/0,_=0;for(let E=1;E<a.length;E++){const b=a[E][l];typeof b=="number"&&Je(d,a,E)&&(C=Math.min(C,b),_++)}return _===0?y.create(0):y.create(C)}}class Km extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const{isError:n,errorObject:s,databaseValues:a}=Xe(e);if(n)return s;const{isError:o,errorObject:c,fieldIndex:l}=Ze(t,a);if(o)return c;const{isError:f,errorObject:m,criteriaValues:d}=ze(r);if(f)return m;let C=1,_=0;for(let E=1;E<a.length;E++){const b=a[E][l];typeof b=="number"&&Je(d,a,E)&&(C*=b,_++)}return _===0?y.create(0):y.create(C)}}class Xm extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const{isError:n,errorObject:s,databaseValues:a}=Xe(e);if(n)return s;const{isError:o,errorObject:c,fieldIndex:l}=Ze(t,a);if(o)return c;const{isError:f,errorObject:m,criteriaValues:d}=ze(r);if(f)return m;const C=[];let _=0,E=0;for(let V=1;V<a.length;V++){const M=a[V][l];typeof M=="number"&&Je(d,a,V)&&(C.push(M),_+=M,E++)}if(E<=1)return g.create(h.DIV_BY_ZERO);const b=_/E;let R=0;for(let V=0;V<E;V++)R+=(C[V]-b)**2;const N=Math.sqrt(R/(E-1));return y.create(N)}}class Zm extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const{isError:n,errorObject:s,databaseValues:a}=Xe(e);if(n)return s;const{isError:o,errorObject:c,fieldIndex:l}=Ze(t,a);if(o)return c;const{isError:f,errorObject:m,criteriaValues:d}=ze(r);if(f)return m;const C=[];let _=0,E=0;for(let V=1;V<a.length;V++){const M=a[V][l];typeof M=="number"&&Je(d,a,V)&&(C.push(M),_+=M,E++)}if(E===0)return g.create(h.DIV_BY_ZERO);const b=_/E;let R=0;for(let V=0;V<E;V++)R+=(C[V]-b)**2;const N=Math.sqrt(R/E);return y.create(N)}}class zm extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const{isError:n,errorObject:s,databaseValues:a}=Xe(e);if(n)return s;const{isError:o,errorObject:c,fieldIndex:l}=Ze(t,a);if(o)return c;const{isError:f,errorObject:m,criteriaValues:d}=ze(r);if(f)return m;let C=0;for(let _=1;_<a.length;_++){const E=a[_][l];typeof E=="number"&&Je(d,a,_)&&(C+=E)}return y.create(C)}}class Jm extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const{isError:n,errorObject:s,databaseValues:a}=Xe(e);if(n)return s;const{isError:o,errorObject:c,fieldIndex:l}=Ze(t,a);if(o)return c;const{isError:f,errorObject:m,criteriaValues:d}=ze(r);if(f)return m;const C=[];let _=0,E=0;for(let V=1;V<a.length;V++){const M=a[V][l];typeof M=="number"&&Je(d,a,V)&&(C.push(M),_+=M,E++)}if(E<=1)return g.create(h.DIV_BY_ZERO);const b=_/E;let R=0;for(let V=0;V<E;V++)R+=(C[V]-b)**2;const N=R/(E-1);return y.create(N)}}class eh extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const{isError:n,errorObject:s,databaseValues:a}=Xe(e);if(n)return s;const{isError:o,errorObject:c,fieldIndex:l}=Ze(t,a);if(o)return c;const{isError:f,errorObject:m,criteriaValues:d}=ze(r);if(f)return m;const C=[];let _=0,E=0;for(let V=1;V<a.length;V++){const M=a[V][l];typeof M=="number"&&Je(d,a,V)&&(C.push(M),_+=M,E++)}if(E===0)return g.create(h.DIV_BY_ZERO);const b=_/E;let R=0;for(let V=0;V<E;V++)R+=(C[V]-b)**2;const N=R/E;return y.create(N)}}var $e=(i=>(i.DAVERAGE="DAVERAGE",i.DCOUNT="DCOUNT",i.DCOUNTA="DCOUNTA",i.DGET="DGET",i.DMAX="DMAX",i.DMIN="DMIN",i.DPRODUCT="DPRODUCT",i.DSTDEV="DSTDEV",i.DSTDEVP="DSTDEVP",i.DSUM="DSUM",i.DVAR="DVAR",i.DVARP="DVARP",i))($e||{});const Jo=[[Ym,$e.DAVERAGE],[Hm,$e.DCOUNT],[Gm,$e.DCOUNTA],[Wm,$e.DGET],[Qm,$e.DMAX],[qm,$e.DMIN],[Km,$e.DPRODUCT],[Xm,$e.DSTDEV],[Zm,$e.DSTDEVP],[zm,$e.DSUM],[Jm,$e.DVAR],[eh,$e.DVARP]],ha="yyyy/mm/dd;@",th="yyyy/mm/dd hh:mm",rh="h:mm A/P";function be(i){const u=new Date(Date.UTC(1900,0,1)),e=new Date(Date.UTC(1900,1,28)),t=Date.UTC(i.getFullYear(),i.getMonth(),i.getDate());let r=(t-u.getTime())/(1e3*3600*24);return t>e.getTime()&&(r+=1),Math.floor(r)+1}function Pr(i){const u=new Date(Date.UTC(1900,0,1,0,0,0)),e=new Date(Date.UTC(1900,1,28,0,0,0));let r=(i.getTime()-u.getTime())/(1e3*3600*24);return i>e&&(r+=1),r+1}function ne(i){const u=new Date(Date.UTC(1900,0,1)),e=new Date(Date.UTC(1900,1,28));let t=Math.floor(i)-1;return t>(e.getTime()-u.getTime())/(1e3*3600*24)&&(t-=1),new Date(u.getTime()+t*(1e3*3600*24))}function ga(i){const u=new Date(Date.UTC(1900,0,1,0,0,0)),e=new Date(Date.UTC(1900,1,28,0,0,0));let t=i-1;return t>(e.getTime()-u.getTime())/(1e3*3600*24)&&(t-=1),t<0&&(t=i),new Date(u.getTime()+t*(1e3*3600*24))}function da(i){if(!/^\d{4}[-/](0?[1-9]|1[012])[-/](0?[1-9]|[12][0-9]|3[01])$/.test(i))return!1;const e=i.replace(/-/g,"/").replace(/T.+/,""),t=new Date(`${e}`);if(Number.isNaN(t.getTime()))return!1;const r=t.getFullYear(),n=(t.getMonth()+1).toString().padStart(2,"0"),s=t.getDate().toString().padStart(2,"0"),a=`${r}-${n}-${s}`;return i.replace(/\//g,"-").split("-").map(c=>c.padStart(2,"0")).join("-")===a}function Ca(i){return S.numfmt.parseDate(i)}function eu(i){return S.numfmt.parseValue(i)}function _a(i){return S.numfmt.parseTime(i)}function Aa(i){return S.numfmt.isDate(i)}const tu={1:[6,0],2:[0,1],3:[1,2],4:[2,3],5:[3,4],6:[4,5],7:[5,6],11:[0],12:[1],13:[2],14:[3],15:[4],16:[5],17:[6]};function jr(i){return!!(typeof i=="string"&&/^[0|1]{7}/.test(i)||tu[Number(i)])}function ru(i){if(!jr(i))return[];if(typeof i=="string"&&/^[0|1]{7}/.test(i)){const u=[];for(let e=1;e<=i.length;e++)`${i[e-1]}`=="1"&&(e===i.length?u.push(0):u.push(e));return u}return tu[Number(i)]||[]}function Bn(i,u,e=1,t){const r=ru(e),n=Math.floor(i),s=Math.floor(u),a=s>n?n:s;let o=0;const c=Math.abs(Math.floor(u)-Math.floor(i))+1;for(let l=0;l<c;l++){const f=a+l;if(t&&t.length>0&&t.some(d=>Math.floor(d)===f))continue;const m=Wt(f);r.includes(m)||o++}return s>=n?o:-o}function Fn(i,u,e=1,t){const r=ru(e),n=Math.floor(i);let s=n,a=Math.abs(u);for(let o=1;o<=a;o++){const c=u<0?n-o:n+o;if(c<0)return g.create(h.NUM);if(t&&t.length>0&&t.some(f=>Math.floor(f)===c)){a++;continue}const l=Wt(c);if(r.includes(l)){a++;continue}s=c}return s}function $(i){if(i.isError())return i;const u=i.getValue();if(i.isString()){let e;if(Ca(`${u}`))e=Ca(`${u}`).v;else if(_a(`${u}`))e=_a(`${u}`).v;else if(S.isRealNum(u))e=+u;else return g.create(h.VALUE);return e instanceof Date&&(e=Pr(e)),+e<0||+e>2958465?g.create(h.NUM):+e}else{const e=+i.getValue();return e<0||e>2958465?g.create(h.NUM):e}}function Wt(i){const u=Math.floor(i)===60;let e=ne(i);const t=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate())).getTime(),r=new Date(Date.UTC(1900,1,28)).getTime();return!u&&t<=r&&(e=new Date(t-24*3600*1e3)),new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate())).getUTCDay()}function _e(i,u,e){switch(e){case 0:return nh(i,u);case 1:return sh(i,u);case 2:return{days:Math.abs(u-i),yearDays:360};case 3:return{days:Math.abs(u-i),yearDays:365};case 4:return ah(i,u);default:return{days:Math.abs(u-i),yearDays:365}}}function nh(i,u){const e=ne(i),t=i>0?e.getUTCFullYear():1900,r=i>0?e.getUTCMonth()+1:1;let n=i>0?e.getUTCDate():0,s=ne(u),a=u>0?s.getUTCFullYear():1900,o=u>0?s.getUTCMonth()+1:1,c=u>0?s.getUTCDate():0;r===2?ne(i+1).getUTCMonth()+1===3&&(n=30):n===31&&(n=30),c===31&&(n<30?(s=ne(u+1),a=s.getUTCFullYear(),o=s.getUTCMonth()+1,c=s.getUTCDate()):c=30);const l=(a-t)*360,f=u>=i?30-n:-n,m=u>=i?c:c-30,d=(u>=i?o-r-1:o-r+1)*30;return{days:Math.abs(l+f+m+d),yearDays:360}}function sh(i,u){const e=ne(i),t=i>0?e.getUTCFullYear():1900,r=ne(u),n=u>0?r.getUTCFullYear():1900,s=Math.abs(u-i),a=Math.abs(n-t)+1;let o,c;if(n<t){const l=new Date(Date.UTC(n,0,1)),f=new Date(Date.UTC(t,11,31));o=be(l),c=be(f),n===1900&&(o+=1)}else{const l=new Date(Date.UTC(t,0,1)),f=new Date(Date.UTC(n,11,31));o=be(l),c=be(f),t===1900&&(o+=1)}return{days:s,yearDays:(c-o+1)/a}}function ah(i,u){const e=ne(i),t=i>0?e.getUTCFullYear():1900,r=i>0?e.getUTCMonth()+1:1;let n=i>0?e.getUTCDate():0;const s=ne(u),a=u>0?s.getUTCFullYear():1900,o=u>0?s.getUTCMonth()+1:1;let c=u>0?s.getUTCDate():0;n===31&&(n=30),c===31&&(c=30);const l=(a-t)*360,f=u>=i?30-n:-n,m=u>=i?c:c-30,d=(u>=i?o-r-1:o-r+1)*30;return{days:Math.abs(l+f+m+d),yearDays:360}}function ih(i){return i%4===0&&i%100!==0||i%400===0}function oh(i){return i%4===0&&i%100!==0||i%400===0||i===1900}const uh=[31,29,31,30,31,30,31,31,30,31,30,31],ch=[31,28,31,30,31,30,31,31,30,31,30,31];function xr(i,u){return ih(i)?uh[u]:ch[u]}function In(i){return oh(i)?366:365}function nu(i,u){switch(u){case 0:case 2:case 4:return 360;case 1:return In(ne(i).getUTCFullYear());case 3:return 365;default:return-1}}function lr(i,u,e){return xr(i,u)===e}function fr(i,u){let e=i.getUTCFullYear(),t=i.getUTCMonth();const r=i.getUTCDate();return lr(e,t,r)?(i.setUTCDate(1),i.setUTCMonth(i.getUTCMonth()+u),e=i.getUTCFullYear(),t=i.getUTCMonth(),i.setUTCDate(xr(e,t))):i.setUTCMonth(i.getUTCMonth()+u),i}class lh extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){if(e.isError())return e;if(t.isError())return t;if(r.isError())return r;const n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e),o=O(n,s,t),c=O(n,s,r);return a.map((l,f,m)=>{const d=o.get(f,m)||oe.create(),C=c.get(f,m)||oe.create();if(l.isError())return l;if(d.isError())return d;if(C.isError())return C;if(l.isString()||d.isString()||C.isString())return g.create(h.VALUE);let _=+l.getValue();const E=Math.floor(+d.getValue()),b=+C.getValue();if(_<0||_>9999)return g.create(h.NUM);_>=0&&_<1899&&(_+=1900);const R=new Date(_,E-1,b),N=be(R);return N<0?g.create(h.NUM):y.create(N,ha)})}}class fh extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){let n=e,s=t,a=r;if(n.isArray()&&(n=n.get(0,0)),s.isArray()&&(s=s.get(0,0)),a.isArray()&&(a=a.get(0,0)),n.isError())return n;if(s.isError())return s;if(a.isError())return a;const o=$(n);if(typeof o!="number")return o;const c=$(s);return typeof c!="number"?c:c<o||!a.isString()?g.create(h.NUM):this._getResultByUnit(o,c,a)}_getResultByUnit(e,t,r){const n=ne(e),s=n.getUTCFullYear(),a=n.getUTCMonth()+1,o=n.getUTCDate(),c=ne(t),l=c.getUTCFullYear(),f=c.getUTCMonth()+1,m=c.getUTCDate(),d=`${r.getValue()}`.toLocaleUpperCase();let C=0,_;switch(d){case"Y":C=l-s,(f<a||f===a&&m<o)&&(C-=1);break;case"M":C=(l-s)*12+f-a,m<o&&(C-=1);break;case"D":C=Math.floor(t)-Math.floor(e);break;case"MD":C=m-o,m<o&&(_=new Date(Date.UTC(l,f-1,0)),C+=xr(_.getUTCFullYear(),_.getUTCMonth()));break;case"YM":C=f-a,(f<a||f===a&&m<o)&&(C+=12),m<o&&(C-=1);break;case"YD":_=new Date(Date.UTC(s,f-1,m)),(f<a||f===a&&m<o)&&(_=new Date(Date.UTC(s+1,f-1,m))),C=Math.floor(be(_))-Math.floor(e);break;default:return g.create(h.NUM)}return y.create(C)}}class mh extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){return e.isError()?e:e.isArray()?e.map(t=>this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){if(e.isString()){const t=`${e.getValue()}`,r=eu(t);if(r){let{v:n,z:s}=r;if(s&&Aa(s))return n instanceof Date&&(n=Pr(n)),y.create(Math.trunc(+n))}}return g.create(h.VALUE)}}class hh extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){return e.isError()?e:e.isArray()?e.map(t=>this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){let t;const r=e.getValue();if(e.isString()){if(!da(`${r}`))return g.create(h.VALUE);t=new Date(`${r}`)}else{const a=+e.getValue();if(a<0)return g.create(h.NUM);if(a===0)return y.create(0);t=ne(a)}const n=t.getDate();return y.create(n)}}class gh extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=O(r,n,e),a=O(r,n,t),o=s.map((c,l,f)=>{const m=a.get(l,f);if(c.isError())return c;if(m.isError())return m;const d=$(c);if(typeof d!="number")return d;const C=$(m);if(typeof C!="number")return C;const _=Math.floor(d)-Math.floor(C);return y.create(_)});return r===1&&n===1?o.get(0,0):o}}class dh extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",3)}calculate(e,t,r){const n=r!=null?r:T.create(!1);if(e.isError())return e;if(t.isError())return t;if(n.isError())return n;const s=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,n.isArray()?n.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,n.isArray()?n.getColumnCount():1),o=O(s,a,e,g.create(h.NA)),c=O(s,a,t,g.create(h.NA)),l=O(s,a,n,g.create(h.NA)),f=o.map((m,d,C)=>{const _=c.get(d,C);let E=l.get(d,C);if(m.isError())return m;const b=$(m);if(typeof b!="number")return b;if(_.isError())return _;const R=$(_);if(typeof R!="number")return R;if(E.isString()&&(E=E.convertToNumberObjectValue()),E.isError())return E;const N=+E.getValue(),{days:V}=_e(b,R,N?4:0),M=R>=b?V:-V;return y.create(M)});return s===1&&a===1?f.get(0,0):f}}class Ch extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=O(r,n,e),a=O(r,n,t);return s.map((o,c,l)=>{const f=a.get(c,l)||oe.create();if(o.isError())return o;if(f.isError())return f;if(o.isString()||o.isBoolean()||f.isString()||f.isBoolean())return g.create(h.VALUE);const m=+o.getValue();if(m<0)return g.create(h.NUM);const d=Math.floor(+f.getValue()),C=ne(m),_=C.getUTCFullYear(),E=C.getUTCMonth()+d,b=C.getUTCDate(),R=new Date(Date.UTC(_,E,b)),N=be(R);return y.create(N,ha)})}}class _h extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){let r=e,n=t;if(r.isArray()){const d=r.getRowCount(),C=r.getColumnCount();if(d>1||C>1)return g.create(h.VALUE);r=r.get(0,0)}if(n.isArray()){const d=n.getRowCount(),C=n.getColumnCount();if(d>1||C>1)return g.create(h.VALUE);n=n.get(0,0)}if(r.isError())return r;if(n.isError())return n;const s=$(r);if(typeof s!="number")return s;if(n.isBoolean())return g.create(h.VALUE);const a=ne(s),o=s>0?a.getUTCFullYear():1900,c=s>0?a.getUTCMonth():0,l=Math.floor(+n.getValue());if(Number.isNaN(l))return g.create(h.VALUE);const f=new Date(Date.UTC(o,c+l+1,0)),m=be(f);return y.create(m)}}class Ah extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",2);A(this,"needsReferenceObject",!0)}calculate(e,t){const r=t!=null?t:y.create(1),{isError:n,errorObject:s,timestampIsReferenceObject:a,timestampObject:o,unitObject:c}=this._checkVariants(e,r);if(n)return s;if(o.isNull()||o.isBoolean()||o.isString()||!a&&o.isNumber()&&o.getPattern()!=="")return g.create(h.VALUE);let l=+o.getValue();const{isError:f,errorObject:m,variants:d}=k(c);if(f)return m;const[C]=d,_=Math.floor(+C.getValue());if(l<0||_<1||_>3)return g.create(h.NUM);_===1&&(l=l*1e3),_===3&&(l=l/1e3);const E=new Date(Date.UTC(1970,0,1,0,0,0,0)+l);if(Number.isNaN(E.getTime())){const b=25569+l/864e5;return y.create(b)}else{const b=Pr(E);return y.create(b,"yyyy-MM-dd AM/PM hh:mm:ss")}}_checkVariants(e,t){const r=e.isReferenceObject(),n=t.isReferenceObject();let s=e;if(r&&(s=e.toArrayValueObject()),s.isArray()){const o=s.getRowCount(),c=s.getColumnCount();if(o>1||c>1)return{isError:!0,errorObject:g.create(h.VALUE)};s=s.get(0,0)}if(s.isError())return{isError:!0,errorObject:s};let a=t;if(n&&(a=t.toArrayValueObject()),a.isArray()){const o=a.getRowCount(),c=a.getColumnCount();if(o>1||c>1)return{isError:!0,errorObject:g.create(h.VALUE)};a=a.get(0,0)}return a.isError()?{isError:!0,errorObject:a}:{isError:!1,errorObject:null,timestampIsReferenceObject:r,timestampObject:s,unitIsReferenceObject:n,unitObject:a}}}var Ee=(i=>(i.DATE="DATE",i.DATEDIF="DATEDIF",i.DATEVALUE="DATEVALUE",i.DAY="DAY",i.DAYS="DAYS",i.DAYS360="DAYS360",i.EDATE="EDATE",i.EOMONTH="EOMONTH",i.EPOCHTODATE="EPOCHTODATE",i.HOUR="HOUR",i.ISOWEEKNUM="ISOWEEKNUM",i.MINUTE="MINUTE",i.MONTH="MONTH",i.NETWORKDAYS="NETWORKDAYS",i.NETWORKDAYS_INTL="NETWORKDAYS.INTL",i.NOW="NOW",i.SECOND="SECOND",i.TIME="TIME",i.TIMEVALUE="TIMEVALUE",i.TO_DATE="TO_DATE",i.TODAY="TODAY",i.WEEKDAY="WEEKDAY",i.WEEKNUM="WEEKNUM",i.WORKDAY="WORKDAY",i.WORKDAY_INTL="WORKDAY.INTL",i.YEAR="YEAR",i.YEARFRAC="YEARFRAC",i))(Ee||{});class Eh extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){return e.isError()?e:e.isArray()?e.map(t=>t.isError()?t:this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){const t=$(e);if(typeof t!="number")return t;if(t===0)return y.create(0);const n=ga(t).getUTCHours();return y.create(n)}}class bh extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){return e.isError()?e:e.isArray()?e.map(t=>t.isError()?t:this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){const t=$(e);if(typeof t!="number")return t;const r=ne(t),n=t>0?r.getUTCFullYear():1900;let s=new Date(Date.UTC(n,0,1)),a=be(s),o=Wt(a),c;o<1?c=a+1:o<=4?c=a-(o-1):c=a+(11-o),t<c&&(s=new Date(Date.UTC(n-1,0,1)),a=be(s),o=Wt(a),o<1?c=a+1:o<=4?c=a-(o-1):c=a+(11-o));const l=Math.ceil((t-c+1)/7);return y.create(l)}}class yh extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){return e.isError()?e:e.isArray()?e.map(t=>t.isError()?t:this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){const t=$(e);if(typeof t!="number")return t;if(t===0)return y.create(0);const n=ga(t).getUTCMinutes();return y.create(n)}}class Rh extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(t=>this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;let t;const r=e.getValue();if(e.isString()){if(!da(`${r}`))return g.create(h.VALUE);t=new Date(`${r}`)}else{const a=+e.getValue();if(a<0)return g.create(h.NUM);if(a===0)return y.create(1);t=ne(a)}const n=t.getUTCMonth()+1;return y.create(n)}}class Nh extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",3)}calculate(e,t,r){let n=e,s=t;if(n.isArray()){const l=n.getRowCount(),f=n.getColumnCount();if(l>1||f>1)return g.create(h.VALUE);n=n.get(0,0)}if(n.isError())return n;if(s.isArray()){const l=s.getRowCount(),f=s.getColumnCount();if(l>1||f>1)return g.create(h.VALUE);s=s.get(0,0)}if(s.isError())return s;if(r!=null&&r.isError())return r;if(n.isBoolean()||s.isBoolean())return g.create(h.VALUE);const a=$(n);if(typeof a!="number")return a;const o=$(s);if(typeof o!="number")return o;if(r)return this._getResultByHolidays(a,o,r);const c=Bn(a,o);return y.create(c)}_getResultByHolidays(e,t,r){const n=[];if(r!=null&&r.isArray()){const a=r.getRowCount(),o=r.getColumnCount();for(let c=0;c<a;c++)for(let l=0;l<o;l++){const f=r.get(c,l);if(f.isBoolean())return g.create(h.VALUE);const m=$(f);if(typeof m!="number")return m;n.push(m)}}else{if(r.isBoolean())return g.create(h.VALUE);const a=$(r);if(typeof a!="number")return a;n.push(a)}const s=Bn(e,t,1,n);return y.create(s)}}class ph extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",4)}calculate(e,t,r,n){return e.isError()?e:t.isError()?t:r!=null&&r.isError()?r:n!=null&&n.isError()?n:r!=null&&r.isArray()?r.map(s=>this._handleSingleObject(e,t,s,n)):this._handleSingleObject(e,t,r,n)}_handleSingleObject(e,t,r,n){let s=e,a=t;if(s.isArray()){const m=s.getRowCount(),d=s.getColumnCount();if(m>1||d>1)return g.create(h.VALUE);s=s.get(0,0)}if(s.isError())return s;if(a.isArray()){const m=a.getRowCount(),d=a.getColumnCount();if(m>1||d>1)return g.create(h.VALUE);a=a.get(0,0)}if(a.isError())return a;let o=1;if(r){if(o=r.getValue(),r.isBoolean()&&(o=+o),r.isString()&&!jr(o))return g.create(h.VALUE);if(!jr(o))return g.create(h.NUM)}if(s.isBoolean()||a.isBoolean())return g.create(h.VALUE);const c=$(s);if(typeof c!="number")return c;const l=$(a);if(typeof l!="number")return l;if(n)return this._getResultByHolidays(c,l,o,n);const f=Bn(c,l,o);return y.create(f)}_getResultByHolidays(e,t,r,n){const s=[];if(n!=null&&n.isArray()){const o=n.getRowCount(),c=n.getColumnCount();for(let l=0;l<o;l++)for(let f=0;f<c;f++){const m=n.get(l,f);if(m.isBoolean())return g.create(h.VALUE);const d=$(m);if(typeof d!="number")return d;s.push(d)}}else{if(n.isBoolean())return g.create(h.VALUE);const o=$(n);if(typeof o!="number")return o;s.push(o)}const a=Bn(e,t,r,s);return y.create(a)}}class Vh extends p{constructor(){super(...arguments);A(this,"minParams",0);A(this,"maxParams",0)}calculate(){const e=new Date,t=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds())),r=Pr(t);return y.create(r,th)}}class Oh extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){return e.isError()?e:e.isArray()?e.map(t=>t.isError()?t:this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){const t=$(e);if(typeof t!="number")return t;if(t===0)return y.create(0);const n=ga(t).getUTCSeconds();return y.create(n)}}class Sh extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){if(e.isError())return e;if(t.isError())return t;if(r.isError())return r;const n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e),o=O(n,s,t),c=O(n,s,r);return a.map((l,f,m)=>this._calculateTime(l,o,c,f,m))}_calculateTime(e,t,r,n,s){let a=e,o=t.get(n,s)||oe.create(),c=r.get(n,s)||oe.create();if((a.isString()||a.isBoolean())&&(a=a.convertToNumberObjectValue()),(o.isString()||o.isBoolean())&&(o=o.convertToNumberObjectValue()),(c.isString()||c.isBoolean())&&(c=c.convertToNumberObjectValue()),a.isError())return a;if(o.isError())return o;if(c.isError())return c;let l=Math.floor(+a.getValue()),f=Math.floor(+o.getValue()),m=Math.floor(+c.getValue());if(l<0||f<0||m<0||l>32767||f>32767||m>32767)return g.create(h.NUM);f+=Math.floor(m/60),m%=60,l+=Math.floor(f/60),f%=60,l%=24;const C=(l*3600+f*60+m)/86400;return y.create(C,rh)}}class Mh extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){return e.isError()?e:e.isArray()?e.map(t=>this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){if(e.isString()){const t=`${e.getValue()}`,r=eu(t);if(r){let{v:n,z:s}=r;if(s&&Aa(s))return n instanceof Date&&(n=Pr(n)),y.create(of(+n))}}return g.create(h.VALUE)}}class Dh extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1);A(this,"needsReferenceObject",!0)}calculate(e){const t=e.isReferenceObject();let r=e;if(t&&(r=e.toArrayValueObject()),r.isArray()){const s=r.getRowCount(),a=r.getColumnCount();if(s>1||a>1)return g.create(h.VALUE);r=r.get(0,0)}if(r.isError()||r.isNull()||r.isBoolean()||r.isString()||!t&&r.isNumber()&&r.getPattern()!=="")return r;const n=+r.getValue();return y.create(n,"yyyy-MM-dd hh:mm:ss AM/PM")}}class wh extends p{constructor(){super(...arguments);A(this,"minParams",0);A(this,"maxParams",0)}calculate(){const e=be(new Date);return y.create(e,ha)}}class Lh extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",2);A(this,"_returnTypeMap",{1:[1,2,3,4,5,6,7],2:[7,1,2,3,4,5,6],3:[6,0,1,2,3,4,5],11:[7,1,2,3,4,5,6],12:[6,7,1,2,3,4,5],13:[5,6,7,1,2,3,4],14:[4,5,6,7,1,2,3],15:[3,4,5,6,7,1,2],16:[2,3,4,5,6,7,1],17:[1,2,3,4,5,6,7]})}calculate(e,t){const r=t!=null?t:y.create(1);if(e.isError())return e;if(r.isError())return r;const n=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),o=O(n,s,r,g.create(h.NA)),c=a.map((l,f,m)=>{const d=o.get(f,m);return this._handleSingleObject(l,d)});return n===1&&s===1?c.get(0,0):c}_handleSingleObject(e,t){let r=t;if(e.isError())return e;if(r.isError())return r;const n=$(e);if(typeof n!="number")return n;if(r.isString()&&(r=r.convertToNumberObjectValue(),r.isError()))return r;const s=Math.floor(+r.getValue());if(!this._returnTypeMap[s])return g.create(h.NUM);const a=Wt(n),o=this._returnTypeMap[s][a];return y.create(o)}}class Ph extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",2);A(this,"_returnTypeMap",{1:0,2:1,11:1,12:2,13:3,14:4,15:5,16:6,17:0,21:4})}calculate(e,t){let r=e,n=t!=null?t:y.create(1);if(r.isArray()){const o=r.getRowCount(),c=r.getColumnCount();if(o>1||c>1)return g.create(h.VALUE);r=r.get(0,0)}if(r.isError())return r;if(n.isArray()){const o=n.getRowCount(),c=n.getColumnCount();if(o>1||c>1)return g.create(h.VALUE);n=n.get(0,0)}if(n.isError())return n;if(r.isBoolean())return g.create(h.VALUE);const s=$(r);if(typeof s!="number")return s;if(n.isBoolean())return g.create(h.VALUE);const a=Math.floor(+n.getValue());return Number.isNaN(a)?g.create(h.VALUE):a in this._returnTypeMap?this._getResult(s,a):g.create(h.NUM)}_getResult(e,t){const r=ne(e),n=e>0?r.getUTCFullYear():1900;let s=new Date(Date.UTC(n,0,1)),a=be(s),o=Wt(a),c;if(t===21)o<1?c=a+1:o<=4?c=a-(o-1):c=a+(11-o),e<c&&(s=new Date(Date.UTC(n-1,0,1)),a=be(s),o=Wt(a),o<1?c=a+1:o<=4?c=a-(o-1):c=a+(11-o));else{const f=this._returnTypeMap[t];o<f?c=a-(o+7-f):c=a-(o-f)}const l=Math.ceil((e-c+1)/7);return y.create(l)}}class jh extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",3)}calculate(e,t,r){let n=e,s=t;if(n.isArray()){const l=n.getRowCount(),f=n.getColumnCount();if(l>1||f>1)return g.create(h.VALUE);n=n.get(0,0)}if(n.isError())return n;if(s.isArray()){const l=s.getRowCount(),f=s.getColumnCount();if(l>1||f>1)return g.create(h.VALUE);s=s.get(0,0)}if(s.isError())return s;if(r!=null&&r.isError())return r;if(n.isBoolean()||s.isBoolean())return g.create(h.VALUE);const a=$(n);if(typeof a!="number")return a;const o=+s.getValue();if(Number.isNaN(o))return g.create(h.VALUE);if(r)return this._getResultByHolidays(a,o,r);const c=Fn(a,o);return typeof c!="number"?c:y.create(c)}_getResultByHolidays(e,t,r){const n=[];if(r!=null&&r.isArray()){const a=r.getRowCount(),o=r.getColumnCount();for(let c=0;c<a;c++)for(let l=0;l<o;l++){const f=r.get(c,l);if(f.isBoolean())return g.create(h.VALUE);const m=$(f);if(typeof m!="number")return m;n.push(m)}}else{if(r.isBoolean())return g.create(h.VALUE);const a=$(r);if(typeof a!="number")return a;n.push(a)}const s=Fn(e,t,1,n);return typeof s!="number"?s:y.create(s)}}class xh extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",4)}calculate(e,t,r,n){return e.isError()?e:t.isError()?t:r!=null&&r.isError()?r:n!=null&&n.isError()?n:r!=null&&r.isArray()?r.map(s=>this._handleSingleObject(e,t,s,n)):this._handleSingleObject(e,t,r,n)}_handleSingleObject(e,t,r,n){const s=r!=null?r:y.create(1),a=this._checkArrayError(e);if(a.isError())return a;const o=this._checkArrayError(t);if(o.isError())return o;if(a.isBoolean()||o.isBoolean())return g.create(h.VALUE);const c=$(e);if(typeof c!="number")return c;const l=+t.getValue();if(Number.isNaN(l))return g.create(h.VALUE);let f=s.getValue();if(s.isBoolean()&&(f=+f),s.isString()&&(!jr(f)||f==="1111111"))return g.create(h.VALUE);if(!jr(f))return g.create(h.NUM);if(n)return this._getResultByHolidays(c,l,f,n);const m=Fn(c,l,f);return typeof m!="number"?m:y.create(m)}_checkArrayError(e){let t=e;if(t.isArray()){const r=t.getRowCount(),n=t.getColumnCount();if(r>1||n>1)return g.create(h.VALUE);t=t.get(0,0)}return t.isError(),t}_getResultByHolidays(e,t,r,n){const s=[];if(n!=null&&n.isArray()){const o=n.getRowCount(),c=n.getColumnCount();for(let l=0;l<o;l++)for(let f=0;f<c;f++){const m=n.get(l,f);if(m.isBoolean())return g.create(h.VALUE);const d=$(m);if(typeof d!="number")return d;s.push(d)}}else{if(n.isBoolean())return g.create(h.VALUE);const o=$(n);if(typeof o!="number")return o;s.push(o)}const a=Fn(e,t,r,s);return typeof a!="number"?a:y.create(a)}}class Uh extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(t=>this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;let t;const r=e.getValue();if(e.isString()){if(!da(`${r}`))return g.create(h.VALUE);t=new Date(`${r}`)}else{const a=+r;if(a<0)return g.create(h.NUM);if(a===0)return y.create(1900);t=ne(a)}const n=t.getUTCFullYear();return y.create(n)}}class vh extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",3)}calculate(e,t,r){let n=r!=null?r:y.create(0);const s=Yt(e);if(s.isError())return s;const a=Yt(t);if(a.isError())return a;if(n=Yt(n),n.isError())return n;if(s.isBoolean()||a.isBoolean()||n.isBoolean())return g.create(h.VALUE);const o=$(s);if(typeof o!="number")return o;const c=$(a);if(typeof c!="number")return c;const l=Math.floor(+n.getValue());if(Number.isNaN(l))return g.create(h.VALUE);if(l<0||l>4)return g.create(h.NUM);const{days:f,yearDays:m}=_e(o,c,l),d=f/m;return y.create(d)}}const su=[[lh,Ee.DATE],[fh,Ee.DATEDIF],[mh,Ee.DATEVALUE],[hh,Ee.DAY],[gh,Ee.DAYS],[dh,Ee.DAYS360],[Ch,Ee.EDATE],[_h,Ee.EOMONTH],[Ah,Ee.EPOCHTODATE],[Eh,Ee.HOUR],[bh,Ee.ISOWEEKNUM],[yh,Ee.MINUTE],[Rh,Ee.MONTH],[Nh,Ee.NETWORKDAYS],[ph,Ee.NETWORKDAYS_INTL],[Vh,Ee.NOW],[Oh,Ee.SECOND],[Sh,Ee.TIME],[Mh,Ee.TIMEVALUE],[Dh,Ee.TO_DATE],[wh,Ee.TODAY],[Lh,Ee.WEEKDAY],[Ph,Ee.WEEKNUM],[jh,Ee.WORKDAY],[xh,Ee.WORKDAY_INTL],[Uh,Ee.YEAR],[vh,Ee.YEARFRAC]];class Th extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){if(e.isNull()||t.isNull())return g.create(h.NA);const{isError:r,errorObject:n,variants:s}=W(e,t);if(r)return n;const[a,o]=s,c=+a.getValue(),l=Math.floor(+o.getValue());if(Number.isNaN(c)||Number.isNaN(l))return g.create(h.VALUE);if(l<0)return g.create(h.NUM);const f=or.besseli(c,l);return Number.isNaN(f)||!Number.isFinite(f)?g.create(h.NUM):y.create(f)}}class Bh extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){if(e.isNull()||t.isNull())return g.create(h.NA);const{isError:r,errorObject:n,variants:s}=W(e,t);if(r)return n;const[a,o]=s,c=+a.getValue(),l=Math.floor(+o.getValue());if(Number.isNaN(c)||Number.isNaN(l))return g.create(h.VALUE);if(l<0)return g.create(h.NUM);const f=or.besselj(c,l);return Number.isNaN(f)||!Number.isFinite(f)?g.create(h.NUM):y.create(f)}}class Fh extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){if(e.isNull()||t.isNull())return g.create(h.NA);const{isError:r,errorObject:n,variants:s}=W(e,t);if(r)return n;const[a,o]=s,c=+a.getValue(),l=Math.floor(+o.getValue());if(Number.isNaN(c)||Number.isNaN(l))return g.create(h.VALUE);if(l<0)return g.create(h.NUM);const f=or.besselk(c,l);return Number.isNaN(f)||!Number.isFinite(f)?g.create(h.NUM):y.create(f)}}class Ih extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){if(e.isNull()||t.isNull())return g.create(h.NA);const{isError:r,errorObject:n,variants:s}=W(e,t);if(r)return n;const[a,o]=s,c=+a.getValue(),l=Math.floor(+o.getValue());if(Number.isNaN(c)||Number.isNaN(l))return g.create(h.VALUE);if(l<0)return g.create(h.NUM);const f=or.bessely(c,l);return Number.isNaN(f)||!Number.isFinite(f)?g.create(h.NUM):y.create(f)}}class kh extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=W(e);if(t)return r;const[s]=n,a=`${s.getValue()}`;if(!Xs(a))return g.create(h.NUM);let o;return a.length===10&&a.substring(0,1)==="1"?o=Number.parseInt(a.substring(1),2)-512:o=Number.parseInt(a,2),y.create(o)}}class $h extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",2)}calculate(e,t){if(e.isNull())return g.create(h.NA);let r=0;if(t){const{isError:f,errorObject:m,variants:d}=W(t);if(f)return m;const[C]=d;if(r=Math.floor(+C.getValue()),Number.isNaN(r))return g.create(h.VALUE);if(r<0||r>10)return g.create(h.NUM)}const{isError:n,errorObject:s,variants:a}=W(e);if(n)return s;const[o]=a,c=`${o.getValue()}`;if(!Xs(c))return g.create(h.NUM);let l;if(c.length===10&&c.substring(0,1)==="1")l=(0xfffffffe00+Number.parseInt(c.substring(1),2)).toString(16);else if(l=Number.parseInt(c,2).toString(16),t){if(r<l.length)return g.create(h.NUM);l="0".repeat(r-l.length)+l}return U.create(l.toLocaleUpperCase())}}class Yh extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",2)}calculate(e,t){if(e.isNull())return g.create(h.NA);let r=0;if(t){const{isError:f,errorObject:m,variants:d}=W(t);if(f)return m;const[C]=d;if(r=Math.floor(+C.getValue()),Number.isNaN(r))return g.create(h.VALUE);if(r<0||r>10)return g.create(h.NUM)}const{isError:n,errorObject:s,variants:a}=W(e);if(n)return s;const[o]=a,c=`${o.getValue()}`;if(!Xs(c))return g.create(h.NUM);let l;if(c.length===10&&c.substring(0,1)==="1")l=(1073741312+Number.parseInt(c.substring(1),2)).toString(8);else if(l=Number.parseInt(c,2).toString(8),t){if(r<l.length)return g.create(h.NUM);l="0".repeat(r-l.length)+l}return U.create(l)}}class Hh extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=O(r,n,e,g.create(h.NA)),a=O(r,n,t,g.create(h.NA)),o=s.map((c,l,f)=>{let m=c;if(m.isString()&&(m=m.convertToNumberObjectValue()),m.isError())return m;let d=a.get(l,f);if(d.isString()&&(d=d.convertToNumberObjectValue()),d.isError())return d;const C=+m.getValue(),_=+d.getValue();if(C<0||_<0||Math.floor(C)!==C||Math.floor(_)!==_||C>0xffffffffffff||_>0xffffffffffff)return g.create(h.NUM);const E=C&_;return y.create(E)});return r===1&&n===1?o.get(0,0):o}}class Gh extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=O(r,n,e,g.create(h.NA)),a=O(r,n,t,g.create(h.NA)),o=s.map((c,l,f)=>{let m=c;if(m.isString()&&(m=m.convertToNumberObjectValue()),m.isError())return m;let d=a.get(l,f);if(d.isString()&&(d=d.convertToNumberObjectValue()),d.isError())return d;const C=+m.getValue();let _=+d.getValue();if(C<0||Math.floor(C)!==C||C>0xffffffffffff||Math.abs(_)>53)return g.create(h.NUM);_=Math.trunc(_);const E=Number(_>=0?BigInt(C)<<BigInt(_):BigInt(C)>>BigInt(-_));return E>0xffffffffffff?g.create(h.NUM):y.create(E)});return r===1&&n===1?o.get(0,0):o}}class Wh extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=O(r,n,e,g.create(h.NA)),a=O(r,n,t,g.create(h.NA)),o=s.map((c,l,f)=>{let m=c;if(m.isString()&&(m=m.convertToNumberObjectValue()),m.isError())return m;let d=a.get(l,f);if(d.isString()&&(d=d.convertToNumberObjectValue()),d.isError())return d;const C=+m.getValue(),_=+d.getValue();if(C<0||_<0||Math.floor(C)!==C||Math.floor(_)!==_||C>0xffffffffffff||_>0xffffffffffff)return g.create(h.NUM);const E=Number(BigInt(C)|BigInt(_));return y.create(E)});return r===1&&n===1?o.get(0,0):o}}class Qh extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=O(r,n,e,g.create(h.NA)),a=O(r,n,t,g.create(h.NA)),o=s.map((c,l,f)=>{let m=c;if(m.isString()&&(m=m.convertToNumberObjectValue()),m.isError())return m;let d=a.get(l,f);if(d.isString()&&(d=d.convertToNumberObjectValue()),d.isError())return d;const C=+m.getValue();let _=+d.getValue();if(C<0||Math.floor(C)!==C||C>0xffffffffffff||Math.abs(_)>53)return g.create(h.NUM);_=Math.trunc(_);const E=Number(_>=0?BigInt(C)>>BigInt(_):BigInt(C)<<BigInt(-_));return E>0xffffffffffff?g.create(h.NUM):y.create(E)});return r===1&&n===1?o.get(0,0):o}}class qh extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=O(r,n,e,g.create(h.NA)),a=O(r,n,t,g.create(h.NA)),o=s.map((c,l,f)=>{let m=c;if(m.isString()&&(m=m.convertToNumberObjectValue()),m.isError())return m;let d=a.get(l,f);if(d.isString()&&(d=d.convertToNumberObjectValue()),d.isError())return d;const C=+m.getValue(),_=+d.getValue();if(C<0||_<0||Math.floor(C)!==C||Math.floor(_)!==_||C>0xffffffffffff||_>0xffffffffffff)return g.create(h.NUM);const E=C^_;return y.create(E)});return r===1&&n===1?o.get(0,0):o}}x.prototype.cos=function(){const i=this.toNumber();return new x(Math.cos(i))};let he=class fe{constructor(u){A(this,"_inumber","");A(this,"_realNum",0);A(this,"_iNum",0);A(this,"_suffix","");A(this,"_isError",!1);if(`${u}`.trim()===""){this._isError=!0;return}this._inumber=u,this._getImReal(),this._getImAginary(),this._getImSuffix()}static getComplex(u,e,t){const r=new x(u).toSignificantDigits(15).toNumber(),n=new x(e).toSignificantDigits(15).toNumber(),s=t===""?"i":t;let a;if(r===0&&n===0)a=0;else if(r===0)a=n===1?s:`${n}${s}`;else if(n===0)a=r;else{const o=n>0?"+":"",c=n===1?s:`${n}${s}`;a=`${r}${o}${c}`}return a}static createByComplexStr(u,e,t){const r=fe.getComplex(u,e,t);return new fe(r)}_getImReal(){if(this._inumber===0||this._inumber==="0"){this._realNum=0;return}const u=`${this._inumber}`;if(["i","+i","1i","+1i","-i","-1i","j","+j","1j","+1j","-j","-1j"].indexOf(u)>=0){this._realNum=0;return}let e=u.indexOf("+"),t=u.indexOf("-");e===0&&(e=u.indexOf("+",1)),t===0&&(t=u.indexOf("-",1));const r=u.substring(u.length-1,u.length),n=r==="i"||r==="j";if(e>=0||t>=0){if(!n){this._isError=!0;return}e>=0?Number.isNaN(+u.substring(0,e))||Number.isNaN(+u.substring(e+1,u.length-1))?this._isError=!0:this._realNum=+u.substring(0,e):Number.isNaN(+u.substring(0,t))||Number.isNaN(+u.substring(t+1,u.length-1))?this._isError=!0:this._realNum=+u.substring(0,t)}else n?Number.isNaN(+u.substring(0,u.length-1))?this._isError=!0:this._realNum=0:Number.isNaN(+u)?this._isError=!0:this._realNum=+u}_getImAginary(){if(this._isError)return;if(this._inumber===0||this._inumber==="0"){this._iNum=0;return}let u=`${this._inumber}`;if(["i","j"].indexOf(u)>=0){this._iNum=1;return}u=u.replace("+i","+1i").replace("-i","-1i").replace("+j","+1j").replace("-j","-1j");let e=u.indexOf("+"),t=u.indexOf("-");e===0&&(e=u.indexOf("+",1)),t===0&&(t=u.indexOf("-",1));const r=u.substring(u.length-1,u.length),n=r==="i"||r==="j";if(e>=0||t>=0){if(!n){this._isError=!0;return}e>=0?Number.isNaN(+u.substring(0,e))||Number.isNaN(+u.substring(e+1,u.length-1))?this._isError=!0:this._iNum=+u.substring(e+1,u.length-1):Number.isNaN(+u.substring(0,t))||Number.isNaN(+u.substring(t+1,u.length-1))?this._isError=!0:this._iNum=-+u.substring(t+1,u.length-1)}else n?Number.isNaN(+u.substring(0,u.length-1))?this._isError=!0:this._iNum=+u.substring(0,u.length-1):Number.isNaN(+u)?this._isError=!0:this._iNum=0}_getImSuffix(){const u=`${this._inumber}`,e=u.substring(u.length-1);this._suffix=e==="i"||e==="j"?e:""}getRealNum(){return this._realNum}getINum(){return this._iNum}getSuffix(){return this._suffix}isError(){return this._isError}toString(){return fe.getComplex(this._realNum,this._iNum,this._suffix)}isDifferentSuffixes(u){const e=u.getSuffix();return this._suffix===""||e===""?!1:this._suffix!==e}Abs(){return x.sqrt(x.pow(this._realNum,2).add(x.pow(this._iNum,2))).toSignificantDigits(16).toNumber()}Argument(){const u=x.sqrt(x.pow(this._realNum,2).add(x.pow(this._iNum,2)));let e=x.acos(new x(this._realNum).div(u)).toSignificantDigits(16).toNumber();return this._iNum<0&&(e=-e),e}Conjugate(){return fe.getComplex(this._realNum,-this._iNum,this._suffix)}Cos(){if(this._iNum){const u=x.cos(this._realNum).mul(x.cosh(this._iNum)).toNumber(),e=x.sin(this._realNum).mul(x.sinh(this._iNum)).negated().toNumber();return fe.getComplex(u,e,this._suffix)}else{const u=x.cos(this._realNum).toNumber();return fe.getComplex(u,this._iNum,this._suffix)}}Cosh(){if(!Number.isFinite(Math.sinh(this._realNum))||!Number.isFinite(Math.cosh(this._realNum)))return this._isError=!0,"";if(this._iNum){const u=x.cosh(this._realNum).mul(x.cos(this._iNum)).toNumber(),e=x.sinh(this._realNum).mul(x.sin(this._iNum)).toNumber();return fe.getComplex(u,e,this._suffix)}else{const u=x.cosh(this._realNum).toNumber();return fe.getComplex(u,this._iNum,this._suffix)}}Cot(){if(this._iNum){const u=x.cosh(this._iNum*2).sub(x.cos(this._realNum*2)),e=x.sin(this._realNum*2).div(u).toNumber(),t=x.sinh(this._iNum*2).div(u).negated().toNumber();return fe.getComplex(e,t,this._suffix)}else{const u=new x(1).div(x.tan(this._realNum)).toNumber();return fe.getComplex(u,this._iNum,this._suffix)}}Coth(){if(!Number.isFinite(Math.sinh(this._realNum))||!Number.isFinite(Math.cosh(this._realNum)))return this._isError=!0,"";if(this._iNum){const u=x.cosh(this._realNum*2).sub(x.cos(this._iNum*2)),e=x.sinh(this._realNum*2).div(u).toNumber(),t=x.sin(this._iNum*2).div(u).negated().toNumber();return fe.getComplex(e,t,this._suffix)}else{const u=new x(1).div(x.tanh(this._realNum)).toNumber();return fe.getComplex(u,this._iNum,this._suffix)}}Csc(){if(this._iNum){const u=x.cosh(this._iNum*2).sub(x.cos(this._realNum*2)),e=x.sin(this._realNum).mul(x.cosh(this._iNum)).mul(2).div(u).toNumber(),t=x.cos(this._realNum).mul(x.sinh(this._iNum)).mul(-2).div(u).toNumber();return fe.getComplex(e,t,this._suffix)}else{const u=new x(1).div(x.sin(this._realNum)).toNumber();return fe.getComplex(u,this._iNum,this._suffix)}}Csch(){if(!Number.isFinite(Math.sinh(this._realNum))||!Number.isFinite(Math.cosh(this._realNum)))return fe.getComplex(0,0,this._suffix);if(this._iNum){const u=x.cosh(this._realNum*2).sub(x.cos(this._iNum*2)),e=x.sinh(this._realNum).mul(x.cos(this._iNum)).mul(2).div(u).toNumber(),t=x.cosh(this._realNum).mul(x.sin(this._iNum)).mul(-2).div(u).toNumber();return fe.getComplex(e,t,this._suffix)}else{const u=new x(1).div(x.sinh(this._realNum)).toNumber();return fe.getComplex(u,this._iNum,this._suffix)}}Div(u){const e=new x(this._realNum),t=new x(this._iNum),r=new x(u.getRealNum()),n=new x(u.getINum()),s=r.mul(r).add(n.mul(n)),a=e.mul(r).add(t.mul(n)).div(s).toNumber(),o=t.mul(r).sub(e.mul(n)).div(s).toNumber(),c=this._suffix===""?u.getSuffix():this._suffix;return fe.getComplex(a,o,c)}Exp(){if(!Number.isFinite(Math.exp(this._realNum)))return this._isError=!0,"";const u=x.exp(this._realNum).mul(x.cos(this._iNum)).toNumber(),e=x.exp(this._realNum).mul(x.sin(this._iNum)).toNumber();return fe.getComplex(u,e,this._suffix)}Ln(){const u=x.sqrt(x.pow(this._realNum,2).add(x.pow(this._iNum,2))),e=x.ln(u).toNumber(),t=x.acos(new x(this._realNum).div(u)).toNumber();return fe.getComplex(e,t,this._suffix)}Log(u){const e=x.sqrt(x.pow(this._realNum,2).add(x.pow(this._iNum,2))),t=x.ln(e);let r=x.acos(new x(this._realNum).div(e));this._iNum<0&&(r=r.negated());const n=x.ln(u),s=new x(0),a=n.mul(n).add(s.mul(s));if(a.eq(0))return this._isError=!0,"";const o=t.mul(n).add(r.mul(s)).div(a).toNumber(),c=r.mul(n).sub(t.mul(s)).div(a).toNumber();return fe.getComplex(o,c,this._suffix)}Power(u){if(this._realNum===0&&this._iNum===0)return u>0?fe.getComplex(this._realNum,this._iNum,this._suffix):(this._isError=!0,"");let e=x.sqrt(x.pow(this._realNum,2).add(x.pow(this._iNum,2))),t=x.acos(new x(this._realNum).div(e));this._iNum<0&&(t=t.negated()),e=x.pow(e,u),t=t.mul(u);const r=x.cos(t).mul(e).toNumber(),n=x.sin(t).mul(e).toNumber();return!Number.isFinite(r)||!Number.isFinite(n)?(this._isError=!0,""):fe.getComplex(r,n,this._suffix)}Product(u){const e=new x(this._realNum),t=new x(this._iNum),r=new x(u.getRealNum()),n=new x(u.getINum()),s=e.mul(r).sub(t.mul(n)).toNumber(),a=e.mul(n).add(t.mul(r)).toNumber(),o=this._suffix===""?u.getSuffix():this._suffix;return fe.getComplex(s,a,o)}Sec(){if(this._iNum){const u=x.cosh(this._iNum*2).add(x.cos(this._realNum*2)),e=x.cos(this._realNum).mul(x.cosh(this._iNum)).mul(2).div(u).toNumber(),t=x.sin(this._realNum).mul(x.sinh(this._iNum)).mul(2).div(u).toNumber();return fe.getComplex(e,t,this._suffix)}else{const u=new x(1).div(x.cos(this._realNum)).toNumber();return fe.getComplex(u,this._iNum,this._suffix)}}Sech(){if(!Number.isFinite(Math.sinh(this._realNum*2))||!Number.isFinite(Math.cosh(this._realNum*2)))return fe.getComplex(0,0,this._suffix);if(this._iNum){const u=x.cosh(this._realNum*2).add(x.cos(this._iNum*2)),e=x.cosh(this._realNum).mul(x.cos(this._iNum)).mul(2).div(u).toNumber(),t=x.sinh(this._realNum).mul(x.sin(this._iNum)).mul(-2).div(u).toNumber();return fe.getComplex(e,t,this._suffix)}else{const u=new x(1).div(x.cosh(this._realNum)).toNumber();return fe.getComplex(u,this._iNum,this._suffix)}}Sin(){if(this._iNum){const u=x.sin(this._realNum).mul(x.cosh(this._iNum)).toNumber(),e=x.cos(this._realNum).mul(x.sinh(this._iNum)).toNumber();return fe.getComplex(u,e,this._suffix)}else{const u=x.sin(this._realNum).toNumber();return fe.getComplex(u,this._iNum,this._suffix)}}Sinh(){if(!Number.isFinite(Math.sinh(this._realNum))||!Number.isFinite(Math.cosh(this._realNum)))return this._isError=!0,"";if(this._iNum){const u=x.sinh(this._realNum).mul(x.cos(this._iNum)).toNumber(),e=x.cosh(this._realNum).mul(x.sin(this._iNum)).toNumber();return fe.getComplex(u,e,this._suffix)}else{const u=x.sinh(this._realNum).toNumber();return fe.getComplex(u,this._iNum,this._suffix)}}Sqrt(){const u=x.sqrt(x.pow(this._realNum,2).add(x.pow(this._iNum,2))),e=x.sqrt(u);let t=x.acos(new x(this._realNum).div(u));this._iNum<0&&(t=t.negated());const r=e.mul(x.cos(t.div(2).toNumber())).toNumber(),n=e.mul(x.sin(t.div(2))).toNumber();return fe.getComplex(r,n,this._suffix)}Sub(u){const e=new x(this._realNum),t=new x(this._iNum),r=new x(u.getRealNum()),n=new x(u.getINum()),s=e.sub(r).toNumber(),a=t.sub(n).toNumber(),o=this._suffix===""?u.getSuffix():this._suffix;return fe.getComplex(s,a,o)}Sum(u){const e=new x(this._realNum),t=new x(this._iNum),r=new x(u.getRealNum()),n=new x(u.getINum()),s=e.add(r).toNumber(),a=t.add(n).toNumber(),o=this._suffix===""?u.getSuffix():this._suffix;return fe.getComplex(s,a,o)}Tan(){if(this._iNum){const u=x.cos(this._realNum*2).add(x.cosh(this._iNum*2)),e=x.sin(this._realNum*2).div(u).toNumber(),t=x.sinh(this._iNum*2).div(u).toNumber();return fe.getComplex(e,t,this._suffix)}else{const u=x.tan(this._realNum).toNumber();return fe.getComplex(u,this._iNum,this._suffix)}}Tanh(){if(!Number.isFinite(Math.sinh(this._realNum))||!Number.isFinite(Math.cosh(this._realNum)))return this._isError=!0,"";if(this._iNum){const u=x.cosh(this._realNum*2).add(x.cos(this._iNum*2)),e=x.sinh(this._realNum*2).div(u).toNumber(),t=x.sin(this._iNum*2).div(u).toNumber();return fe.getComplex(e,t,this._suffix)}else{const u=x.tanh(this._realNum).toNumber();return fe.getComplex(u,this._iNum,this._suffix)}}};class Kh extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",3)}calculate(e,t,r){const n=r!=null?r:U.create("i"),{isError:s,errorObject:a,variants:o}=W(e,t,n);if(s)return a;const[c,l,f]=o,m=+c.getValue(),d=+l.getValue(),C=`${f.getValue()}`;if(Number.isNaN(m)||Number.isNaN(d)||C!=="i"&&C!=="j")return g.create(h.VALUE);const _=he.getComplex(m,d,C);return typeof _=="number"?y.create(_):U.create(_)}}class Xh extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3);A(this,"_units",[["a.u. of action","?",null,"action",!1,!1,105457168181818e-48],["a.u. of charge","e",null,"electric_charge",!1,!1,160217653141414e-33],["a.u. of energy","Eh",null,"energy",!1,!1,435974417757576e-32],["a.u. of length","a?",null,"length",!1,!1,529177210818182e-25],["a.u. of mass","m?",null,"mass",!1,!1,910938261616162e-45],["a.u. of time","?/Eh",null,"time",!1,!1,241888432650516e-31],["admiralty knot","admkn",null,"speed",!1,!0,.514773333],["ampere","A",null,"electric_current",!0,!1,1],["ampere per meter","A/m",null,"magnetic_field_intensity",!0,!1,1],["ångström","Å",["ang"],"length",!1,!0,1e-10],["are","ar",null,"area",!1,!0,100],["astronomical unit","ua",null,"length",!1,!1,149597870691667e-25],["bar","bar",null,"pressure",!1,!1,1e5],["barn","b",null,"area",!1,!1,1e-28],["becquerel","Bq",null,"radioactivity",!0,!1,1],["bit","bit",["b"],"information",!1,!0,1],["btu","BTU",["btu"],"energy",!1,!0,1055.05585262],["byte","byte",null,"information",!1,!0,8],["candela","cd",null,"luminous_intensity",!0,!1,1],["candela per square metre","cd/m?",null,"luminance",!0,!1,1],["centigrade","C",["cel"],"temperature",!0,!1,1],["cubic ångström","ang3",["ang^3"],"volume",!1,!0,1e-30],["cubic foot","ft3",["ft^3"],"volume",!1,!0,.028316846592],["cubic inch","in3",["in^3"],"volume",!1,!0,16387064e-12],["cubic light-year","ly3",["ly^3"],"volume",!1,!0,846786664623715e-61],["cubic metre","m3",["m^3"],"volume",!0,!0,1],["cubic mile","mi3",["mi^3"],"volume",!1,!0,416818182544058e-5],["cubic nautical mile","Nmi3",["Nmi^3"],"volume",!1,!0,6352182208],["cubic Pica","Pica3",["Picapt3","Pica^3","Picapt^3"],"volume",!1,!0,758660370370369e-22],["cubic yard","yd3",["yd^3"],"volume",!1,!0,.764554857984],["cup","cup",null,"volume",!1,!0,.0002365882365],["dalton","Da",["u"],"mass",!1,!1,166053886282828e-41],["day","d",["day"],"time",!1,!0,86400],["degree","°",null,"angle",!1,!1,.0174532925199433],["dyne","dyn",["dy"],"force",!1,!0,1e-5],["electronvolt","eV",["ev"],"energy",!1,!0,1.60217656514141],["ell","ell",null,"length",!1,!0,1.143],["erg","erg",["e"],"energy",!1,!0,1e-7],["fahrenheit","F",["fah"],"temperature",!0,!1,1],["fluid ounce","oz",null,"volume",!1,!0,295735295625e-16],["foot","ft",null,"length",!1,!0,.3048],["foot-pound","flb",null,"energy",!1,!0,1.3558179483314],["gal","Gal",null,"acceleration",!1,!1,.01],["gallon","gal",null,"volume",!1,!0,.003785411784],["gauss","G",["ga"],"magnetic_flux_density",!1,!0,1],["grain","grain",null,"mass",!1,!0,647989e-10],["gram","g",null,"mass",!1,!0,.001],["gray","Gy",null,"absorbed_dose",!0,!1,1],["gross registered ton","GRT",["regton"],"volume",!1,!0,2.8316846592],["hectare","ha",null,"area",!1,!0,1e4],["henry","H",null,"inductance",!0,!1,1],["hertz","Hz",null,"frequency",!0,!1,1],["horsepower","HP",["h"],"power",!1,!0,745.69987158227],["horsepower-hour","HPh",["hh","hph"],"energy",!1,!0,2684519538e-3],["hour","h",["hr"],"time",!1,!0,3600],["imperial gallon (U.K.)","uk_gal",null,"volume",!1,!0,.00454609],["imperial hundredweight","lcwt",["uk_cwt","hweight"],"mass",!1,!0,50.802345],["imperial quart (U.K)","uk_qt",null,"volume",!1,!0,.0011365225],["imperial ton","brton",["uk_ton","LTON"],"mass",!1,!0,1016.046909],["inch","in",null,"length",!1,!0,.0254],["international acre","uk_acre",null,"area",!1,!0,4046.8564224],["IT calorie","cal",null,"energy",!1,!0,4.1868],["joule","J",null,"energy",!0,!0,1],["katal","kat",null,"catalytic_activity",!0,!1,1],["kelvin","K",["kel"],"temperature",!0,!0,1],["kilogram","kg",null,"mass",!0,!0,1],["knot","kn",null,"speed",!1,!0,.514444444444444],["light-year","ly",null,"length",!1,!0,9460730472580800],["litre","L",["l","lt"],"volume",!1,!0,.001],["lumen","lm",null,"luminous_flux",!0,!1,1],["lux","lx",null,"illuminance",!0,!1,1],["maxwell","Mx",null,"magnetic_flux",!1,!1,1e-18],["measurement ton","MTON",null,"volume",!1,!0,1.13267386368],["meter per hour","m/h",["m/hr"],"speed",!1,!0,.00027777777777778],["meter per second","m/s",["m/sec"],"speed",!0,!0,1],["meter per second squared","m?s??",null,"acceleration",!0,!1,1],["parsec","pc",["parsec"],"length",!1,!0,0x6da012f958ee1c],["meter squared per second","m?/s",null,"kinematic_viscosity",!0,!1,1],["metre","m",null,"length",!0,!0,1],["miles per hour","mph",null,"speed",!1,!0,.44704],["millimetre of mercury","mmHg",null,"pressure",!1,!1,133.322],["minute","?",null,"angle",!1,!1,.000290888208665722],["minute","min",["mn"],"time",!1,!0,60],["modern teaspoon","tspm",null,"volume",!1,!0,5e-6],["mole","mol",null,"amount_of_substance",!0,!1,1],["morgen","Morgen",null,"area",!1,!0,2500],["n.u. of action","?",null,"action",!1,!1,105457168181818e-48],["n.u. of mass","m?",null,"mass",!1,!1,910938261616162e-45],["n.u. of speed","c?",null,"speed",!1,!1,299792458],["n.u. of time","?/(me?c??)",null,"time",!1,!1,128808866778687e-35],["nautical mile","M",["Nmi"],"length",!1,!0,1852],["newton","N",null,"force",!0,!0,1],["œrsted","Oe ",null,"magnetic_field_intensity",!1,!1,79.5774715459477],["ohm","Ω",null,"electric_resistance",!0,!1,1],["ounce mass","ozm",null,"mass",!1,!0,.028349523125],["pascal","Pa",null,"pressure",!0,!1,1],["pascal second","Pa?s",null,"dynamic_viscosity",!0,!1,1],["pferdestärke","PS",null,"power",!1,!0,735.49875],["phot","ph",null,"illuminance",!1,!1,1e-4],["pica (1/6 inch)","pica",null,"length",!1,!0,.00035277777777778],["pica (1/72 inch)","Pica",["Picapt"],"length",!1,!0,.00423333333333333],["poise","P",null,"dynamic_viscosity",!1,!1,.1],["pond","pond",null,"force",!1,!0,.00980665],["pound force","lbf",null,"force",!1,!0,4.4482216152605],["pound mass","lbm",null,"mass",!1,!0,.45359237],["quart","qt",null,"volume",!1,!0,.000946352946],["radian","rad",null,"angle",!0,!1,1],["rankine","Rank",null,"temperature",!1,!0,1],["reaumur","Reau",null,"temperature",!1,!0,1],["second","?",null,"angle",!1,!1,484813681109536e-20],["second","s",["sec"],"time",!0,!0,1],["short hundredweight","cwt",["shweight"],"mass",!1,!0,45.359237],["siemens","S",null,"electrical_conductance",!0,!1,1],["sievert","Sv",null,"equivalent_dose",!0,!1,1],["slug","sg",null,"mass",!1,!0,14.59390294],["square ångström","ang2",["ang^2"],"area",!1,!0,1e-20],["square foot","ft2",["ft^2"],"area",!1,!0,.09290304],["square inch","in2",["in^2"],"area",!1,!0,64516e-8],["square light-year","ly2",["ly^2"],"area",!1,!0,895054210748189e17],["square meter","m?",null,"area",!0,!0,1],["square mile","mi2",["mi^2"],"area",!1,!0,2589988110336e-6],["square nautical mile","Nmi2",["Nmi^2"],"area",!1,!0,3429904],["square Pica","Pica2",["Picapt2","Pica^2","Picapt^2"],"area",!1,!0,1792111111111e-17],["square yard","yd2",["yd^2"],"area",!1,!0,.83612736],["statute mile","mi",null,"length",!1,!0,1609.344],["steradian","sr",null,"solid_angle",!0,!1,1],["stilb","sb",null,"luminance",!1,!1,1e-4],["stokes","St",null,"kinematic_viscosity",!1,!1,1e-4],["stone","stone",null,"mass",!1,!0,6.35029318],["tablespoon","tbs",null,"volume",!1,!0,147868e-10],["teaspoon","tsp",null,"volume",!1,!0,492892e-11],["tesla","T",null,"magnetic_flux_density",!0,!0,1],["thermodynamic calorie","c",null,"energy",!1,!0,4.184],["ton","ton",null,"mass",!1,!0,907.18474],["tonne","t",null,"mass",!1,!1,1e3],["U.K. pint","uk_pt",null,"volume",!1,!0,.00056826125],["U.S. bushel","bushel",null,"volume",!1,!0,.03523907],["U.S. oil barrel","barrel",null,"volume",!1,!0,.158987295],["U.S. pint","pt",["us_pt"],"volume",!1,!0,.000473176473],["U.S. survey mile","survey_mi",null,"length",!1,!0,1609.347219],["U.S. survey/statute acre","us_acre",null,"area",!1,!0,4046.87261],["volt","V",null,"voltage",!0,!1,1],["watt","W",null,"power",!0,!0,1],["watt-hour","Wh",["wh"],"energy",!1,!0,3600],["weber","Wb",null,"magnetic_flux",!0,!1,1],["yard","yd",null,"length",!1,!0,.9144],["year","yr",null,"time",!1,!0,31557600]]);A(this,"_binaryPrefixes",{Yi:["yobi",80,12089258196146292e8,"Yi","yotta"],Zi:["zebi",70,11805916207174113e5,"Zi","zetta"],Ei:["exbi",60,1152921504606847e3,"Ei","exa"],Pi:["pebi",50,0x4000000000000,"Pi","peta"],Ti:["tebi",40,1099511627776,"Ti","tera"],Gi:["gibi",30,1073741824,"Gi","giga"],Mi:["mebi",20,1048576,"Mi","mega"],ki:["kibi",10,1024,"ki","kilo"]});A(this,"_unitPrefixes",{Y:["yotta",1e24,"Y"],Z:["zetta",1e21,"Z"],E:["exa",1e18,"E"],P:["peta",1e15,"P"],T:["tera",1e12,"T"],G:["giga",1e9,"G"],M:["mega",1e6,"M"],k:["kilo",1e3,"k"],h:["hecto",100,"h"],e:["dekao",10,"e"],d:["deci",.1,"d"],c:["centi",.01,"c"],m:["milli",.001,"m"],u:["micro",1e-6,"u"],n:["nano",1e-9,"n"],p:["pico",1e-12,"p"],f:["femto",1e-15,"f"],a:["atto",1e-18,"a"],z:["zepto",1e-21,"z"],y:["yocto",1e-24,"y"]})}calculate(e,t,r){const{isError:n,errorObject:s,variants:a}=W(e,t,r);if(n)return s;const[o,c,l]=a,f=+o.getValue(),m=`${c.getValue()}`,d=`${l.getValue()}`;if(Number.isNaN(f))return g.create(h.VALUE);let C,_=1,E,b=1;const{_from:R,_to:N}=this._lookupFromAndToUnits(m,d);if(C=R,E=N,C===null){const{_from:M,_fromMultiplier:D}=this._lookupFromPrefix(m);C=M,_=D}if(E===null){const{_to:M,_toMultiplier:D}=this._lookupToPrefix(d);E=M,b=D}if(C===null||E===null||C[3]!==E[3])return g.create(h.NA);let V;return C[3]==="temperature"?(V=this._getTemperatureConversion(f,C[1],E[1]),V=+V.toFixed(2)):V=f*C[6]*_/(E[6]*b),y.create(V)}_lookupFromAndToUnits(e,t){let r=null,n=null,s;for(let a=0;a<this._units.length;a++)s=this._units[a][2]===null?[]:this._units[a][2],(this._units[a][1]===e||s.indexOf(e)>=0)&&(r=this._units[a]),(this._units[a][1]===t||s.indexOf(t)>=0)&&(n=this._units[a]);return{_from:r,_to:n}}_lookupFromPrefix(e){let t=null,r=1,n=e,s;const a=this._binaryPrefixes[e.substring(0,2)];let o=this._unitPrefixes[e.substring(0,1)];e.substring(0,2)==="da"&&(o=["dekao",10,"da"]),a?(r=a[2],n=e.substring(2)):o&&(r=o[1],n=e.substring(o[2].length));for(let c=0;c<this._units.length;c++)s=this._units[c][2]===null?[]:this._units[c][2],(this._units[c][1]===n||s.indexOf(n)>=0)&&(t=this._units[c]);return{_from:t,_fromMultiplier:r}}_lookupToPrefix(e){let t=null,r=1,n=e,s;const a=this._binaryPrefixes[e.substring(0,2)];let o=this._unitPrefixes[e.substring(0,1)];e.substring(0,2)==="da"&&(o=["dekao",10,"da"]),a?(r=a[2],n=e.substring(2)):o&&(r=o[1],n=e.substring(o[2].length));for(let c=0;c<this._units.length;c++)s=this._units[c][2]===null?[]:this._units[c][2],(this._units[c][1]===n||s.indexOf(n)>=0)&&(t=this._units[c]);return{_to:t,_toMultiplier:r}}_getTemperatureConversion(e,t,r){switch(t){case"C":return this._centigradeConversion(e,r);case"F":return this._fahrenheitConversion(e,r);case"K":return this._kelvinConversion(e,r);case"Rank":return this._rankineConversion(e,r);case"Reau":return this._reaumurConversion(e,r);default:return e}}_centigradeConversion(e,t){switch(t){case"F":return e*9/5+32;case"K":return e+273.15;case"Rank":return(e+273.15)*9/5;case"Reau":return e*4/5;default:return e}}_fahrenheitConversion(e,t){switch(t){case"C":return(e-32)*5/9;case"K":return(e-32)*5/9+273.15;case"Rank":return e+459.67;case"Reau":return(e-32)*4/9;default:return e}}_kelvinConversion(e,t){switch(t){case"C":return e-273.15;case"F":return(e-273.15)*9/5+32;case"Rank":return e*9/5;case"Reau":return(e-273.15)*4/5;default:return e}}_rankineConversion(e,t){switch(t){case"C":return(e-491.67)*5/9;case"F":return e-459.67;case"K":return e*5/9;case"Reau":return(e-491.67)*4/9;default:return e}}_reaumurConversion(e,t){switch(t){case"C":return e*5/4;case"F":return e*9/4+32;case"K":return e*5/4+273.15;case"Rank":return e*9/4+491.67;default:return e}}}class Zh extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",2)}calculate(e,t){if(e.isNull())return g.create(h.NA);let r=0;if(t){const{isError:f,errorObject:m,variants:d}=W(t);if(f)return m;const[C]=d;if(r=Math.floor(+C.getValue()),Number.isNaN(r))return g.create(h.VALUE);if(r<0||r>10)return g.create(h.NUM)}const{isError:n,errorObject:s,variants:a}=W(e);if(n)return s;const[o]=a,c=Math.trunc(+o.getValue());if(Number.isNaN(c))return g.create(h.VALUE);if(!/^-?[0-9]{1,3}$/.test(`${c}`)||c<-512||c>511)return g.create(h.NUM);let l;if(c<0){const f=(512+c).toString(2);l=`1${"0".repeat(9-f.length)}${f}`}else if(l=Number.parseInt(`${c}`,10).toString(2),t){if(r<l.length)return g.create(h.NUM);l="0".repeat(r-l.length)+l}return U.create(l)}}class zh extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",2)}calculate(e,t){if(e.isNull())return g.create(h.NA);let r=0;if(t){const{isError:f,errorObject:m,variants:d}=W(t);if(f)return m;const[C]=d;if(r=Math.floor(+C.getValue()),Number.isNaN(r))return g.create(h.VALUE);if(r<0||r>10)return g.create(h.NUM)}const{isError:n,errorObject:s,variants:a}=W(e);if(n)return s;const[o]=a,c=Math.trunc(+o.getValue());if(Number.isNaN(c))return g.create(h.VALUE);if(!/^-?[0-9]{1,12}$/.test(`${c}`)||c<-549755813888||c>549755813887)return g.create(h.NUM);let l;if(c<0)l=(1099511627776+c).toString(16);else if(l=Number.parseInt(`${c}`,10).toString(16),t){if(r<l.length)return g.create(h.NUM);l="0".repeat(r-l.length)+l}return U.create(l.toLocaleUpperCase())}}class Jh extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",2)}calculate(e,t){if(e.isNull())return g.create(h.NA);let r=0;if(t){const{isError:f,errorObject:m,variants:d}=W(t);if(f)return m;const[C]=d;if(r=Math.floor(+C.getValue()),Number.isNaN(r))return g.create(h.VALUE);if(r<0||r>10)return g.create(h.NUM)}const{isError:n,errorObject:s,variants:a}=W(e);if(n)return s;const[o]=a,c=Math.trunc(+o.getValue());if(Number.isNaN(c))return g.create(h.VALUE);if(!/^-?[0-9]{1,9}$/.test(`${c}`)||c<-536870912||c>536870911)return g.create(h.NUM);let l;if(c<0)l=(1073741824+c).toString(8);else if(l=Number.parseInt(`${c}`,10).toString(8),t){if(r<l.length)return g.create(h.NUM);l="0".repeat(r-l.length)+l}return U.create(l)}}class eg extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",2)}calculate(e,t){const r=t!=null?t:y.create(0),{isError:n,errorObject:s,variants:a}=W(e,r);if(n)return s;const[o,c]=a,l=+o.getValue(),f=+c.getValue();if(Number.isNaN(l)||Number.isNaN(f))return g.create(h.VALUE);const m=l===f?1:0;return y.create(m)}}class tg extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",2)}calculate(e,t){let r;if(t){const{isError:n,errorObject:s,variants:a}=W(e,t);if(n)return s;const[o,c]=a,l=+o.getValue(),f=+c.getValue();if(Number.isNaN(l)||Number.isNaN(f))return g.create(h.VALUE);r=Ht(f)-Ht(l)}else{const{isError:n,errorObject:s,variants:a}=W(e);if(n)return s;const[o]=a,c=+o.getValue();if(Number.isNaN(c))return g.create(h.VALUE);r=Ht(c)}return y.create(r)}}class rg extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=W(e);if(t)return r;const[s]=n,a=+s.getValue();if(Number.isNaN(a))return g.create(h.VALUE);const o=Ht(a);return y.create(o)}}class ng extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=W(e);if(t)return r;const[s]=n,a=+s.getValue();if(Number.isNaN(a))return g.create(h.VALUE);const o=Js(a);return y.create(o)}}class sg extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=W(e);if(t)return r;const[s]=n,a=+s.getValue();if(Number.isNaN(a))return g.create(h.VALUE);const o=Js(a);return y.create(o)}}var z=(i=>(i.BESSELI="BESSELI",i.BESSELJ="BESSELJ",i.BESSELK="BESSELK",i.BESSELY="BESSELY",i.BIN2DEC="BIN2DEC",i.BIN2HEX="BIN2HEX",i.BIN2OCT="BIN2OCT",i.BITAND="BITAND",i.BITLSHIFT="BITLSHIFT",i.BITOR="BITOR",i.BITRSHIFT="BITRSHIFT",i.BITXOR="BITXOR",i.COMPLEX="COMPLEX",i.CONVERT="CONVERT",i.DEC2BIN="DEC2BIN",i.DEC2HEX="DEC2HEX",i.DEC2OCT="DEC2OCT",i.DELTA="DELTA",i.ERF="ERF",i.ERF_PRECISE="ERF.PRECISE",i.ERFC="ERFC",i.ERFC_PRECISE="ERFC.PRECISE",i.GESTEP="GESTEP",i.HEX2BIN="HEX2BIN",i.HEX2DEC="HEX2DEC",i.HEX2OCT="HEX2OCT",i.IMABS="IMABS",i.IMAGINARY="IMAGINARY",i.IMARGUMENT="IMARGUMENT",i.IMCONJUGATE="IMCONJUGATE",i.IMCOS="IMCOS",i.IMCOSH="IMCOSH",i.IMCOT="IMCOT",i.IMCOTH="IMCOTH",i.IMCSC="IMCSC",i.IMCSCH="IMCSCH",i.IMDIV="IMDIV",i.IMEXP="IMEXP",i.IMLN="IMLN",i.IMLOG="IMLOG",i.IMLOG10="IMLOG10",i.IMLOG2="IMLOG2",i.IMPOWER="IMPOWER",i.IMPRODUCT="IMPRODUCT",i.IMREAL="IMREAL",i.IMSEC="IMSEC",i.IMSECH="IMSECH",i.IMSIN="IMSIN",i.IMSINH="IMSINH",i.IMSQRT="IMSQRT",i.IMSUB="IMSUB",i.IMSUM="IMSUM",i.IMTAN="IMTAN",i.IMTANH="IMTANH",i.OCT2BIN="OCT2BIN",i.OCT2DEC="OCT2DEC",i.OCT2HEX="OCT2HEX",i))(z||{});class ag extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",2)}calculate(e,t){if(e.isNull())return g.create(h.NA);const r=t!=null?t:y.create(0),{isError:n,errorObject:s,variants:a}=W(e,r);if(n)return s;const[o,c]=a,l=+o.getValue(),f=+c.getValue();if(Number.isNaN(l)||Number.isNaN(f))return g.create(h.VALUE);const m=l>=f?1:0;return y.create(m)}}class ig extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",2)}calculate(e,t){if(e.isNull())return g.create(h.NA);let r=0;if(t){const{isError:d,errorObject:C,variants:_}=W(t);if(d)return C;const[E]=_;if(r=Math.floor(+E.getValue()),Number.isNaN(r))return g.create(h.VALUE);if(r<0||r>10)return g.create(h.NUM)}const{isError:n,errorObject:s,variants:a}=W(e);if(n)return s;const[o]=a,c=`${o.getValue()}`;if(!zs(c))return g.create(h.NUM);const l=c.length===10&&c.substring(0,1).toLocaleUpperCase()==="F",f=l?Number.parseInt(c,16)-1099511627776:Number.parseInt(c,16);if(f<-512||f>511)return g.create(h.NUM);let m;if(l){const d=(512+f).toString(2);m=`1${"0".repeat(9-d.length)}${d}`}else if(m=f.toString(2),t){if(r<m.length)return g.create(h.NUM);m="0".repeat(r-m.length)+m}return U.create(m)}}class og extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=W(e);if(t)return r;const[s]=n,a=`${s.getValue()}`;if(!zs(a))return g.create(h.NUM);let o=Number.parseInt(a,16);return o>=549755813888&&(o-=1099511627776),y.create(o)}}class ug extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",2)}calculate(e,t){if(e.isNull())return g.create(h.NA);let r=0;if(t){const{isError:m,errorObject:d,variants:C}=W(t);if(m)return d;const[_]=C;if(r=Math.floor(+_.getValue()),Number.isNaN(r))return g.create(h.VALUE);if(r<0||r>10)return g.create(h.NUM)}const{isError:n,errorObject:s,variants:a}=W(e);if(n)return s;const[o]=a,c=`${o.getValue()}`;if(!zs(c))return g.create(h.NUM);const l=Number.parseInt(c,16);if(l>536870911&&l<0xffe0000000)return g.create(h.NUM);let f;if(l>=0xffe0000000)f=(l-0xffc0000000).toString(8);else if(f=l.toString(8),t){if(r<f.length)return g.create(h.NUM);f="0".repeat(r-f.length)+f}return U.create(f)}}class cg extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=W(e);if(t)return r;const[s]=n,a=`${s.getValue()}`,o=new he(a);if(o.isError())return g.create(h.NUM);const c=o.Abs();return y.create(c)}}class lg extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=W(e);if(t)return r;const[s]=n,a=`${s.getValue()}`,o=new he(a);if(o.isError())return g.create(h.NUM);const c=o.getINum();return y.create(c)}}class fg extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=W(e);if(t)return r;const[s]=n,a=`${s.getValue()}`,o=new he(a);if(o.isError())return g.create(h.NUM);if(o.getRealNum()===0&&o.getINum()===0)return g.create(h.DIV_BY_ZERO);const c=o.Argument();return y.create(c)}}class mg extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=W(e);if(t)return r;const[s]=n,a=`${s.getValue()}`,o=new he(a);if(o.isError())return g.create(h.NUM);const c=o.Conjugate();return typeof c=="number"||S.isRealNum(c)?y.create(+c):U.create(c)}}class hg extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=W(e);if(t)return r;const[s]=n,a=`${s.getValue()}`,o=new he(a);if(o.isError())return g.create(h.NUM);const c=o.Cos();return typeof c=="number"||S.isRealNum(c)?y.create(+c):U.create(c)}}class gg extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=W(e);if(t)return r;const[s]=n,a=`${s.getValue()}`,o=new he(a);if(o.isError())return g.create(h.NUM);const c=o.Cosh();return o.isError()?g.create(h.NUM):typeof c=="number"||S.isRealNum(c)?y.create(+c):U.create(c)}}class dg extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=W(e);if(t)return r;const[s]=n,a=`${s.getValue()}`,o=new he(a);if(o.isError()||o.getRealNum()===0&&o.getINum()===0)return g.create(h.NUM);const c=o.Cot();return typeof c=="number"||S.isRealNum(c)?y.create(+c):U.create(c)}}class Cg extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=W(e);if(t)return r;const[s]=n,a=`${s.getValue()}`,o=new he(a);if(o.isError()||o.getRealNum()===0&&o.getINum()===0)return g.create(h.NUM);const c=o.Coth();return o.isError()?g.create(h.NUM):typeof c=="number"||S.isRealNum(c)?y.create(+c):U.create(c)}}class _g extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=W(e);if(t)return r;const[s]=n,a=`${s.getValue()}`,o=new he(a);if(o.isError()||o.getRealNum()===0&&o.getINum()===0)return g.create(h.NUM);const c=o.Csc();return typeof c=="number"||S.isRealNum(c)?y.create(+c):U.create(c)}}class Ag extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=W(e);if(t)return r;const[s]=n,a=`${s.getValue()}`,o=new he(a);if(o.isError()||o.getRealNum()===0&&o.getINum()===0)return g.create(h.NUM);const c=o.Csch();return typeof c=="number"||S.isRealNum(c)?y.create(+c):U.create(c)}}class Eg extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){if(e.isNull()||t.isNull())return g.create(h.NA);const{isError:r,errorObject:n,variants:s}=W(e,t);if(r)return n;const[a,o]=s,c=`${a.getValue()}`,l=`${o.getValue()}`,f=new he(c),m=new he(l);if(f.isError()||m.isError()||f.isDifferentSuffixes(m)||m.getRealNum()===0&&m.getINum()===0)return g.create(h.NUM);const d=f.Div(m);return typeof d=="number"||S.isRealNum(d)?y.create(+d):U.create(d)}}class bg extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=W(e);if(t)return r;const[s]=n,a=`${s.getValue()}`,o=new he(a);if(o.isError())return g.create(h.NUM);const c=o.Exp();return o.isError()?g.create(h.NUM):typeof c=="number"||S.isRealNum(c)?y.create(+c):U.create(c)}}class yg extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=W(e);if(t)return r;const[s]=n,a=`${s.getValue()}`,o=new he(a);if(o.isError()||o.getRealNum()===0&&o.getINum()===0)return g.create(h.NUM);const c=o.Ln();return typeof c=="number"||S.isRealNum(c)?y.create(+c):U.create(c)}}class Rg extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",2)}calculate(e,t){const{isError:r,errorObject:n,variants:s}=W(e);if(r)return n;const[a]=s;let o=t!=null?t:y.create(10);if(o.isArray()){const b=o.getRowCount(),R=o.getColumnCount();if(b>1||R>1)return g.create(h.VALUE);o=o.get(0,0)}const{isError:c,errorObject:l,variants:f}=k(o);if(c)return l;const[m]=f,d=`${a.getValue()}`,C=+m.getValue(),_=new he(d);if(_.isError()||_.getRealNum()===0&&_.getINum()===0||C<=0)return g.create(h.NUM);const E=_.Log(C);return _.isError()?g.create(h.NUM):typeof E=="number"||S.isRealNum(E)?y.create(+E):U.create(E)}}class Ng extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=W(e);if(t)return r;const[s]=n,a=`${s.getValue()}`,o=new he(a);if(o.isError()||o.getRealNum()===0&&o.getINum()===0)return g.create(h.NUM);const c=o.Log(2);return typeof c=="number"||S.isRealNum(c)?y.create(+c):U.create(c)}}class pg extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=W(e);if(t)return r;const[s]=n,a=`${s.getValue()}`,o=new he(a);if(o.isError()||o.getRealNum()===0&&o.getINum()===0)return g.create(h.NUM);const c=o.Log(10);return typeof c=="number"||S.isRealNum(c)?y.create(+c):U.create(c)}}class Vg extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){if(e.isNull()||t.isNull())return g.create(h.NA);const{isError:r,errorObject:n,variants:s}=W(e,t);if(r)return n;const[a,o]=s,c=`${a.getValue()}`,l=new he(c);if(l.isError())return g.create(h.NUM);const f=+o.getValue();if(Number.isNaN(f))return g.create(h.VALUE);const m=l.Power(f);return l.isError()?g.create(h.NUM):typeof m=="number"||S.isRealNum(m)?y.create(+m):U.create(m)}}class Og extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){let t="";for(let r=0;r<e.length;r++){if(t instanceof g)return t;const n=e[r];if(n.isArray()){let s=!1,a;if(n.iterator(o=>{if(t=this._handleSingleObject(o,t),t instanceof g)return s=!0,a=t,!1}),s)return a}else t=this._handleSingleObject(n,t)}return t instanceof g?t:typeof t=="number"||S.isRealNum(t)?y.create(+t):U.create(t)}_handleSingleObject(e,t){let r=t;if(e.isError())return e;if(e.isBoolean())return g.create(h.VALUE);const n=`${e.getValue()}`;if(typeof t!="number"&&!t){const s=new he(n);if(s.isError())return g.create(h.NUM);r=s.toString()}else{const s=new he(t),a=new he(n);if(s.isError()||a.isError())return g.create(h.NUM);if(s.isDifferentSuffixes(a))return g.create(h.VALUE);r=s.Product(a)}return r}}class Sg extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=W(e);if(t)return r;const[s]=n,a=`${s.getValue()}`,o=new he(a);if(o.isError())return g.create(h.NUM);const c=o.getRealNum();return y.create(c)}}class Mg extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=W(e);if(t)return r;const[s]=n,a=`${s.getValue()}`,o=new he(a);if(o.isError())return g.create(h.NUM);const c=o.Sec();return typeof c=="number"||S.isRealNum(c)?y.create(+c):U.create(c)}}class Dg extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=W(e);if(t)return r;const[s]=n,a=`${s.getValue()}`,o=new he(a);if(o.isError())return g.create(h.NUM);const c=o.Sech();return typeof c=="number"||S.isRealNum(c)?y.create(+c):U.create(c)}}class wg extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=W(e);if(t)return r;const[s]=n,a=`${s.getValue()}`,o=new he(a);if(o.isError())return g.create(h.NUM);const c=o.Sin();return typeof c=="number"||S.isRealNum(c)?y.create(+c):U.create(c)}}class Lg extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=W(e);if(t)return r;const[s]=n,a=`${s.getValue()}`,o=new he(a);if(o.isError())return g.create(h.NUM);const c=o.Sinh();return o.isError()?g.create(h.NUM):typeof c=="number"||S.isRealNum(c)?y.create(+c):U.create(c)}}class Pg extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=W(e);if(t)return r;const[s]=n,a=`${s.getValue()}`,o=new he(a);if(o.isError())return g.create(h.NUM);if(o.getRealNum()===0&&o.getINum()===0)return y.create(0);const c=o.Sqrt();return typeof c=="number"||S.isRealNum(c)?y.create(+c):U.create(c)}}class jg extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){if(e.isNull()||t.isNull())return g.create(h.NA);const{isError:r,errorObject:n,variants:s}=W(e,t);if(r)return n;const[a,o]=s,c=`${a.getValue()}`,l=`${o.getValue()}`,f=new he(c),m=new he(l);if(f.isError()||m.isError()||f.isDifferentSuffixes(m))return g.create(h.NUM);const d=f.Sub(m);return typeof d=="number"||S.isRealNum(d)?y.create(+d):U.create(d)}}class xg extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){let t="";for(let r=0;r<e.length;r++){if(t instanceof g)return t;const n=e[r];if(n.isArray()){let s=!1,a;if(n.iterator(o=>{if(t=this._handleSingleObject(o,t),t instanceof g)return s=!0,a=t,!1}),s)return a}else t=this._handleSingleObject(n,t)}return t instanceof g?t:typeof t=="number"||S.isRealNum(t)?y.create(+t):U.create(t)}_handleSingleObject(e,t){let r=t;if(e.isError())return e;if(e.isBoolean())return g.create(h.VALUE);const n=`${e.getValue()}`;if(typeof t!="number"&&!t){const s=new he(n);if(s.isError())return g.create(h.NUM);r=s.toString()}else{const s=new he(t),a=new he(n);if(s.isError()||a.isError())return g.create(h.NUM);if(s.isDifferentSuffixes(a))return g.create(h.VALUE);r=s.Sum(a)}return r}}class Ug extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=W(e);if(t)return r;const[s]=n,a=`${s.getValue()}`,o=new he(a);if(o.isError())return g.create(h.NUM);const c=o.Tan();return typeof c=="number"||S.isRealNum(c)?y.create(+c):U.create(c)}}class vg extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=W(e);if(t)return r;const[s]=n,a=`${s.getValue()}`,o=new he(a);if(o.isError())return g.create(h.NUM);const c=o.Tanh();return o.isError()?g.create(h.NUM):typeof c=="number"||S.isRealNum(c)?y.create(+c):U.create(c)}}class Tg extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",2)}calculate(e,t){if(e.isNull())return g.create(h.NA);let r=0;if(t){const{isError:d,errorObject:C,variants:_}=W(t);if(d)return C;const[E]=_;if(r=Math.floor(+E.getValue()),Number.isNaN(r))return g.create(h.VALUE);if(r<0||r>10)return g.create(h.NUM)}const{isError:n,errorObject:s,variants:a}=W(e);if(n)return s;const[o]=a,c=`${o.getValue()}`;if(!Zs(c))return g.create(h.NUM);const l=c.length===10&&c.substring(0,1)==="7",f=l?Number.parseInt(c,8)-1073741824:Number.parseInt(c,8);if(f<-512||f>511)return g.create(h.NUM);let m;if(l){const d=(512+f).toString(2);m=`1${"0".repeat(9-d.length)}${d}`}else if(m=f.toString(2),t){if(r<m.length)return g.create(h.NUM);m="0".repeat(r-m.length)+m}return U.create(m)}}class Bg extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=W(e);if(t)return r;const[s]=n,a=`${s.getValue()}`;if(!Zs(a))return g.create(h.NUM);let o=Number.parseInt(a,8);return o>=536870912&&(o-=1073741824),y.create(o)}}class Fg extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",2)}calculate(e,t){if(e.isNull())return g.create(h.NA);let r=0;if(t){const{isError:m,errorObject:d,variants:C}=W(t);if(m)return d;const[_]=C;if(r=Math.floor(+_.getValue()),Number.isNaN(r))return g.create(h.VALUE);if(r<0||r>10)return g.create(h.NUM)}const{isError:n,errorObject:s,variants:a}=W(e);if(n)return s;const[o]=a,c=`${o.getValue()}`;if(!Zs(c))return g.create(h.NUM);const l=Number.parseInt(c,8);let f;if(l>=536870912)f=`ff${(l+3221225472).toString(16)}`;else if(f=l.toString(16),t){if(r<f.length)return g.create(h.NUM);f="0".repeat(r-f.length)+f}return U.create(f.toLocaleUpperCase())}}const au=[[Th,z.BESSELI],[Bh,z.BESSELJ],[Fh,z.BESSELK],[Ih,z.BESSELY],[kh,z.BIN2DEC],[$h,z.BIN2HEX],[Yh,z.BIN2OCT],[Hh,z.BITAND],[Gh,z.BITLSHIFT],[Wh,z.BITOR],[Qh,z.BITRSHIFT],[qh,z.BITXOR],[Kh,z.COMPLEX],[Xh,z.CONVERT],[Zh,z.DEC2BIN],[zh,z.DEC2HEX],[Jh,z.DEC2OCT],[eg,z.DELTA],[tg,z.ERF],[rg,z.ERF_PRECISE],[ng,z.ERFC],[sg,z.ERFC_PRECISE],[ag,z.GESTEP],[ig,z.HEX2BIN],[og,z.HEX2DEC],[ug,z.HEX2OCT],[cg,z.IMABS],[lg,z.IMAGINARY],[fg,z.IMARGUMENT],[mg,z.IMCONJUGATE],[hg,z.IMCOS],[gg,z.IMCOSH],[dg,z.IMCOT],[Cg,z.IMCOTH],[_g,z.IMCSC],[Ag,z.IMCSCH],[Eg,z.IMDIV],[bg,z.IMEXP],[yg,z.IMLN],[Rg,z.IMLOG],[pg,z.IMLOG10],[Ng,z.IMLOG2],[Vg,z.IMPOWER],[Og,z.IMPRODUCT],[Sg,z.IMREAL],[Mg,z.IMSEC],[Dg,z.IMSECH],[wg,z.IMSIN],[Lg,z.IMSINH],[Pg,z.IMSQRT],[jg,z.IMSUB],[xg,z.IMSUM],[Ug,z.IMTAN],[vg,z.IMTANH],[Tg,z.OCT2BIN],[Bg,z.OCT2DEC],[Fg,z.OCT2HEX]];var ee=(i=>(i.ACCRINT="ACCRINT",i.ACCRINTM="ACCRINTM",i.AMORDEGRC="AMORDEGRC",i.AMORLINC="AMORLINC",i.COUPDAYBS="COUPDAYBS",i.COUPDAYS="COUPDAYS",i.COUPDAYSNC="COUPDAYSNC",i.COUPNCD="COUPNCD",i.COUPNUM="COUPNUM",i.COUPPCD="COUPPCD",i.CUMIPMT="CUMIPMT",i.CUMPRINC="CUMPRINC",i.DB="DB",i.DDB="DDB",i.DISC="DISC",i.DOLLARDE="DOLLARDE",i.DOLLARFR="DOLLARFR",i.DURATION="DURATION",i.EFFECT="EFFECT",i.FV="FV",i.FVSCHEDULE="FVSCHEDULE",i.INTRATE="INTRATE",i.IPMT="IPMT",i.IRR="IRR",i.ISPMT="ISPMT",i.MDURATION="MDURATION",i.MIRR="MIRR",i.NOMINAL="NOMINAL",i.NPER="NPER",i.NPV="NPV",i.ODDFPRICE="ODDFPRICE",i.ODDFYIELD="ODDFYIELD",i.ODDLPRICE="ODDLPRICE",i.ODDLYIELD="ODDLYIELD",i.PDURATION="PDURATION",i.PMT="PMT",i.PPMT="PPMT",i.PRICE="PRICE",i.PRICEDISC="PRICEDISC",i.PRICEMAT="PRICEMAT",i.PV="PV",i.RATE="RATE",i.RECEIVED="RECEIVED",i.RRI="RRI",i.SLN="SLN",i.SYD="SYD",i.TBILLEQ="TBILLEQ",i.TBILLPRICE="TBILLPRICE",i.TBILLYIELD="TBILLYIELD",i.VDB="VDB",i.XIRR="XIRR",i.XNPV="XNPV",i.YIELD="YIELD",i.YIELDDISC="YIELDDISC",i.YIELDMAT="YIELDMAT",i))(ee||{});function kn(i,u,e,t){const r=Lt(i,u,e),{days:n}=_e(r,i,t);return n}function Qe(i,u,e,t){let r;if(t===1){const n=Lt(i,u,e);let s=ne(n);s=fr(s,12/e);const a=be(s);n<0&&e===1?r=365:r=a-n}else t===3?r=365/e:r=360/e;return r}function iu(i,u,e){const t=ne(i);let r=ne(u);for(r.setUTCFullYear(t.getUTCFullYear()),r<t&&r.setUTCFullYear(r.getUTCFullYear()+1);r>t;)r=fr(r,-12/e);return r=fr(r,12/e),be(r)}function Qt(i,u,e){let t=0;const r=ne(i);let n=ne(u);for(;n>r;)n=fr(n,-12/e),t++;return t}function Lt(i,u,e){const t=ne(i);let r=ne(u);for(r.setUTCFullYear(t.getUTCFullYear()),r<t&&r.setUTCFullYear(r.getUTCFullYear()+1);r>t;)r=fr(r,-12/e);return be(r)}function ou(i,u,e,t,r,n){const s=kn(i,u,r,n),a=Qe(i,u,r,n),o=Qt(i,u,r),c=(a-s)/a-1,l=t/r+1,f=e*100/r;let m=0,d=0;for(let E=1;E<=o;E++){const b=E+c,R=f/l**b;m+=b*R,d+=R}const C=o+c,_=100/l**C;return m+=C*_,d+=_,m/d/r}function Ur(i,u,e,t,r){let n;if(i===0)n=(e+t)/u;else{const s=(1+i)**u;n=r===1?(t*i/(s-1)+e*i/(1-1/s))/(1+i):t*i/(s-1)+e*i/(1-1/s)}return-n}function qt(i,u,e,t,r){let n;if(i===0)n=t+e*u;else{if(i===-1&&u===0)return Number.NaN;const s=(1+i)**u;n=r===1?t*s+e*(1+i)*(s-1)/i:t*s+e*(s-1)/i}return-n}function uu(i,u,e,t,r,n){const s=Ur(i,e,t,r,n);return(u===1?n===1?0:-t:n===1?qt(i,u-2,s,t,1)-s:qt(i,u-1,s,t,0))*i}function cu(i,u){let e=0;for(let t=1;t<=u.length;t++)e+=u[t-1]/(1+i)**t;return e}function lu(i,u,e,t,r,n,s,a,o){const c=Kt(e,t,o),l=Qe(i,t,a,o);return c<l?Ig(i,u,e,t,r,n,s,a,o,c,l):kg(i,u,e,t,r,n,s,a,o,l)}function Ig(i,u,e,t,r,n,s,a,o,c,l){let f=0;const m=Qt(i,u,a),d=Kt(i,t,o);f+=s/(1+n/a)**(m-1+d/l),f+=100*r/a*c/l/(1+n/a)**(d/l);for(let _=2;_<=m;_++)f+=100*r/a/(1+n/a)**(_-1+d/l);const C=Kt(e,i,o);return f-=100*r/a*C/l,f}function kg(i,u,e,t,r,n,s,a,o,c){let l=0;const f=Qt(t,u,a),m=$g(t,i,12/a);let d;if(o===2||o===3){const R=iu(i,t,a);d=Kt(i,R,o)}else{const R=Lt(i,t,a),{days:N}=_e(R,i,o);d=c-N}l+=s/(1+n/a)**(f+m+d/c);const C=Qt(e,t,a);let _=t,E=0,b=0;for(let R=C;R>=1;R--){const N=Xt(_,-12/a,!1),V=o===1?Kt(N,_,o):c,M=R>1?V:Kt(e,_,o);E+=M/V;const D=e>N?e:N,L=i<_?i:_,P=Kt(D,L,o);b+=P/V,_=N}l+=100*r/a*E/(1+n/a)**(m+d/c);for(let R=1;R<=f;R++)l+=100*r/a/(1+n/a)**(R+m+d/c);return l-=100*r/a*b,l}function Kt(i,u,e){const{days:t}=_e(i,u,e);return i<u?t:0}function fu(i,u,e){const t=ne(i),r=t.getUTCFullYear(),n=t.getUTCMonth(),s=t.getUTCDate(),a=lr(r,n,s),o=ne(u),c=o.getUTCFullYear(),l=o.getUTCMonth(),f=o.getUTCDate(),m=lr(c,l,f);return!(s!==f&&!(a&&m)||Math.abs((c-r)*12+(l-n))%(12/e)!==0)}function mr(i,u,e){return Lt(i,u,e)>=0}function Xt(i,u,e){let t=ne(i);if(t=fr(t,u),e){const r=t.getUTCFullYear(),n=t.getUTCMonth(),s=xr(r,n);t.setUTCDate(s)}return be(t)}function $g(i,u,e,t){const r=ne(i),n=ne(u),s=r.getUTCFullYear(),a=r.getUTCMonth(),o=r.getUTCDate(),c=n.getUTCFullYear(),l=n.getUTCMonth(),f=n.getUTCDate(),m=lr(s,a,o),d=!m&&a!==1&&o>28&&o<xr(s,a)?lr(c,l,f):m,C=Xt(u,0,d);let _=1+ +(u<C),E=Xt(C,e,d);for(;!(e>0?E>=u:E<=u);)E=Xt(E,e,d),_++;return _}function Ea(i,u){let n=1,s=0,a=i,o;for(;n>1e-7&&s<500;){const c=(u(a+1e-7)-u(a-1e-7))/2e-7;o=a-u(a)/c,s++,n=Math.abs(o-a),a=o}return Number.isNaN(a)||Math.abs(a)===1/0||s===500?Yg(i,u):a}function Yg(i,u){const r=Number.MAX_VALUE,n=-1,s=1.6;let a=i-.01<=n?n+1e-7:i-.01,o=i+.01>=r?r-1e-7:i+.01,c,l,f=0;if(i<=n||i>=r)return g.create(h.NUM);for(let E=0;E<60;E++){c=a<=n?n+1e-7:a,l=o>=r?r-1e-7:o;const b=u(c),R=u(l);if(b*R<=0)break;if(b*R>0)a=c+s*(c-l),o=l+s*(l-c);else return g.create(h.NUM);if(E===59)return g.create(h.NUM)}c=c,l=l;let m=u(c);const d=u(l);let C,_;if(Math.abs(m)<1e-7||Math.abs(d)<1e-7)return g.create(h.NUM);do _=c+(l-c)/2,C=u(_),m*C<0?l=_:c=_,m=u(c),f++;while(Math.abs(C)>1e-7&&f<60);return _}function $n(i,u,e,t,r,n,s){const a=Qt(i,u,n),o=Qe(i,u,n,s),c=kn(i,u,n,s);if(a===1){const m=o-c,d=100*e/n+r,C=t/n*m/o+1,_=100*e/n*c/o;return d/C-_}const l=o-c;let f=r/(1+t/n)**(a-1+l/o);for(let m=1;m<=a;m++)f+=100*e/n/(1+t/n)**(m-1+l/o);return f-=100*e/n*c/o,f}function ba(i,u,e,t,r){let n=0,s=r/e;s>=1?(s=1,n=t===1?i:0):n=i*(1-s)**(t-1);const a=i*(1-s)**t;let o=0;return a<u?o=n-u:o=n-a,o<0&&(o=0),o}class Hg extends p{constructor(){super(...arguments);A(this,"minParams",6);A(this,"maxParams",8)}calculate(e,t,r,n,s,a,o,c){const l=o!=null?o:y.create(0),f=c!=null?c:T.create(!0),{isError:m,errorObject:d,variants:C}=W(e,t,r,n,s,a,l);if(m)return d;const[_,E,b,R,N,V,M]=C,D=$(_);if(typeof D!="number")return D;const L=$(E);if(typeof L!="number")return L;const P=$(b);if(typeof P!="number")return P;const j=+R.getValue(),F=+N.getValue(),v=Math.floor(+V.getValue()),Y=Math.floor(+M.getValue()),q=+f.getValue();return Number.isNaN(j)||Number.isNaN(F)||Number.isNaN(v)||Number.isNaN(Y)||Number.isNaN(q)?g.create(h.VALUE):j<=0||F<=0||![1,2,4].includes(v)||Y<0||Y>4||Math.floor(D)>=Math.floor(P)?g.create(h.NUM):this._getResult(D,L,P,j,F,v,Y,q)}_getResult(e,t,r,n,s,a,o,c){let l=Lt(e,t,a);if(l<=0)return y.create(0);l=Lt(r,t,a);const f=12/a,m=ne(t),d=m.getUTCFullYear(),C=m.getUTCMonth(),_=m.getUTCDate(),E=lr(d,C,_);let b=Xt(t,-f,E);if(r>t&&c)for(b=t;b<r;)b=Xt(b,f,E);let R=e>b?e:b,{days:N}=_e(R,r,o);if(l>=e){const{days:j}=_e(R,r,o?4:0);N=j}r<R&&(N=-N);let V=Qe(b,t,a,o),M=N/V,D=b,L=e;for(;D>e;){L=D,D=Xt(D,-f,E),R=e>D?e:D;const{days:j}=_e(R,L,o);if(o===0)L>=R||e<=D?N=j:N=-j,V=Qe(D,L,a,o);else if(N=L<R?-j:j,o===3)V=365/a;else{const{days:F}=_e(D,L,o);V=L<D?-F:F}M+=e<=D?c?1:0:N/V}const P=s*n/a*M;return y.create(P)}}class Gg extends p{constructor(){super(...arguments);A(this,"minParams",4);A(this,"maxParams",5)}calculate(e,t,r,n,s){const a=s!=null?s:y.create(0),{isError:o,errorObject:c,variants:l}=W(e,t,r,n,a);if(o)return c;const[f,m,d,C,_]=l,E=$(f);if(typeof E!="number")return E;const b=$(m);if(typeof b!="number")return b;const R=+d.getValue(),N=+C.getValue(),V=Math.floor(+_.getValue());if(Number.isNaN(R)||Number.isNaN(N)||Number.isNaN(V))return g.create(h.VALUE);if(R<=0||N<=0||V<0||V>4||Math.floor(E)>Math.floor(b))return g.create(h.NUM);if(Math.floor(E)===Math.floor(b))return y.create(0);const{days:M,yearDays:D}=_e(E,b,V),L=N*R*M/D;return y.create(L)}}class Wg extends p{constructor(){super(...arguments);A(this,"minParams",6);A(this,"maxParams",7)}calculate(e,t,r,n,s,a,o){const c=o!=null?o:y.create(0),{isError:l,errorObject:f,variants:m}=W(e,t,r,n,s,a,c);if(l)return f;const[d,C,_,E,b,R,N]=m,V=$(C);if(typeof V!="number")return V;const M=$(_);if(typeof M!="number")return M;const D=+d.getValue(),L=+E.getValue();let P=+b.getValue();const j=+R.getValue(),F=Math.floor(+N.getValue());return Number.isNaN(D)||Number.isNaN(L)||Number.isNaN(P)||Number.isNaN(j)||Number.isNaN(F)?g.create(h.VALUE):D<=0||L<0||D<L||Math.floor(V)>Math.floor(M)||P<0||j<=0||![0,1,3,4].includes(F)?g.create(h.NUM):(P>1?P=Math.floor(P):P=Math.ceil(P),this._getResult(D,V,M,L,P,j,F))}_getResult(e,t,r,n,s,a,o){const c=e-n,l=e*a,{days:f,yearDays:m}=_e(t,r,o),d=f/m,C=Math.ceil(c/l-d);if(C<0)return y.create(0);let _=l;return s===0?_=l*d:s===C?_=c-l*(d+s-1):s>C&&(_=0),y.create(_)}}class Qg extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",4)}calculate(e,t,r,n){const s=n!=null?n:y.create(0),{isError:a,errorObject:o,variants:c}=W(e,t,r,s);if(a)return o;const[l,f,m,d]=c,C=$(l);if(typeof C!="number")return C;const _=$(f);if(typeof _!="number")return _;const E=Math.floor(+m.getValue()),b=Math.floor(+d.getValue());if(Number.isNaN(E)||Number.isNaN(b))return g.create(h.VALUE);if(![1,2,4].includes(E)||b<0||b>4||Math.floor(C)>=Math.floor(_))return g.create(h.NUM);const R=kn(C,_,E,b);return y.create(R)}}class qg extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",4)}calculate(e,t,r,n){const s=n!=null?n:y.create(0),{isError:a,errorObject:o,variants:c}=W(e,t,r,s);if(a)return o;const[l,f,m,d]=c,C=$(l);if(typeof C!="number")return C;const _=$(f);if(typeof _!="number")return _;const E=Math.floor(+m.getValue()),b=Math.floor(+d.getValue());if(Number.isNaN(E)||Number.isNaN(b))return g.create(h.VALUE);if(![1,2,4].includes(E)||b<0||b>4||Math.floor(C)>=Math.floor(_))return g.create(h.NUM);const R=Qe(C,_,E,b);return y.create(R)}}class Kg extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",4)}calculate(e,t,r,n){const s=n!=null?n:y.create(0),{isError:a,errorObject:o,variants:c}=W(e,t,r,s);if(a)return o;const[l,f,m,d]=c,C=$(l);if(typeof C!="number")return C;const _=$(f);if(typeof _!="number")return _;const E=Math.floor(+m.getValue()),b=Math.floor(+d.getValue());if(Number.isNaN(E)||Number.isNaN(b))return g.create(h.VALUE);if(![1,2,4].includes(E)||b<0||b>4||Math.floor(C)>=Math.floor(_))return g.create(h.NUM);const R=ne(C),N=ne(_);for(N.setUTCFullYear(R.getUTCFullYear()),N<R&&N.setUTCFullYear(N.getUTCFullYear()+1);N>R;)N.setUTCMonth(N.getUTCMonth()-12/E);N.setUTCMonth(N.getUTCMonth()+12/E);const V=be(N),{days:M}=_e(C,V,b);return y.create(M)}}class Xg extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",4)}calculate(e,t,r,n){const s=n!=null?n:y.create(0),{isError:a,errorObject:o,variants:c}=W(e,t,r,s);if(a)return o;const[l,f,m,d]=c,C=$(l);if(typeof C!="number")return C;const _=$(f);if(typeof _!="number")return _;const E=Math.floor(+m.getValue()),b=Math.floor(+d.getValue());if(Number.isNaN(E)||Number.isNaN(b))return g.create(h.VALUE);if(![1,2,4].includes(E)||b<0||b>4||Math.floor(C)>=Math.floor(_))return g.create(h.NUM);const R=iu(C,_,E);return y.create(R)}}class Zg extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",4)}calculate(e,t,r,n){const s=n!=null?n:y.create(0),{isError:a,errorObject:o,variants:c}=W(e,t,r,s);if(a)return o;const[l,f,m,d]=c,C=$(l);if(typeof C!="number")return C;const _=$(f);if(typeof _!="number")return _;const E=Math.floor(+m.getValue()),b=Math.floor(+d.getValue());if(Number.isNaN(E)||Number.isNaN(b))return g.create(h.VALUE);if(![1,2,4].includes(E)||b<0||b>4||Math.floor(C)>=Math.floor(_)||Lt(C,_,E)<0)return g.create(h.NUM);const N=Qt(C,_,E);return y.create(N)}}class zg extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",4)}calculate(e,t,r,n){const s=n!=null?n:y.create(0),{isError:a,errorObject:o,variants:c}=W(e,t,r,s);if(a)return o;const[l,f,m,d]=c,C=$(l);if(typeof C!="number")return C;const _=$(f);if(typeof _!="number")return _;const E=Math.floor(+m.getValue()),b=Math.floor(+d.getValue());if(Number.isNaN(E)||Number.isNaN(b))return g.create(h.VALUE);if(![1,2,4].includes(E)||b<0||b>4||Math.floor(C)>=Math.floor(_))return g.create(h.NUM);let R=Lt(C,_,E);return R<0&&(R=0),y.create(R)}}class Jg extends p{constructor(){super(...arguments);A(this,"minParams",6);A(this,"maxParams",6)}calculate(e,t,r,n,s,a){const{isError:o,errorObject:c,variants:l}=W(e,t,r,n,s,a);if(o)return c;const[f,m,d,C,_,E]=l,b=+f.getValue(),R=+m.getValue(),N=+d.getValue(),V=+C.getValue(),M=+_.getValue(),D=+E.getValue();return Number.isNaN(b)||Number.isNaN(R)||Number.isNaN(N)||Number.isNaN(V)||Number.isNaN(M)||Number.isNaN(D)?g.create(h.VALUE):b<=0||R<=0||N<=0||V<1||M<1||V>M||V>R||M>R||![0,1].includes(D)?g.create(h.NUM):Math.trunc(V)!==V&&Math.trunc(M)!==M&&Math.trunc(V)===Math.trunc(M)?y.create(0):this._getResult(b,R,N,V,M,D)}_getResult(e,t,r,n,s,a){const o=Ur(e,t,r,0,a);let c=0,l=Math.ceil(n);l===1&&(a===0&&(c=-r),l++);let f=!1;for(let m=l;m<=s;m++){const d=a===1?qt(e,m-2,o,r,1):qt(e,m-1,o,r,0);if(d===0){f=!0;break}c+=a===1?d-o:d}return c*=e,(c<o*(s-n+1)||f)&&(c=o*(s-n+1)),y.create(c)}}class e1 extends p{constructor(){super(...arguments);A(this,"minParams",6);A(this,"maxParams",6)}calculate(e,t,r,n,s,a){const{isError:o,errorObject:c,variants:l}=W(e,t,r,n,s,a);if(o)return c;const[f,m,d,C,_,E]=l,b=+f.getValue(),R=+m.getValue(),N=+d.getValue(),V=+C.getValue(),M=+_.getValue(),D=+E.getValue();return Number.isNaN(b)||Number.isNaN(R)||Number.isNaN(N)||Number.isNaN(V)||Number.isNaN(M)||Number.isNaN(D)?g.create(h.VALUE):b<=0||R<=0||N<=0||V<1||M<1||V>M||![0,1].includes(D)?g.create(h.NUM):Math.trunc(V)!==V&&Math.trunc(M)!==M&&Math.trunc(V)===Math.trunc(M)?y.create(0):this._getResult(b,R,N,V,M,D)}_getResult(e,t,r,n,s,a){const o=Ur(e,t,r,0,a);let c=0,l=Math.ceil(n);l===1&&(c=a===0?o+r*e:o,l++);for(let f=l;f<=s;f++)c+=a===1?o-(qt(e,f-2,o,r,1)-o)*e:o-qt(e,f-1,o,r,0)*e;return y.create(c)}}class t1 extends p{constructor(){super(...arguments);A(this,"minParams",4);A(this,"maxParams",5);A(this,"needsLocale",!0)}calculate(e,t,r,n,s){let a=s!=null?s:y.create(12);a.isNull()&&(a=y.create(12));const o=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1,a.isArray()?a.getRowCount():1),c=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1,a.isArray()?a.getColumnCount():1),l=O(o,c,e,g.create(h.NA)),f=O(o,c,t,g.create(h.NA)),m=O(o,c,r,g.create(h.NA)),d=O(o,c,n,g.create(h.NA)),C=O(o,c,a,g.create(h.NA)),_=l.map((E,b,R)=>{const N=f.get(b,R),V=m.get(b,R),M=d.get(b,R),D=C.get(b,R),{isError:L,errorObject:P,variants:j}=k(E,N,V,M,D);if(L)return P;const[F,v,Y,q,se]=j,te=+F.getValue(),Q=+v.getValue(),le=+Y.getValue();let Ce=+q.getValue();const ye=Math.floor(+se.getValue());return te<0||Q<0||le<=0||Ce<=0||Math.floor(Ce)>Math.floor(le)||ye<1||ye>12?g.create(h.NUM):(Ce<1&&(Ce=1),Ce=Math.floor(Ce),this._getResult(te,Q,le,Ce,ye,b,R))});return o===1&&c===1?_.get(0,0):_}_getResult(e,t,r,n,s,a,o){const c=+(1-(t/e)**(1/r)).toFixed(3),l=e*c*s/12;let f=l,m=0;const d=n===r?r-1:n;for(let _=2;_<=d;_++)m=(e-f)*c,f+=m;let C;return n===1?C=l:n===r?C=(e-f)*c:C=m,Number.isNaN(C)||!Number.isFinite(C)?g.create(h.NUM):a===0&&o===0?y.create(C,He(this.getLocale())):y.create(C)}}class r1 extends p{constructor(){super(...arguments);A(this,"minParams",4);A(this,"maxParams",5);A(this,"needsLocale",!0)}calculate(e,t,r,n,s){let a=s!=null?s:y.create(2);a.isNull()&&(a=y.create(2));const o=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1,a.isArray()?a.getRowCount():1),c=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1,a.isArray()?a.getColumnCount():1),l=O(o,c,e,g.create(h.NA)),f=O(o,c,t,g.create(h.NA)),m=O(o,c,r,g.create(h.NA)),d=O(o,c,n,g.create(h.NA)),C=O(o,c,a,g.create(h.NA)),_=l.map((E,b,R)=>{const N=f.get(b,R),V=m.get(b,R),M=d.get(b,R),D=C.get(b,R),{isError:L,errorObject:P,variants:j}=k(E,N,V,M,D);if(L)return P;const[F,v,Y,q,se]=j,te=+F.getValue(),Q=+v.getValue(),le=+Y.getValue(),Ce=+q.getValue(),ye=+se.getValue();if(te<0||Q<0||le<=0||Ce<=0||Ce>le||ye<=0)return g.create(h.NUM);const Ne=ba(te,Q,le,Ce,ye);return Number.isNaN(Ne)||!Number.isFinite(Ne)?g.create(h.NUM):b===0&&R===0?y.create(Ne,He(this.getLocale())):y.create(Ne)});return o===1&&c===1?_.get(0,0):_}}class n1 extends p{constructor(){super(...arguments);A(this,"minParams",4);A(this,"maxParams",5)}calculate(e,t,r,n,s){const a=s!=null?s:y.create(0),{isError:o,errorObject:c,variants:l}=W(e,t,r,n,a);if(o)return c;const[f,m,d,C,_]=l,E=$(f);if(typeof E!="number")return E;const b=$(m);if(typeof b!="number")return b;const R=+d.getValue(),N=+C.getValue(),V=Math.floor(+_.getValue());if(Number.isNaN(R)||Number.isNaN(N)||Number.isNaN(V))return g.create(h.VALUE);if(R<=0||N<=0||V<0||V>4||Math.floor(E)>=Math.floor(b))return g.create(h.NUM);const{days:M,yearDays:D}=_e(E,b,V),L=(N-R)/N*(D/M);return y.create(L)}}class s1 extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const{isError:r,errorObject:n,variants:s}=W(e,t);if(r)return n;const[a,o]=s,c=+a.getValue();let l=Math.floor(+o.getValue());if(Number.isNaN(c)||Number.isNaN(l))return g.create(h.VALUE);if(l<0)return g.create(h.NUM);if(l>=0&&l<1)return g.create(h.DIV_BY_ZERO);l=Number.parseInt(`${l}`,10);let f=Number.parseInt(`${c}`,10);f+=c%1*10**Math.ceil(Math.log(l)/Math.LN10)/l;const m=10**(Math.ceil(Math.log(l)/Math.LN2)+1);return f=Math.round(f*m)/m,y.create(f)}}class a1 extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const{isError:r,errorObject:n,variants:s}=W(e,t);if(r)return n;const[a,o]=s,c=+a.getValue();let l=Math.floor(+o.getValue());if(Number.isNaN(c)||Number.isNaN(l))return g.create(h.VALUE);if(l<0)return g.create(h.NUM);if(l>=0&&l<1)return g.create(h.DIV_BY_ZERO);l=Number.parseInt(`${l}`,10);let f=Number.parseInt(`${c}`,10);return f+=c%1*10**-Math.ceil(Math.log(l)/Math.LN10)*l,y.create(f)}}class i1 extends p{constructor(){super(...arguments);A(this,"minParams",5);A(this,"maxParams",6)}calculate(e,t,r,n,s,a){let o=a!=null?a:y.create(0);o.isNull()&&(o=y.create(0));const{isError:c,errorObject:l,variants:f}=ve(e,t,r,n,s,o);if(c)return l;const[m,d,C,_,E,b]=f,R=$(m);if(typeof R!="number")return R;const N=$(d);if(typeof N!="number")return N;const V=+C.getValue(),M=+_.getValue(),D=Math.floor(+E.getValue()),L=Math.floor(+b.getValue());if(Number.isNaN(V)||Number.isNaN(M)||Number.isNaN(D)||Number.isNaN(L))return g.create(h.VALUE);if(V<0||M<0||![1,2,4].includes(D)||L<0||L>4||Math.floor(R)>=Math.floor(N)||R<=0||N<=366)return g.create(h.NUM);const P=ou(R,N,V,M,D,L);return y.create(P)}}class o1 extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const{isError:r,errorObject:n,variants:s}=W(e,t);if(r)return n;const[a,o]=s,c=+a.getValue();let l=Math.floor(+o.getValue());if(Number.isNaN(c)||Number.isNaN(l))return g.create(h.VALUE);if(c<=0||l<1)return g.create(h.NUM);l=Number.parseInt(`${l}`,10);const f=(1+c/l)**l-1;return y.create(f)}}class u1 extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",5);A(this,"needsLocale",!0)}calculate(e,t,r,n,s){const a=n!=null?n:y.create(0),o=s!=null?s:y.create(0),c=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,a.isArray()?a.getRowCount():1,o.isArray()?o.getRowCount():1),l=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,a.isArray()?a.getColumnCount():1,o.isArray()?o.getColumnCount():1),f=O(c,l,e,g.create(h.NA)),m=O(c,l,t,g.create(h.NA)),d=O(c,l,r,g.create(h.NA)),C=O(c,l,a,g.create(h.NA)),_=O(c,l,o,g.create(h.NA)),E=f.map((b,R,N)=>{const V=m.get(R,N),M=d.get(R,N),D=C.get(R,N),L=_.get(R,N),{isError:P,errorObject:j,variants:F}=k(b,V,M,D,L);if(P)return j;const[v,Y,q,se,te]=F,Q=+v.getValue(),le=+Y.getValue(),Ce=+q.getValue(),ye=+se.getValue(),Ne=+te.getValue(),de=qt(Q,le,Ce,ye,Ne?1:0);return Number.isNaN(de)||!Number.isFinite(de)?g.create(h.NUM):R===0&&N===0?y.create(de,He(this.getLocale())):y.create(de)});return c===1&&l===1?E.get(0,0):E}}class c1 extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const{isError:r,errorObject:n,variants:s}=W(e);if(r)return n;const[a]=s,o=+a.getValue();if(Number.isNaN(o))return g.create(h.VALUE);let c=o;if(t.isArray()){const l=t.getArrayValue().flat();for(let f=0;f<l.length;f++){const m=l[f];if(m.isBoolean())return g.create(h.VALUE);const d=+m.getValue();if(Number.isNaN(d))return g.create(h.VALUE);c*=1+d}}else{if(t.isBoolean())return g.create(h.VALUE);const l=+t.getValue();if(Number.isNaN(l))return g.create(h.VALUE);c*=1+l}return y.create(c)}}class l1 extends p{constructor(){super(...arguments);A(this,"minParams",4);A(this,"maxParams",5)}calculate(e,t,r,n,s){const a=s!=null?s:y.create(0),{isError:o,errorObject:c,variants:l}=W(e,t,r,n,a);if(o)return c;const[f,m,d,C,_]=l,E=$(f);if(typeof E!="number")return E;const b=$(m);if(typeof b!="number")return b;const R=+d.getValue(),N=+C.getValue(),V=Math.floor(+_.getValue());if(Number.isNaN(R)||Number.isNaN(N)||Number.isNaN(V))return g.create(h.VALUE);if(R<=0||N<=0||V<0||V>4||Math.floor(E)>=Math.floor(b))return g.create(h.NUM);const{days:M,yearDays:D}=_e(E,b,V),L=(N-R)/R*(D/M);return y.create(L)}}class f1 extends p{constructor(){super(...arguments);A(this,"minParams",4);A(this,"maxParams",6);A(this,"needsLocale",!0)}calculate(e,t,r,n,s,a){const o=s!=null?s:y.create(0),c=a!=null?a:y.create(0),l=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1,o.isArray()?o.getRowCount():1,c.isArray()?c.getRowCount():1),f=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1,o.isArray()?o.getColumnCount():1,c.isArray()?c.getColumnCount():1),m=O(l,f,e,g.create(h.NA)),d=O(l,f,t,g.create(h.NA)),C=O(l,f,r,g.create(h.NA)),_=O(l,f,n,g.create(h.NA)),E=O(l,f,o,g.create(h.NA)),b=O(l,f,c,g.create(h.NA)),R=m.map((N,V,M)=>{const D=d.get(V,M),L=C.get(V,M),P=_.get(V,M),j=E.get(V,M),F=b.get(V,M),{isError:v,errorObject:Y,variants:q}=k(N,D,L,P,j,F);if(v)return Y;const[se,te,Q,le,Ce,ye]=q,Ne=+se.getValue(),de=+te.getValue(),Be=+Q.getValue(),Pt=+le.getValue(),hr=+Ce.getValue(),jt=+ye.getValue();if(de<1||Math.floor(de)>Math.ceil(Be))return g.create(h.NUM);const st=uu(Ne,de,Be,Pt,hr,jt?1:0);return Number.isNaN(st)||!Number.isFinite(st)?g.create(h.NUM):V===0&&M===0?y.create(st,He(this.getLocale())):y.create(st)});return l===1&&f===1?R.get(0,0):R}}class m1 extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",2)}calculate(e,t){let r=t!=null?t:y.create(.1);return r.isNull()&&(r=y.create(.1)),r.isArray()?r.map((n,s,a)=>this._handleSingleObject(e,n,s,a)):this._handleSingleObject(e,r)}_handleSingleObject(e,t,r=0,n=0){if(e.isError())return e;if(t.isError())return t;if(e.isNull())return g.create(h.VALUE);if(!e.isArray())return g.create(h.NUM);const{_values:s,valuesHasError:a}=this._getValues(e);if(a)return g.create(h.VALUE);let o=t;if(o.isString()&&(o=o.convertToNumberObjectValue(),o.isError()))return o;const c=+o.getValue(),{positive:l,negative:f}=this._checkValues(s);if(!l||!f)return g.create(h.NUM);const m=Ea(c,d=>cu(d,s));return typeof m!="number"?m:r===0&&n===0?y.create(m,"0%"):y.create(m)}_getValues(e){const t=[];let r=!1;return e.iterator(n=>{const s=n;if(s.isError())return r=!0,!1;if(s.isNull()||s.isBoolean())return!0;const a=+s.getValue();if(Number.isNaN(a))return!0;t.push(a)}),{_values:t,valuesHasError:r}}_checkValues(e){let t=!1,r=!1;for(let n=0;n<e.length;n++)e[n]>0&&(t=!0),e[n]<0&&(r=!0);return{positive:t,negative:r}}}class h1 extends p{constructor(){super(...arguments);A(this,"minParams",4);A(this,"maxParams",4)}calculate(e,t,r,n){const s=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1),o=O(s,a,e,g.create(h.NA)),c=O(s,a,t,g.create(h.NA)),l=O(s,a,r,g.create(h.NA)),f=O(s,a,n,g.create(h.NA)),m=o.map((d,C,_)=>{const E=c.get(C,_),b=l.get(C,_),R=f.get(C,_),{isError:N,errorObject:V,variants:M}=k(d,E,b,R);if(N)return V;const[D,L,P,j]=M,F=+D.getValue(),v=+L.getValue(),Y=+P.getValue(),q=+j.getValue();if(Y===0)return g.create(h.DIV_BY_ZERO);const se=q*F*(v/Y-1);return y.create(se)});return s===1&&a===1?m.get(0,0):m}}class g1 extends p{constructor(){super(...arguments);A(this,"minParams",5);A(this,"maxParams",6)}calculate(e,t,r,n,s,a){let o=a!=null?a:y.create(0);o.isNull()&&(o=y.create(0));const{isError:c,errorObject:l,variants:f}=ve(e,t,r,n,s,o);if(c)return l;const[m,d,C,_,E,b]=f,R=$(m);if(typeof R!="number")return R;const N=$(d);if(typeof N!="number")return N;const V=+C.getValue(),M=+_.getValue(),D=Math.floor(+E.getValue()),L=Math.floor(+b.getValue());if(Number.isNaN(V)||Number.isNaN(M)||Number.isNaN(D)||Number.isNaN(L))return g.create(h.VALUE);if(V<0||M<0||![1,2,4].includes(D)||L<0||L>4||Math.floor(R)>=Math.floor(N))return g.create(h.NUM);let P=ou(R,N,V,M,D,L);return P/=1+M/D,y.create(P)}}class d1 extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const{_values:n,numberValues:s,positive:a,negative:o}=this._getValues(e),c=Math.max(t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),l=Math.max(t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),f=O(c,l,t,g.create(h.NA)),m=O(c,l,r,g.create(h.NA)),d=f.map((C,_,E)=>{const b=m.get(_,E);if(e.isError())return e;if(b.isError())return b;if(n.isError())return n;if(!a||!o)return g.create(h.DIV_BY_ZERO);const R=+C.getValue(),N=+b.getValue();if(Number.isNaN(R)||Number.isNaN(N))return g.create(h.VALUE);if(N===-1)return g.create(h.DIV_BY_ZERO);const V=this._getResult(s,R,N);return _===0&&E===0?y.create(V,"0%"):y.create(V)});return c===1&&l===1?d.get(0,0):d}_getValues(e){let t=e,r=[],n=!1,s=!1;if(!e.isError())if(e.isNull())t=g.create(h.VALUE);else if(!e.isArray())t=g.create(h.DIV_BY_ZERO);else{const{numberValues:a,valuesHasError:o,errorObject:c,positive:l,negative:f}=this._checkValues(e);o&&(t=c),r=a,n=l,s=f}return{_values:t,numberValues:r,positive:n,negative:s}}_checkValues(e){const t=[];let r=!1,n=g.create(h.VALUE),s=!1,a=!1;return e.iterator(o=>{const c=o;if(c.isError())return r=!0,n=c,!1;if(c.isNull()||c.isBoolean())return!0;const l=+c.getValue();if(Number.isNaN(l))return!0;l>0&&(s=!0),l<0&&(a=!0),t.push(l)}),{numberValues:t,valuesHasError:r,errorObject:n,positive:s,negative:a}}_getResult(e,t,r){const n=e.length,s=[],a=[];for(let d=0;d<n;d++)e[d]>0?a.push(e[d]):e[d]<0&&s.push(e[d]);const o=this._npv(r,e,"positive"),c=this._npv(t,e,"negative"),l=-o*(1+r)**n,f=c*(1+t);return(l/f)**(1/(n-1))-1}_npv(e,t,r){let n=0;for(let s=1;s<=t.length;s++){const a=t[s-1];(r==="positive"&&a>0||r==="negative"&&a<0)&&(n+=a/(1+e)**s)}return n}}class C1 extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const{isError:r,errorObject:n,variants:s}=W(e,t);if(r)return n;const[a,o]=s,c=+a.getValue();let l=Math.floor(+o.getValue());if(Number.isNaN(c)||Number.isNaN(l))return g.create(h.VALUE);if(c<=0||l<1)return g.create(h.NUM);l=Number.parseInt(`${l}`,10);const f=((c+1)**(1/l)-1)*l;return y.create(f)}}class _1 extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",5)}calculate(e,t,r,n,s){const a=n!=null?n:y.create(0),o=s!=null?s:y.create(0),c=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,a.isArray()?a.getRowCount():1,o.isArray()?o.getRowCount():1),l=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,a.isArray()?a.getColumnCount():1,o.isArray()?o.getColumnCount():1),f=O(c,l,e,g.create(h.NA)),m=O(c,l,t,g.create(h.NA)),d=O(c,l,r,g.create(h.NA)),C=O(c,l,a,g.create(h.NA)),_=O(c,l,o,g.create(h.NA)),E=f.map((b,R,N)=>{const V=m.get(R,N),M=d.get(R,N),D=C.get(R,N),L=_.get(R,N),{isError:P,errorObject:j,variants:F}=k(b,V,M,D,L);if(P)return j;const[v,Y,q,se,te]=F,Q=+v.getValue(),le=+Y.getValue(),Ce=+q.getValue(),ye=+se.getValue();let Ne=+te.getValue();if(Ne=Ne?1:0,Q===0&&le===0)return g.create(h.DIV_BY_ZERO);let de;if(Q===0)de=-(Ce+ye)/le;else{const Be=le*(1+Q*Ne)-ye*Q,Pt=Ce*Q+le*(1+Q*Ne);de=Math.log(Be/Pt)/Math.log(1+Q)}return Number.isNaN(de)||!Number.isFinite(de)?g.create(h.NUM):y.create(de)});return c===1&&l===1?E.get(0,0):E}}class A1 extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",255);A(this,"needsLocale",!0)}calculate(e,...t){if(e.isError())return e;const{isError:r,errorObject:n,values:s}=this._getValues(t);return e.isArray()?e.map((a,o,c)=>this._handleSingleObject(a,r,n,s,o,c)):this._handleSingleObject(e,r,n,s)}_handleSingleObject(e,t,r,n,s=0,a=0){let o=e;if(o.isString()&&(o=o.convertToNumberObjectValue()),o.isError())return o;if(t)return r;const c=+e.getValue(),l=cu(c,n);return Number.isNaN(l)||Math.abs(l)===1/0?g.create(h.DIV_BY_ZERO):s===0&&a===0?y.create(l,He(this.getLocale())):y.create(l)}_getValues(e){const t=[];for(let r=0;r<e.length;r++){const n=e[r];if(n.isError())return{isError:!0,errorObject:n};if(n.isArray()){let s=!1,a=g.create(h.VALUE);if(n.iterator(o=>{const c=o;if(c.isError())return s=!0,a=c,!1;if(c.isNull()||c.isBoolean())return!0;const l=+c.getValue();if(Number.isNaN(l))return!0;t.push(l)}),s)return{isError:s,errorObject:a}}else{const s=+n.getValue();if(Number.isNaN(s))return{isError:!0,errorObject:g.create(h.VALUE)};t.push(s)}}return{isError:!1,values:t}}}class E1 extends p{constructor(){super(...arguments);A(this,"minParams",8);A(this,"maxParams",9)}calculate(e,t,r,n,s,a,o,c,l){let f=l!=null?l:y.create(0);f.isNull()&&(f=y.create(0));const{isError:m,errorObject:d,variants:C}=ve(e,t,r,n,s,a,o,c,f);if(m)return d;const[_,E,b,R,N,V,M,D,L]=C,P=$(_);if(typeof P!="number")return P;const j=$(E);if(typeof j!="number")return j;const F=$(b);if(typeof F!="number")return F;const v=$(R);if(typeof v!="number")return v;const Y=+N.getValue(),q=+V.getValue(),se=+M.getValue(),te=Math.floor(+D.getValue()),Q=Math.floor(+L.getValue());if(Number.isNaN(Y)||Number.isNaN(q)||Number.isNaN(se)||Number.isNaN(te)||Number.isNaN(Q))return g.create(h.VALUE);if(Y<0||q<0||se<=0||![1,2,4].includes(te)||Q<0||Q>4||!this._validDate(j,v,P,F,te))return g.create(h.NUM);const le=lu(P,j,F,v,Y,q,se,te,Q);return y.create(le)}_validDate(e,t,r,n,s){return this._getDateCorrectOrder(e,t,r,n)&&fu(e,t,s)&&mr(n,e,s)}_getDateCorrectOrder(e,t,r,n){return Math.floor(e)>Math.floor(t)&&Math.floor(t)>Math.floor(r)&&Math.floor(r)>Math.floor(n)}}class b1 extends p{constructor(){super(...arguments);A(this,"minParams",8);A(this,"maxParams",9)}calculate(e,t,r,n,s,a,o,c,l){let f=l!=null?l:y.create(0);f.isNull()&&(f=y.create(0));const{isError:m,errorObject:d,variants:C}=ve(e,t,r,n,s,a,o,c,f);if(m)return d;const[_,E,b,R,N,V,M,D,L]=C,P=$(_);if(typeof P!="number")return P;const j=$(E);if(typeof j!="number")return j;const F=$(b);if(typeof F!="number")return F;const v=$(R);if(typeof v!="number")return v;const Y=+N.getValue(),q=+V.getValue(),se=+M.getValue(),te=Math.floor(+D.getValue()),Q=Math.floor(+L.getValue());return Number.isNaN(Y)||Number.isNaN(q)||Number.isNaN(se)||Number.isNaN(te)||Number.isNaN(Q)?g.create(h.VALUE):Y<0||q<=0||se<=0||![1,2,4].includes(te)||Q<0||Q>4||!this._validDate(j,v,P,F,te)?g.create(h.NUM):this._getResult(P,j,F,v,Y,q,se,te,Q)}_validDate(e,t,r,n,s){return this._getDateCorrectOrder(e,t,r,n)&&fu(e,t,s)&&mr(n,e,s)}_getDateCorrectOrder(e,t,r,n){return Math.floor(e)>Math.floor(t)&&Math.floor(t)>Math.floor(r)&&Math.floor(r)>Math.floor(n)}_getResult(e,t,r,n,s,a,o,c,l){const{days:f}=_e(e,t,l),m=(s*f*100-(a-100))/((a-100)*.25*(1+2*f)+f*100);function d(_){return a-lu(e,t,r,n,s,_,o,c,l)}const C=Ea(m,_=>d(_));return typeof C!="number"?C:y.create(C)}}class y1 extends p{constructor(){super(...arguments);A(this,"minParams",7);A(this,"maxParams",8)}calculate(e,t,r,n,s,a,o,c){let l=c!=null?c:y.create(0);l.isNull()&&(l=y.create(0));const{isError:f,errorObject:m,variants:d}=ve(e,t,r,n,s,a,o,l);if(f)return m;const[C,_,E,b,R,N,V,M]=d,D=$(C);if(typeof D!="number")return D;const L=$(_);if(typeof L!="number")return L;const P=$(E);if(typeof P!="number")return P;const j=+b.getValue(),F=+R.getValue(),v=+N.getValue(),Y=Math.floor(+V.getValue()),q=Math.floor(+M.getValue());if(Number.isNaN(j)||Number.isNaN(F)||Number.isNaN(v)||Number.isNaN(Y)||Number.isNaN(q))return g.create(h.VALUE);if(j<0||F<0||v<=0||![1,2,4].includes(Y)||q<0||q>4||!this._validDate(L,D,P,Y))return g.create(h.NUM);const se=this._getResult(D,L,P,j,F,v,Y,q);return y.create(se)}_validDate(e,t,r,n){return Math.floor(e)>Math.floor(t)&&Math.floor(t)>Math.floor(r)&&mr(r,e,n)}_getResult(e,t,r,n,s,a,o,c){const l=this._getCoupDate(t,r,o),f=this._getFrac(r,e,l,o,c),m=this._getFrac(r,t,l,o,c),d=this._getFrac(e,t,l,o,c);return(a*o+100*n*(m-f*(1+s*d/o)))/(s*d+o)}_getCoupDate(e,t,r){const n=ne(e),s=ne(t);for(s.setUTCFullYear(n.getUTCFullYear()),s>n&&s.setUTCFullYear(s.getUTCFullYear()-1);s<n;)s.setUTCMonth(s.getUTCMonth()+12/r);return be(s)}_getFrac(e,t,r,n,s){const a=ne(e),o=ne(t),c=ne(r);for(c.setUTCFullYear(a.getUTCFullYear()),c<a&&c.setUTCFullYear(c.getUTCFullYear()+1);c>a;)c.setUTCMonth(c.getUTCMonth()-12/n);let l=be(c);c.setUTCMonth(c.getUTCMonth()+12/n);let f=be(c);if(f>=t){const{days:N}=_e(e,t,s),V=Qe(l,f,n,s);return N/V}const{days:m}=_e(e,f,s),d=Qe(l,f,n,s);let C=m/d;const _=ne(f),E=ne(f);for(E.setUTCMonth(E.getUTCMonth()+12/n);E<o;)_.setUTCMonth(_.getUTCMonth()+12/n),E.setUTCMonth(E.getUTCMonth()+12/n),C+=1;l=be(_),f=be(E);const{days:b}=_e(l,t,s),R=Qe(l,f,n,s);return C+=b/R,C}}class R1 extends p{constructor(){super(...arguments);A(this,"minParams",8);A(this,"maxParams",9)}calculate(e,t,r,n,s,a,o,c){let l=c!=null?c:y.create(0);l.isNull()&&(l=y.create(0));const{isError:f,errorObject:m,variants:d}=ve(e,t,r,n,s,a,o,l);if(f)return m;const[C,_,E,b,R,N,V,M]=d,D=$(C);if(typeof D!="number")return D;const L=$(_);if(typeof L!="number")return L;const P=$(E);if(typeof P!="number")return P;const j=+b.getValue(),F=+R.getValue(),v=+N.getValue(),Y=Math.floor(+V.getValue()),q=Math.floor(+M.getValue());if(Number.isNaN(j)||Number.isNaN(F)||Number.isNaN(v)||Number.isNaN(Y)||Number.isNaN(q))return g.create(h.VALUE);if(j<0||F<=0||v<=0||![1,2,4].includes(Y)||q<0||q>4||!this._validDate(L,D,P,Y))return g.create(h.NUM);const se=this._getResult(D,L,P,j,F,v,Y,q);return y.create(se)}_validDate(e,t,r,n){return Math.floor(e)>Math.floor(t)&&Math.floor(t)>Math.floor(r)&&mr(r,e,n)}_getResult(e,t,r,n,s,a,o,c){const l=this._getCoupDate(t,r,o),f=this._getFrac(r,e,l,o,c),m=this._getFrac(r,t,l,o,c),d=this._getFrac(e,t,l,o,c);return(o*(a-s)+100*n*(m-f))/(d*s+100*n*f*d/o)}_getCoupDate(e,t,r){const n=ne(e),s=ne(t);for(s.setUTCFullYear(n.getUTCFullYear()),s>n&&s.setUTCFullYear(s.getUTCFullYear()-1);s<n;)s.setUTCMonth(s.getUTCMonth()+12/r);return be(s)}_getFrac(e,t,r,n,s){const a=ne(e),o=ne(t),c=ne(r);for(c.setUTCFullYear(a.getUTCFullYear()),c<a&&c.setUTCFullYear(c.getUTCFullYear()+1);c>a;)c.setUTCMonth(c.getUTCMonth()-12/n);let l=be(c);c.setUTCMonth(c.getUTCMonth()+12/n);let f=be(c);if(f>=t){const{days:N}=_e(e,t,s),V=Qe(l,f,n,s);return N/V}const{days:m}=_e(e,f,s),d=Qe(l,f,n,s);let C=m/d;const _=ne(f),E=ne(f);for(E.setUTCMonth(E.getUTCMonth()+12/n);E<o;)_.setUTCMonth(_.getUTCMonth()+12/n),E.setUTCMonth(E.getUTCMonth()+12/n),C+=1;l=be(_),f=be(E);const{days:b}=_e(l,t,s),R=Qe(l,f,n,s);return C+=b/R,C}}class N1 extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),o=O(n,s,t,g.create(h.NA)),c=O(n,s,r,g.create(h.NA)),l=a.map((f,m,d)=>{const C=o.get(m,d),_=c.get(m,d),{isError:E,errorObject:b,variants:R}=k(f,C,_);if(E)return b;const[N,V,M]=R,D=+N.getValue(),L=+V.getValue(),P=+M.getValue();if(D<=-1)return g.create(h.NUM);const j=(Math.log(P)-Math.log(L))/Math.log(1+D);return Number.isNaN(j)||!Number.isFinite(j)?g.create(h.NUM):y.create(j)});return n===1&&s===1?l.get(0,0):l}}class p1 extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",5);A(this,"needsLocale",!0)}calculate(e,t,r,n,s){const a=n!=null?n:y.create(0),o=s!=null?s:y.create(0),c=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,a.isArray()?a.getRowCount():1,o.isArray()?o.getRowCount():1),l=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,a.isArray()?a.getColumnCount():1,o.isArray()?o.getColumnCount():1),f=O(c,l,e,g.create(h.NA)),m=O(c,l,t,g.create(h.NA)),d=O(c,l,r,g.create(h.NA)),C=O(c,l,a,g.create(h.NA)),_=O(c,l,o,g.create(h.NA)),E=f.map((b,R,N)=>{const V=m.get(R,N),M=d.get(R,N),D=C.get(R,N),L=_.get(R,N),{isError:P,errorObject:j,variants:F}=k(b,V,M,D,L);if(P)return j;const[v,Y,q,se,te]=F,Q=+v.getValue(),le=+Y.getValue(),Ce=+q.getValue(),ye=+se.getValue(),Ne=+te.getValue();if(Q<=-1)return g.create(h.NUM);const de=Ur(Q,le,Ce,ye,Ne?1:0);return Number.isNaN(de)||!Number.isFinite(de)?g.create(h.NUM):R===0&&N===0?y.create(de,He(this.getLocale())):y.create(de)});return c===1&&l===1?E.get(0,0):E}}class V1 extends p{constructor(){super(...arguments);A(this,"minParams",4);A(this,"maxParams",6);A(this,"needsLocale",!0)}calculate(e,t,r,n,s,a){const o=s!=null?s:y.create(0),c=a!=null?a:y.create(0),l=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1,o.isArray()?o.getRowCount():1,c.isArray()?c.getRowCount():1),f=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1,o.isArray()?o.getColumnCount():1,c.isArray()?c.getColumnCount():1),m=O(l,f,e,g.create(h.NA)),d=O(l,f,t,g.create(h.NA)),C=O(l,f,r,g.create(h.NA)),_=O(l,f,n,g.create(h.NA)),E=O(l,f,o,g.create(h.NA)),b=O(l,f,c,g.create(h.NA)),R=m.map((N,V,M)=>{const D=d.get(V,M),L=C.get(V,M),P=_.get(V,M),j=E.get(V,M),F=b.get(V,M),{isError:v,errorObject:Y,variants:q}=k(N,D,L,P,j,F);if(v)return Y;const[se,te,Q,le,Ce,ye]=q,Ne=+se.getValue(),de=+te.getValue(),Be=+Q.getValue(),Pt=+le.getValue(),hr=+Ce.getValue(),jt=+ye.getValue();if(de<1||Math.floor(de)>Math.ceil(Be)||de-Be>=1)return g.create(h.NUM);const st=Ur(Ne,Be,Pt,hr,jt?1:0)-uu(Ne,de,Be,Pt,hr,jt?1:0);return Number.isNaN(st)||!Number.isFinite(st)?g.create(h.NUM):V===0&&M===0?y.create(st,He(this.getLocale())):y.create(st)});return l===1&&f===1?R.get(0,0):R}}class O1 extends p{constructor(){super(...arguments);A(this,"minParams",6);A(this,"maxParams",7)}calculate(e,t,r,n,s,a,o){let c=o!=null?o:y.create(0);c.isNull()&&(c=y.create(0));const{isError:l,errorObject:f,variants:m}=ve(e,t,r,n,s,a,c);if(l)return f;const[d,C,_,E,b,R,N]=m,V=$(d);if(typeof V!="number")return V;const M=$(C);if(typeof M!="number")return M;const D=+_.getValue(),L=+E.getValue(),P=+b.getValue(),j=Math.floor(+R.getValue()),F=Math.floor(+N.getValue());if(Number.isNaN(D)||Number.isNaN(L)||Number.isNaN(P)||Number.isNaN(j)||Number.isNaN(F))return g.create(h.VALUE);if(D<0||L<0||P<=0||![1,2,4].includes(j)||F<0||F>4||V>=M||!mr(V,M,j))return g.create(h.NUM);const v=$n(V,M,D,L,P,j,F);return y.create(v)}}class S1 extends p{constructor(){super(...arguments);A(this,"minParams",4);A(this,"maxParams",5)}calculate(e,t,r,n,s){let a=s!=null?s:y.create(0);a.isNull()&&(a=y.create(0));const{isError:o,errorObject:c,variants:l}=ve(e,t,r,n,a);if(o)return c;const[f,m,d,C,_]=l,E=$(f);if(typeof E!="number")return E;const b=$(m);if(typeof b!="number")return b;const R=+d.getValue(),N=+C.getValue(),V=Math.floor(+_.getValue());if(Number.isNaN(R)||Number.isNaN(N)||Number.isNaN(V))return g.create(h.VALUE);if(R<=0||N<=0||V<0||V>4||E>=b)return g.create(h.NUM);const{days:M,yearDays:D}=_e(E,b,V),L=N-R*N*M/D;return y.create(L)}}class M1 extends p{constructor(){super(...arguments);A(this,"minParams",5);A(this,"maxParams",6)}calculate(e,t,r,n,s,a){let o=a!=null?a:y.create(0);o.isNull()&&(o=y.create(0));const{isError:c,errorObject:l,variants:f}=ve(e,t,r,n,s,o);if(c)return l;const[m,d,C,_,E,b]=f,R=$(m);if(typeof R!="number")return R;const N=$(d);if(typeof N!="number")return N;const V=$(C);if(typeof V!="number")return V;const M=+_.getValue(),D=+E.getValue(),L=Math.floor(+b.getValue());if(Number.isNaN(M)||Number.isNaN(D)||Number.isNaN(L))return g.create(h.VALUE);const P=this._getDateCorrectOrder(N,R,V);if(M<0||D<0||L<0||L>4||!P)return g.create(h.NUM);const j=nu(R,L),{days:F}=_e(R,N,L),{days:v}=_e(V,N,L),{days:Y}=_e(V,R,L),q=(100+v/j*M*100)/(1+F/j*D)-Y/j*M*100;return y.create(q)}_getDateCorrectOrder(e,t,r){return Math.floor(e)>Math.floor(t)&&Math.floor(t)>Math.floor(r)}}class D1 extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",5);A(this,"needsLocale",!0)}calculate(e,t,r,n,s){const a=n!=null?n:y.create(0),o=s!=null?s:y.create(0),c=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,a.isArray()?a.getRowCount():1,o.isArray()?o.getRowCount():1),l=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,a.isArray()?a.getColumnCount():1,o.isArray()?o.getColumnCount():1),f=O(c,l,e,g.create(h.NA)),m=O(c,l,t,g.create(h.NA)),d=O(c,l,r,g.create(h.NA)),C=O(c,l,a,g.create(h.NA)),_=O(c,l,o,g.create(h.NA)),E=f.map((b,R,N)=>{const V=m.get(R,N),M=d.get(R,N),D=C.get(R,N),L=_.get(R,N),{isError:P,errorObject:j,variants:F}=k(b,V,M,D,L);if(P)return j;const[v,Y,q,se,te]=F,Q=+v.getValue(),le=+Y.getValue(),Ce=+q.getValue(),ye=+se.getValue();let Ne=+te.getValue();Ne=Ne?1:0;const de=Q===0?-Ce*le-ye:((1-(1+Q)**le)/Q*Ce*(1+Q*Ne)-ye)/(1+Q)**le;return Number.isNaN(de)||!Number.isFinite(de)?g.create(h.NUM):R===0&&N===0?y.create(de,He(this.getLocale())):y.create(de)});return c===1&&l===1?E.get(0,0):E}}class w1 extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",6)}calculate(e,t,r,n,s,a){const o=n!=null?n:y.create(0),c=s!=null?s:y.create(0),l=a!=null?a:y.create(.1),f=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,o.isArray()?o.getRowCount():1,c.isArray()?c.getRowCount():1,l.isArray()?l.getRowCount():1),m=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,o.isArray()?o.getColumnCount():1,c.isArray()?c.getColumnCount():1,l.isArray()?l.getColumnCount():1),d=O(f,m,e,g.create(h.NA)),C=O(f,m,t,g.create(h.NA)),_=O(f,m,r,g.create(h.NA)),E=O(f,m,o,g.create(h.NA)),b=O(f,m,c,g.create(h.NA)),R=O(f,m,l,g.create(h.NA)),N=d.map((V,M,D)=>{const L=C.get(M,D),P=_.get(M,D),j=E.get(M,D),F=b.get(M,D),v=R.get(M,D),{isError:Y,errorObject:q,variants:se}=k(V,L,P,j,F,v);if(Y)return q;const[te,Q,le,Ce,ye,Ne]=se,de=+te.getValue(),Be=+Q.getValue(),Pt=+le.getValue(),hr=+Ce.getValue();let jt=+ye.getValue();const st=+Ne.getValue();return jt=jt?1:0,de<=0||Be>=0?g.create(h.NUM):this._getResult(de,Be,Pt,hr,jt,st,M,D)});return f===1&&m===1?N.get(0,0):N}_getResult(e,t,r,n,s,a,o,c){let m=a;for(let d=0;d<20;d++){if(m<=-1)return g.create(h.NUM);let C,_;if(Math.abs(m)<1e-10?C=r*(1+e*m)+t*(1+m*s)*e+n:(_=(1+m)**e,C=r*_+t*(1/m+s)*(_-1)+n),Math.abs(C)<1e-10)break;let E;if(Math.abs(m)<1e-10)E=r*e+t*s*e;else{_=(1+m)**e;const b=e*(1+m)**(e-1);E=r*b+t*(1/m+s)*b+t*(-1/(m*m))*(_-1)}m-=C/E}return o===0&&c===0?y.create(m,"0%"):y.create(m)}}class L1 extends p{constructor(){super(...arguments);A(this,"minParams",4);A(this,"maxParams",5)}calculate(e,t,r,n,s){let a=s!=null?s:y.create(0);a.isNull()&&(a=y.create(0));const{isError:o,errorObject:c,variants:l}=ve(e,t,r,n,a);if(o)return c;const[f,m,d,C,_]=l,E=$(f);if(typeof E!="number")return E;const b=$(m);if(typeof b!="number")return b;const R=+d.getValue(),N=+C.getValue(),V=Math.floor(+_.getValue());if(Number.isNaN(R)||Number.isNaN(N)||Number.isNaN(V))return g.create(h.VALUE);if(R<=0||N<=0||V<0||V>4||E>=b)return g.create(h.NUM);const{days:M,yearDays:D}=_e(E,b,V),L=R/(1-N*M/D);return L<0?g.create(h.NUM):y.create(L)}}class P1 extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",6)}calculate(e,t,r){const n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),o=O(n,s,t,g.create(h.NA)),c=O(n,s,r,g.create(h.NA)),l=a.map((f,m,d)=>{const C=o.get(m,d),_=c.get(m,d),{isError:E,errorObject:b,variants:R}=k(f,C,_);if(E)return b;const[N,V,M]=R,D=+N.getValue(),L=+V.getValue(),P=+M.getValue();if(D<=0)return g.create(h.NUM);if(L===0&&P===0)return y.create(0);const j=(P/L)**(1/D)-1;return Number.isNaN(j)||!Number.isFinite(j)||P/L<0?g.create(h.NUM):y.create(j)});return n===1&&s===1?l.get(0,0):l}}class j1 extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3);A(this,"needsLocale",!0)}calculate(e,t,r){const n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),o=O(n,s,t,g.create(h.NA)),c=O(n,s,r,g.create(h.NA)),l=a.map((f,m,d)=>{const C=o.get(m,d),_=c.get(m,d);if(C.isError())return C;if(_.isError())return _;const E=+f.getValue(),b=+C.getValue(),R=+_.getValue();if(Number.isNaN(E)||Number.isNaN(b)||Number.isNaN(R))return g.create(h.VALUE);if(R===0)return g.create(h.DIV_BY_ZERO);const N=(E-b)/R;return m===0&&d===0?y.create(N,He(this.getLocale())):y.create(N)});return n===1&&s===1?l.get(0,0):l}}class x1 extends p{constructor(){super(...arguments);A(this,"minParams",4);A(this,"maxParams",4);A(this,"needsLocale",!0)}calculate(e,t,r,n){const s=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1),o=O(s,a,e,g.create(h.NA)),c=O(s,a,t,g.create(h.NA)),l=O(s,a,r,g.create(h.NA)),f=O(s,a,n,g.create(h.NA)),m=o.map((d,C,_)=>{const E=c.get(C,_),b=l.get(C,_),R=f.get(C,_);if(E.isError())return E;if(b.isError())return b;if(R.isError())return R;const N=+d.getValue(),V=+E.getValue(),M=+b.getValue(),D=+R.getValue();if(Number.isNaN(N)||Number.isNaN(V)||Number.isNaN(M)||Number.isNaN(D))return g.create(h.VALUE);if(V<0||M<=0||D>M)return g.create(h.NUM);const L=(N-V)*(M-D+1)*2/(M*(M+1));return C===0&&_===0?y.create(L,He(this.getLocale())):y.create(L)});return s===1&&a===1?m.get(0,0):m}}class U1 extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const{isError:n,errorObject:s,variants:a}=ve(e,t,r);if(n)return s;const[o,c,l]=a,f=$(o);if(typeof f!="number")return f;const m=$(c);if(typeof m!="number")return m;const d=+l.getValue();if(Number.isNaN(d))return g.create(h.VALUE);if(d<=0||f>=m)return g.create(h.NUM);const C=Math.floor(m)-Math.floor(f),E=ne(f).getUTCFullYear(),b=In(E);if(C>b)return g.create(h.NUM);let R=365*d/(360-d*C);if(C>182){const N=100*(1-d*C/360),V=C/365;if(R=(-V+Math.sqrt(V*V-(V*2-1)*(1-100/N)))/(V-.5),Number.isNaN(R))return g.create(h.NUM)}return R<0?g.create(h.NUM):y.create(R)}}class v1 extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3);A(this,"needsLocale",!0)}calculate(e,t,r){const{isError:n,errorObject:s,variants:a}=ve(e,t,r);if(n)return s;const[o,c,l]=a,f=$(o);if(typeof f!="number")return f;const m=$(c);if(typeof m!="number")return m;const d=+l.getValue();if(Number.isNaN(d))return g.create(h.VALUE);if(d<=0||f>=m)return g.create(h.NUM);const C=Math.floor(m)-Math.floor(f),E=ne(f).getUTCFullYear(),b=In(E);if(C>b)return g.create(h.NUM);const R=100*(1-d*C/360);return R<0?g.create(h.NUM):y.create(R,He(this.getLocale()))}}class T1 extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const{isError:n,errorObject:s,variants:a}=ve(e,t,r);if(n)return s;const[o,c,l]=a,f=$(o);if(typeof f!="number")return f;const m=$(c);if(typeof m!="number")return m;const d=+l.getValue();if(Number.isNaN(d))return g.create(h.VALUE);if(d<=0||f>=m)return g.create(h.NUM);const C=Math.floor(m)-Math.floor(f),E=ne(f).getUTCFullYear(),b=In(E);if(C>b)return g.create(h.NUM);const R=(100-d)/d*360/C;return y.create(R)}}class B1 extends p{constructor(){super(...arguments);A(this,"minParams",5);A(this,"maxParams",7);A(this,"needsLocale",!0)}calculate(e,t,r,n,s,a,o){let c=a!=null?a:y.create(2);c.isNull()&&(c=y.create(2));let l=o!=null?o:T.create(!1);l.isNull()&&(l=T.create(!1));const f=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1,s.isArray()?s.getRowCount():1,c.isArray()?c.getRowCount():1,l.isArray()?l.getRowCount():1),m=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1,s.isArray()?s.getColumnCount():1,c.isArray()?c.getColumnCount():1,l.isArray()?l.getColumnCount():1),d=O(f,m,e,g.create(h.NA)),C=O(f,m,t,g.create(h.NA)),_=O(f,m,r,g.create(h.NA)),E=O(f,m,n,g.create(h.NA)),b=O(f,m,s,g.create(h.NA)),R=O(f,m,c,g.create(h.NA)),N=O(f,m,l,g.create(h.NA));return this._getResultArray(d,C,_,E,b,R,N,f,m)}_getResultArray(e,t,r,n,s,a,o,c,l){const f=e.map((m,d,C)=>{const _=t.get(d,C),E=r.get(d,C),b=n.get(d,C),R=s.get(d,C),N=a.get(d,C),V=o.get(d,C),{isError:M,errorObject:D,variants:L}=k(m,_,E,b,R,N,V);if(M)return D;const[P,j,F,v,Y,q,se]=L,te=+P.getValue(),Q=+j.getValue(),le=+F.getValue(),Ce=+v.getValue(),ye=+Y.getValue(),Ne=+q.getValue(),de=+se.getValue();if(te<0||Q<0||le<0||Ce<0||ye<0||ye>le||Ce>ye||Ne<0)return g.create(h.NUM);if(le===0&&Ce===0&&ye===0)return g.create(h.DIV_BY_ZERO);const Be=this._getResult(te,Q,le,Ce,ye,Ne,de);return d===0&&C===0?y.create(Be,He(this.getLocale())):y.create(Be)});return c===1&&l===1?f.get(0,0):f}_getResult(e,t,r,n,s,a,o){const c=Math.floor(n),l=Math.ceil(s);let f=0;if(e<t){if(n>=1||o)return f;const m=Math.abs(e-t);return f=m*(s-n)>m?m:m*(s-n),-f}if(o)for(let m=c+1;m<=l;m++){let d=ba(e,t,r,m,a);m===c+1?d*=Math.min(s,c+1)-n:m===l&&(d*=s+1-l),f+=d}else{const m=e-this._getVdb(e,t,r,r,n,a);f=this._getVdb(m,t,r,r-n,s-n,a)}return f}_getVdb(e,t,r,n,s,a){const o=Math.ceil(s);let c=0,l=e-t,f=0,m=0,d=!1;for(let C=1;C<=o;C++){if(d)m=f;else{const _=ba(e,t,r,C,a);f=l/(n-(C-1)),f>_?(m=f,d=!0):(m=_,l-=_)}C===o&&(m*=s+1-o),c+=m}return c}}class F1 extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",3)}calculate(e,t,r){if(e.isNull()||t.isNull())return g.create(h.NA);const{isError:n,errorObejct:s,_values:a,_dates:o}=this._checkErrors(e,t);if(n)return s;let c=r!=null?r:y.create(.1);c.isNull()&&(c=y.create(.1));const{isError:l,errorObject:f,variants:m}=W(c);if(l)return f;const[d]=m,C=+d.getValue();if(Number.isNaN(C))return g.create(h.VALUE);const{positive:_,negative:E}=this._checkValues(a);if(!_||!E||(a==null?void 0:a.length)!==(o==null?void 0:o.length)||C<0)return g.create(h.NUM);const b=Ea(C,R=>this._iterF(a,o,R));return typeof b!="number"?b:y.create(b)}_checkErrors(e,t){if(e.isError())return{isError:!0,errorObejct:e};if(t.isError())return{isError:!0,errorObejct:t};const{isError:r,errorObejct:n,_values:s}=this._checkErrorValues(e);if(r)return{isError:r,errorObejct:n};const{isError:a,errorObejct:o,_dates:c}=this._checkErrorDates(t);return a?{isError:a,errorObejct:o}:{isError:!1,_values:s,_dates:c}}_checkErrorValues(e){const t=[];if(e.isArray()){let r=!1,n=g.create(h.VALUE);return e.iterator(s=>{const a=s;if(a.isError())return r=!0,n=a,!1;if(a.isBoolean())return r=!0,n=g.create(h.VALUE),!1;const o=+a.getValue();if(Number.isNaN(o))return r=!0,n=g.create(h.VALUE),!1;t.push(o)}),r?{isError:r,errorObejct:n}:t.length<=1?{isError:!0,errorObejct:g.create(h.NA)}:{isError:r,_values:t}}else{const r=e.getValue();return e.isBoolean()||e.isString()&&!S.isRealNum(r)?{isError:!0,errorObejct:g.create(h.VALUE)}:{isError:!0,errorObejct:g.create(h.NA)}}}_checkErrorDates(e){const t=[];if(e.isArray()){let r=!1,n=g.create(h.VALUE);return e.iterator(s=>{if(s!=null&&s.isError())return r=!0,n=s,!1;if(s!=null&&s.isBoolean())return r=!0,n=g.create(h.VALUE),!1;const a=+s.getValue();if(Number.isNaN(a))return r=!0,n=g.create(h.VALUE),!1;if(a<0)return r=!0,n=g.create(h.NUM),!1;t.push(Math.floor(a))}),r?{isError:r,errorObejct:n}:t.length<=1?{isError:!0,errorObejct:g.create(h.NA)}:{isError:r,_dates:t}}else{const r=e.getValue();return e.isBoolean()||e.isString()&&!S.isRealNum(r)?{isError:!0,errorObejct:g.create(h.VALUE)}:+r<0?{isError:!0,errorObejct:g.create(h.NUM)}:{isError:!0,errorObejct:g.create(h.NA)}}}_checkValues(e){let t=!1,r=!1;for(let n=0;n<e.length;n++)e[n]>0&&(t=!0),e[n]<0&&(r=!0);return{positive:t,negative:r}}_iterF(e,t,r){return e.reduce((n,s,a)=>n+s/(1+r)**((t[a]-t[0])/365),0)}}class I1 extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){if(e.isNull()||t.isNull()||r.isNull())return g.create(h.NA);const{isError:n,errorObject:s,variants:a}=W(e);if(n)return s;const[o]=a,c=+o.getValue();if(Number.isNaN(c))return g.create(h.VALUE);let{isError:l,errorObejct:f,_values:m,_dates:d}=this._checkErrors(t,r);if(l)return f;if(m=m,d=d,c<0||m.length!==d.length)return g.create(h.NUM);let C=0;const _=d[0];for(let E=0;E<d.length;E++){const b=d[E],R=m[E];C+=R/(1+c)**((b-_)/365)}return y.create(C)}_checkErrors(e,t){if(e.isError())return{isError:!0,errorObejct:e};if(t.isError())return{isError:!0,errorObejct:t};const{isError:r,errorObejct:n,_values:s}=this._checkErrorValues(e);if(r)return{isError:r,errorObejct:n};const{isError:a,errorObejct:o,_dates:c}=this._checkErrorDates(t);return a?{isError:a,errorObejct:o}:{isError:!1,_values:s,_dates:c}}_checkErrorValues(e){const t=[];if(e.isArray()){let r=!1,n=g.create(h.VALUE);return e.iterator(s=>{const a=s;if(a.isError())return r=!0,n=a,!1;if(a.isNull()||a.isBoolean())return r=!0,n=g.create(h.VALUE),!1;const o=+a.getValue();if(Number.isNaN(o))return r=!0,n=g.create(h.VALUE),!1;t.push(o)}),r?{isError:r,errorObejct:n}:t.length<=1?{isError:!0,errorObejct:g.create(h.NA)}:{isError:r,_values:t}}else{const r=e.getValue();return e.isNull()||e.isBoolean()||e.isString()&&!S.isRealNum(r)?{isError:!0,errorObejct:g.create(h.VALUE)}:{isError:!0,errorObejct:g.create(h.NA)}}}_checkErrorDates(e){const t=[];if(e.isArray()){let r=!1,n=g.create(h.VALUE);return e.iterator(s=>{const a=s;if(a.isError())return r=!0,n=a,!1;if(a.isNull()||a.isBoolean())return r=!0,n=g.create(h.VALUE),!1;const o=+a.getValue();if(Number.isNaN(o))return r=!0,n=g.create(h.VALUE),!1;if(o<0)return r=!0,n=g.create(h.NUM),!1;t.push(Math.floor(o))}),r?{isError:r,errorObejct:n}:t.length<=1?{isError:!0,errorObejct:g.create(h.NA)}:{isError:r,_dates:t}}else{const r=e.getValue();return e.isNull()||e.isBoolean()||e.isString()&&!S.isRealNum(r)?{isError:!0,errorObejct:g.create(h.VALUE)}:+r<0?{isError:!0,errorObejct:g.create(h.NUM)}:{isError:!0,errorObejct:g.create(h.NA)}}}}class k1 extends p{constructor(){super(...arguments);A(this,"minParams",6);A(this,"maxParams",7)}calculate(e,t,r,n,s,a,o){let c=o!=null?o:y.create(0);c.isNull()&&(c=y.create(0));const{isError:l,errorObject:f,variants:m}=ve(e,t,r,n,s,a,c);if(l)return f;const[d,C,_,E,b,R,N]=m,V=$(d);if(typeof V!="number")return V;const M=$(C);if(typeof M!="number")return M;const D=+_.getValue(),L=+E.getValue(),P=+b.getValue(),j=Math.floor(+R.getValue()),F=Math.floor(+N.getValue());if(Number.isNaN(D)||Number.isNaN(L)||Number.isNaN(P)||Number.isNaN(j)||Number.isNaN(F))return g.create(h.VALUE);if(D<0||L<=0||P<=0||![1,2,4].includes(j)||F<0||F>4||V>=M||!mr(V,M,j))return g.create(h.NUM);const v=this._getResult(V,M,D,L,P,j,F);return y.create(v)}_getResult(e,t,r,n,s,a,o){if(Qt(e,t,a)>1){let E=r||.01,b=$n(e,t,r,E,s,a,o),R=b-n;for(let N=0;N<100&&Math.abs(R)>1e-7;N++)b=$n(e,t,r,1.01*E,s,a,o),E+=-R/(b-n-R)*E*.01,R=$n(e,t,r,E,s,a,o)-n;return E}const l=kn(e,t,a,o),f=Qe(e,t,a,o),{days:m}=_e(e,t,o),d=n/100+l/f*r/a;return(s/100+r/a-d)/d*a*f/m}}class $1 extends p{constructor(){super(...arguments);A(this,"minParams",4);A(this,"maxParams",5)}calculate(e,t,r,n,s){let a=s!=null?s:y.create(0);a.isNull()&&(a=y.create(0));const{isError:o,errorObject:c,variants:l}=ve(e,t,r,n,a);if(o)return c;const[f,m,d,C,_]=l,E=$(f);if(typeof E!="number")return E;const b=$(m);if(typeof b!="number")return b;const R=+d.getValue(),N=+C.getValue(),V=Math.floor(+_.getValue());if(Number.isNaN(R)||Number.isNaN(N)||Number.isNaN(V))return g.create(h.VALUE);if(R<=0||N<=0||V<0||V>4||E>=b)return g.create(h.NUM);const{days:M,yearDays:D}=_e(E,b,V),L=(N/R-1)/(M/D);return y.create(L)}}class Y1 extends p{constructor(){super(...arguments);A(this,"minParams",5);A(this,"maxParams",6)}calculate(e,t,r,n,s,a){let o=a!=null?a:y.create(0);o.isNull()&&(o=y.create(0));const{isError:c,errorObject:l,variants:f}=ve(e,t,r,n,s,o);if(c)return l;const[m,d,C,_,E,b]=f,R=$(m);if(typeof R!="number")return R;const N=$(d);if(typeof N!="number")return N;const V=$(C);if(typeof V!="number")return V;const M=+_.getValue(),D=+E.getValue(),L=Math.floor(+b.getValue());if(Number.isNaN(M)||Number.isNaN(D)||Number.isNaN(L))return g.create(h.VALUE);const P=this._getDateCorrectOrder(N,R,V);if(M<0||D<=0||L<0||L>4||!P)return g.create(h.NUM);const j=nu(R,L),{days:F}=_e(R,N,L),{days:v}=_e(V,N,L),{days:Y}=_e(V,R,L),q=((1+v/j*M)/(D/100+Y/j*M)-1)/(F/j);return y.create(q)}_getDateCorrectOrder(e,t,r){return Math.floor(e)>Math.floor(t)&&Math.floor(t)>Math.floor(r)}}const mu=[[Hg,ee.ACCRINT],[Gg,ee.ACCRINTM],[Wg,ee.AMORLINC],[Qg,ee.COUPDAYBS],[qg,ee.COUPDAYS],[Kg,ee.COUPDAYSNC],[Xg,ee.COUPNCD],[Zg,ee.COUPNUM],[zg,ee.COUPPCD],[Jg,ee.CUMIPMT],[e1,ee.CUMPRINC],[t1,ee.DB],[r1,ee.DDB],[n1,ee.DISC],[s1,ee.DOLLARDE],[a1,ee.DOLLARFR],[i1,ee.DURATION],[o1,ee.EFFECT],[u1,ee.FV],[c1,ee.FVSCHEDULE],[l1,ee.INTRATE],[f1,ee.IPMT],[m1,ee.IRR],[h1,ee.ISPMT],[g1,ee.MDURATION],[d1,ee.MIRR],[C1,ee.NOMINAL],[_1,ee.NPER],[A1,ee.NPV],[E1,ee.ODDFPRICE],[b1,ee.ODDFYIELD],[y1,ee.ODDLPRICE],[R1,ee.ODDLYIELD],[N1,ee.PDURATION],[p1,ee.PMT],[V1,ee.PPMT],[O1,ee.PRICE],[S1,ee.PRICEDISC],[M1,ee.PRICEMAT],[D1,ee.PV],[w1,ee.RATE],[L1,ee.RECEIVED],[P1,ee.RRI],[j1,ee.SLN],[x1,ee.SYD],[U1,ee.TBILLEQ],[v1,ee.TBILLPRICE],[T1,ee.TBILLYIELD],[B1,ee.VDB],[F1,ee.XIRR],[I1,ee.XNPV],[k1,ee.YIELD],[$1,ee.YIELDDISC],[Y1,ee.YIELDMAT]];class H1 extends p{constructor(){super(...arguments);A(this,"needsReferenceObject",!0);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){let r=e;if(r.isError())return r;if(r.isReferenceObject()&&(r=r.toArrayValueObject()),r.isArray()){const n=r.getRowCount(),s=r.getColumnCount();if(n===1&&s===1){const a=r.get(0,0);return this._handleSingleObject(a,t)}return r.map(a=>a.isError()?a:this._handleSingleObject(a,t,!0))}return this._handleSingleObject(r,t)}_handleSingleObject(e,t,r=!1){let n=t;if(n.isError())return n;if(!n.isReferenceObject())return g.create(h.NA);const s=n.getCurrentActiveSheetData(),{columnData:a,defaultColumnWidth:o}=s;n=n.toArrayValueObject();const c=n.getCurrentRow(),l=n.getCurrentColumn();n=n.getFirstCell();const f=`${e.getValue()}`;let m;switch(f.toLocaleLowerCase()){case"address":return U.create(`$${S.Tools.chatAtABC(l)}$${c+1}`);case"col":return y.create(l+1);case"color":return y.create(0);case"contents":return n;case"filename":return g.create(h.VALUE);case"format":return U.create("G");case"parentheses":return y.create(0);case"prefix":return U.create("");case"protect":return y.create(1);case"row":return y.create(c+1);case"type":return m="v",n.isNull()&&(m="b"),n.isString()&&(m="l"),U.create(m);case"width":return this._getWidthResult(a,o,l,r);default:return g.create(h.VALUE)}}_getWidthResult(e,t,r,n){var o;let s=(o=e[r])==null?void 0:o.w;if(!s&&s!==0&&(s=t),n)return y.create(s);const a=[[s,s===t]];return K.createByArray(a)}}class G1 extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1);A(this,"_errorTypeValueMap",new Map([[h.NULL,1],[h.DIV_BY_ZERO,2],[h.VALUE,3],[h.REF,4],[h.NAME,5],[h.NUM,6],[h.NA,7],[h.CONNECT,8],[h.CALC,14]]))}calculate(e){return e.isArray()?e.mapValue(t=>this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){const t=e.getValue(),r=this._errorTypeValueMap.get(t);return r?y.create(r):g.create(h.NA)}}var pe=(i=>(i.CELL="CELL",i.ERROR_TYPE="ERROR.TYPE",i.INFO="INFO",i.ISBETWEEN="ISBETWEEN",i.ISBLANK="ISBLANK",i.ISDATE="ISDATE",i.ISEMAIL="ISEMAIL",i.ISERR="ISERR",i.ISERROR="ISERROR",i.ISEVEN="ISEVEN",i.ISFORMULA="ISFORMULA",i.ISLOGICAL="ISLOGICAL",i.ISNA="ISNA",i.ISNONTEXT="ISNONTEXT",i.ISNUMBER="ISNUMBER",i.ISODD="ISODD",i.ISOMITTED="ISOMITTED",i.ISREF="ISREF",i.ISTEXT="ISTEXT",i.ISURL="ISURL",i.N="N",i.NA="NA",i.SHEET="SHEET",i.SHEETS="SHEETS",i.TYPE="TYPE",i))(pe||{});class W1 extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",5)}calculate(e,t,r,n,s){const a=n!=null?n:T.create(!0),o=s!=null?s:T.create(!0),{isError:c,errorObject:l,variants:f}=Dr(e,t,r,a,o);if(c)return l;const[m,d,C,_,E]=f;if(_.isString()||E.isString())return g.create(h.VALUE);if(d.compare(C,">").getValue()===!0)return g.create(h.NUM);const R=+_.getValue(),N=+E.getValue(),V=R?">=":">",M=N?"<=":"<";return m.compare(d,V).getValue()===!1||m.compare(C,M).getValue()===!1?T.create(!1):T.create(!0)}}class Q1 extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){return e.isNull()?T.create(!0):e.isArray()?e.mapValue(t=>t.isNull()?T.create(!0):T.create(!1)):T.create(!1)}}class q1 extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){let t=e;if(t.isArray()){const r=t.getRowCount(),n=t.getColumnCount();if(r>1||n>1)return g.create(h.VALUE);t=t.get(0,0)}return t.isError()?t:t.isNumber()&&t.getPattern()!==""?T.create(Aa(t.getPattern())):t.isString()&&(Ca(`${t.getValue()}`)||_a(`${t.getValue()}`))?T.create(!0):T.create(!1)}}class K1 extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){let t=e;if(t.isArray()){const a=t.getRowCount(),o=t.getColumnCount();if(a>1||o>1)return g.create(h.VALUE);t=t.get(0,0)}if(t.isError())return t;if(t.isNull()||t.isBoolean()||t.isNumber())return T.create(!1);const r=`${t.getValue()}`;if(r.length>254)return T.create(!1);const n=S.Tools.topLevelDomainCombiningString(),s=new RegExp(`^(?:[\\w+-]+\\.)*[\\w+-]+@[a-z0-9_-]+(?:\\.[a-z0-9_-]+)*\\.(?:${n})$`,"i");return T.create(s.test(r))}}class X1 extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){return e.getValue()===h.NA?T.create(!1):e.isError()?T.create(!0):e.isArray()?e.mapValue(t=>t.getValue()===h.NA?T.create(!1):t.isError()?T.create(!0):T.create(!1)):T.create(!1)}}class Z1 extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){return e.isError()?T.create(!0):e.isArray()?e.mapValue(t=>t.isError()?T.create(!0):T.create(!1)):T.create(!1)}}class z1 extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){let t=e;if(t.isArray()){const s=t.getRowCount(),a=t.getColumnCount();if(s>1||a>1)return g.create(h.VALUE);t=t.get(0,0)}if(t.isError())return t;if(t.isBoolean())return g.create(h.VALUE);const r=Math.trunc(+t.getValue());if(Number.isNaN(r))return g.create(h.VALUE);const n=r%2===0;return T.create(n)}}class J1 extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1);A(this,"needsReferenceObject",!0)}calculate(e){var o;if(e.isError())return e;if(!e.isReferenceObject())return g.create(h.NA);const t=(o=e.getCurrentActiveSheetData())==null?void 0:o.cellData.getMatrix(),{startRow:r,startColumn:n}=e.getRangePosition(),s=e.toArrayValueObject(),a=s.mapValue((c,l,f)=>{var d;const m=(d=t==null?void 0:t[r+l])==null?void 0:d[n+f];return m!=null&&m.f||m!=null&&m.si?T.create(!0):T.create(!1)});return s.getRowCount()===1&&s.getColumnCount()===1?a.get(0,0):a}}class ed extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){return e.isBoolean()?T.create(!0):e.isArray()?e.mapValue(t=>t.isBoolean()?T.create(!0):T.create(!1)):T.create(!1)}}class td extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){return e.getValue()===h.NA?T.create(!0):e.isArray()?e.mapValue(t=>t.getValue()===h.NA?T.create(!0):T.create(!1)):T.create(!1)}}class rd extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){return!e.isArray()&&!e.isString()?T.create(!0):e.isArray()?e.mapValue(t=>t.isString()?T.create(!1):T.create(!0)):T.create(!1)}}class nd extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){return e.isNumber()?T.create(!0):e.isArray()?e.mapValue(t=>t.isNumber()?T.create(!0):T.create(!1)):T.create(!1)}}class sd extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){let t=e;if(t.isArray()){const s=t.getRowCount(),a=t.getColumnCount();if(s>1||a>1)return g.create(h.VALUE);t=t.get(0,0)}if(t.isError())return t;if(t.isBoolean())return g.create(h.VALUE);const r=Math.trunc(+t.getValue());if(Number.isNaN(r))return g.create(h.VALUE);const n=r%2!==0;return T.create(n)}}class ad extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1);A(this,"needsReferenceObject",!0)}calculate(e){return e.isReferenceObject()?T.create(!0):T.create(!1)}}class id extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){return e.isString()?T.create(!0):e.isArray()?e.mapValue(t=>t.isString()?T.create(!0):T.create(!1)):T.create(!1)}}class od extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){let t=e;if(t.isArray()){const a=t.getRowCount(),o=t.getColumnCount();if(a>1||o>1)return g.create(h.VALUE);t=t.get(0,0)}if(t.isError())return t;if(t.isNull()||t.isBoolean()||t.isNumber())return T.create(!1);const r=`${t.getValue()}`.replace(/^\s+|\s+$/g,"");if(r.length>1e3)return T.create(!1);const n=S.Tools.topLevelDomainCombiningString(),s=new RegExp(`^(?:(?:https?|s?ftp|ftps|nfs|ssh)://+[a-z0-9_-]+(?:\\.[a-z0-9_-]+)*(?::[0-9]+)?(?:/(?:[A-Za-z0-9\\-._~!$&'()*+,;=:@]|%[A-Fa-f0-9]{2})*)*/?(?:[?#]\\S*)?|[a-z0-9_-]+(?:\\.[a-z0-9_-]+)*\\.(?:${n})(?::[0-9]+)?(?:/(?:[A-Za-z0-9\\-._~!$&'()*+,;=:@]|%[A-Fa-f0-9]{2})*)*/?(?:[?#]\\S*)?|mailto:(?:[\\w+-]+\\.)*[\\w+-]+@[a-z0-9_-]+(?:\\.[a-z0-9_-]+)*\\.(?:${n})|(?:news|aim):[%a-z0-9$_\\.+!*(),;/?#:@&~=-]+)$`,"i");return T.create(s.test(r))}}class ud extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){let t=e;if(e.isArray()&&(t=e.get(0,0)),t.isError())return t;if(t.isString())return y.create(0);const r=+t.getValue();return y.create(r)}}class cd extends p{constructor(){super(...arguments);A(this,"minParams",0);A(this,"maxParams",0)}calculate(){return g.create(h.NA)}}class ld extends p{constructor(){super(...arguments);A(this,"minParams",0);A(this,"maxParams",1);A(this,"needsReferenceObject",!0);A(this,"needsSheetsInfo",!0)}calculate(e){var o;if(e!=null&&e.isError())return e;const{sheetOrder:t,sheetNameMap:r}=this.getSheetsInfo();if(!e){const c=t.findIndex(l=>l===this.subUnitId);return y.create(c+1)}if(e.isReferenceObject()){const c=e.getForcedSheetId(),l=e.getDefaultSheetId(),f=t.findIndex(m=>c?m===c:m===l);return y.create(f+1)}if(e.isArray())return g.create(h.NA);const n=`${e.getValue()}`.toLocaleLowerCase(),s=(o=Object.entries(r).find(([c,l])=>l.toLocaleLowerCase()===n))==null?void 0:o[0];if(!s)return g.create(h.NA);const a=t.findIndex(c=>c===s);return y.create(a+1)}}class fd extends p{constructor(){super(...arguments);A(this,"minParams",0);A(this,"maxParams",0);A(this,"needsSheetsInfo",!0)}calculate(){const{sheetOrder:e}=this.getSheetsInfo();return y.create(e.length)}}class md extends p{constructor(){super(...arguments);A(this,"needsReferenceObject",!0);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){if(e.isReferenceObject()){const t=e.getRowCount(),r=e.getColumnCount();if(t===1&&r===1){const n=e.getFirstCell();if(n.isError())return y.create(16);if(n.isBoolean())return y.create(4);if(n.isString())return y.create(2);if(n.isNumber()||n.isNull())return y.create(1)}else return y.create(64)}else{if(e.isArray())return y.create(64);if(e.isError())return y.create(16);if(e.isBoolean())return y.create(4);if(e.isString())return y.create(2);if(e.isNumber()||e.isNull())return y.create(1)}return y.create(128)}}const hu=[[H1,pe.CELL],[G1,pe.ERROR_TYPE],[W1,pe.ISBETWEEN],[Q1,pe.ISBLANK],[q1,pe.ISDATE],[K1,pe.ISEMAIL],[X1,pe.ISERR],[Z1,pe.ISERROR],[z1,pe.ISEVEN],[J1,pe.ISFORMULA],[ed,pe.ISLOGICAL],[td,pe.ISNA],[rd,pe.ISNONTEXT],[nd,pe.ISNUMBER],[sd,pe.ISODD],[ad,pe.ISREF],[id,pe.ISTEXT],[od,pe.ISURL],[ud,pe.N],[cd,pe.NA],[ld,pe.SHEET],[fd,pe.SHEETS],[md,pe.TYPE]];class hd extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){let t=!0,r=!0,n=null;for(const s of e){if(s.isError())return s;if(s.isArray()){if(s.iterator(a=>{if(a!=null&&a.isError())return n=a,!1;(a!=null&&a.isBoolean()||a!=null&&a.isNumber())&&(t=t&&!!a.getValue(),r=!1)}),n)return n}else(s.isBoolean()||s.isNumber())&&(t=t&&!!s.getValue(),r=!1)}return r?g.create(h.VALUE):T.create(t)}}class gd extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2);A(this,"needsReferenceObject",!0)}calculate(e,t){let r=e,n=null;if(e.isReferenceObject()&&(r=e.toArrayValueObject(),n=e),r.isError())return r;if(t.isError())return t;if(!(t.isValueObject()&&t.isLambda()&&t.getLambdaPrivacyVarKeys().length===1))return g.create(h.VALUE);const s=t,a=r.isArray()?r.getRowCount():1,o=r.isArray()?r.getColumnCount():1;r=O(a,o,r);const c=[[]];for(let l=0;l<o;l++){const f=[];for(let C=0;C<a;C++){const _=r.get(C,l);f.push([_])}let m=K.create({calculateValueList:f,rowCount:a,columnCount:1,unitId:"",sheetId:"",row:0,column:0});if(n){const{startRow:C,startColumn:_}=n.getRangePosition(),E={startRow:C,startColumn:_+l,endRow:C+a-1,endColumn:_+l};m=this.createReferenceObject(n,E)}let d=s.execute(m);if(d.isArray()){const C=d.getRowCount(),_=d.getColumnCount();if(C>1||_>1)return g.create(h.CALC);d=d.get(0,0)}d.isNull()&&(d=y.create(0)),c[0].push(d)}return o===1?c[0][0]:K.create({calculateValueList:c,rowCount:1,columnCount:o,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}}class dd extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2);A(this,"needsReferenceObject",!0)}calculate(e,t){let r=e,n=null;if(e.isReferenceObject()&&(r=e.toArrayValueObject(),n=e),r.isError())return r;if(t.isError())return t;if(!(t.isValueObject()&&t.isLambda()&&t.getLambdaPrivacyVarKeys().length===1))return g.create(h.VALUE);const s=t,a=r.isArray()?r.getRowCount():1,o=r.isArray()?r.getColumnCount():1;r=O(a,o,r);const c=[];for(let l=0;l<a;l++){const f=[[]];for(let C=0;C<o;C++){const _=r.get(l,C);f[0].push(_)}let m=K.create({calculateValueList:f,rowCount:1,columnCount:o,unitId:"",sheetId:"",row:0,column:0});if(n){const{startRow:C,startColumn:_}=n.getRangePosition(),E={startRow:C+l,startColumn:_,endRow:C+l,endColumn:_+o-1};m=this.createReferenceObject(n,E)}let d=s.execute(m);if(d.isArray()){const C=d.getRowCount(),_=d.getColumnCount();if(C>1||_>1)return g.create(h.CALC);d=d.get(0,0)}d.isNull()&&(d=y.create(0)),c.push([d])}return a===1?c[0][0]:K.create({calculateValueList:c,rowCount:a,columnCount:1,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}}class Cd extends p{constructor(){super(...arguments);A(this,"minParams",0);A(this,"maxParams",0)}calculate(){return T.create(!1)}}var Oe=(i=>(i.AND="AND",i.BYCOL="BYCOL",i.BYROW="BYROW",i.FALSE="FALSE",i.IF="IF",i.IFERROR="IFERROR",i.IFNA="IFNA",i.IFS="IFS",i.LAMBDA="LAMBDA",i.LET="LET",i.MAKEARRAY="MAKEARRAY",i.MAP="MAP",i.NOT="NOT",i.OR="OR",i.REDUCE="REDUCE",i.SCAN="SCAN",i.SWITCH="SWITCH",i.TRUE="TRUE",i.XOR="XOR",i))(Oe||{});class _d extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",3)}calculate(e,t,r=T.create(!1)){const n=this._getSingleValueObject(e);if(n.isError())return n;if(!n.isArray())return n.getValue()?t:r;const s=Math.max(n.isArray()?n.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),a=Math.max(n.isArray()?n.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),o=O(s,a,n),c=O(s,a,t,g.create(h.NA)),l=O(s,a,r,g.create(h.NA));return o.map((f,m,d)=>{if(f.isNull())return g.create(h.NA);{const C=c.get(m,d)||oe.create(),_=l.get(m,d)||oe.create();return this._calculateSingleCell(f,C,_)}})}_getSingleValueObject(e){return e.isArray()&&e.getRowCount()===1&&e.getColumnCount()===1?e.getFirstCell():e}_calculateSingleCell(e,t,r){return e.isNull()?g.create(h.NA):e.getValue()?t.isNull()?g.create(h.NA):t:r.isNull()?g.create(h.NA):r}}class Ad extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){if(!e.isArray())return e.isError()?t:e;const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=O(r,n,e),a=O(r,n,t);return s.iterator((o,c,l)=>{o!=null&&o.isError()&&s.set(c,l,a.get(c,l))}),s}}class Ed extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){if(e.isError()&&e.getErrorType()!==h.NA)return e;if(t.isError())return t;if(!e.isArray())return e.isError()&&e.getErrorType()===h.NA?t:e;const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=O(r,n,e),a=O(r,n,t);return s.iterator((o,c,l)=>{o!=null&&o.isError()&&o.getErrorType()===h.NA&&s.set(c,l,a.get(c,l))}),s}}class bd extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",255)}calculate(...e){if(e.length%2!==0)return g.create(h.NA);for(let a=0;a<e.length;a++)if(e[a].isError())return e[a];const t=Math.max(...e.map(a=>a.isArray()?a.getRowCount():1)),r=Math.max(...e.map(a=>a.isArray()?a.getColumnCount():1)),n=e.map(a=>O(t,r,a,g.create(h.NA))),s=n[0].map((a,o,c)=>{for(let l=0;l<n.length;l+=2){const f=n[l].get(o,c)||oe.create(),m=n[l+1].get(o,c)||oe.create();if(f.isNull())continue;if(f.isError())return f;const d=f.getValue();if(f.isString()){if(`${d}`.toLocaleUpperCase()==="TRUE")return m;if(`${d}`.toLocaleUpperCase()==="FALSE")continue;return g.create(h.VALUE)}if(+d)return m.isNull()?g.create(h.NA):m}return g.create(h.NA)});return t===1&&r===1?s.get(0,0):s}}class yd extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){return g.create(h.VALUE)}}class Rd extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",255)}calculate(...e){return g.create(h.VALUE)}}class Nd extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(...e){const t=this.getIndexNumValue(e[0]);if(typeof t!="number")return t;const r=this.getIndexNumValue(e[1]);if(typeof r!="number")return r;if(!(e[2].isValueObject()&&e[2].isLambda()))return g.create(h.VALUE);const n=e[2],s=[];for(let a=0;a<t;a++){s[a]==null&&(s[a]=[]);for(let o=0;o<r;o++){let c=n.execute(y.create(a+1),y.create(o+1));c.isArray()&&(c=c.get(0,0)),s[a][o]=c}}return new Ti(s)}isAsync(){return!0}}let pd=class extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",255);A(this,"needsReferenceObject",!0)}calculate(...e){const t=[];let r=null,n=0,s=0;for(let o=0;o<e.length;o++){const c=e[o];let l=c;if(l.isReferenceObject()&&(l=c.toArrayValueObject()),l.isError())return l;if(o===e.length-1){if(!(c.isValueObject()&&c.isLambda()))return g.create(h.VALUE);r=c}else t.push(c),n=Math.max(n,l.isArray()?l.getRowCount():1),s=Math.max(s,l.isArray()?l.getColumnCount():1)}const a=this._getResultArray(t,r,n,s);return a instanceof g?a:n===1&&s===1?a[0][0]:K.create({calculateValueList:a,rowCount:n,columnCount:s,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}_getResultArray(e,t,r,n){const s=[];for(let a=0;a<r;a++){const o=[];for(let c=0;c<n;c++){const l=[];let f=!1;for(let d=0;d<e.length;d++){let C=e[d],_=null;if(C.isReferenceObject()&&(_=C,C=C.toArrayValueObject()),!C.isArray())if(a===0&&c===0){l.push(_||C);continue}else{o.push(g.create(h.NA)),f=!0;break}let E=C.get(a,c);if(!E){o.push(g.create(h.NA)),f=!0;break}if(_){const{startRow:b,startColumn:R}=_.getRangePosition(),N={startRow:b+a,startColumn:R+c,endRow:b+a,endColumn:R+c};E=this.createReferenceObject(_,N)}l.push(E)}if(f||l.length===0)continue;let m=t.execute(...l);if(m.isArray()){const d=m.getRowCount(),C=m.getColumnCount();if(d>1||C>1)return g.create(h.CALC);m=m.get(0,0)}m.isNull()&&(m=y.create(0)),o.push(m)}s.push(o)}return s}};class Vd extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(t=>this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;const t=+e.getValue();return Number.isNaN(t)?g.create(h.VALUE):T.create(!t)}}class Od extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){let t=!1,r=!0,n=null;for(const s of e){if(s.isError())return s;if(s.isArray()){if(s.iterator(a=>{if(a!=null&&a.isError())return n=a,!1;(a!=null&&a.isBoolean()||a!=null&&a.isNumber())&&(t=t||!!a.getValue(),r=!1)}),n)return n}else(s.isBoolean()||s.isNumber())&&(t=t||!!s.getValue(),r=!1)}return r?new g(h.VALUE):new T(t)}}class Sd extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3);A(this,"needsReferenceObject",!0)}calculate(e,t,r){let n,s;e.isReferenceObject()?(n=e.toArrayValueObject(),s=e):(n=e,s=null);let a,o;return t.isReferenceObject()?(a=t.toArrayValueObject(),o=t):(a=t,o=null),n.isArray()?n.mapValue(c=>this._handleSingleValueObject(c,a,r,s,o)):this._handleSingleValueObject(n,a,r,s,o)}_handleSingleValueObject(e,t,r,n,s){if(e.isError())return e;if(t.isError())return t;if(r.isError())return r;if(!(r.isValueObject()&&r.isLambda()&&r.getLambdaPrivacyVarKeys().length===2))return g.create(h.VALUE);const a=r,o=t.isArray()?t.getRowCount():1,c=t.isArray()?t.getColumnCount():1;let l=e;n&&(l=n);for(let f=0;f<o;f++)for(let m=0;m<c;m++){let d=t.isArray()?t.get(f,m):t;if(d.isError())return d;if(s){const{startRow:_,startColumn:E}=s.getRangePosition(),b={startRow:_+f,startColumn:E+m,endRow:_+f,endColumn:E+m};d=this.createReferenceObject(s,b)}let C=a.execute(l,d);if(C.isError())return C;C.isNull()&&(C=y.create(0)),l=C}return l.isReferenceObject()?l.toArrayValueObject():l}}class Md extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3);A(this,"needsReferenceObject",!0)}calculate(e,t,r){let n=e,s=null;e.isReferenceObject()&&(n=e.toArrayValueObject(),s=e),n=n;let a=t,o=null;if(t.isReferenceObject()&&(a=t.toArrayValueObject(),o=t),a=a,n.isError())return n;if(a.isError())return a;if(r.isError())return r;if(!(r.isValueObject()&&r.isLambda()&&r.getLambdaPrivacyVarKeys().length===2))return g.create(h.VALUE);if(n.isArray()){const c=n.getRowCount(),l=n.getColumnCount();if(c>1||l>1)return g.create(h.CALC);n=n.get(0,0)}return this._getResult(n,a,r,s,o)}_getResult(e,t,r,n,s){const a=[],o=t.isArray()?t.getRowCount():1,c=t.isArray()?t.getColumnCount():1;let l=e;n&&(l=n);for(let f=0;f<o;f++){const m=[];for(let d=0;d<c;d++){if(l.isError()){m.push(l);continue}let C=t.isArray()?t.get(f,d):t;if(C.isError()){l=C,m.push(C);continue}if(s){const{startRow:E,startColumn:b}=s.getRangePosition(),R={startRow:E+f,startColumn:b+d,endRow:E+f,endColumn:b+d};C=this.createReferenceObject(s,R)}let _=r.execute(l,C);if(_.isArray()){const E=_.getRowCount(),b=_.getColumnCount();if(E>1||b>1)return g.create(h.CALC);_=_.get(0,0)}_.isNull()&&(_=y.create(0)),l=_,m.push(_)}a.push(m)}return o===1&&c===1?a[0][0]:K.create({calculateValueList:a,rowCount:o,columnCount:c,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}}class Dd extends p{constructor(){super(...arguments);A(this,"minParams",3)}calculate(e,...t){if(e.isError())return e;const r=t.length%2!==0,n=r?t[t.length-1]:oe.create();return!e.isArray()&&!t.some(s=>s.isArray())?this._handleNonArrayInputs(e,t,n,r):this._handleArrayInputs(e,t,n,r)}_handleNonArrayInputs(e,t,r,n){for(let s=0;s<t.length-(n?1:0);s+=2){const a=t[s],o=t[s+1];if(!a.isNull()){if(a.isError())return a;if(`${e.getValue()}`.toLocaleLowerCase()===`${a.getValue()}`.toLocaleLowerCase())return o.isNull()?g.create(h.NA):o}}return r.isNull()?g.create(h.NA):r}_handleArrayInputs(e,t,r,n){const s=Math.max(e.isArray()?e.getRowCount():1,...t.map(f=>f.isArray()?f.getRowCount():1),r.isArray()?r.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,...t.map(f=>f.isArray()?f.getColumnCount():1),r.isArray()?r.getColumnCount():1),o=O(s,a,e),c=t.map(f=>O(s,a,f,g.create(h.NA))),l=O(s,a,r,g.create(h.NA));return o.map((f,m,d)=>{for(let _=0;_<c.length-(n?1:0);_+=2){const E=c[_].get(m,d)||oe.create(),b=c[_+1].get(m,d)||oe.create();if(!E.isNull()){if(E.isError()||f.isError())return E.isError()?E:f;if(`${f.getValue()}`.toLocaleLowerCase()===`${E.getValue()}`.toLocaleLowerCase())return b.isNull()?g.create(h.NA):b}}const C=l.get(m,d)||oe.create();return C.isNull()?g.create(h.NA):C})}}class wd extends p{constructor(){super(...arguments);A(this,"minParams",0);A(this,"maxParams",0)}calculate(){return T.create(!0)}}class Ld extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){let t=0,r=!0,n=null;for(const s of e){if(s.isError())return s;if(s.isArray()){if(s.iterator(a=>{if(a!=null&&a.isError())return n=a,!1;(a!=null&&a.isBoolean()||a!=null&&a.isNumber())&&(a.getValue()&&t++,r=!1)}),n)return n}else(s.isBoolean()||s.isNumber())&&(s.getValue()&&t++,r=!1)}return r?g.create(h.VALUE):T.create(t%2===1)}}const gu=[[hd,Oe.AND],[gd,Oe.BYCOL],[dd,Oe.BYROW],[Cd,Oe.FALSE],[_d,Oe.IF],[Ad,Oe.IFERROR],[Ed,Oe.IFNA],[bd,Oe.IFS],[yd,Oe.LAMBDA],[Rd,Oe.LET],[Nd,Oe.MAKEARRAY],[pd,Oe.MAP],[Vd,Oe.NOT],[Od,Oe.OR],[Sd,Oe.REDUCE],[Md,Oe.SCAN],[Dd,Oe.SWITCH],[wd,Oe.TRUE],[Ld,Oe.XOR]];class Pd extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",5)}calculate(e,t,r,n,s){if(e.isError())return e;if(t.isError())return t;if(r!=null&&r.isError())return r;if(n!=null&&n.isError())return n;if(s!=null&&s.isError())return s;const a=r!=null?r:y.create(1),o=n!=null?n:T.create(!0),c=s!=null?s:U.create(""),l=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,a.isArray()?a.getRowCount():1,o.isArray()?o.getRowCount():1,c.isArray()?c.getRowCount():1),f=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,a.isArray()?a.getColumnCount():1,o.isArray()?o.getColumnCount():1,c.isArray()?c.getColumnCount():1),m=O(l,f,e,g.create(h.NA)),d=O(l,f,t,g.create(h.NA)),C=O(l,f,a,g.create(h.NA)),_=O(l,f,o,g.create(h.NA)),E=O(l,f,c,g.create(h.NA));return m.map((b,R,N)=>{const V=d.get(R,N)||g.create(h.NA),M=C.get(R,N)||g.create(h.NA),D=_.get(R,N)||g.create(h.NA),L=E.get(R,N)||g.create(h.NA);return b.isError()?b:V.isError()?V:M.isError()?M:D.isError()?D:L.isError()?L:this._calculateSingleCell(b,V,M,D,L)})}_calculateSingleCell(e,t,r,n,s){const a=Number.parseInt(`${Number(e.getValue())-1}`),o=Number.parseInt(`${Number(t.getValue())-1}`),c=Number.parseInt(`${Number(r.getValue())}`);if(Number.isNaN(a)||Number.isNaN(o)||Number.isNaN(c)||c<1||c>4)return g.create(h.VALUE);const l=jd(c),f=this.getZeroOrOneByOneDefault(n),m=`${s.getValue()}`,d=si(m),C={startRow:a,startColumn:o,endRow:a,endColumn:o,startAbsoluteRefType:l,endAbsoluteRefType:l},_=n&&!f?im(C):Ut(C);return U.create(d!==""?`${d}!${_}`:_)}}function jd(i){switch(i){case 1:return S.AbsoluteRefType.ALL;case 2:return S.AbsoluteRefType.ROW;case 3:return S.AbsoluteRefType.COLUMN;case 4:return S.AbsoluteRefType.NONE;default:return S.AbsoluteRefType.ALL}}class xd extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1);A(this,"needsReferenceObject",!0)}calculate(e){return e.isReferenceObject()?y.create(1):g.create(h.VALUE)}}class Ud extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",255);A(this,"needsReferenceObject",!0)}calculate(e,...t){let r=e;if(r.isError())return r;if(r.isReferenceObject()&&(r=r.toArrayValueObject()),!r.isArray()){const c=r.convertToNumberObjectValue();return c.isError()?c:t[Math.trunc(+c.getValue())-1]||g.create(h.VALUE)}let n=r.isArray()?r.getRowCount():1,s=r.isArray()?r.getColumnCount():1;t.forEach((c,l)=>{if(c.isArray()){const f=c;n=Math.max(n,f.getRowCount()),s=Math.max(s,f.getColumnCount())}else n=Math.max(n,1),s=Math.max(s,1)});const a=O(n,s,r,g.create(h.NA)),o=t.map(c=>{let l=c;return l.isReferenceObject()&&(l=l.toArrayValueObject()),O(n,s,l,g.create(h.NA))});return a.map((c,l,f)=>{if(c.isError())return c;const m=c.convertToNumberObjectValue();if(m.isError())return m;const d=o[Math.trunc(+m.getValue())-1];let C=(d==null?void 0:d.get(l,f))||g.create(h.VALUE);return C!=null&&C.isNull()&&(C=y.create(0)),C})}}class vd extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",255)}calculate(e,...t){if(e.isError())return e;const r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,s=[];for(let a=0;a<t.length;a++){let o=t[a];if(o.isArray()){const f=o.getRowCount(),m=o.getColumnCount();if(f>1||m>1)return g.create(h.VALUE);o=o.get(0,0)}if(o.isString()&&(o=o.convertToNumberObjectValue()),o.isError())return o;const c=Math.trunc(+o.getValue());if(c===0||Math.abs(c)>n)return g.create(h.VALUE);let l=e;n>1&&(c<0?l=e.slice(void 0,[c+n,c+1+n]):l=e.slice(void 0,[c-1,c]));for(let f=0;f<r;f++)s[f]||(s[f]=[]),e.isArray()?s[f].push(l.get(f,0)):s[f].push(e)}return K.create({calculateValueList:s,rowCount:s.length,columnCount:s[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}}class Td extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",255)}calculate(e,...t){if(e.isError())return e;const r=e.isArray()?e.getRowCount():1,n=[];for(let s=0;s<t.length;s++){let a=t[s];if(a.isArray()){const l=a.getRowCount(),f=a.getColumnCount();if(l>1||f>1)return g.create(h.VALUE);a=a.get(0,0)}if(a.isString()&&(a=a.convertToNumberObjectValue()),a.isError())return a;const o=Math.trunc(+a.getValue());if(o===0||Math.abs(o)>r)return g.create(h.VALUE);let c=e;r>1&&(o<0?c=e.slice([o+r,o+1+r]):c=e.slice([o-1,o])),e.isArray()?n.push(c.getArrayValue()[0]):n.push([e])}return K.create({calculateValueList:n,rowCount:n.length,columnCount:n[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}}class Bd extends p{constructor(){super(...arguments);A(this,"minParams",0);A(this,"maxParams",1)}calculate(e){if(e==null)return y.create(this.column+1);if(e.isError())return e;if(!e.isArray())return g.create(h.NA);const t=e.getCurrentColumn(),r=e.getColumnCount(),n=[];for(let a=0;a<r;a++)n.push(y.create(t+a+1));const s={calculateValueList:[n],rowCount:1,columnCount:r,unitId:this.unitId||"",sheetId:this.subUnitId||"",row:this.row,column:this.column};return K.create(s)}}class Fd extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){if(e.isError())return e;if(e.isString()||e.isNumber()||e.isBoolean())return y.create(1);if(!e.isArray())return g.create(h.NA);const t=e.getColumnCount();return y.create(t)}}class Id extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",3)}calculate(e,t,r){const n=r!=null?r:y.create(0),s=e.isArray()?e.getRowCount():1,a=e.isArray()?e.getColumnCount():1,o=Math.max(t.isArray()?t.getRowCount():1,n.isArray()?n.getRowCount():1),c=Math.max(t.isArray()?t.getColumnCount():1,n.isArray()?n.getColumnCount():1),l=O(o,c,t,g.create(h.NA)),f=O(o,c,n,g.create(h.NA));if(o>1||c>1)return l.mapValue((R,N,V)=>{const M=f.get(N,V);if(e.isError())return e;if(e.isNull())return g.create(h.VALUE);const{isError:D,errorObject:L}=this._checkRowsColumns(R,M,s,a);return D?L:e.isArray()?g.create(h.VALUE):e});if(e.isError())return e;if(e.isNull())return g.create(h.VALUE);const m=t.isArray()?t.get(0,0):t,d=n.isArray()?n.get(0,0):n,{isError:C,errorObject:_,rowsValue:E,columnsValue:b}=this._checkRowsColumns(m,d,s,a);return C?_:this._getResultArray(e,E,b,s,a)}_checkRowsColumns(e,t,r,n){if(e.isError())return{isError:!0,errorObject:e};if(t.isError())return{isError:!0,errorObject:t};const s=Math.trunc(+e.getValue()),a=Math.trunc(+t.getValue());return Number.isNaN(s)||Number.isNaN(a)?{isError:!0,errorObject:g.create(h.VALUE)}:Math.abs(s)>=r||Math.abs(a)>=n?{isError:!0,errorObject:g.create(h.CALC)}:{isError:!1,rowsValue:s,columnsValue:a}}_getResultArray(e,t,r,n,s){const a=t>=0?[t,n]:[0,n+t],o=r>=0?[r,s]:[0,s+r];let c;return t===0&&r===0?c=e:t===0?c=e.slice(void 0,o):r===0?c=e.slice(a,void 0):c=e.slice(a,o),c=c.map(l=>l.isNull()?y.create(0):l),n-t===1&&s-r===1?c.get(0,0):c}}class kd extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",4)}calculate(e,t,r,n){const s=e.isArray()?e.getRowCount():1,a=e.isArray()?e.getColumnCount():1;let o=t,c=r!=null?r:y.create(a);const l=n!=null?n:g.create(h.NA);t.isNull()&&(o=y.create(s)),c.isNull()&&(c=y.create(a));const f=Math.max(o.isArray()?o.getRowCount():1,c.isArray()?c.getRowCount():1),m=Math.max(o.isArray()?o.getColumnCount():1,c.isArray()?c.getColumnCount():1),d=O(f,m,o,g.create(h.NA)),C=O(f,m,c,g.create(h.NA));if(f>1||m>1)return d.mapValue((D,L,P)=>{const j=C.get(L,P);if(e.isError())return e;if(e.isNull())return g.create(h.VALUE);const{isError:F,errorObject:v}=this._checkRowsColumnsPadWith(D,j,l,s,a);return F?v:e.isArray()?e.get(0,0):e});if(e.isError())return e;if(e.isNull())return g.create(h.VALUE);const _=o.isArray()?o.get(0,0):o,E=c.isArray()?c.get(0,0):c,{isError:b,errorObject:R,rowsValue:N,columnsValue:V,padWithObject:M}=this._checkRowsColumnsPadWith(_,E,l,s,a);return b?R:this._getResultArray(e,N,V,M,s,a)}_checkRowsColumnsPadWith(e,t,r,n,s){if(e.isError())return{isError:!0,errorObject:e};if(t.isError())return{isError:!0,errorObject:t};const a=Math.trunc(+e.getValue()),o=Math.trunc(+t.getValue());if(Number.isNaN(a)||Number.isNaN(o))return{isError:!0,errorObject:g.create(h.VALUE)};if(Math.abs(a)<n||Math.abs(o)<s)return{isError:!0,errorObject:g.create(h.VALUE)};let c=r;if(r.isArray()){const l=r.getRowCount(),f=r.getColumnCount();if(l>1||f>1)return{isError:!0,errorObject:g.create(h.VALUE)};c=r.get(0,0)}return{isError:!1,rowsValue:a,columnsValue:o,padWithObject:c}}_getResultArray(e,t,r,n,s,a){let o=[];e.isArray()?o=e.map(f=>f.isNull()?y.create(0):f).getArrayValue():o=[[e]];const c=Math.max(0,t-s),l=Math.max(0,r-a);for(let f=0;f<c;f++)o.push(new Array(a).fill(n));for(let f=0;f<l;f++)o.forEach(m=>{m.push(n)});return t===1&&r===1?o[0][0]:K.create({calculateValueList:o,rowCount:o.length,columnCount:o[0].length,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}}class $d extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",3)}calculate(e,t,r){const n=r!=null?r:g.create(h.CALC);if(e.isError())return e;if(t.isError())return t;const s=e.isArray()?e.getRowCount():1,a=e.isArray()?e.getColumnCount():1,o=t.isArray()?t.getRowCount():1,c=t.isArray()?t.getColumnCount():1;return o>1&&c>1||o===1&&c!==a||c===1&&o!==s?g.create(h.VALUE):s===1&&a===1?this._getResultArrayByR1C1(e,t,n):o===1?c!==a?g.create(h.VALUE):this._getResultArrayByR1(s,a,e,t,n):c===1?o!==s?g.create(h.VALUE):this._getResultArrayByC1(s,a,e,t,n):n}_getResultArrayByR1C1(e,t,r){let n=e,s=t;return n.isArray()&&(n=n.get(0,0)),s.isArray()&&(s=s.get(0,0)),s.isString()&&(s=s.convertToNumberObjectValue()),s.isError()?s:+s.getValue()?n:r}_getResultArrayByR1(e,t,r,n,s){const a=[];for(let o=0;o<t;o++){let c=n.get(0,o);if(c.isString()&&(c=c.convertToNumberObjectValue()),c.isError())return c;if(+c.getValue())for(let f=0;f<e;f++){a[f]||(a[f]=[]);const m=r.get(f,o);a[f].push(m)}}return a.length===0?s:K.create({calculateValueList:a,rowCount:a.length,columnCount:a[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}_getResultArrayByC1(e,t,r,n,s){const a=[];for(let o=0;o<e;o++){let c=n.get(o,0);if(c.isString()&&(c=c.convertToNumberObjectValue()),c.isError())return c;if(!+c.getValue())continue;const f=[];for(let m=0;m<t;m++){const d=r.get(o,m);f.push(d)}a.push(f)}return a.length===0?s:K.create({calculateValueList:a,rowCount:a.length,columnCount:a[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}}class Yd extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1);A(this,"needsReferenceObject",!0);A(this,"needsFormulaDataModel",!0)}calculate(e){var f,m;if(!e.isReferenceObject())return g.create(h.NA);const t=e.getUnitId(),r=e.getSheetId(),s=(m=(f=e.getUnitData()[t])==null?void 0:f[r])==null?void 0:m.cellData,{startRow:a,startColumn:o}=e.getRangePosition(),l=e.toArrayValueObject().mapValue((d,C,_)=>{const E=s.getValue(a+C,o+_);if(E!=null&&E.f||E!=null&&E.si){const b=this._formulaDataModel.getFormulaStringByCell(a+C,o+_,r,t);return U.create(b)}return g.create(h.NA)});return l.getRowCount()===1&&l.getColumnCount()===1?l.get(0,0):l}}var ge=(i=>(i.ADDRESS="ADDRESS",i.AREAS="AREAS",i.CHOOSE="CHOOSE",i.CHOOSECOLS="CHOOSECOLS",i.CHOOSEROWS="CHOOSEROWS",i.COLUMN="COLUMN",i.COLUMNS="COLUMNS",i.DROP="DROP",i.EXPAND="EXPAND",i.FILTER="FILTER",i.FORMULATEXT="FORMULATEXT",i.GETPIVOTDATA="GETPIVOTDATA",i.HLOOKUP="HLOOKUP",i.HSTACK="HSTACK",i.HYPERLINK="HYPERLINK",i.IMAGE="IMAGE",i.INDEX="INDEX",i.INDIRECT="INDIRECT",i.LOOKUP="LOOKUP",i.MATCH="MATCH",i.OFFSET="OFFSET",i.ROW="ROW",i.ROWS="ROWS",i.RTD="RTD",i.SORT="SORT",i.SORTBY="SORTBY",i.TAKE="TAKE",i.TOCOL="TOCOL",i.TOROW="TOROW",i.TRANSPOSE="TRANSPOSE",i.UNIQUE="UNIQUE",i.VLOOKUP="VLOOKUP",i.VSTACK="VSTACK",i.WRAPCOLS="WRAPCOLS",i.WRAPROWS="WRAPROWS",i.XLOOKUP="XLOOKUP",i.XMATCH="XMATCH",i))(ge||{});class Hd extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",4)}calculate(e,t,r,n){if(e.isError())return e;if(t.isError())return g.create(h.REF);if(!t.isArray()||r.isError()||n!=null&&n.isError())return g.create(h.NA);const s=this.getZeroOrOneByOneDefault(n);if(s==null)return g.create(h.VALUE);const a=this.getIndexNumValue(r);if(a instanceof g)return a;const o=t.slice([0,1]),c=t.slice([a-1,a]);return o==null||c==null?g.create(h.REF):e.isArray()?e.map(l=>this._handleSingleObject(l,o,c,s)):this._handleSingleObject(e,o,c,s)}_handleSingleObject(e,t,r,n){return n===0?this.equalSearch(e,t,r):this.binarySearch(e,t,r)}}class Gd extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){const t=Math.max(...e.map(n=>n.isArray()?n.getRowCount():1)),r=[];for(let n=0;n<e.length;n++){const s=e[n];if(s.isError())return s;const a=s.isArray()?s.getRowCount():1,o=s.isArray()?s.getColumnCount():1;for(let c=0;c<t;c++){r[c]||(r[c]=[]);for(let l=0;l<o;l++){let f=s;s.isArray()&&(f=s.get(c,l)),c>a-1||!f?r[c].push(g.create(h.NA)):r[c].push(f)}}}return K.create({calculateValueList:r,rowCount:r.length,columnCount:r[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}}class Wd extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",4);A(this,"needsReferenceObject",!0)}calculate(e,t,r,n){if(e.isError())return e;if(t!=null&&t.isError())return t;if(r!=null&&r.isError())return r;if(n!=null&&n.isError())return n;let s=0,a=0;if(e.isValueObject())s=1,a=1;else if(e.isReferenceObject()){const{startRow:d,endRow:C,startColumn:_,endColumn:E}=e.getRangePosition();s=C-d+1,a=E-_+1}else return g.create(h.VALUE);let o,c;s===1&&a>1&&r==null?(c=t!=null?t:y.create(0),o=y.create(0)):(o=t!=null?t:y.create(0),c=r!=null?r:y.create(0));let l=n!=null?n:y.create(1);o.isReferenceObject()&&(o=o.toArrayValueObject()),c.isReferenceObject()&&(c=c.toArrayValueObject()),l.isReferenceObject()&&(l=l.toArrayValueObject());const f=Math.max(o.isArray()?o.getRowCount():1,c.isArray()?c.getRowCount():1,l.isArray()?l.getRowCount():1),m=Math.max(o.isArray()?o.getColumnCount():1,c.isArray()?c.getColumnCount():1,l.isArray()?l.getColumnCount():1);if(o=o,c=c,l=l,f===1&&m===1)return this._calculateSingleCell(e,o,c,l);{const d=O(f,m,o,g.create(h.NA)),C=O(f,m,c,g.create(h.NA)),_=O(f,m,l,g.create(h.NA));return d.map((E,b,R)=>{const N=C.get(b,R)||oe.create(),V=_.get(b,R)||oe.create(),M=this._calculateSingleCell(e,E,N,V);return M.isReferenceObject()?M.toArrayValueObject().getFirstCell():M})}}_calculateSingleCell(e,t,r,n){if(t.isError())return t;const s=this._getNumberValue(t);if(s===void 0||s<0)return g.create(h.VALUE);if(r.isError())return r;const a=this._getNumberValue(r);if(a===void 0||a<0)return g.create(h.VALUE);if(n.isError())return n;const o=this._getAreaNumberValue(n);return o===void 0||o<1?g.create(h.VALUE):e.isReferenceObject()?this._getReferenceObject(e,s,a,o):e.isValueObject()&&s===1&&a===1?e:g.create(h.REF)}_getNumberValue(e){if(e==null)return 0;let t=0;if(e.isBoolean())e.getValue()===!0&&(t=1);else{if(e.isString())return;e.isNumber()?t=Math.floor(e.getValue()):e.isNull()&&(t=0)}return t}_getAreaNumberValue(e){if(e==null)return 1;let t=0;if(e.isBoolean())e.getValue()===!0&&(t=1);else{if(e.isString())return;e.isNumber()?t=Math.floor(e.getValue()):e.isNull()&&(t=0)}return t}_getReferenceObject(e,t,r,n){const{startRow:s,endRow:a,startColumn:o,endColumn:c}=e.getRangePosition();let l=0,f=0,m=0,d=0;if(t===0?(l=s,f=a):l=f=s+t-1,r===0?(m=o,d=c):m=d=o+r-1,l>a||m>c)return g.create(h.REF);const C={startRow:l,startColumn:m,endRow:f,endColumn:d};return this.createReferenceObject(e,C)}}class Qd extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",2)}isAddress(){return!0}calculate(e,t){if(e.isError())return e;if(t!=null&&t.isError())return t;let r=this.getZeroOrOneByOneDefault(t);r==null&&(r=1);let n=e;if(e.isArray()){const s=e.getRowCount(),a=e.getColumnCount();if(s>1||a>1)return e.map(()=>g.create(h.VALUE));n=e.getFirstCell()}return this._handleSingleObject(n,r)}_handleSingleObject(e,t){const r=`${e.getValue()}`;if(r.trim()==="")return g.create(h.REF);const n=this._convertToDefinedName(r);if(t===0){const f=ro(n),{range:m,sheetName:d,unitId:C}=f,_=new pr(m);return _.setForcedUnitIdDirect(C),_.setForcedSheetName(d),this._setDefault(_)}if(dr(n))return this._setDefault(new xs(n));if(Qa(n))return this._setDefault(new vs(n));if(qa(n))return this._setDefault(new Us(n));const s=Tt(n),{range:a,sheetName:o,unitId:c}=s;if(Number.isNaN(a.startRow)||a.endRow+1>1048576||Number.isNaN(a.startColumn)||a.endColumn+1>16384)return g.create(h.REF);const l=new pr(a);return l.setForcedUnitIdDirect(c),l.setForcedSheetName(o),this._setDefault(l)}_setDefault(e){return this.unitId==null||this.subUnitId==null?g.create(h.REF):(e.setDefaultUnitId(this.unitId),e.setDefaultSheetId(this.subUnitId),e)}_convertToDefinedName(e){const t=this.getDefinedName(e);if(t==null)return e;const r=t.formulaOrRefString;return r==null?e:r.startsWith(Z.EQUALS)?r.slice(1):r}}class qd extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",3);A(this,"needsExpandParams",!0)}calculate(e,t,r){return e.isError()?e:t.isError()?g.create(h.REF):t.isArray()?r!=null&&r.isError()?r:t.getColumnCount()===1||t.getRowCount()===1?r!=null&&!r.isArray()?g.create(h.REF):this._handleVector(e,t,r):this._handleArray(e,t):g.create(h.VALUE)}_handleVector(e,t,r){let n=r;if(n==null)n=t;else if(n.getRowCount()!==t.getRowCount()||n.getColumnCount()!==t.getColumnCount())return g.create(h.REF);return e.isArray()?e.map(s=>this.binarySearch(s,t,n)):this.binarySearch(e,t,n)}_handleArray(e,t){const r=t.getRowCount(),n=t.getColumnCount();let s,a;return n>r?(s=t.slice([0,1]),a=t.slice([r-1,r])):(s=t.slice(void 0,[0,1]),a=t.slice(void 0,[n-1,n])),s==null||a==null?g.create(h.VALUE):e.isArray()?e.map(o=>this.binarySearch(o,s,a)):this.binarySearch(e,s,a)}}class Kd extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",3)}calculate(e,t,r){if(e.isError())return e;if(t.isError())return g.create(h.REF);if(!t.isArray())return g.create(h.VALUE);const n=t.getRowCount(),s=t.getColumnCount();if(n!==1&&s!==1||r!=null&&r.isError())return g.create(h.NA);const a=this.getMatchTypeValue(r);return a==null?g.create(h.VALUE):e.isArray()?e.map(o=>this._handleSingleObject(o,t,a)):this._handleSingleObject(e,t,a)}_handleSingleObject(e,t,r){const n=this._getSearchModeValue(r),s=t.orderSearch(e,n);if(s==null)return g.create(h.NA);if(s instanceof g)return s;const a=t.getRowCount()===1?s.column+1:s.row+1;return y.create(a)}_getSearchModeValue(e){switch(e){case 1:return Me.MIN;case 0:return Me.NORMAL;case-1:return Me.MAX}}}class Xd extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",5);A(this,"needsReferenceObject",!0)}isAddress(){return!0}calculate(e,t,r,n,s){if(e.isError())return e;if(t.isError())return t;if(r.isError())return r;if(n!=null&&n.isError())return n;if(s!=null&&s.isError())return s;if(!e.isReferenceObject())return g.create(h.VALUE);const a=e.getRowCount(),o=e.getColumnCount();let c=t;c.isReferenceObject()&&(c=c.toArrayValueObject());let l=r;l.isReferenceObject()&&(l=l.toArrayValueObject());let f=n!=null?n:y.create(a);f.isReferenceObject()&&(f=f.toArrayValueObject()),f.isNull()&&(f=y.create(a));let m=s!=null?s:y.create(o);m.isReferenceObject()&&(m=m.toArrayValueObject()),m.isNull()&&(m=y.create(o));const d=Math.max(c.isArray()?c.getRowCount():1,l.isArray()?l.getRowCount():1,f.isArray()?f.getRowCount():1,m.isArray()?m.getRowCount():1),C=Math.max(c.isArray()?c.getColumnCount():1,l.isArray()?l.getColumnCount():1,f.isArray()?f.getColumnCount():1,m.isArray()?m.getColumnCount():1);if(c=c,l=l,f=f,m=m,d===1&&C===1)return c=c.isArray()?c.get(0,0):c,l=l.isArray()?l.get(0,0):l,f=f.isArray()?f.get(0,0):f,m=m.isArray()?m.get(0,0):m,this._handleSingleObject(e,c,l,f,m);const _=O(d,C,c,g.create(h.NA)),E=O(d,C,l,g.create(h.NA)),b=O(d,C,f,g.create(h.NA)),R=O(d,C,m,g.create(h.NA));return _.mapValue((N,V,M)=>{const D=E.get(V,M),L=b.get(V,M),P=R.get(V,M);return N.isError()?N:D.isError()?D:L.isError()?L:P.isError()?P:this._handleSingleObject(e,N,D,L,P,!0)})}_handleSingleObject(e,t,r,n,s,a=!1){const{startRow:o,startColumn:c}=e.getRangePosition();let l=t;if(l.isString()&&(l=l.convertToNumberObjectValue()),l.isError())return l;let f=r;if(f.isString()&&(f=f.convertToNumberObjectValue()),f.isError())return f;const m=+l.getValue(),d=+f.getValue();if(typeof m!="number"||typeof d!="number")return g.create(h.VALUE);const C=o+m,_=c+d;if(C<0||_<0)return g.create(h.REF);const E=this.getIndexNumValue(n),b=this.getIndexNumValue(s);if(typeof E!="number"||typeof b!="number")return g.create(h.VALUE);if(E===0||b===0)return g.create(h.REF);const R=E>0?C+E-1:C+E+1,N=b>0?_+b-1:_+b+1;if(R<0||N<0)return g.create(h.REF);if(a)return g.create(h.VALUE);const V=C<R?C:R,M=_<N?_:N,D=C>R?C:R,L=_>N?_:N,P={startRow:V,startColumn:M,endRow:D,endColumn:L};return this.createReferenceObject(e,P)}}class Zd extends p{constructor(){super(...arguments);A(this,"minParams",0);A(this,"maxParams",1)}calculate(e){if(e==null)return y.create(this.row+1);if(e.isError())return e;if(!e.isArray())return g.create(h.NA);const t=e.getCurrentRow(),r=e.getRowCount(),n=[];for(let a=0;a<r;a++)n.push([y.create(t+a+1)]);const s={calculateValueList:n,rowCount:r,columnCount:1,unitId:this.unitId||"",sheetId:this.subUnitId||"",row:this.row,column:this.column};return K.create(s)}}class zd extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){if(e.isError())return e;if(e.isString()||e.isNumber()||e.isBoolean())return y.create(1);if(!e.isArray())return g.create(h.NA);const t=e.getRowCount();return y.create(t)}}class Jd extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",4)}calculate(e,t,r,n){const s=t!=null?t:y.create(1),a=r!=null?r:y.create(1),o=n!=null?n:T.create(!1);if(o.isArray()){const c=o.getRowCount(),l=o.getColumnCount();if(c===1&&l===1){const f=o.get(0,0);return this._handleSingleObject(e,s,a,f)}return o.map(f=>{const m=this._handleSingleObject(e,s,a,f);return m.isArray()?m.get(0,0):m})}return this._handleSingleObject(e,s,a,o)}_handleSingleObject(e,t,r,n){if(e.isError())return e;const s=e.isArray()?e.getRowCount():1,a=e.isArray()?e.getColumnCount():1,o=this._checkArrayError(t);if(o.isError())return o;const c=Math.floor(+o.getValue());if(c<1)return g.create(h.VALUE);const l=this._checkArrayError(r);if(l.isError())return l;const f=Math.floor(+l.getValue());if(f!==-1&&f!==1)return g.create(h.VALUE);let m=n;if(m.isString()&&(m=m.convertToNumberObjectValue()),m.isError())return m;if(!e.isArray()||s===1&&a===1)return e;const d=+m.getValue();return this._getResult(e,c,f,d,s,a)}_checkArrayError(e){let t=e;if(t.isArray()){const r=t.getRowCount(),n=t.getColumnCount();if(r>1||n>1)return g.create(h.VALUE);t=t.get(0,0)}return t.isString()&&(t=t.convertToNumberObjectValue()),t}_getResult(e,t,r,n,s,a){if(n){if(t>s)return g.create(h.VALUE);const o=e.transpose().getArrayValue();return o.sort(this._sort(t-1,r)),K.create({calculateValueList:o,rowCount:o.length,columnCount:o[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column}).transpose()}else{if(t>a)return g.create(h.VALUE);const o=e.getArrayValue();return o.sort(this._sort(t-1,r)),K.create({calculateValueList:o,rowCount:o.length,columnCount:o[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}}_sort(e,t=1){const r=rn();return t===1?this._sortAsc(e,r):this._sortDesc(e,r)}_sortAsc(e,t){return(r,n)=>{const s=r[e],a=n[e];if(s==null||s.isNull())return 1;if(a==null||a.isNull())return-1;if(s.isError()&&a.isError())return 0;if(s.isError())return 1;if(a.isError())return-1;const o=s.getValue(),c=a.getValue();return s.isBoolean()&&o===!0?1:a.isBoolean()&&c===!0?-1:s.isBoolean()&&o===!1?1:a.isBoolean()&&c===!1?-1:s.isNumber()&&a.isNumber()?+o-+c:t(o,c)}}_sortDesc(e,t){return(r,n)=>{const s=r[e],a=n[e];if(s==null||s.isNull())return 1;if(a==null||a.isNull())return-1;if(s.isError()&&a.isError())return 0;if(s.isError())return-1;if(a.isError())return 1;const o=s.getValue(),c=a.getValue();return s.isBoolean()&&o===!0?-1:a.isBoolean()&&c===!0?1:s.isBoolean()&&o===!1?-1:a.isBoolean()&&c===!1?1:s.isNumber()&&a.isNumber()?+c-+o:t(c,o)}}}class e0 extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",255)}calculate(e,...t){t.length===1&&t.push(y.create(1));const r=this._getVariantsError(e,...t),{maxRowLength:n,maxColumnLength:s}=nr(t);if(r.isError()){const c=O(n,s,r);return n===1&&s===1?c.get(0,0):c}const a=t.map((c,l)=>l%2===0?c:O(n,s,c,g.create(h.NA))),o=this._getResultArray(e,a,n,s);return n===1&&s===1?o[0][0]:K.create({calculateValueList:o,rowCount:o.length,columnCount:o[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}_getVariantsError(e,...t){if(e.isError())return e;for(let o=0;o<t.length;o++){const c=t[o];if(c.isError())return c}if(t.length<2||t.length%2!==0)return g.create(h.VALUE);const r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,s=t[0].isArray()?t[0].getRowCount():1,a=t[0].isArray()?t[0].getColumnCount():1;if((s>1||a>1)&&(s>1&&a>1||s===1&&a!==n||a===1&&s!==r))return g.create(h.VALUE);for(let o=2;o<t.length;o++){if(o%2===1)continue;const c=t[o].isArray()?t[o].getRowCount():1,l=t[o].isArray()?t[o].getColumnCount():1;if(c!==s||l!==a)return g.create(h.VALUE)}return T.create(!0)}_getResultArray(e,t,r,n){const s=e.isArray()?e.getRowCount():1,a=e.isArray()?e.getColumnCount():1,o=t[0].isArray()?t[0].getRowCount():1,c=t[0].isArray()?t[0].getColumnCount():1,l=[];for(let f=0;f<r;f++){l[f]=[];for(let m=0;m<n;m++){const{isError:d,errorObject:C,byArrays:_,sortOrders:E}=this._getByArraysAndSortOrders(t,f,m,c);if(d){l[f].push(C);continue}if(!e.isArray()||s===1&&a===1){l[f].push(e);continue}let b=e.getArrayValue();o===1&&c===1||(o===1?(b=b.concat(_),b=this._transposeArray(b),b.sort(this._sort(s,E)),b=this._transposeArray(b).slice(0,s)):c===1&&(b=this._transposeArray(b),b=b.concat(_),b=this._transposeArray(b),b.sort(this._sort(a,E)),b=b.map(N=>N.slice(0,a))));const R=K.create({calculateValueList:b,rowCount:b.length,columnCount:b[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column});if(r>1||n>1){l[f].push(R.get(0,0));continue}l[f].push(R)}}return l}_getByArraysAndSortOrders(e,t,r,n){const s=[],a=[];let o=!1,c=null;for(let l=0;l<e.length;l++){if(l%2===1)continue;const f=e[l];let m=e[l+1].get(t,r);if(m.isString()&&(m=m.convertToNumberObjectValue()),m.isError()){o=!0,c=m;break}const d=Math.floor(+m.getValue());if(d!==-1&&d!==1){o=!0,c=g.create(h.VALUE);break}if(a.push(d),f.isArray()){let C=f.getArrayValue();n===1&&(C=this._transposeArray(C)),s.push(C[0])}else s.push([f])}return{isError:o,errorObject:c,byArrays:s,sortOrders:a}}_transposeArray(e){const t=e.length,r=e[0].length,n=[];for(let s=0;s<r;s++){n[s]=[];for(let a=0;a<t;a++)n[s][a]=e[a][s]}return n}_sort(e,t){const r=rn();return(n,s)=>{let a=n[e],o=s[e],c=this._compare(a,o,t[0],r);if(c===0&&t.length>1){for(let l=1;l<t.length;l++)if(a=n[e+l],o=s[e+l],c=this._compare(a,o,t[l],r),c!==0)return c}return c}}_compare(e,t,r,n){return r===1?this._asc(e,t,n):this._desc(e,t,n)}_asc(e,t,r){if(e==null||e.isNull())return 1;if(t==null||t.isNull())return-1;if(e.isError()&&t.isError())return 0;if(e.isError())return 1;if(t.isError())return-1;const n=e.getValue(),s=t.getValue();return e.isBoolean()&&n===!0?1:t.isBoolean()&&s===!0?-1:e.isBoolean()&&n===!1?1:t.isBoolean()&&s===!1?-1:e.isNumber()&&t.isNumber()?+n-+s:r(n,s)}_desc(e,t,r){if(e==null||e.isNull())return 1;if(t==null||t.isNull())return-1;if(e.isError()&&t.isError())return 0;if(e.isError())return-1;if(t.isError())return 1;const n=e.getValue(),s=t.getValue();return e.isBoolean()&&n===!0?-1:t.isBoolean()&&s===!0?1:e.isBoolean()&&n===!1?-1:t.isBoolean()&&s===!1?1:e.isNumber()&&t.isNumber()?+s-+n:r(s,n)}}class t0 extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",3)}calculate(e,t,r){const n=e.isArray()?e.getRowCount():1,s=e.isArray()?e.getColumnCount():1;let a=t,o=r!=null?r:y.create(s);t.isNull()&&(a=y.create(n)),o.isNull()&&(o=y.create(s));const c=Math.max(a.isArray()?a.getRowCount():1,o.isArray()?o.getRowCount():1),l=Math.max(a.isArray()?a.getColumnCount():1,o.isArray()?o.getColumnCount():1),f=O(c,l,a,g.create(h.NA)),m=O(c,l,o,g.create(h.NA));if(c>1||l>1)return f.mapValue((N,V,M)=>{const D=m.get(V,M);if(e.isError())return e;if(e.isNull())return g.create(h.VALUE);const{isError:L,errorObject:P}=this._checkRowsColumns(N,D,n,s);return L?P:e.isArray()?g.create(h.VALUE):e});if(e.isError())return e;if(e.isNull())return g.create(h.VALUE);const d=a.isArray()?a.get(0,0):a,C=o.isArray()?o.get(0,0):o,{isError:_,errorObject:E,rowsValue:b,columnsValue:R}=this._checkRowsColumns(d,C,n,s);return _?E:this._getResultArray(e,b,R,n,s)}_checkRowsColumns(e,t,r,n){if(e.isError())return{isError:!0,errorObject:e};if(t.isError())return{isError:!0,errorObject:t};let s=Math.trunc(+e.getValue()),a=Math.trunc(+t.getValue());return Number.isNaN(s)||Number.isNaN(a)?{isError:!0,errorObject:g.create(h.VALUE)}:Math.abs(s)===0||Math.abs(a)===0?{isError:!0,errorObject:g.create(h.CALC)}:(s>r&&(s=r),a>n&&(a=n),{isError:!1,rowsValue:s,columnsValue:a})}_getResultArray(e,t,r,n,s){if(!e.isArray())return e;const a=t>=0?[0,t]:[n+t,n],o=r>=0?[0,r]:[s+r,s];let c;return t===n&&r===s?c=e:t===n?c=e.slice(void 0,o):r===s?c=e.slice(a,void 0):c=e.slice(a,o),c=c.map(l=>l.isNull()?y.create(0):l),t===1&&r===1?c.get(0,0):c}}class r0 extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",3)}calculate(e,t,r){const n=t!=null?t:y.create(0),s=r!=null?r:T.create(!1),a=Math.max(n.isArray()?n.getRowCount():1,s.isArray()?s.getRowCount():1),o=Math.max(n.isArray()?n.getColumnCount():1,s.isArray()?s.getColumnCount():1),c=O(a,o,n,g.create(h.NA)),l=O(a,o,s,g.create(h.NA)),f=c.mapValue((m,d,C)=>{const _=l.get(d,C);if(e.isError())return e;if(e.isNull())return g.create(h.VALUE);if(m.isError())return m;if(_.isError())return _;const E=Math.trunc(+m.getValue()),b=+_.getValue();if(Number.isNaN(E)||E<0||E>3||Number.isNaN(b))return g.create(h.VALUE);if(!e.isArray())return e;let R=[];return b?R=this._getArrayValueByColumn(e,E):R=this._getArrayValueByRow(e,E),R.length===0?g.create(h.CALC):a>1||o>1||R.length===1?R[0]:K.create({calculateValueList:R.map(N=>[N]),rowCount:R.length,columnCount:1,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})});return a===1&&o===1?f.get(0,0):f}_getArrayValueByColumn(e,t){const r=e,n=r.getRowCount(),s=r.getColumnCount(),a=[];for(let o=0;o<s;o++)for(let c=0;c<n;c++){const l=r.get(c,o);this._isIgnore(l,t)||a.push(l.isNull()?y.create(0):l)}return a}_getArrayValueByRow(e,t){const r=e,n=r.getRowCount(),s=r.getColumnCount(),a=[];for(let o=0;o<n;o++)for(let c=0;c<s;c++){const l=r.get(o,c);this._isIgnore(l,t)||a.push(l.isNull()?y.create(0):l)}return a}_isIgnore(e,t){switch(t){case 0:return!1;case 1:return e.isNull();case 2:return e.isError();case 3:return e.isNull()||e.isError();default:return!1}}}class n0 extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",3)}calculate(e,t,r){const n=t!=null?t:y.create(0),s=r!=null?r:T.create(!1),a=Math.max(n.isArray()?n.getRowCount():1,s.isArray()?s.getRowCount():1),o=Math.max(n.isArray()?n.getColumnCount():1,s.isArray()?s.getColumnCount():1),c=O(a,o,n,g.create(h.NA)),l=O(a,o,s,g.create(h.NA)),f=c.mapValue((m,d,C)=>{const _=l.get(d,C);if(e.isError())return e;if(m.isError())return m;if(_.isError())return _;const E=Math.trunc(+m.getValue()),b=+_.getValue();if(Number.isNaN(E)||E<0||E>3||Number.isNaN(b)||e.isNull())return g.create(h.VALUE);if(!e.isArray())return e;let R=[];return b?R=this._getArrayValueByColumn(e,E):R=this._getArrayValueByRow(e,E),R.length===0?g.create(h.CALC):a>1||o>1||R.length===1?R[0]:K.create({calculateValueList:[R],rowCount:1,columnCount:R.length,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})});return a===1&&o===1?f.get(0,0):f}_getArrayValueByColumn(e,t){const r=e,n=r.getRowCount(),s=r.getColumnCount(),a=[];for(let o=0;o<s;o++)for(let c=0;c<n;c++){const l=r.get(c,o);this._isIgnore(l,t)||a.push(l.isNull()?y.create(0):l)}return a}_getArrayValueByRow(e,t){const r=e,n=r.getRowCount(),s=r.getColumnCount(),a=[];for(let o=0;o<n;o++)for(let c=0;c<s;c++){const l=r.get(o,c);this._isIgnore(l,t)||a.push(l.isNull()?y.create(0):l)}return a}_isIgnore(e,t){switch(t){case 0:return!1;case 1:return e.isNull();case 2:return e.isError();case 3:return e.isNull()||e.isError();default:return!1}}}class s0 extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){if(e.isError())return e;if(e.isArray()){const t=e.getRowCount(),r=e.getColumnCount();return t===1&&r===1?e.get(0,0):e.transpose()}return e}}class a0 extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",3)}calculate(e,t,r){const n=t!=null?t:T.create(!1),s=r!=null?r:T.create(!1),a=e.isArray()?e.getRowCount():1,o=e.isArray()?e.getColumnCount():1,c=Math.max(n.isArray()?n.getRowCount():1,s.isArray()?s.getRowCount():1),l=Math.max(n.isArray()?n.getColumnCount():1,s.isArray()?s.getColumnCount():1),f=O(c,l,n,g.create(h.NA)),m=O(c,l,s,g.create(h.NA)),d=f.map((C,_,E)=>{let b=C,R=m.get(_,E);if(e.isError())return e;if(b.isString()&&(b=b.convertToNumberObjectValue()),b.isError())return b;if(R.isString()&&(R=R.convertToNumberObjectValue()),R.isError())return R;const N=+b.getValue(),V=+R.getValue();let M;return!N&&a===1||N&&o===1?M=e:M=this._getResult(e,N,V),(c>1||l>1)&&(M!=null&&M.isArray())?M.get(0,0):M});return c===1&&l===1?d.get(0,0):d}_getResult(e,t,r){const n=e.isArray()?e.getRowCount():1,s=e.isArray()?e.getColumnCount():1;let a=e.getArrayValue(),o=n,c=s;t&&(a=this._transposeArray(a),o=s,c=n);const l=this._getRepeatRows(a,o,c);if(l.length>0){const f=[];l.forEach(m=>{m.forEach((d,C)=>{(C!==0||r)&&f.push(d)})}),a=a.filter((m,d)=>!f.includes(d))}return a.length===0?g.create(h.CALC):(t&&(a=this._transposeArray(a)),K.create({calculateValueList:a,rowCount:a.length,columnCount:a[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column}))}_getRepeatRows(e,t,r){let n=[];for(let s=0;s<r;s++)if(s===0){const a=new Array(t).fill(null).map((o,c)=>({r:c,valueObject:e[c][s]}));n=this._getRepeatRowsByObjects(a)}else{if(n.length===0)break;let a=[];n.forEach(o=>{const c=o.map(f=>({r:f,valueObject:e[f][s]})),l=this._getRepeatRowsByObjects(c);a=a.concat(l)}),n=a}return n}_getRepeatRowsByObjects(e){const t=new Map;return e.forEach(r=>{const n=r.r,s=r.valueObject;let a=s.getValue();if(s.isNull()?a=null:s.isString()&&S.isRealNum(a)&&(a=+a),!t.has(a))t.set(a,[n]);else{const o=t.get(a);o.push(n),t.set(a,o)}}),Array.from(t.values()).filter(r=>r.length>1)}_transposeArray(e){const t=e.length,r=e[0].length,n=[];for(let s=0;s<r;s++){n[s]=[];for(let a=0;a<t;a++)n[s][a]=e[a][s]}return n}}class i0 extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",4)}calculate(e,t,r,n){if(e.isError())return e;if(t.isError())return t;if(!t.isArray())return g.create(h.VALUE);if(r.isError())return r;if(n!=null&&n.isError())return n;const s=n!=null?n:T.create(!0);return Bi(e)&&Bi(s)&&r.isArray()?this._handleArrayColIndexNum(e,t,r,s):this._handleNonArrayColIndexNum(e,t,r,s)}_handleArrayColIndexNum(e,t,r,n){const s=e.isArray()?e.getFirstCell():e,a=this.getZeroOrOneByOneDefault(n);if(a==null)return g.create(h.VALUE);let o;const c=[];return r.iterator((l,f,m)=>{if(l==null)return o=g.create(h.VALUE),!1;const d=this._handleTableArray(s,t,l,a);if(d.isError())return o=d,!1;c[f]===void 0&&(c[f]=[]),c[f][m]=d}),o||rr(c,c.length,c[0].length,this.unitId||"",this.subUnitId||"")}_handleNonArrayColIndexNum(e,t,r,n){const s=Math.max(e.isArray()?e.getRowCount():1,n.isArray()?n.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,n.isArray()?n.getColumnCount():1),o=O(s,a,e),c=O(s,a,n);return o.map((l,f,m)=>{if(l.isError())return l;const d=c.get(f,m);if(d==null)return g.create(h.VALUE);if(d.isError())return d;const C=this.getZeroOrOneByOneDefault(d);return C==null?g.create(h.VALUE):this._handleTableArray(l,t,r,C)})}_handleTableArray(e,t,r,n){let s=this.getIndexNumValue(r);if(s instanceof g)return s;if(s=Math.floor(s),s<1)return g.create(h.VALUE);const a=t.slice(void 0,[0,1]);if(a==null)return g.create(h.VALUE);const o=t.slice(void 0,[s-1,s]);return o==null?g.create(h.REF):this._handleSingleObject(e,a,o,n)}_handleSingleObject(e,t,r,n){return n===0?this.equalSearch(e,t,r):this.binarySearch(e,t,r)}}class o0 extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){const t=Math.max(...e.map(n=>n.isArray()?n.getColumnCount():1)),r=[];for(let n=0;n<e.length;n++){const s=e[n];if(s.isError())return s;const a=s.isArray()?s.getRowCount():1,o=s.isArray()?s.getColumnCount():1;for(let c=0;c<a;c++){const l=[];for(let f=0;f<t;f++){let m=s;s.isArray()&&(m=s.get(c,f)),f>o-1||!m?l.push(g.create(h.NA)):l.push(m)}r.push(l)}}return K.create({calculateValueList:r,rowCount:r.length,columnCount:r[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}}class u0 extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",3)}calculate(e,t,r){let n=r!=null?r:g.create(h.NA);n.isNull()&&(n=g.create(h.NA));const s=e.isArray()?e.getRowCount():1,a=e.isArray()?e.getColumnCount():1,o=Math.max(t.isArray()?t.getRowCount():1,n.isArray()?n.getRowCount():1),c=Math.max(t.isArray()?t.getColumnCount():1,n.isArray()?n.getColumnCount():1),l=O(o,c,t,g.create(h.NA)),f=O(o,c,n,g.create(h.NA)),m=l.mapValue((d,C,_)=>{const E=f.get(C,_);if(e.isError())return e;if(e.isNull())return g.create(h.VALUE);if(d.isError())return d;const b=Math.trunc(+d.getValue());if(s>1&&a>1||Number.isNaN(b))return g.create(h.VALUE);if(b<1)return g.create(h.NUM);const R=e.isArray()?e.getArrayValue().flat():[e],N=this._getWrapArray(R,b,E);return o>1||c>1||N.length===1&&N[0].length===1?N[0][0]:K.create({calculateValueList:N,rowCount:N.length,columnCount:N[0].length,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})});return o===1&&c===1?m.get(0,0):m}_getWrapArray(e,t,r){const n=Math.ceil(e.length/t),s=n>1?t:e.length,a=[];for(let o=0;o<n;o++)for(let c=0;c<s;c++){a[c]||(a[c]=[]);const l=o*s+c;l<e.length?a[c].push(e[l].isNull()?y.create(0):e[l]):a[c].push(r)}return a}}class c0 extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",3)}calculate(e,t,r){let n=r!=null?r:g.create(h.NA);n.isNull()&&(n=g.create(h.NA));const s=e.isArray()?e.getRowCount():1,a=e.isArray()?e.getColumnCount():1,o=Math.max(t.isArray()?t.getRowCount():1,n.isArray()?n.getRowCount():1),c=Math.max(t.isArray()?t.getColumnCount():1,n.isArray()?n.getColumnCount():1),l=O(o,c,t,g.create(h.NA)),f=O(o,c,n,g.create(h.NA)),m=l.mapValue((d,C,_)=>{const E=f.get(C,_);if(e.isError())return e;if(e.isNull())return g.create(h.VALUE);if(d.isError())return d;const b=Math.trunc(+d.getValue());if(s>1&&a>1||Number.isNaN(b))return g.create(h.VALUE);if(b<1)return g.create(h.NUM);const R=e.isArray()?e.getArrayValue().flat():[e],N=this._getWrapArray(R,b,E);return o>1||c>1||N.length===1&&N[0].length===1?N[0][0]:K.create({calculateValueList:N,rowCount:N.length,columnCount:N[0].length,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})});return o===1&&c===1?m.get(0,0):m}_getWrapArray(e,t,r){const n=Math.ceil(e.length/t),s=n>1?t:e.length,a=[];for(let o=0;o<n;o++){const c=[];for(let l=0;l<s;l++){const f=o*s+l;f<e.length?c.push(e[f].isNull()?y.create(0):e[f]):c.push(r)}a.push(c)}return a}}class l0 extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",6)}calculate(e,t,r,n,s,a){let o=n!=null?n:g.create(h.NA);n!=null&&n.isNull()&&(o=g.create(h.NA));let c=s!=null?s:y.create(0);s!=null&&s.isNull()&&(c=y.create(0));let l=a!=null?a:y.create(1);if(a!=null&&a.isNull()&&(l=y.create(1)),e.isError())return e;if(t.isError()||r.isError())return g.create(h.REF);if(!t.isArray()||!r.isArray())return g.create(h.VALUE);const f=t.getRowCount(),m=t.getColumnCount(),d=r.getRowCount(),C=r.getColumnCount();if(f!==1&&m!==1||f===1&&m>1&&m!==C||m===1&&f>1&&f!==d)return g.create(h.VALUE);if(c.isError())return c;if(l.isError())return l;const _=this.getIndexNumValue(c);if(_ instanceof g)return _;const E=this.getIndexNumValue(l);return E instanceof g?E:this._getResult(e,t,r,o,_,E,f,m,d,C)}_getResult(e,t,r,n,s,a,o,c,l,f){const m=e.isArray()?e.getRowCount():1,d=e.isArray()?e.getColumnCount():1;if(m>1||d>1){let b;return o===1?b=r.slice([0,1]):b=r.slice(void 0,[0,1]),b==null?g.create(h.NA):e.map(R=>{const N=this._checkErrorCombination(s,a);if(N)return N;const V=this._handleSingleObject(R,t,b,s,a);return V.isError()?n:V})}const C=e.isArray()?e.get(0,0):e;if(c===f&&o===l){const b=this._checkErrorCombination(s,a);if(b)return b;const R=this._handleSingleObject(C,t,r,s,a);return R.isError()?n:R}let _=0;c===f&&(_=1);const E=this._handleExpandObject(C,t,r,s,a,_);return E==null?g.create(h.NA):E}_handleExpandObject(e,t,r,n,s,a=0){if((s===2||s===-2)&&n!==2){const o=ps(s),c=Ns(n);return this.binarySearchExpand(e,t,r,a,o,c)}return n===2?this.fuzzySearchExpand(e,t,r,s!==-1,a):n===-1||n===1?this.orderSearchExpand(e,t,r,n===1?Me.MAX:Me.MIN,s===-1,a):this.equalSearchExpand(e,t,r,s!==-1,a)}_handleSingleObject(e,t,r,n,s){if((s===2||s===-2)&&n!==2){const a=ps(s),o=Ns(n);return this.binarySearch(e,t,r,a,o)}return n===2?this.fuzzySearch(e,t,r,s!==-1):n===-1||n===1?this.orderSearch(e,t,r,n===1?Me.MAX:Me.MIN,s===-1):this.equalSearch(e,t,r,s!==-1)}_checkErrorCombination(e,t){return e===2&&(t===-2||t===2)?g.create(h.VALUE):null}}class f0 extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",4)}calculate(e,t,r,n){if(e.isError())return e;if(t.isError())return g.create(h.REF);if(!t.isArray())return g.create(h.VALUE);const s=t.getRowCount(),a=t.getColumnCount();if(s!==1&&a!==1)return g.create(h.VALUE);if(r!=null&&r.isError()||n!=null&&n.isError())return g.create(h.NA);const o=this.getIndexNumValue(r||y.create(0));if(o instanceof g)return o;const c=this.getIndexNumValue(n||y.create(1));return c instanceof g?c:e.isArray()?e.map(l=>this._handleSingleObject(l,t,o,c)):this._handleSingleObject(e,t,o,c)}_handleSingleObject(e,t,r,n){let s;if((n===2||n===-2)&&r!==2){const a=ps(n),o=Ns(r);s=t.binarySearch(e,a,o)}else if(r===2){const a=t.compare(e,H.EQUALS);let o;if(n!==-1?o=a.getFirstTruePosition():o=a.getLastTruePosition(),o==null)return g.create(h.NA);s=t.getRowCount()===1?o.column:o.row}else if(r===-1||r===1){const a=t.orderSearch(e,r===1?Me.MAX:Me.MIN,n===-1);if(a==null)return g.create(h.NA);if(a instanceof g)return a;s=t.getRowCount()===1?a.column:a.row}else{const a=t.isEqual(e);let o;if(n!==-1?o=a.getFirstTruePosition():o=a.getLastTruePosition(),o==null)return g.create(h.NA);s=t.getRowCount()===1?o.column:o.row}return s==null?g.create(h.NA):y.create(s+1)}}const du=[[Pd,ge.ADDRESS],[xd,ge.AREAS],[Ud,ge.CHOOSE],[vd,ge.CHOOSECOLS],[Td,ge.CHOOSEROWS],[Bd,ge.COLUMN],[Fd,ge.COLUMNS],[Id,ge.DROP],[kd,ge.EXPAND],[$d,ge.FILTER],[Yd,ge.FORMULATEXT],[Hd,ge.HLOOKUP],[Gd,ge.HSTACK],[Wd,ge.INDEX],[Qd,ge.INDIRECT],[qd,ge.LOOKUP],[Kd,ge.MATCH],[Xd,ge.OFFSET],[Zd,ge.ROW],[zd,ge.ROWS],[Jd,ge.SORT],[e0,ge.SORTBY],[t0,ge.TAKE],[r0,ge.TOCOL],[n0,ge.TOROW],[s0,ge.TRANSPOSE],[a0,ge.UNIQUE],[i0,ge.VLOOKUP],[o0,ge.VSTACK],[u0,ge.WRAPCOLS],[c0,ge.WRAPROWS],[l0,ge.XLOOKUP],[f0,ge.XMATCH]];class m0 extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.abs()}}class h0 extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.acos()}}class g0 extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.acosh()}}class d0 extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.isArray()?t.map(r=>r.isError()?r:Cu(r)):Cu(t)}}function Cu(i){let u=i.getValue();if(i.isBoolean()&&(u=u?1:0),!Number.isFinite(u))return g.create(h.VALUE);u=Number(u);let e=Math.atan(1/u);return u<0&&(e+=Math.PI),Number.isNaN(e)?g.create(h.VALUE):y.create(e)}class C0 extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.isArray()?t.map(r=>r.isError()?r:_u(r)):_u(t)}}function _u(i){let u=i.getValue();if(i.isBoolean()&&(u=u?1:0),!Number.isFinite(u))return g.create(h.VALUE);if(u=Number(u),Math.abs(u)<=1)return g.create(h.NUM);const e=1/2*Math.log((u+1)/(u-1));return Number.isNaN(e)?g.create(h.VALUE):y.create(e)}class _0 extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.mapValue(r=>this._handleSingleObject(r));return t.getRowCount()===1&&t.getColumnCount()===1?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;if(e.isNull())return y.create(0);if(e.isBoolean()||e.isNumber())return g.create(h.VALUE);let t=e.getValue().toLocaleString().toLocaleUpperCase();if(t.length>255)return g.create(h.VALUE);const r=t.startsWith("-");r&&(t=t.slice(1));let n=0;for(let s=0;s<t.length;s++){const a=Dn.get(t[s])||0,o=Dn.get(t[s+1])||0,c=Dn.get(t[s+2])||0,l=Dn.get(t[s+3])||0;if(!a||c>=o&&c>a||a===o&&a===c&&a===l||a===o/2)return g.create(h.VALUE);a<o?n-=a:n+=a}return y.create(r?-n:n)}}class A0 extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.asin()}}class E0 extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.asinh()}}class b0 extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.atan()}}class y0 extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){let r=e,n=t;return r.isString()&&(r=r.convertToNumberObjectValue()),r.isError()?r:(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError()?n:n.atan2(r))}}class R0 extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.atanh()}}class N0 extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",3)}calculate(e,t,r){const n=r!=null?r:y.create(0);if(e.isError())return e;if(t.isError())return t;if(n.isError())return n;const s=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,n.isArray()?n.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,n.isArray()?n.getColumnCount():1),o=O(s,a,e,g.create(h.NA)),c=O(s,a,t,g.create(h.NA)),l=O(s,a,n,g.create(h.NA)),f=o.map((m,d,C)=>{const _=c.get(d,C),E=l.get(d,C);return this._handleSingleObject(m,_,E)});return f.getRowCount()===1&&f.getColumnCount()===1?f.getArrayValue()[0][0]:f}_handleSingleObject(e,t,r){let n=e;if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;let s=t;if(s.isString()&&(s=s.convertToNumberObjectValue()),s.isError())return s;let a=r;if(a.isString()&&(a=a.convertToNumberObjectValue()),a.isError())return a;const o=Math.floor(+n.getValue()),c=Math.floor(+s.getValue()),l=Math.floor(+a.getValue());if(o<0||o>=2**53||c<2||c>36||l<0)return g.create(h.NUM);let f=o.toString(c);return f.length<l&&(f=new Array(l-f.length+1).join("0")+f),U.create(f.toLocaleUpperCase())}}class p0 extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=O(r,n,e,g.create(h.NA)),a=O(r,n,t,g.create(h.NA)),o=s.map((c,l,f)=>{let m=c,d=a.get(l,f);if(m.isString()&&(m=m.convertToNumberObjectValue()),m.isError())return m;if(d.isString()&&(d=d.convertToNumberObjectValue()),d.isError())return d;const C=+m.getValue(),_=+d.getValue();if(C>0&&_<0)return g.create(h.NUM);if(C===0||_===0)return y.create(0);const E=Ie(C/_,0)*_;return y.create(E)});return o.getRowCount()===1&&o.getColumnCount()===1?o.getArrayValue()[0][0]:o}}class V0 extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",3)}calculate(e,t,r){const n=t!=null?t:y.create(1),s=r!=null?r:y.create(0);if(e.isError())return e;if(n.isError())return n;if(s.isError())return s;const a=Math.max(e.isArray()?e.getRowCount():1,n.isArray()?n.getRowCount():1,s.isArray()?s.getRowCount():1),o=Math.max(e.isArray()?e.getColumnCount():1,n.isArray()?n.getColumnCount():1,s.isArray()?s.getColumnCount():1),c=O(a,o,e,g.create(h.NA)),l=O(a,o,n,g.create(h.NA)),f=O(a,o,s,g.create(h.NA)),m=c.map((d,C,_)=>{let E=d,b=l.get(C,_),R=f.get(C,_);if(E.isString()&&(E=E.convertToNumberObjectValue()),E.isError())return E;if(b.isString()&&(b=b.convertToNumberObjectValue()),b.isError())return b;if(R.isString()&&(R=R.convertToNumberObjectValue()),R.isError())return R;const N=+E.getValue(),V=+b.getValue(),M=+R.getValue();return N===0||V===0?y.create(0):this._getResult(N,V,M)});return a===1&&o===1?m.get(0,0):m}_getResult(e,t,r){let n;return e<0&&r!==0?n=(t<0?Ie(Math.abs(e)/Math.abs(t),0):-Ie(Math.abs(e)/t,0))*t:n=(t<0?-Ie(e/Math.abs(t),0):Ie(e/t,0))*t,y.create(n)}}class O0 extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",2)}calculate(e,t){const r=t!=null?t:y.create(1);if(e.isError())return e;if(r.isError())return r;const n=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),o=O(n,s,r,g.create(h.NA)),c=a.map((l,f,m)=>{let d=o.get(f,m),C=l;if(C.isString()&&(C=C.convertToNumberObjectValue()),C.isError())return C;if(d.isString()&&(d=d.convertToNumberObjectValue()),d.isError())return d;const _=+C.getValue(),E=+d.getValue();if(_===0||E===0)return y.create(0);const b=(E<0?-Ie(_/Math.abs(E),0):Ie(_/E,0))*E;return y.create(b)});return n===1&&s===1?c.get(0,0):c}}class S0 extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=O(r,n,e,g.create(h.NA)),a=O(r,n,t,g.create(h.NA)),o=s.mapValue((c,l,f)=>{let m=c,d=a.get(l,f);if(m.isString()&&(m=m.convertToNumberObjectValue()),d.isString()&&(d=d.convertToNumberObjectValue()),m.isError())return m;if(d.isError())return d;const C=Math.floor(+m.getValue()),_=Math.floor(+d.getValue());if(C<0||_<0||C<_)return g.create(h.NUM);const E=Gt(C,_);return Number.isNaN(E)||!Number.isFinite(E)?g.create(h.NUM):y.create(E)});return r===1&&n===1?o.get(0,0):o}}class M0 extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=O(r,n,e,g.create(h.NA)),a=O(r,n,t,g.create(h.NA)),o=s.mapValue((c,l,f)=>{let m=c,d=a.get(l,f);if(m.isString()&&(m=m.convertToNumberObjectValue()),d.isString()&&(d=d.convertToNumberObjectValue()),m.isError())return m;if(d.isError())return d;const C=Math.floor(+m.getValue()),_=Math.floor(+d.getValue());if(C<0||_<0||C===0&&C<_)return g.create(h.NUM);const E=Gt(C+_-1,C-1);return Number.isNaN(E)||!Number.isFinite(E)?g.create(h.NUM):y.create(E)});return r===1&&n===1?o.get(0,0):o}}class D0 extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.cos()}}class w0 extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.cosh()}}class L0 extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(t=>this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;const r=+t.getValue();return Math.abs(r)>=2**27?g.create(h.NUM):r===0?g.create(h.DIV_BY_ZERO):t.tan().getReciprocal()}}class P0 extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(t=>this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:+t.getValue()===0?g.create(h.DIV_BY_ZERO):t.tanh().getReciprocal()}}class j0 extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(t=>this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;const r=+t.getValue();return Math.abs(r)>=2**27?g.create(h.NUM):r===0?g.create(h.DIV_BY_ZERO):t.sin().getReciprocal()}}class x0 extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(t=>this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;const r=+t.getValue();return r===0?g.create(h.DIV_BY_ZERO):!Number.isNaN(r)&&!Number.isFinite(Math.sinh(r))?y.create(0):t.sinh().getReciprocal()}}class U0 extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=O(r,n,e,g.create(h.NA)),a=O(r,n,t,g.create(h.NA)),o=s.map((c,l,f)=>{if(c.isError())return c;let m=a.get(l,f);if(m.isString()&&(m=m.convertToNumberObjectValue()),m.isError())return m;const d=`${c.getValue()}`,C=Math.floor(+m.getValue());if(S.isRealNum(d)&&(+d<0||+d>=2**53||!Number.isInteger(+d))||d.toLocaleLowerCase()==="true"||d.toLocaleLowerCase()==="false"||C<2||C>36)return g.create(h.NUM);if(d.replace(/\s/g,"")==="")return y.create(0);if(!this._isValidCharForRadix(d,C))return g.create(h.NUM);const _=Number.parseInt(d,C);return Number.isNaN(_)?g.create(h.NUM):y.create(_)});return r===1&&n===1?o.get(0,0):o}_isValidCharForRadix(e,t){for(const r of e){const n=r.toUpperCase().charCodeAt(0);if(t<=10&&!(n>=48&&n<48+t)||t>10&&!(n>=48&&n<58||n>=65&&n<65+t-10))return!1}return!0}}class v0 extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(t=>this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;const r=+t.getValue();if(!Number.isFinite(r))return g.create(h.VALUE);const n=r*(180/Math.PI);return Number.isNaN(n)?g.create(h.VALUE):y.create(n)}}class T0 extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(t=>this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;const r=+t.getValue();if(!Number.isFinite(r))return g.create(h.VALUE);const n=(r<0?-Ie(Math.abs(r)/2,0):Ie(r/2,0))*2;return Number.isNaN(n)?g.create(h.VALUE):n===0?y.create(0):y.create(n)}}class B0 extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.exp()}}class F0 extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){return e.isArray()?e.mapValue(t=>this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;const r=Math.floor(+t.getValue()),n=ur(r);return Number.isNaN(n)||!Number.isFinite(n)?g.create(h.NUM):y.create(n)}}class I0 extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){let t=e;if(e.isArray()){const r=e.getRowCount(),n=e.getColumnCount();if(r>1||n>1)return g.create(h.VALUE);t=e.get(0,0)}return this._handleSingleObject(t)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;const r=Math.floor(+t.getValue()),n=ur(r,2);return Number.isNaN(n)||!Number.isFinite(n)?g.create(h.NUM):y.create(n)}}class k0 extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=O(r,n,e,g.create(h.NA)),a=O(r,n,t,g.create(h.NA)),o=s.map((c,l,f)=>{let m=a.get(l,f),d=c;if(d.isString()&&(d=d.convertToNumberObjectValue()),d.isError())return d;if(m.isString()&&(m=m.convertToNumberObjectValue()),m.isError())return m;const C=+d.getValue(),_=+m.getValue();if(C>0&&_<0)return g.create(h.NUM);if(C===0)return y.create(0);if(_===0)return g.create(h.DIV_BY_ZERO);const E=Ge(C/_,0)*_;return y.create(E)});return r===1&&n===1?o.get(0,0):o}}class $0 extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",3)}calculate(e,t,r){const n=t!=null?t:y.create(1),s=r!=null?r:y.create(0),a=Math.max(e.isArray()?e.getRowCount():1,n.isArray()?n.getRowCount():1,s.isArray()?s.getRowCount():1),o=Math.max(e.isArray()?e.getColumnCount():1,n.isArray()?n.getColumnCount():1,s.isArray()?s.getColumnCount():1),c=O(a,o,e,g.create(h.NA)),l=O(a,o,n,g.create(h.NA)),f=O(a,o,s,g.create(h.NA)),m=c.map((d,C,_)=>{let E=d,b=l.get(C,_),R=f.get(C,_);if(E.isString()&&(E=E.convertToNumberObjectValue()),E.isError())return E;if(b.isString()&&(b=b.convertToNumberObjectValue()),b.isError())return b;if(R.isString()&&(R=R.convertToNumberObjectValue()),R.isError())return R;const N=+E.getValue(),V=+b.getValue(),M=+R.getValue();if(N===0||V===0)return y.create(0);let D;return N<0&&M!==0?D=(V<0?Ge(Math.abs(N)/Math.abs(V),0):-Ge(Math.abs(N)/V,0))*V:D=(V<0?-Ge(N/Math.abs(V),0):Ge(N/V,0))*V,y.create(D)});return a===1&&o===1?m.get(0,0):m}}class Y0 extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",2)}calculate(e,t){const r=t!=null?t:y.create(1);if(e.isError())return e;if(r.isError())return r;const n=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),o=O(n,s,r,g.create(h.NA)),c=a.map((l,f,m)=>{let d=o.get(f,m),C=l;if(C.isString()&&(C=C.convertToNumberObjectValue()),C.isError())return C;if(d.isString()&&(d=d.convertToNumberObjectValue()),d.isError())return d;const _=+C.getValue(),E=+d.getValue();if(_===0||E===0)return y.create(0);const b=(E<0?-Ge(_/Math.abs(E),0):Ge(_/E,0))*E;return y.create(b)});return n===1&&s===1?c.get(0,0):c}}class H0 extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){let t=0;for(let r=0;r<e.length;r++){const n=e[r];if(!n.isNull())if(n.isArray()){let s=!1,a=g.create(h.VALUE);if(n.iterator(o=>{if(o!=null&&o.isNull())return!0;const{isError:c,errorObject:l,number:f}=this._handleSingleObject(o);if(c)return s=!0,a=l,!1;t=ea(t,f)}),s)return a}else{const{isError:s,errorObject:a,number:o}=this._handleSingleObject(n);if(s)return a;t=ea(t,o)}}return y.create(t)}_handleSingleObject(e){if(e.isBoolean())return{isError:!0,errorObject:g.create(h.VALUE),number:null};let t=e;if(e.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return{isError:!0,errorObject:t,number:null};const r=Math.floor(+t.getValue());return r<0||r>=2**53?{isError:!0,errorObject:g.create(h.NUM),number:null}:{isError:!1,errorObject:null,number:r}}}class G0 extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){return e.isArray()?e.mapValue(t=>this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;const r=Math.floor(+t.getValue());return y.create(r)}}class W0 extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){let t=1,r=!0;for(let n=0;n<e.length;n++){const s=e[n];if(!s.isNull())if(s.isArray()){let a=!1,o=g.create(h.VALUE);if(s.iterator(c=>{if(c!=null&&c.isNull())return!0;const{isError:l,errorObject:f,number:m}=this._handleSingleObject(c);if(l)return a=!0,o=f,!1;t=so(t,m),r=!1}),a)return o}else{const{isError:a,errorObject:o,number:c}=this._handleSingleObject(s);if(a)return o;t=so(t,c),r=!1}}return r?y.create(0):Number.isNaN(t)||!Number.isFinite(t)||t>=2**53?g.create(h.VALUE):y.create(t)}_handleSingleObject(e){if(e.isBoolean())return{isError:!0,errorObject:g.create(h.VALUE),number:null};let t=e;if(e.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return{isError:!0,errorObject:t,number:null};const r=Math.floor(+t.getValue());return r<0?{isError:!0,errorObject:g.create(h.NUM),number:null}:{isError:!1,errorObject:null,number:r}}}class Q0 extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.log()}}class q0 extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",2)}calculate(e,t){const r=t!=null?t:y.create(10);if(e.isError())return e;if(r.isError())return r;const n=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),o=O(n,s,r,g.create(h.NA)),c=a.map((l,f,m)=>{let d=o.get(f,m),C=l;if(C.isString()&&(C=C.convertToNumberObjectValue()),C.isError())return C;if(d.isString()&&(d=d.convertToNumberObjectValue()),d.isError())return d;const _=+C.getValue(),E=+d.getValue();if(_<=0||E<=0)return g.create(h.NUM);const b=Math.log(E);if(b===0)return g.create(h.DIV_BY_ZERO);const R=Math.log(_)/b;return y.create(R)});return n===1&&s===1?c.get(0,0):c}}class K0 extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.log10()}}class X0 extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){const t=e.isArray()?e.getRowCount():1,r=e.isArray()?e.getColumnCount():1,n=[];for(let a=0;a<t;a++){const o=[];for(let c=0;c<r;c++){let l=e.isArray()?e.get(a,c):e;if(l.isError())return l;if(l.isNull()||l.isBoolean())return g.create(h.VALUE);if(l.isString()&&(l=l.convertToNumberObjectValue()),l.isError())return l;const f=+l.getValue();o.push(f)}n.push(o)}if(t!==r)return g.create(h.VALUE);const s=ta(n);return y.create(s)}}class Z0 extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){const t=e.isArray()?e.getRowCount():1,r=e.isArray()?e.getColumnCount():1,n=[];for(let a=0;a<t;a++){const o=[];for(let c=0;c<r;c++){let l=e.isArray()?e.get(a,c):e;if(l.isError())return l;if(l.isNull()||l.isBoolean())return g.create(h.VALUE);if(l.isString()&&(l=l.convertToNumberObjectValue()),l.isError())return l;const f=+l.getValue();o.push(f)}n.push(o)}if(t!==r)return g.create(h.VALUE);const s=lm(n);return s===null?g.create(h.NUM):K.createByArray(s)}}class z0 extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,s=t.isArray()?t.getRowCount():1,a=t.isArray()?t.getColumnCount():1;if(n!==s)return g.create(h.VALUE);const o=this._getMatrix(e,r,n),c=this._getMatrix(t,s,a);if(o instanceof g)return o;if(c instanceof g)return c;const l=cr(o,c);return K.createByArray(l)}_getMatrix(e,t,r){const n=[];for(let s=0;s<t;s++){const a=[];for(let o=0;o<r;o++){let c=e.isArray()?e.get(s,o):e;if(c.isError())return c;if(c.isNull()||c.isBoolean())return g.create(h.VALUE);if(c.isString()&&(c=c.convertToNumberObjectValue()),c.isError())return c;const l=+c.getValue();a.push(l)}n.push(a)}return n}}class J0 extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){let r=e;if(r.isString()&&(r=r.convertToNumberObjectValue()),r.isError())return r;let n=t;return n.isString()&&(n=n.convertToNumberObjectValue()),n.isError()?n:r.mod(n)}}class eC extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){let r=e;if(r.isArray()){const c=r.getRowCount(),l=r.getColumnCount();if(c>1||l>1)return g.create(h.VALUE);r=r.get(0,0)}if(r.isError())return r;let n=t;if(n.isArray()){const c=n.getRowCount(),l=n.getColumnCount();if(c>1||l>1)return g.create(h.VALUE);n=n.get(0,0)}if(n.isError())return n;if(r.isBoolean()||n.isBoolean())return g.create(h.VALUE);const s=+r.getValue(),a=+n.getValue();if(Number.isNaN(s)||Number.isNaN(a))return g.create(h.VALUE);if(a===0)return y.create(0);if(s>0&&a<0||s<0&&a>0)return g.create(h.NUM);const o=Dt(s/a,0)*a;return y.create(o)}}class tC extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){let t=0,r=1;for(let s=0;s<e.length;s++){const a=e[s];if(!a.isNull())if(a.isArray()){let o=!1,c=g.create(h.VALUE);if(a.iterator(l=>{if(l!=null&&l.isNull())return!0;const{isError:f,errorObject:m,number:d}=this._handleSingleObject(l);if(f)return o=!0,c=m,!1;if(t+=d,t>170)return o=!0,c=g.create(h.NUM),!1;r*=ur(d)}),o)return c}else{const{isError:o,errorObject:c,number:l}=this._handleSingleObject(a);if(o)return c;if(t+=l,t>170)return g.create(h.NUM);r*=ur(l)}}const n=ur(t)/r;return y.create(n)}_handleSingleObject(e){if(e.isBoolean())return{isError:!0,errorObject:g.create(h.VALUE),number:null};let t=e;if(e.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return{isError:!0,errorObject:t,number:null};const r=Math.floor(+t.getValue());return r<0?{isError:!0,errorObject:g.create(h.NUM),number:null}:{isError:!1,errorObject:null,number:r}}}class rC extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.getRowCount(),r=e.getColumnCount(),n=e.mapValue(s=>{const a=this._handleSingleObject(s);return a.isError()?a:t>1||r>1?a.get(0,0):a});return t===1&&r===1?n.get(0,0):n}return this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;const r=Math.floor(+t.getValue());if(r<=0)return g.create(h.VALUE);const n=[];for(let s=0;s<r;s++){n[s]=[];for(let a=0;a<r;a++)n[s][a]=s===a?1:0}return K.createByArray(n)}}class nC extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(t=>this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;const r=+t.getValue();if(!Number.isFinite(r))return g.create(h.VALUE);let n=r<0?-Ie(Math.abs(r),0):Ie(r,0);return Number.isNaN(n)?g.create(h.VALUE):(Math.abs(n)%2===0&&(r<0?n--:n++),y.create(n))}}class sC extends p{constructor(){super(...arguments);A(this,"minParams",0);A(this,"maxParams",0)}calculate(){return y.create(Math.PI)}}class aC extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){let r=e;if(r.isString()&&(r=r.convertToNumberObjectValue()),r.isError())return r;let n=t;return n.isString()&&(n=n.convertToNumberObjectValue()),n.isError()?n:r.pow(n)}}class iC extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){let t=y.create(1),r=!0;for(let n=0;n<e.length;n++){let s=e[n];if(s.isError())return s;if(s.isArray()){let a=!1,o=null;if(s.iterator(c=>{if(c!=null&&c.isError())return a=!0,o=c,!1;if(!c||c.isNull()||c.isString()||c.isBoolean())return!0;t=t.multiply(c),r=!1}),a)return o}else{if(s.isNull())continue;if(s.isString()&&(s=s.convertToNumberObjectValue()),s.isError())return s;t=t.multiply(s),r=!1}if(t.isError())return t}return r?y.create(0):t}}class oC extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const{isError:r,errorObject:n,variants:s}=W(e,t);if(r)return n;const[a,o]=s,c=+a.getValue(),l=+o.getValue();if(Number.isNaN(c)||Number.isNaN(l))return g.create(h.VALUE);if(l===0)return g.create(h.DIV_BY_ZERO);const f=Math.trunc(c/l);return y.create(f)}}class uC extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(t=>this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;const r=+t.getValue();if(!Number.isFinite(r))return g.create(h.VALUE);const n=r*(Math.PI/180);return Number.isNaN(n)?g.create(h.VALUE):y.create(n)}}class cC extends p{constructor(){super(...arguments);A(this,"minParams",0);A(this,"maxParams",0)}calculate(){return y.create(Math.random())}}class lC extends p{constructor(){super(...arguments);A(this,"minParams",0);A(this,"maxParams",5);A(this,"needsSheetRowColumnCount",!0)}calculate(e,t,r,n,s){if(e!=null&&e.isError())return e;if(t!=null&&t.isError())return t;if(r!=null&&r.isError())return r;if(n!=null&&n.isError())return n;if(s!=null&&s.isError())return s;const a=e!=null?e:y.create(1),o=t!=null?t:y.create(1),c=r!=null?r:y.create(0),l=n!=null?n:y.create(1),f=s!=null?s:y.create(0);return this._calculateResult(a,o,c,l,f)}_calculateResult(e,t,r,n,s){const a=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1,s.isArray()?s.getRowCount():1),o=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1,s.isArray()?s.getColumnCount():1);if(a===1&&o===1)return this._calculateSingleCell(e,t,r,n,s);const c=O(a,o,e,g.create(h.NA)),l=O(a,o,t,g.create(h.NA)),f=O(a,o,r,g.create(h.NA)),m=O(a,o,n,g.create(h.NA)),d=O(a,o,s,g.create(h.NA));return c.map((C,_,E)=>{const b=l.get(_,E),R=f.get(_,E),N=m.get(_,E),V=d.get(_,E),M=this._handleError(C,b,R,N,V);if(M.errorObject)return M.errorObject;let{minValue:D,maxValue:L,wholeNumberValue:P}=M,j;return P?(D=Math.ceil(D),L=Math.floor(L),j=Math.floor(Math.random()*(L-D+1))+D):j=Math.random()*(L-D)+D,j<D||j>L?g.create(h.VALUE):y.create(j)})}_calculateSingleCell(e,t,r,n,s){let a=e;a.isArray()&&(a=a.get(0,0));let o=t;o.isArray()&&(o=o.get(0,0));let c=r;c.isArray()&&(c=c.get(0,0));let l=n;l.isArray()&&(l=l.get(0,0));let f=s;f.isArray()&&(f=f.get(0,0));const m=this._handleError(a,o,c,l,f);if(m.errorObject)return m.errorObject;let{rowsValue:d,columnsValue:C,minValue:_,maxValue:E,wholeNumberValue:b}=m;if(b&&(_=Math.ceil(_),E=Math.floor(E),_>E))return g.create(h.VALUE);const R=[];for(let N=0;N<d;N++){const V=[];for(let M=0;M<C;M++)b?V.push(Math.floor(Math.random()*(E-_+1))+_):V.push(Math.random()*(E-_)+_);R.push(V)}return d===1&&C===1?y.create(R[0][0]):K.createByArray(R)}_handleError(e,t,r,n,s){let a=e;if(a.isString()&&(a=a.convertToNumberObjectValue()),a.isError())return{errorObject:a};let o=t;if(o.isString()&&(o=o.convertToNumberObjectValue()),o.isError())return{errorObject:o};let c=r;if(c.isString()&&(c=c.convertToNumberObjectValue()),c.isError())return{errorObject:c};let l=n;if(l.isString()&&(l=l.convertToNumberObjectValue()),l.isError())return{errorObject:l};let f=s;return f.isString()&&(f=f.convertToNumberObjectValue()),f.isError()?{errorObject:f}:this._getValue(a,o,c,l,f)}_getValue(e,t,r,n,s){const a=Math.floor(+e.getValue()),o=Math.floor(+t.getValue());if(a===0||o===0)return{errorObject:g.create(h.CALC)};const c=this._rowCount-this.row,l=this._columnCount-this.column;if(a<0||o<0||a*o>10**7)return{errorObject:g.create(h.VALUE)};if(a>c||o>l)return{errorObject:g.create(h.REF)};const f=+r.getValue(),m=+n.getValue(),d=+s.getValue();return f>m?{errorObject:g.create(h.VALUE)}:d&&(!Number.isInteger(f)||!Number.isInteger(m))?{errorObject:g.create(h.VALUE)}:{rowsValue:a,columnsValue:o,minValue:f,maxValue:m,wholeNumberValue:d}}}class fC extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){let r=e;if(r.isArray()){const c=r.getRowCount(),l=r.getColumnCount();if(c>1||l>1)return g.create(h.VALUE);r=r.get(0,0)}if(r.isError())return r;let n=t;if(n.isArray()){const c=n.getRowCount(),l=n.getColumnCount();if(c>1||l>1)return g.create(h.VALUE);n=n.get(0,0)}if(n.isError())return n;if(r.isBoolean()||n.isBoolean())return g.create(h.VALUE);let s=+r.getValue(),a=+n.getValue();if(Number.isNaN(s)||Number.isNaN(a))return g.create(h.VALUE);if(s>a)return g.create(h.NUM);s=Math.ceil(s),a=Math.floor(a);const o=Math.floor(Math.random()*(a-s+1))+s;return y.create(o)}}class mC extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",2)}calculate(e,t){const r=t!=null?t:y.create(0),n=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),o=O(n,s,r,g.create(h.NA)),c=a.mapValue((l,f,m)=>{const d=o.get(f,m);return l.isError()?l:d.isError()?d:this._handleSingleObject(l,d)});return n===1&&s===1?c.get(0,0):c}_handleSingleObject(e,t){const{isError:r,errorObject:n,variants:s}=k(e);if(r)return n;const[a]=s;let o=Math.floor(+a.getValue()),c=t;if(c.isString()&&(c=c.convertToNumberObjectValue(),c.isError()))return c;let l=Math.floor(+c.getValue());if(c.isBoolean()&&(l=c.getValue()?0:4),o<0||o>3999||l<0||l>4)return g.create(h.VALUE);const f=Am[l];let m=f.length-1,d="";for(;o>0;){m=this._binarySearch(o,0,m,f);const C=f[m];o-=C,d+=_m.get(C)}return U.create(d)}_binarySearch(e,t,r,n){let s=t,a=r;for(;a-s>1;){const o=Math.floor((s+a)/2),c=n[o];if(c===e)return o;c>e?a=o:s=o}return s!==a&&n[a]<=e?a:s}}class hC extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){let r=e;if(r.isString()&&(r=r.convertToNumberObjectValue()),r.isError())return r;let n=t;return n.isString()&&(n=n.convertToNumberObjectValue()),n.isError()?n:r.round(n)}}class gC extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=O(r,n,e,g.create(h.NA)),a=O(r,n,t,g.create(h.NA)),o=s.mapValue((c,l,f)=>{const m=a.get(l,f);if(c.isError())return c;if(m.isError())return m;const{isError:d,errorObject:C,variants:_}=k(c,m);if(d)return C;const[E,b]=_,R=+E.getValue(),N=Math.trunc(+b.getValue()),V=this._roundBank(R,N);return y.create(V)});return r===1&&n===1?o.get(0,0):o}_roundBank(e,t){if(t>16)return e;if(t<-16)return 0;const r=1e-8,n=10**t,s=+(e*n).toFixed(8),a=Math.floor(s),o=s-a;let c=Math.round(s);return o>.5-r&&o<.5+r&&(c=a%2===0?a:a+1),t?c/n:c}}class dC extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){let r=e;if(r.isString()&&(r=r.convertToNumberObjectValue()),r.isError())return r;let n=t;return n.isString()&&(n=n.convertToNumberObjectValue()),n.isError()?n:r.floor(n)}}class CC extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){let r=e;if(r.isString()&&(r=r.convertToNumberObjectValue()),r.isError())return r;let n=t;return n.isString()&&(n=n.convertToNumberObjectValue()),n.isError()?n:r.ceil(n)}}class _C extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(t=>this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;const r=+t.getValue();return Math.abs(r)>=2**27?g.create(h.NUM):t.cos().getReciprocal()}}class AC extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(t=>this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;const r=+t.getValue();return Number.isFinite(Math.cosh(r))?Math.abs(r)>=2**27?g.create(h.NUM):t.cosh().getReciprocal():y.create(0)}}class EC extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",4);A(this,"needsSheetRowColumnCount",!0)}calculate(e,t,r,n){let s=e,a=t!=null?t:y.create(1),o=r!=null?r:y.create(1),c=n!=null?n:y.create(1);s.isNull()&&(s=y.create(1)),a.isNull()&&(a=y.create(1)),o.isNull()&&(o=y.create(1)),c.isNull()&&(c=y.create(1));const l=Math.max(s.isArray()?s.getRowCount():1,a.isArray()?a.getRowCount():1,o.isArray()?o.getRowCount():1,c.isArray()?c.getRowCount():1),f=Math.max(s.isArray()?s.getColumnCount():1,a.isArray()?a.getColumnCount():1,o.isArray()?o.getColumnCount():1,c.isArray()?c.getColumnCount():1),m=O(l,f,s,g.create(h.NA)),d=O(l,f,a,g.create(h.NA)),C=O(l,f,o,g.create(h.NA)),_=O(l,f,c,g.create(h.NA)),E=m.mapValue((b,R,N)=>{const V=d.get(R,N),M=C.get(R,N),D=_.get(R,N);return b.isError()?b:V.isError()?V:M.isError()?M:D.isError()?D:this._getResult(b,V,M,D,l,f)});return l===1&&f===1?E.get(0,0):E}_getResult(e,t,r,n,s,a){const{isError:o,errorObject:c,variants:l}=k(e,t,r,n);if(o)return c;const[f,m,d,C]=l,_=Math.floor(+f.getValue()),E=Math.floor(+m.getValue()),b=+d.getValue(),R=+C.getValue();if(_<0||E<0||_*E>10**7)return g.create(h.VALUE);if(_===0||E===0)return g.create(h.CALC);const N=this._rowCount-this.row,V=this._columnCount-this.column;if(_>N||E>V)return g.create(h.REF);const M=[];for(let D=0;D<_;D++){M[D]=[];for(let L=0;L<E;L++)M[D][L]=b+(D*E+L)*R}return s>1||a>1?y.create(M[0][0]):K.createByArray(M)}}class bC extends p{constructor(){super(...arguments);A(this,"minParams",4);A(this,"maxParams",4)}calculate(e,t,r,n){if(e.isNull()||t.isNull()||r.isNull()||n.isNull())return g.create(h.NA);const{isError:s,errorObject:a,variants:o}=W(e,t,r);if(s)return a;const{isError:c,errorObject:l,variants:f}=k(...o);if(c)return l;const[m,d,C]=f,_=+m.getValue(),E=+d.getValue(),b=+C.getValue(),R=[];if(n.isArray()){let V=!1,M=g.create(h.VALUE);if(n.iterator(D=>{const{isError:L,errorObject:P,coefficientsObject:j}=this._handleSingleObject(D);if(L)return V=!0,M=P,!1;const F=+j.getValue();R.push(F)}),V)return M}else{const{isError:V,errorObject:M,coefficientsObject:D}=this._handleSingleObject(n);if(V)return M;const L=+D.getValue();R.push(L)}let N=0;for(let V=0;V<R.length;V++)N+=R[V]*_**(E+V*b);return Number.isNaN(N)||!Number.isFinite(N)?g.create(h.NUM):y.create(N)}_handleSingleObject(e){if(e.isError())return{isError:!0,errorObject:e,coefficientsObject:null};if(e!=null&&e.isBoolean())return{isError:!0,errorObject:g.create(h.VALUE),coefficientsObject:null};let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?{isError:!0,errorObject:t,coefficientsObject:null}:{isError:!1,errorObject:null,coefficientsObject:t}}}class yC extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.mapValue(r=>this._handleSingleObject(r));return t.getRowCount()===1&&t.getColumnCount()===1?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;const{isError:t,errorObject:r,variants:n}=k(e);if(t)return r;const[s]=n,a=+s.getValue();return a>0?y.create(1):a<0?y.create(-1):y.create(0)}}class RC extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.sin()}}class NC extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.sinh()}}class pC extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.sqrt()}}class VC extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){let t=e;if(t.isArray()){const s=t.getRowCount(),a=t.getColumnCount();if(s>1||a>1)return g.create(h.VALUE);t=t.get(0,0)}if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;const r=+t.getValue();if(r<0)return g.create(h.NUM);const n=Math.sqrt(r*Math.PI);return y.create(n)}}class OC extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",255);A(this,"needsReferenceObject",!0);A(this,"needsFilteredOutRows",!0)}calculate(e,...t){return e.isError()?e:e.isReferenceObject()?e.toArrayValueObject().mapValue(r=>this._handleSingleObject(r,...t)):this._handleSingleObject(e,...t)}_handleSingleObject(e,...t){const r=this._getIndexNumValue(e);let n;if(r instanceof g)return r;switch(r){case 1:n=this._average(!1,...t);break;case 2:n=this._count(!1,...t);break;case 3:n=this._counta(!1,...t);break;case 4:n=this._max(!1,...t);break;case 5:n=this._min(!1,...t);break;case 6:n=this._product(!1,...t);break;case 7:n=this._stdev(!1,...t);break;case 8:n=this._stdevp(!1,...t);break;case 9:n=this._sum(!1,...t);break;case 10:n=this._var(!1,...t);break;case 11:n=this._varp(!1,...t);break;case 101:n=this._average(!0,...t);break;case 102:n=this._count(!0,...t);break;case 103:n=this._counta(!0,...t);break;case 104:n=this._max(!0,...t);break;case 105:n=this._min(!0,...t);break;case 106:n=this._product(!0,...t);break;case 107:n=this._stdev(!0,...t);break;case 108:n=this._stdevp(!0,...t);break;case 109:n=this._sum(!0,...t);break;case 110:n=this._var(!0,...t);break;case 111:n=this._varp(!0,...t);break;default:n=g.create(h.VALUE)}return n}_getIndexNumValue(e){const t=e?Number(e.getValue()):0;if(Number.isNaN(t))return g.create(h.VALUE);const r=Math.floor(t);return r>=1&&r<=11||r>=101&&r<=111?r:g.create(h.VALUE)}_average(e,...t){const r=this._flattenRefArray(e,...t);return r.isError()?r:r.mean()}_count(e,...t){let r=y.create(0);for(let n=0;n<t.length;n++){const s=t[n];if(!s.isReferenceObject())return g.create(h.VALUE);const a=s.getFilteredOutRows(),o=s.getRowData();s.iterator((c,l)=>{if(a.includes(l)||e&&this._isRowHidden(o,l))return!0;c!=null&&c.isNumber()&&(r=r.plusBy(1))})}return r}_counta(e,...t){let r=y.create(0);for(let n=0;n<t.length;n++){const s=t[n];if(!s.isReferenceObject())return g.create(h.VALUE);const a=s.getFilteredOutRows(),o=s.getRowData();s.iterator((c,l)=>{if(a.includes(l)||e&&this._isRowHidden(o,l)||c==null||c.isNull())return!0;r=r.plusBy(1)})}return r}_max(e,...t){const r=this._flattenRefArray(e,...t);return r.isError()?r:this._isBlankArrayObject(r)?y.create(0):r.max()}_min(e,...t){const r=this._flattenRefArray(e,...t);return r.isError()?r:this._isBlankArrayObject(r)?y.create(0):r.min()}_product(e,...t){const r=this._flattenRefArray(e,...t);if(r.isError())return r;if(this._isBlankArrayObject(r))return y.create(0);let n=y.create(1);return r.iterator(s=>{n=n.multiply(s)}),n}_stdev(e,...t){const r=this._flattenRefArray(e,...t);return r.isError()?r:this._isBlankArrayObject(r)?g.create(h.DIV_BY_ZERO):r.std(1)}_stdevp(e,...t){const r=this._flattenRefArray(e,...t);return r.isError()?r:this._isBlankArrayObject(r)?g.create(h.DIV_BY_ZERO):r.std()}_sum(e,...t){const r=this._flattenRefArray(e,...t);return r.isError()?r:r.sum()}_var(e,...t){const r=this._flattenRefArray(e,...t);return r.isError()?r:this._isBlankArrayObject(r)?g.create(h.DIV_BY_ZERO):r.var(1)}_varp(e,...t){const r=this._flattenRefArray(e,...t);return r.isError()?r:this._isBlankArrayObject(r)?g.create(h.DIV_BY_ZERO):r.var()}_flattenRefArray(e,...t){const r=[];r[0]=[];for(let n=0;n<t.length;n++){const s=t[n];if(s.isError())return s;if(!s.isReferenceObject())return g.create(h.VALUE);const a=s.getFilteredOutRows(),o=s.getRowData();let c;if(s.iterator((l,f)=>{if(a.includes(f)||e&&this._isRowHidden(o,f)||l==null||l.isNull()||l.isString()||l.isBoolean())return!0;if(l.isError())return c=l,!1;r[0].push(l)}),c!=null&&c.isError())return c}return rr(r,1,r[0].length)}_isRowHidden(e,t){const r=e[t];return r?r.hd===S.BooleanNumber.TRUE:!1}_isBlankArrayObject(e){return e.getArrayValue()[0].length===0}}class SC extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){let t=y.create(0);for(let r=0;r<e.length;r++){let n=e[r];if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError()||(n.isArray()&&(n=n.sum()),n.isError()))return n;if(t=t.plus(n),t.isError())return t}return t}}class MC extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",3);A(this,"needsReferenceObject",!0)}calculate(e,t,r){let n=t;if(t.isReferenceObject()&&(n=t.toArrayValueObject()),n.isArray()){const s=n.mapValue(a=>this._handleSingleObject(e,a,r));return s.getRowCount()===1&&s.getColumnCount()===1?s.get(0,0):s}return this._handleSingleObject(e,n,r)}_handleSingleObject(e,t,r){if(e.isError())return e;if(t.isError())return t;if(r!=null&&r.isError())return r;if(!e.isReferenceObject()||r&&!r.isReferenceObject())return g.create(h.VALUE);const n=e.toArrayValueObject();let s=Cn(n,t);s=_n(s,n,t);const a=n.getRowCount(),o=n.getColumnCount();let c=n;if(r){c=r.toArrayValueObject();const l=c.getRowCount(),f=c.getColumnCount();if(a!==l||o!==f){const m=r.getRangeData();m.endRow=m.startRow+a-1,m.endColumn=m.startColumn+o-1,r.setRangeData(m),c=r.toArrayValueObject()}}return c.pick(s).sum()}}class DC extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",255)}calculate(e,...t){if(e.isError())return e;if(!e.isArray()||t.length<2||t.length%2!==0||t.some((o,c)=>c%2===0&&!o.isArray()))return g.create(h.VALUE);const{maxRowLength:r,maxColumnLength:n}=nr(t),s=Vr(t,e,r,n);if(s)return s;const a=Or(t,r,n,!0);return this._aggregateResults(e,a)}_aggregateResults(e,t){const r=t.map(s=>s.map(a=>e.pick(a).sum())),n={calculateValueList:r,rowCount:r.length,columnCount:r[0].length,unitId:this.unitId||"",sheetId:this.subUnitId||"",row:this.row,column:this.column};return K.create(n)}}class wC extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(e,...t){if(e.isError())return e;const r=this._initArray1(e);if(t.length>0){const n=r.getRowCount(),s=r.getColumnCount();let a=this._getResultArrayByArray1(n,s,r);if(a instanceof g)return a;a=a;for(let c=0;c<t.length;c++){if(t[c].isError())return t[c];let l=1,f=1;if(t[c].isArray()&&(l=t[c].getRowCount(),f=t[c].getColumnCount()),l!==n||f!==s)return g.create(h.VALUE);for(let m=0;m<n;m++){const d=[];for(let C=0;C<s;C++){let _=t[c];if(t[c].isArray()&&(_=t[c].get(m,C)),_.isError())return _;const E=_.getValue();!E||!S.isRealNum(E)?d.push(0):d.push(+E*a[m][C])}a[m]=d}}const o=a.reduce((c,l)=>c.concat(l)).reduce((c,l)=>c+l,0);return y.create(o)}else return r.sum()}_initArray1(e){let t=e;return t.isArray()||(t=K.create({calculateValueList:[[t]],rowCount:1,columnCount:1,unitId:"",sheetId:"",row:0,column:0})),t}_getResultArrayByArray1(e,t,r){const n=[];for(let s=0;s<e;s++){const a=[];for(let o=0;o<t;o++){const c=r.get(s,o);if(c.isError())return c;const l=c.getValue();!l||!S.isRealNum(l)?a.push(0):a.push(+l)}n.push(a)}return n}}class LC extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){let t=y.create(0);const r=y.create(2);for(let n=0;n<e.length;n++){let s=e[n];if(s.isString()&&(s=s.convertToNumberObjectValue()),s.isError())return s;if(s.isArray()?s.iterator(a=>{if(a==null||a.isString()||a.isBoolean()||a.isNull())return!0;if(a.isError())return t=a,!1;t=t.plus(a.pow(r))}):t=t.plus(s.pow(r)),t.isError())return t}return t}}class PC extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;const r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,s=r*n,a=t.isArray()?t.getRowCount():1,o=t.isArray()?t.getColumnCount():1,c=a*o;if(s!==c)return g.create(h.NA);if(s===1)return this._calculateSingleCell(e,t);{const l=e.flatten(),f=t.flatten();let m=oe.create();const d=[],C=[];let _=0;return l.iterator((E,b,R)=>{const N=f.get(b,R);if(E==null||E.isString()||E.isBoolean()||E.isNull())return!0;if(E!=null&&E.isError())return m=E,!1;if(N==null||N.isString()||N.isBoolean()||N.isNull())return!0;if(N!=null&&N.isError())return m=N,!1;const V=+E.getValue(),M=+N.getValue();d.push(V),C.push(M),_+=V**2-M**2}),m.isError()?m:d.length===0||C.length===0?g.create(h.DIV_BY_ZERO):y.create(_)}}_calculateSingleCell(e,t){let r=e;if(r.isArray()&&(r=r.get(0,0)),r.isError())return r;let n=t;if(n.isArray()&&(n=n.get(0,0)),n.isError())return n;if(r.isNull()||n.isNull())return g.create(h.VALUE);const s=+r.getValue(),a=+n.getValue();if(r.isString()&&!S.isRealNum(s)||r.isBoolean()||n.isString()&&!S.isRealNum(a)||n.isBoolean())return g.create(h.DIV_BY_ZERO);const o=s**2-a**2;return y.create(o)}}class jC extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;const r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,s=r*n,a=t.isArray()?t.getRowCount():1,o=t.isArray()?t.getColumnCount():1,c=a*o;if(s!==c)return g.create(h.NA);if(s===1)return this._calculateSingleCell(e,t);{const l=e.flatten(),f=t.flatten();let m=oe.create();const d=[],C=[];let _=0;return l.iterator((E,b,R)=>{const N=f.get(b,R);if(E==null||E.isString()||E.isBoolean()||E.isNull())return!0;if(E!=null&&E.isError())return m=E,!1;if(N==null||N.isString()||N.isBoolean()||N.isNull())return!0;if(N!=null&&N.isError())return m=N,!1;const V=+E.getValue(),M=+N.getValue();d.push(V),C.push(M),_+=V**2+M**2}),m.isError()?m:d.length===0||C.length===0?g.create(h.DIV_BY_ZERO):y.create(_)}}_calculateSingleCell(e,t){let r=e;if(r.isArray()&&(r=r.get(0,0)),r.isError())return r;let n=t;if(n.isArray()&&(n=n.get(0,0)),n.isError())return n;if(r.isNull()||n.isNull())return g.create(h.VALUE);const s=+r.getValue(),a=+n.getValue();if(r.isString()&&!S.isRealNum(s)||r.isBoolean()||n.isString()&&!S.isRealNum(a)||n.isBoolean())return g.create(h.DIV_BY_ZERO);const o=s**2+a**2;return y.create(o)}}class xC extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;const r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,s=r*n,a=t.isArray()?t.getRowCount():1,o=t.isArray()?t.getColumnCount():1,c=a*o;if(s!==c)return g.create(h.NA);if(s===1)return this._calculateSingleCell(e,t);{const l=e.flatten(),f=t.flatten();let m=oe.create();const d=[],C=[];let _=0;return l.iterator((E,b,R)=>{const N=f.get(b,R);if(E==null||E.isString()||E.isBoolean()||E.isNull())return!0;if(E!=null&&E.isError())return m=E,!1;if(N==null||N.isString()||N.isBoolean()||N.isNull())return!0;if(N!=null&&N.isError())return m=N,!1;const V=+E.getValue(),M=+N.getValue();d.push(V),C.push(M),_+=(V-M)**2}),m.isError()?m:d.length===0||C.length===0?g.create(h.DIV_BY_ZERO):y.create(_)}}_calculateSingleCell(e,t){let r=e;if(r.isArray()&&(r=r.get(0,0)),r.isError())return r;let n=t;if(n.isArray()&&(n=n.get(0,0)),n.isError())return n;if(r.isNull()||n.isNull())return g.create(h.VALUE);const s=+r.getValue(),a=+n.getValue();if(r.isString()&&!S.isRealNum(s)||r.isBoolean()||n.isString()&&!S.isRealNum(a)||n.isBoolean())return g.create(h.DIV_BY_ZERO);const o=(s-a)**2;return y.create(o)}}class UC extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.tan()}}class vC extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.tanh()}}class TC extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",2)}calculate(e,t){const r=t!=null?t:y.create(0),n=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),o=O(n,s,r,g.create(h.NA)),c=a.map((l,f,m)=>{let d=o.get(f,m),C=l;if(C.isString()&&(C=C.convertToNumberObjectValue()),C.isError())return C;if(d.isString()&&(d=d.convertToNumberObjectValue()),d.isError())return d;const _=+C.getValue(),E=+d.getValue(),b=10**Math.trunc(E),R=mn(_,b),N=Math.trunc(tr(_,b)+R)/b;return y.create(N)});return n===1&&s===1?c.get(0,0):c}}const Au=[[m0,G.ABS],[h0,G.ACOS],[g0,G.ACOSH],[d0,G.ACOT],[C0,G.ACOTH],[_0,G.ARABIC],[A0,G.ASIN],[E0,G.ASINH],[b0,G.ATAN],[y0,G.ATAN2],[R0,G.ATANH],[N0,G.BASE],[p0,G.CEILING],[V0,G.CEILING_MATH],[O0,G.CEILING_PRECISE],[S0,G.COMBIN],[M0,G.COMBINA],[D0,G.COS],[w0,G.COSH],[L0,G.COT],[P0,G.COTH],[j0,G.CSC],[x0,G.CSCH],[U0,G.DECIMAL],[v0,G.DEGREES],[T0,G.EVEN],[B0,G.EXP],[F0,G.FACT],[I0,G.FACTDOUBLE],[k0,G.FLOOR],[$0,G.FLOOR_MATH],[Y0,G.FLOOR_PRECISE],[H0,G.GCD],[G0,G.INT],[W0,G.LCM],[Q0,G.LN],[q0,G.LOG],[K0,G.LOG10],[X0,G.MDETERM],[Z0,G.MINVERSE],[z0,G.MMULT],[J0,G.MOD],[eC,G.MROUND],[tC,G.MULTINOMIAL],[rC,G.MUNIT],[nC,G.ODD],[sC,G.PI],[aC,G.POWER],[iC,G.PRODUCT],[oC,G.QUOTIENT],[uC,G.RADIANS],[cC,G.RAND],[lC,G.RANDARRAY],[fC,G.RANDBETWEEN],[mC,G.ROMAN],[hC,G.ROUND],[gC,G.ROUNDBANK],[dC,G.ROUNDDOWN],[CC,G.ROUNDUP],[_C,G.SEC],[AC,G.SECH],[bC,G.SERIESSUM],[EC,G.SEQUENCE],[yC,G.SIGN],[RC,G.SIN],[NC,G.SINH],[pC,G.SQRT],[VC,G.SQRTPI],[OC,G.SUBTOTAL],[SC,G.SUM],[MC,G.SUMIF],[DC,G.SUMIFS],[wC,G.SUMPRODUCT],[LC,G.SUMSQ],[PC,G.SUMX2MY2],[jC,G.SUMX2PY2],[xC,G.SUMXMY2],[UC,G.TAN],[vC,G.TANH],[TC,G.TRUNC]];class BC extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2);A(this,"_compareType",H.EQUALS)}setCompareType(e){this._compareType=e}calculate(e,t){return e.isError()?e:t.isError()?t:e.compare(t,this._compareType)}}class ya extends _t{constructor(e){super("");A(this,"_values",[]);this._values=e}static create(e){return new ya(e)}isCube(){return!0}dispose(){this._values.forEach(e=>{e.dispose()}),this._values=[]}sum(){const e=y.create(0);return this._values.forEach(t=>{e.plus(t.sum())}),e}max(){let e=y.create(Number.NEGATIVE_INFINITY);return this._values.forEach(t=>{const r=t.max();e.isLessThan(r)&&(e=r)}),e}min(){let e=y.create(Number.POSITIVE_INFINITY);return this._values.forEach(t=>{const r=t.max();e.isGreaterThan(r)&&(e=r)}),e}count(){const e=y.create(0);return this._values.forEach(t=>{e.plus(t.count())}),e}countA(){const e=y.create(0);return this._values.forEach(t=>{e.plus(t.countA())}),e}countBlank(){const e=y.create(0);return this._values.forEach(t=>{e.plus(t.countBlank())}),e}}class FC extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){const t=[];for(let r=0;r<e.length;r++){const n=e[r];if(n.isError())return n;if(!n.isArray())return g.create(h.VALUE);t.push(n)}return ya.create(t)}}class IC extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){return e.isError()?e:t.isError()?t:!t.isArray()&&t.getValue()===0?g.create(h.DIV_BY_ZERO):e.divided(t)}}class kC extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){return e.isError()?e:t.isError()?t:e.minus(t)}}class $C extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){return e.isError()?e:t.isError()?t:e.multiply(t)}}class YC extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){return e.isError()?e:t.isError()?t:e.plus(t)}}const Eu=[[BC,Ue.COMPARE],[IC,Ue.DIVIDED],[kC,Ue.MINUS],[$C,Ue.MULTIPLY],[YC,Ue.PLUS],[FC,Ue.CUBE]];class HC extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){let t=y.create(0),r=y.create(0);for(let a=0;a<e.length;a++){let o=e[a];if(o.isString()&&(o=o.convertToNumberObjectValue()),o.isError())return o;if(o.isArray()){if(o=GC(o),o.isError())return o;if(e[a]=o,t=t.plus(o.sum()),t.isError())return t;r=r.plus(o.count())}else o.isNull()||(t=t.plus(o),r=r.plus(y.create(1)))}if(r.getValue()===0)return g.create(h.NUM);const n=t.divided(r);if(n.isError())return n;let s=y.create(0);for(let a=0;a<e.length;a++){let o=e[a];if(o.isString()&&(o=o.convertToNumberObjectValue()),o.isError())return o;if(o.isArray()){if(s=s.plus(o.minus(n).abs().sum()),s.isError())return s}else o.isNull()||(s=s.plus(o.minus(n).abs()))}return s.divided(r)}}function GC(i){const u=[];u[0]=[];let e=null;return i.iterator((t,r,n)=>{if(t!=null&&t.isError())return e=t,!1;t!=null&&t.isNumber()&&u[0].push(t)}),e||rr(u,1,u[0].length)}class WC extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){let t=y.create(0),r=y.create(0);for(let n=0;n<e.length;n++){let s=e[n];if((s.isString()||s.isBoolean())&&(s=s.convertToNumberObjectValue()),s.isError())return s;if(s.isArray()){if(t=t.plus(s.sum()),t.isError())return t;r=r.plus(s.count())}else s.isNull()||(t=t.plus(s),r=r.plus(y.create(1)))}return t.divided(r)}}class QC extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",254)}calculate(...e){let t=!1,r;e.length%2!==0&&(t=!0,r=g.create(h.NA));const n=[],s=[];for(let a=0;a<e.length;a+=2){const o=e[a],c=o.isArray()?o.getRowCount():1,l=o.isArray()?o.getColumnCount():1;for(let C=0;C<c;C++)for(let _=0;_<l;_++){const E=o.isArray()?o.get(C,_):o;if(E.isError())return E;if(t)continue;const b=E.isNull()?"":E.getValue();n.push(b)}if(a+1>=e.length)continue;const f=e[a+1],m=f.isArray()?f.getRowCount():1,d=f.isArray()?f.getColumnCount():1;(m!==c||d!==l)&&(t=!0,r=g.create(h.VALUE));for(let C=0;C<m;C++)for(let _=0;_<d;_++){const E=f.isArray()?f.get(C,_):f;if(E.isError())return E;if(t)continue;const b=E.isNull()?"":E.getValue();s.push(b)}}return t?r:this._getResult(n,s)}_getResult(e,t){const r=e.length;let n=0,s=0;for(let o=0;o<r;o++){const c=e[o],l=t[o];if(!(typeof c!="number"&&typeof l!="number")){if(typeof c!="number"||typeof l!="number"||l<0)return g.create(h.VALUE);n+=c*l,s+=l}}if(s===0)return g.create(h.DIV_BY_ZERO);const a=n/s;return y.create(a)}}class qC extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){let t=y.create(0),r=y.create(0);for(let n=0;n<e.length;n++){let s=e[n];if((s.isString()||s.isBoolean())&&(s=s.convertToNumberObjectValue()),s.isError())return s;if(s.isArray()){if(s.iterator(a=>{if(a==null||a.isNull())return!0;let o=a;if(o.isString()&&(o=o.convertToNumberObjectValue(),o.isError()&&(o=y.create(0))),o.isBoolean()&&(o=o.convertToNumberObjectValue()),o.isError())return t=o,!1;t=t.plus(o),r=r.plus(y.create(1))}),t.isError())return t}else s.isNull()||(t=t.plus(s),r=r.plus(y.create(1)))}return t.divided(r)}}class KC extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",3);A(this,"needsReferenceObject",!0)}calculate(e,t,r){if(e.isError())return e;if(t.isError())return t;if(r!=null&&r.isError())return r;let n=e;n.isReferenceObject()&&(n=n.toArrayValueObject()),n.isArray()||(n=rr([[n]],1,1));let s=t;return s.isReferenceObject()&&(s=s.toArrayValueObject()),r&&!(r!=null&&r.isReferenceObject())?g.create(h.NA):(s=s,s.isArray()?s.map(a=>this._handleSingleObject(n,a,r)):this._handleSingleObject(n,s,r))}_handleSingleObject(e,t,r){let n=Cn(e,t);n=_n(n,e,t);let s=r?this._createRangeReferenceObject(r,e):e;if(!s)return g.create(h.VALUE);if(s.isError())return s;s.isReferenceObject()&&(s=s.toArrayValueObject()),s=s;const a=s.pick(n),o=a.sum(),c=a.count();return o.divided(c)}_createRangeReferenceObject(e,t){const r=e.getRowCount(),n=e.getColumnCount(),s=t.isArray()?t.getRowCount():1,a=t.isArray()?t.getColumnCount():1;if(r===s&&n===a)return e;const{startRow:o,startColumn:c}=e.getRangePosition(),l={startRow:o,startColumn:c,endRow:o+s-1,endColumn:c+a-1};return this.createReferenceObject(e,l)}}class XC extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",255)}calculate(e,...t){if(e.isError())return g.create(h.NA);if(!e.isArray()||t.length%2!==0||t.some((o,c)=>c%2===0&&!o.isArray()))return g.create(h.VALUE);const{maxRowLength:r,maxColumnLength:n}=nr(t),s=Vr(t,e,r,n);if(s)return s;const a=Or(t,r,n,!0);return this._aggregateResults(e,a)}_aggregateResults(e,t){const r=t.map(s=>s.map(a=>{const o=e.pick(a),c=o.sum(),l=o.count();return c.divided(l)})),n={calculateValueList:r,rowCount:r.length,columnCount:r[0].length,unitId:this.unitId||"",sheetId:this.subUnitId||"",row:this.row,column:this.column};return K.create(n)}}class ZC extends p{constructor(){super(...arguments);A(this,"minParams",4);A(this,"maxParams",6)}calculate(e,t,r,n,s,a){let o=s!=null?s:y.create(0),c=a!=null?a:y.create(1);o.isNull()&&(o=y.create(0)),c.isNull()&&(c=y.create(1));const l=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1,o.isArray()?o.getRowCount():1,c.isArray()?c.getRowCount():1),f=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1,o.isArray()?o.getColumnCount():1,c.isArray()?c.getColumnCount():1),m=O(l,f,e,g.create(h.NA)),d=O(l,f,t,g.create(h.NA)),C=O(l,f,r,g.create(h.NA)),_=O(l,f,n,g.create(h.NA)),E=O(l,f,o,g.create(h.NA)),b=O(l,f,c,g.create(h.NA)),R=m.mapValue((N,V,M)=>{const D=d.get(V,M),L=C.get(V,M),P=_.get(V,M),j=E.get(V,M),F=b.get(V,M);return this._handleSignleObject(N,D,L,P,j,F)});return l===1&&f===1?R.get(0,0):R}_handleSignleObject(e,t,r,n,s,a){if(e.isError())return e;if(t.isError())return t;if(r.isError())return r;if(n.isError())return n;if(s.isError())return s;if(a.isError())return a;const{isError:o,errorObject:c,variants:l}=k(e,t,r,n,s,a);if(o)return c;const[f,m,d,C,_,E]=l,b=+f.getValue(),R=+m.getValue(),N=+d.getValue(),V=+C.getValue(),M=+_.getValue(),D=+E.getValue();if(R<=0||N<=0||b<M||b>D||M===D)return g.create(h.NUM);let L;return V?L=oo((b-M)/(D-M),R,N):L=Em((b-M)/(D-M),R,N)/(D-M),y.create(L)}}class zC extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",4)}calculate(e,t,r,n){let s=n!=null?n:r;s.isNull()&&(s=r);const a=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,s.isArray()?s.getRowCount():1),o=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,s.isArray()?s.getColumnCount():1),c=O(a,o,e,g.create(h.NA)),l=O(a,o,t,g.create(h.NA)),f=O(a,o,r,g.create(h.NA)),m=O(a,o,s,g.create(h.NA)),d=c.mapValue((C,_,E)=>{const b=l.get(_,E),R=f.get(_,E),N=m.get(_,E);return C.isError()?C:b.isError()?b:R.isError()?R:N.isError()?N:this._handleSignleObject(C,b,R,N)});return a===1&&o===1?d.get(0,0):d}_handleSignleObject(e,t,r,n){const{isError:s,errorObject:a,variants:o}=k(e,t,r,n);if(s)return a;const[c,l,f,m]=o,d=Math.floor(+c.getValue()),C=+l.getValue(),_=Math.floor(+f.getValue()),E=Math.floor(+m.getValue());if(d<0||C<0||C>1||_<0||_>d||E<0||E<_||E>d)return g.create(h.NUM);let b=0;for(let R=_;R<=E;R++)b+=oa(R,d,C);return y.create(b)}}class JC extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),o=O(n,s,t,g.create(h.NA)),c=O(n,s,r,g.create(h.NA)),l=a.mapValue((f,m,d)=>{const C=o.get(m,d),_=c.get(m,d);return f.isError()?f:C.isError()?C:_.isError()?_:this._handleSignleObject(f,C,_)});return n===1&&s===1?l.get(0,0):l}_handleSignleObject(e,t,r){const{isError:n,errorObject:s,variants:a}=k(e,t,r);if(n)return s;const[o,c,l]=a,f=+o.getValue(),m=Math.floor(+c.getValue()),d=+l.getValue();if(f<0||m<1||m>10**10)return g.create(h.NUM);let C;return d?C=ua(f,m):C=bm(f,m),y.create(C)}}class e_ extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=O(r,n,e,g.create(h.NA)),a=O(r,n,t,g.create(h.NA)),o=s.mapValue((c,l,f)=>{const m=a.get(l,f);return c.isError()?c:m.isError()?m:this._handleSignleObject(c,m)});return r===1&&n===1?o.get(0,0):o}_handleSignleObject(e,t){const{isError:r,errorObject:n,variants:s}=k(e,t);if(r)return n;const[a,o]=s,c=+a.getValue(),l=Math.floor(+o.getValue());if(c<0||c>1||l<1||l>10**10)return g.create(h.NUM);const f=lo(c,l);return Number.isNaN(f)||!Number.isFinite(f)?g.create(h.NUM):y.create(f)}}class t_ extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),o=O(n,s,t,g.create(h.NA)),c=O(n,s,r,g.create(h.NA)),l=a.mapValue((f,m,d)=>{const C=o.get(m,d),_=c.get(m,d);if(f.isError())return f;if(C.isError())return C;if(_.isError())return _;const{isError:E,errorObject:b,variants:R}=k(f,C,_);if(E)return b;const[N,V,M]=R,D=+N.getValue(),L=+V.getValue(),P=Math.floor(+M.getValue());if(D<=0||D>=1||L<=0||P<1)return g.create(h.NUM);if(P===1)return g.create(h.DIV_BY_ZERO);const j=Math.abs(jn(D/2,P-1)*L/Math.sqrt(P));return y.create(j)});return n===1&&s===1?l.get(0,0):l}}class r_ extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,s=t.isArray()?t.getRowCount():1,a=t.isArray()?t.getColumnCount():1;let o=e;if(e.isArray()&&r===1&&n===1&&(o=e.get(0,0)),o.isError())return o;let c=t;if(t.isArray()&&s===1&&a===1&&(c=t.get(0,0)),c.isError())return c;if(r*n===1||s*a===1)return o.isNull()||c.isNull()?g.create(h.VALUE):g.create(h.DIV_BY_ZERO);if(r*n!==s*a)return g.create(h.NA);const{isError:l,errorObject:f,array1Values:m,array2Values:d,noCalculate:C}=Ke(e,t,r*n,n,a);return l?f:C?g.create(h.DIV_BY_ZERO):this._getResult(m,d)}_getResult(e,t){const r=e.length;let n=0,s=0;for(let d=0;d<r;d++)n+=e[d],s+=t[d];const a=n/r,o=s/r;let c=0,l=0,f=0;for(let d=0;d<r;d++){const C=e[d]-a,_=t[d]-o;c+=C*_,l+=C**2,f+=_**2}const m=Math.sqrt(l*f);return m===0?g.create(h.DIV_BY_ZERO):y.create(c/m)}}class n_ extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){let t=y.create(0);for(let r=0;r<e.length;r++){const n=e[r];n.isError()||(n.isArray()?t=t.plus(n.count()):n.isString()?n.convertToNumberObjectValue().isError()||(t=t.plus(y.create(1))):n.isNull()||(t=t.plus(y.create(1))))}return t}}class s_ extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){let t=y.create(0);for(let r=0;r<e.length;r++){let n=e[r];if(n.isError()){t=t.plus(y.create(1));continue}n.isArray()?(n=n.countA(),t=t.plus(n)):n.isNull()||(t=t.plus(y.create(1)))}return t}}class a_ extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){return e.isError()?e:e.getValue()===""||e.isNull()?y.create(1):e.isArray()?e.countBlank():y.create(0)}}class i_ extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){return e.isError()||t.isError()?g.create(h.NA):e.isArray()?t.isArray()?t.mapValue(r=>this._handleSingleObject(e,r)):this._handleSingleObject(e,t):g.create(h.VALUE)}_handleSingleObject(e,t){let r=Cn(e,t);r=_n(r,e,t);const n=e.pick(r);return this._countA(n)}_countA(e){let t=y.create(0);return e.iterator(r=>{if(r==null)return!0;t=t.plusBy(1)}),t}}class o_ extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",255)}calculate(...e){if(e.length%2!==0||e.some((a,o)=>o%2===0&&!a.isArray()))return g.create(h.VALUE);const{maxRowLength:t,maxColumnLength:r}=nr(e),n=Vr(e,e[0],t,r);if(n)return n;const s=Or(e,t,r,!0);return this._aggregateResults(s)}_aggregateResults(e){const t=e.map(n=>n.map(s=>u_(s))),r={calculateValueList:t,rowCount:t.length,columnCount:t[0].length,unitId:this.unitId||"",sheetId:this.subUnitId||"",row:this.row,column:this.column};return K.create(r)}}function u_(i){let u=0;return i.iterator(e=>{e!=null&&e.isBoolean()&&e.getValue()===!0&&u++}),y.create(u)}class c_ extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,s=t.isArray()?t.getRowCount():1,a=t.isArray()?t.getColumnCount():1;let o=e;if(e.isArray()&&r===1&&n===1&&(o=e.get(0,0)),o.isError())return o;let c=t;if(t.isArray()&&s===1&&a===1&&(c=t.get(0,0)),c.isError())return c;if((r*n===1||s*a===1)&&(o.isNull()||c.isNull()))return g.create(h.VALUE);if(r*n!==s*a)return g.create(h.NA);const{isError:l,errorObject:f,array1Values:m,array2Values:d,noCalculate:C}=Ke(e,t,r*n,n,a);return l?f:C?g.create(h.DIV_BY_ZERO):this._getResult(m,d)}_getResult(e,t){if(e.length<=1)return g.create(h.DIV_BY_ZERO);const r=e.length;let n=0,s=0;for(let l=0;l<r;l++)n+=e[l],s+=t[l];const a=n/r,o=s/r;let c=0;for(let l=0;l<r;l++){const f=e[l]-a,m=t[l]-o;c+=f*m}return y.create(c/(r-1))}}class l_ extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){const t=[];let r=0,n=!0;for(let o=0;o<e.length;o++){const c=e[o];if(c.isArray()){let l=!1,f=g.create(h.VALUE);if(c.iterator(m=>{const d=this._handleSingleObject(m);if(d.isError())return l=!0,f=d,!1;if(d.isNull())return!0;const C=d.getValue();t.push(C),r+=C,n=!1}),l)return f}else{const l=this._handleSingleObject(c);if(l.isError())return l;if(l.isNull())continue;const f=l.getValue();t.push(f),r+=f,n=!1}}if(n)return g.create(h.NUM);const s=r/t.length;let a=0;for(let o=0;o<t.length;o++)a+=(t[o]-s)**2;return y.create(a)}_handleSingleObject(e){if(e.isError())return e;if(e.isNull()||e.isBoolean())return oe.create();const t=e.getValue();return S.isRealNum(t)?y.create(+t):oe.create()}}class f_ extends p{constructor(){super(...arguments);A(this,"minParams",4);A(this,"maxParams",4)}calculate(e,t,r,n){const s=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1),o=O(s,a,e,g.create(h.NA)),c=O(s,a,t,g.create(h.NA)),l=O(s,a,r,g.create(h.NA)),f=O(s,a,n,g.create(h.NA)),m=o.mapValue((d,C,_)=>{const E=c.get(C,_),b=l.get(C,_),R=f.get(C,_);return d.isError()?d:E.isError()?E:b.isError()?b:R.isError()?R:this._handleSignleObject(d,E,b,R)});return s===1&&a===1?m.get(0,0):m}_handleSignleObject(e,t,r,n){const{isError:s,errorObject:a,variants:o}=k(e,t,r,n);if(s)return a;const[c,l,f,m]=o,d=+c.getValue(),C=Math.floor(+l.getValue()),_=Math.floor(+f.getValue()),E=+m.getValue();if(d<0||C<1||C>10**10||_<1||_>10**10)return g.create(h.NUM);let b;return E?b=ca(d,C,_):b=ym(d,C,_),Number.isNaN(b)||!Number.isFinite(b)?g.create(h.NUM):y.create(b)}}class m_ extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),o=O(n,s,t,g.create(h.NA)),c=O(n,s,r,g.create(h.NA)),l=a.mapValue((f,m,d)=>{const C=o.get(m,d),_=c.get(m,d);return f.isError()?f:C.isError()?C:_.isError()?_:this._handleSignleObject(f,C,_)});return n===1&&s===1?l.get(0,0):l}_handleSignleObject(e,t,r){const{isError:n,errorObject:s,variants:a}=k(e,t,r);if(n)return s;const[o,c,l]=a,f=+o.getValue(),m=Math.floor(+c.getValue()),d=Math.floor(+l.getValue());if(f<0||f>1||m<1||m>10**10||d<1||d>10**10)return g.create(h.NUM);const C=fo(f,m,d);return Number.isNaN(C)||!Number.isFinite(C)?g.create(h.NUM):y.create(C)}}class h_ extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){return e.isArray()?e.mapValue(t=>this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){const{isError:t,errorObject:r,variants:n}=k(e);if(t)return r;const[s]=n,a=s.getValue();if(a<=-1||a>=1)return g.create(h.NUM);const o=Math.log((1+a)/(1-a))/2;return y.create(o)}}class g_ extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){return e.isArray()?e.mapValue(t=>this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){const{isError:t,errorObject:r,variants:n}=k(e);if(t)return r;const[s]=n,a=+s.getValue(),o=Math.exp(2*a)-1,c=Math.exp(2*a)+1;return!Number.isFinite(o)&&o>0&&!Number.isFinite(c)&&c>0?y.create(1):y.create(o/c)}}class bu extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const n=t.isArray()?t.getRowCount():1,s=t.isArray()?t.getColumnCount():1,a=r.isArray()?r.getRowCount():1,o=r.isArray()?r.getColumnCount():1;let c=t;t.isArray()&&n===1&&s===1&&(c=t.get(0,0));let l=r;return r.isArray()&&a===1&&o===1&&(l=r.get(0,0)),e.isArray()?e.mapValue(f=>this._handleSignleObject(f,c,l,n,s,a,o)):this._handleSignleObject(e,c,l,n,s,a,o)}_handleSignleObject(e,t,r,n,s,a,o){if(e.isError())return e;if(t.isError())return t;if(r.isError())return r;let c=e;if(e.isString()&&(c=e.convertToNumberObjectValue()),c.isError())return c;const l=+c.getValue();if((n*s===1||a*o===1)&&(t.isNull()||r.isNull()))return g.create(h.VALUE);if(n*s!==a*o)return g.create(h.NA);const{isError:f,errorObject:m,array1Values:d,array2Values:C,noCalculate:_}=Ke(t,r,n*s,s,o);if(f)return m;if(_)return g.create(h.DIV_BY_ZERO);const E=mo(l,d,C);return Number.isFinite(E)?y.create(E):g.create(h.DIV_BY_ZERO)}}class d_ extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const{isError:r,errorObject:n,values:s}=this._getValues(e);if(r)return n;if(e.isNull()||t.isNull())return g.create(h.VALUE);let{values:a}=this._getValues(t,!0);a.length===0&&(a=[0]);const o=this._getNewBinsArrayValues(a),c=new Array(o.length).fill(0);for(let l=0;l<s.length;l++){const f=s[l],m=o.findIndex(d=>f>d.start&&f<=d.end);c[m]++}return K.createByArray(c.map(l=>[l]))}_getValues(e,t=!1){const r=[],n=e.isArray()?e.getRowCount():1,s=e.isArray()?e.getColumnCount():1;for(let a=0;a<n;a++)for(let o=0;o<s;o++){const c=e.isArray()?e.get(a,o):e;if(c.isError()){if(!t)return{isError:!0,errorObject:c,values:r};continue}if(c.isNull()||c.isBoolean())continue;const l=c.getValue();S.isRealNum(l)&&r.push(+l)}return{isError:!1,errorObject:null,values:r}}_getNewBinsArrayValues(e){const t=e.map((n,s)=>({value:n,index:s})).sort((n,s)=>n.value-s.value),r=[];for(let n=0;n<t.length;n++){const s=t[n].index;if(n===0){r[s]={start:-1/0,end:t[n].value};continue}r[s]={start:t[n-1].value,end:t[n].value}}return r.push({start:t[t.length-1].value,end:1/0}),r}}var B=(i=>(i.AVEDEV="AVEDEV",i.AVERAGE="AVERAGE",i.AVERAGE_WEIGHTED="AVERAGE.WEIGHTED",i.AVERAGEA="AVERAGEA",i.AVERAGEIF="AVERAGEIF",i.AVERAGEIFS="AVERAGEIFS",i.BETA_DIST="BETA.DIST",i.BETA_INV="BETA.INV",i.BINOM_DIST="BINOM.DIST",i.BINOM_DIST_RANGE="BINOM.DIST.RANGE",i.BINOM_INV="BINOM.INV",i.CHISQ_DIST="CHISQ.DIST",i.CHISQ_DIST_RT="CHISQ.DIST.RT",i.CHISQ_INV="CHISQ.INV",i.CHISQ_INV_RT="CHISQ.INV.RT",i.CHISQ_TEST="CHISQ.TEST",i.CONFIDENCE_NORM="CONFIDENCE.NORM",i.CONFIDENCE_T="CONFIDENCE.T",i.CORREL="CORREL",i.COUNT="COUNT",i.COUNTA="COUNTA",i.COUNTBLANK="COUNTBLANK",i.COUNTIF="COUNTIF",i.COUNTIFS="COUNTIFS",i.COVARIANCE_P="COVARIANCE.P",i.COVARIANCE_S="COVARIANCE.S",i.DEVSQ="DEVSQ",i.EXPON_DIST="EXPON.DIST",i.F_DIST="F.DIST",i.F_DIST_RT="F.DIST.RT",i.F_INV="F.INV",i.F_INV_RT="F.INV.RT",i.F_TEST="F.TEST",i.FISHER="FISHER",i.FISHERINV="FISHERINV",i.FORECAST="FORECAST",i.FORECAST_ETS="FORECAST.ETS",i.FORECAST_ETS_CONFINT="FORECAST.ETS.CONFINT",i.FORECAST_ETS_SEASONALITY="FORECAST.ETS.SEASONALITY",i.FORECAST_ETS_STAT="FORECAST.ETS.STAT",i.FORECAST_LINEAR="FORECAST.LINEAR",i.FREQUENCY="FREQUENCY",i.GAMMA="GAMMA",i.GAMMA_DIST="GAMMA.DIST",i.GAMMA_INV="GAMMA.INV",i.GAMMALN="GAMMALN",i.GAMMALN_PRECISE="GAMMALN.PRECISE",i.GAUSS="GAUSS",i.GEOMEAN="GEOMEAN",i.GROWTH="GROWTH",i.HARMEAN="HARMEAN",i.HYPGEOM_DIST="HYPGEOM.DIST",i.INTERCEPT="INTERCEPT",i.KURT="KURT",i.LARGE="LARGE",i.LINEST="LINEST",i.LOGEST="LOGEST",i.LOGNORM_DIST="LOGNORM.DIST",i.LOGNORM_INV="LOGNORM.INV",i.MARGINOFERROR="MARGINOFERROR",i.MAX="MAX",i.MAXA="MAXA",i.MAXIFS="MAXIFS",i.MEDIAN="MEDIAN",i.MIN="MIN",i.MINA="MINA",i.MINIFS="MINIFS",i.MODE_MULT="MODE.MULT",i.MODE_SNGL="MODE.SNGL",i.NEGBINOM_DIST="NEGBINOM.DIST",i.NORM_DIST="NORM.DIST",i.NORM_INV="NORM.INV",i.NORM_S_DIST="NORM.S.DIST",i.NORM_S_INV="NORM.S.INV",i.PEARSON="PEARSON",i.PERCENTILE_EXC="PERCENTILE.EXC",i.PERCENTILE_INC="PERCENTILE.INC",i.PERCENTRANK_EXC="PERCENTRANK.EXC",i.PERCENTRANK_INC="PERCENTRANK.INC",i.PERMUT="PERMUT",i.PERMUTATIONA="PERMUTATIONA",i.PHI="PHI",i.POISSON_DIST="POISSON.DIST",i.PROB="PROB",i.QUARTILE_EXC="QUARTILE.EXC",i.QUARTILE_INC="QUARTILE.INC",i.RANK_AVG="RANK.AVG",i.RANK_EQ="RANK.EQ",i.RSQ="RSQ",i.SKEW="SKEW",i.SKEW_P="SKEW.P",i.SLOPE="SLOPE",i.SMALL="SMALL",i.STANDARDIZE="STANDARDIZE",i.STDEV_P="STDEV.P",i.STDEV_S="STDEV.S",i.STDEVA="STDEVA",i.STDEVPA="STDEVPA",i.STEYX="STEYX",i.T_DIST="T.DIST",i.T_DIST_2T="T.DIST.2T",i.T_DIST_RT="T.DIST.RT",i.T_INV="T.INV",i.T_INV_2T="T.INV.2T",i.T_TEST="T.TEST",i.TREND="TREND",i.TRIMMEAN="TRIMMEAN",i.VAR_P="VAR.P",i.VAR_S="VAR.S",i.VARA="VARA",i.VARPA="VARPA",i.WEIBULL_DIST="WEIBULL.DIST",i.Z_TEST="Z.TEST",i))(B||{});class C_ extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.mapValue(r=>this._handleSingleObject(r));return t.getRowCount()===1&&t.getColumnCount()===1?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){const{isError:t,errorObject:r,variants:n}=k(e);if(t)return r;const[s]=n,a=+s.getValue();if(a===0||a<0&&a%1===0)return g.create(h.NUM);const o=Ln(a);return Number.isNaN(o)||!Number.isFinite(o)?g.create(h.NUM):y.create(o)}}class yu extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.mapValue(r=>this._handleSingleObject(r));return t.getRowCount()===1&&t.getColumnCount()===1?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){const{isError:t,errorObject:r,variants:n}=k(e);if(t)return r;const[s]=n,a=+s.getValue();if(a<=0)return g.create(h.NUM);const o=nt(a);return Math.abs(o)<1e-15?y.create(0):y.create(o)}}class __ extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.mapValue(r=>this._handleSingleObject(r));return t.getRowCount()===1&&t.getColumnCount()===1?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){const{isError:t,errorObject:r,variants:n}=k(e);if(t)return r;const[s]=n,a=+s.getValue(),o=wr(a,0,1)-.5;return y.create(o)}}class A_ extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){let t=1,r=0,n=!1;for(let a=0;a<e.length;a++){const o=e[a];if(o.isArray()){let c=!1,l=g.create(h.VALUE);if(o.iterator(f=>{if(f!=null&&f.isError())return c=!0,l=f,!1;if(f!=null&&f.isNull()||f!=null&&f.isBoolean())return!0;const m=f.getValue();if(!S.isRealNum(m))return!0;+m<=0&&(n=!0),t*=+m,r++}),c)return l}else{if(o.isError())return o;if(o.isString()){const l=o.convertToNumberObjectValue();if(l.isError())return l}if(o.isNull()||o.isBoolean())continue;const c=o.getValue();if(!S.isRealNum(c))continue;+c<=0&&(n=!0),t*=+c,r++}}if(r===0||n)return g.create(h.NUM);const s=t**(1/r);return y.create(s)}}class E_ extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",4)}calculate(e,t,r,n){const{isError:s,errorObject:a}=xn(e,t,r);if(s)return a;const o=gt(e);if(o instanceof g)return o;const c=this._getKnownXsValues(o,t);if(c instanceof g)return c;const l=this._getNewXsValues(c,r);if(l instanceof g)return l;let f=n!=null?n:T.create(!0);if(f.isArray()&&(f=f.get(0,0)),f.isString()&&(f=f.convertToNumberObjectValue()),f.isError())return f;const m=+f.getValue();return this._getResult(o,c,l,m)}_getResult(e,t,r,n){return e.length===1&&t.length>1||e[0].length===1&&t[0].length>1?e.length===1&&t.length>1&&(n?t.length+1:t.length)>e[0].length||e[0].length===1&&t[0].length>1&&(n?t[0].length+1:t[0].length)>e.length?g.create(h.NA):this._getResultByMultipleVariables(e,t,r,n):this._getResultBySimpleVariables(e,t,r,n)}_getResultByMultipleVariables(e,t,r,n){const s=e.length===1&&e[0].length>1,a=Tn(e,t,r,n,!0);if(a instanceof g)return a;const{coefficients:o,newX:c}=a,l=o[0].length,f=o[0][l-1];let m=[];for(let d=0;d<c.length;d++){m[d]=[];let C=f;for(let _=l-2;_>=0;_--)C*=o[0][l-2-_]**c[d][_];m[d].push(C)}return s&&(m=ht(m)),K.createByArray(m)}_getResultBySimpleVariables(e,t,r,n){const s=e.flat(),a=t.flat(),{slope:o,intercept:c}=vn(a,s,n,!0),l=r.map(f=>f.map(m=>c*o**m));return K.createByArray(l)}_getKnownXsValues(e,t){return!t||t.isNull()?Un(e.length,e[0].length):gt(t)}_getNewXsValues(e,t){return!t||t.isNull()?e:gt(t)}}class b_ extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){let t=0,r=0,n=!1;for(let a=0;a<e.length;a++){const o=e[a];if(o.isArray()){let c=!1,l=g.create(h.VALUE);if(o.iterator(f=>{if(f!=null&&f.isError())return c=!0,l=f,!1;if(f!=null&&f.isNull()||f!=null&&f.isBoolean())return!0;const m=f.getValue();if(!S.isRealNum(m))return!0;+m<=0&&(n=!0),t+=1/+m,r++}),c)return l}else{if(o.isError())return o;if(o.isString()){const l=o.convertToNumberObjectValue();if(l.isError())return l}if(o.isNull()||o.isBoolean())continue;const c=o.getValue();if(!S.isRealNum(c))continue;+c<=0&&(n=!0),t+=1/+c,r++}}if(r===0)return g.create(h.NA);if(n)return g.create(h.NUM);const s=r/t;return y.create(s)}}class y_ extends p{constructor(){super(...arguments);A(this,"minParams",5);A(this,"maxParams",5)}calculate(e,t,r,n,s){const a=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1,s.isArray()?s.getRowCount():1),o=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1,s.isArray()?s.getColumnCount():1),c=O(a,o,e,g.create(h.NA)),l=O(a,o,t,g.create(h.NA)),f=O(a,o,r,g.create(h.NA)),m=O(a,o,n,g.create(h.NA)),d=O(a,o,s,g.create(h.NA)),C=c.mapValue((_,E,b)=>{const R=l.get(E,b),N=f.get(E,b),V=m.get(E,b),M=d.get(E,b);return _.isError()?_:R.isError()?R:N.isError()?N:V.isError()?V:M.isError()?M:this._handleSignleObject(_,R,N,V,M)});return a===1&&o===1?C.get(0,0):C}_handleSignleObject(e,t,r,n,s){const{isError:a,errorObject:o,variants:c}=k(e,t,r,n,s);if(a)return o;const[l,f,m,d,C]=c,_=Math.floor(+l.getValue()),E=Math.floor(+f.getValue()),b=Math.floor(+m.getValue()),R=Math.floor(+d.getValue()),N=+C.getValue();if(_<0||_>E||_>b||_<E-R+b||E<=0||E>R||b<=0||b>R||R<=0)return g.create(h.NUM);let V;return N?V=Sm(_,E,b,R):V=fa(_,E,b,R),Number.isNaN(V)&&(V=0),y.create(V)}}class R_ extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,s=t.isArray()?t.getRowCount():1,a=t.isArray()?t.getColumnCount():1;let o=e;if(e.isArray()&&r===1&&n===1&&(o=e.get(0,0)),o.isError())return o;let c=t;if(t.isArray()&&s===1&&a===1&&(c=t.get(0,0)),c.isError())return c;if(r*n===1||s*a===1)return o.isNull()||c.isNull()?g.create(h.VALUE):g.create(h.DIV_BY_ZERO);if(r*n!==s*a)return g.create(h.NA);const{isError:l,errorObject:f,array1Values:m,array2Values:d,noCalculate:C}=Ke(e,t,r*n,n,a);return l?f:C?g.create(h.DIV_BY_ZERO):this._getResult(m,d)}_getResult(e,t){const r=mo(0,e,t);return Number.isFinite(r)?y.create(r):g.create(h.DIV_BY_ZERO)}}class N_ extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){const t=[];let r=0;for(let n=0;n<e.length;n++){const s=e[n];if(s.isError())return s;if(s.isString()){const c=s.convertToNumberObjectValue();if(c.isError())return c}const a=s.isArray()?s.getRowCount():1,o=s.isArray()?s.getColumnCount():1;for(let c=0;c<a;c++)for(let l=0;l<o;l++){const f=s.isArray()?s.get(c,l):s;if(f.isError())return f;if(f.isNull()||f.isBoolean())continue;const m=f.getValue();S.isRealNum(m)&&(t.push(+m),r+=+m)}}return t.length<=3?g.create(h.DIV_BY_ZERO):this._getResult(t,r)}_getResult(e,t){const r=e.length,n=t/r;let s=0;for(let l=0;l<r;l++)s+=(e[l]-n)**2;const a=Math.sqrt(s/(r-1));if(a===0)return g.create(h.DIV_BY_ZERO);let o=0;for(let l=0;l<r;l++)o+=((e[l]-n)/a)**4;const c=r*(r+1)/((r-1)*(r-2)*(r-3))*o-3*(r-1)**2/((r-2)*(r-3));return y.create(c)}}class p_ extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=this._getValues(e);if(t.isArray()){const n=t.mapValue(s=>this._handleSingleObject(r,s));return n.getRowCount()===1&&n.getColumnCount()===1?n.get(0,0):n}return this._handleSingleObject(r,t)}_handleSingleObject(e,t){if(e instanceof g)return e;const{isError:r,errorObject:n,variants:s}=k(t);if(r)return n;const[a]=s;let o=+a.getValue();return o<1||o>e.length?g.create(h.NUM):(o=Math.ceil(o),y.create(e[o-1]))}_getValues(e){const t=e.isArray()?e.getRowCount():1,r=e.isArray()?e.getColumnCount():1,n=[];for(let s=0;s<t;s++)for(let a=0;a<r;a++){const o=e.isArray()?e.get(s,a):e;if(o.isError())return o;if(o.isNull()||o.isBoolean()||o.isString())continue;const c=o.getValue();S.isRealNum(c)&&n.push(+c)}return n.length===0?g.create(h.NUM):n.sort((s,a)=>a-s)}}class V_ extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",4)}calculate(e,t,r,n){const{isError:s,errorObject:a}=xn(e,t);if(s)return a;const o=gt(e);if(o instanceof g)return o;const c=this._getKnownXsValues(o,t);if(c instanceof g)return c;let l=r!=null?r:T.create(!0);l.isArray()&&(l=l.get(0,0));let f=n!=null?n:T.create(!1);f.isArray()&&(f=f.get(0,0));const{isError:m,errorObject:d,variants:C}=k(l,f);if(m)return d;const[_,E]=C;return this._getResult(o,c,+_.getValue(),+E.getValue())}_getResult(e,t,r,n){return e.length===1&&t.length>1||e[0].length===1&&t[0].length>1?e.length===1&&t.length>1&&(r?t.length+1:t.length)>e[0].length||e[0].length===1&&t[0].length>1&&(r?t[0].length+1:t[0].length)>e.length?g.create(h.NA):this._getResultByMultipleVariables(e,t,r,n):this._getResultBySimpleVariables(e,t,r,n)}_getResultByMultipleVariables(e,t,r,n){const s=Tn(e,t,t,r,!1);if(s instanceof g)return s;const{coefficients:a,X:o,XTXInverse:c}=s;let l=[];if(n){const f=e.flat(),m=f.length,d=r?f.reduce((v,Y)=>v+Y,0)/m:0,C=c.length,_=m-C,E=a[0].length,b=new Array(E-2).fill(h.NA),R=a[0][E-1],N=[];for(let v=0;v<o.length;v++){let Y=R;for(let q=E-2;q>=0;q--)Y+=a[0][E-2-q]*o[v][q];N.push(Y)}let V=0,M=0;for(let v=0;v<m;v++)V+=(f[v]-d)**2,M+=(f[v]-N[v])**2;const D=V-M,L=V===0?0:D/V,P=[];for(let v=C-1;v>=0;v--){const Y=_>0?Math.sqrt(M/_*c[v][v]):0;P.push(Y)}if(r){const v=P.shift();P.push(v)}else P.push(h.NA);const j=_>0?Math.sqrt(M/_):0,F=_>0?D/(E-1)/(M/_):h.NUM;l=[a[0],[...P],[L,j,...b],[F,_,...b],[D,M,...b]]}else l=[a[0]];return K.createByArray(l)}_getResultBySimpleVariables(e,t,r,n){const s=e.flat(),a=t.flat(),{slope:o,intercept:c}=vn(a,s,r,!1);if(Number.isNaN(o))return g.create(h.NA);let l=[];if(n){const f=s.length;let m=0,d=0,C=f-1;if(r){let P=0,j=0;for(let F=0;F<f;F++)P+=s[F],j+=a[F];m=P/f,d=j/f,C=f-2}let _=0,E=0,b=0;for(let P=0;P<f;P++)_+=(s[P]-m)**2,E+=(s[P]-(o*a[P]+c))**2,b+=(a[P]-d)**2;const R=_-E,N=R===_?1:R/_;let V=0,M=0,D=0;C>0&&(b>0&&(V=Math.sqrt(E/C/b),M=Math.sqrt(E/C*(1/f+d**2/b))),D=Math.sqrt(E/C));const L=C>0?R/1/(E/C):h.NUM;r||(M=h.NA),l=[[o,c],[V,M],[N,D],[L,C],[R,E]]}else l=[[o,c]];return K.createByArray(l)}_getKnownXsValues(e,t){return!t||t.isNull()?Un(e.length,e[0].length):gt(t)}}class O_ extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",4)}calculate(e,t,r,n){const{isError:s,errorObject:a}=xn(e,t);if(s)return a;const o=gt(e);if(o instanceof g)return o;const c=this._getKnownXsValues(o,t);if(c instanceof g)return c;let l=r!=null?r:T.create(!0);l.isArray()&&(l=l.get(0,0));let f=n!=null?n:T.create(!1);f.isArray()&&(f=f.get(0,0));const{isError:m,errorObject:d,variants:C}=k(l,f);if(m)return d;const[_,E]=C;return this._getResult(o,c,+_.getValue(),+E.getValue())}_getResult(e,t,r,n){return e.length===1&&t.length>1||e[0].length===1&&t[0].length>1?e.length===1&&t.length>1&&(r?t.length+1:t.length)>e[0].length||e[0].length===1&&t[0].length>1&&(r?t[0].length+1:t[0].length)>e.length?g.create(h.NA):this._getResultByMultipleVariables(e,t,r,n):this._getResultBySimpleVariables(e,t,r,n)}_getResultByMultipleVariables(e,t,r,n){const s=Tn(e,t,t,r,!0);if(s instanceof g)return s;const{coefficients:a,Y:o,X:c,XTXInverse:l}=s;let f=[];if(n){const m=o.flat(),d=m.length,C=r?m.reduce((Y,q)=>Y+q,0)/d:0,_=l.length,E=d-_,b=a[0].length,R=new Array(b-2).fill(h.NA),N=a[0][b-1],V=[];for(let Y=0;Y<c.length;Y++){let q=N;for(let se=b-2;se>=0;se--)q*=a[0][b-2-se]**c[Y][se];V.push(Math.log(q))}let M=0,D=0;for(let Y=0;Y<d;Y++)M+=(m[Y]-C)**2,!(!r&&!Number.isFinite(V[Y]))&&(D+=(m[Y]-V[Y])**2);Number.isFinite(D)||(D=0);const L=M-D,P=M===0?0:L/M,j=[];for(let Y=_-1;Y>=0;Y--){const q=E>0?Math.sqrt(D/E*l[Y][Y]):0;j.push(q)}if(r){const Y=j.shift();j.push(Y)}else j.push(h.NA);const F=E>0?Math.sqrt(D/E):0,v=E>0?L/(b-1)/(D/E):h.NUM;f=[a[0],[...j],[P,F,...R],[v,E,...R],[L,D,...R]]}else f=[a[0]];return K.createByArray(f)}_getResultBySimpleVariables(e,t,r,n){const s=e.flat(),a=t.flat(),{slope:o,intercept:c,Y:l}=vn(a,s,r,!0);if(Number.isNaN(o))return g.create(h.NA);let f=[];if(n){const m=l.length;let d=0,C=0,_=m-1;if(r){let j=0,F=0;for(let v=0;v<m;v++)j+=l[v],F+=a[v];d=j/m,C=F/m,_=m-2}let E=0,b=0,R=0;for(let j=0;j<m;j++)E+=(l[j]-d)**2,b+=(l[j]-Math.log(c*o**a[j]))**2,R+=(a[j]-C)**2;const N=E-b,V=E===0?0:N/E;let M=0,D=0,L=0,P=0;_>0&&(R>0&&(M=Math.sqrt(b/_/R),D=Math.sqrt(b/_*(1/m+C**2/R))),L=Math.sqrt(b/_),P=N/1/(b/_)),r||(D=h.NA),f=[[o,c],[M,D],[V,L],[P,_],[N,b]]}else f=[[o,c]];return K.createByArray(f)}_getKnownXsValues(e,t){return!t||t.isNull()?Un(e.length,e[0].length):gt(t)}}class S_ extends p{constructor(){super(...arguments);A(this,"minParams",4);A(this,"maxParams",4)}calculate(e,t,r,n){const s=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1),o=O(s,a,e,g.create(h.NA)),c=O(s,a,t,g.create(h.NA)),l=O(s,a,r,g.create(h.NA)),f=O(s,a,n,g.create(h.NA)),m=o.mapValue((d,C,_)=>{const E=c.get(C,_),b=l.get(C,_),R=f.get(C,_);return d.isError()?d:E.isError()?E:b.isError()?b:R.isError()?R:this._handleSignleObject(d,E,b,R)});return s===1&&a===1?m.get(0,0):m}_handleSignleObject(e,t,r,n){const{isError:s,errorObject:a,variants:o}=k(e,t,r,n);if(s)return a;const[c,l,f,m]=o,d=+c.getValue(),C=+l.getValue(),_=+f.getValue(),E=+m.getValue();if(d<=0||_<=0)return g.create(h.NUM);let b;return E?b=go(d,C,_):b=Mm(d,C,_),y.create(b)}}class M_ extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=this._getRangeValues(e);if(r instanceof g)return r;const n=Yt(t);if(n.isError())return n;const{isError:s,errorObject:a,variants:o}=k(n);if(s)return a;const[c]=o,l=+c.getValue();if(l<=0||l>=1)return g.create(h.NUM);if(r.length<2)return g.create(h.DIV_BY_ZERO);const f=1-l,m=r.length,d=r.reduce((b,R)=>b+R,0)/m,C=r.reduce((b,R)=>b+(R-d)**2,0)/(m-1),_=Math.sqrt(C);if(_<=0)return g.create(h.NUM);const E=Math.abs(jn(f/2,m-1)*_/Math.sqrt(m));return y.create(E)}_getRangeValues(e){const t=[],r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1;for(let s=0;s<r;s++)for(let a=0;a<n;a++){const o=e.isArray()?e.get(s,a):e;if(o.isError())return o;o.isNull()||o.isBoolean()||o.isString()||t.push(+o.getValue())}return t}}class D_ extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){let t=y.create(Number.NEGATIVE_INFINITY);for(let r=0;r<e.length;r++){let n=e[r];if(!n.isNull()){if((n.isString()||n.isBoolean())&&(n=n.convertToNumberObjectValue()),n.isArray()&&(n=n.max()),n.isError())return n;t=this._validator(t,n)}}return t.getValue()===Number.NEGATIVE_INFINITY?y.create(0):t}_validator(e,t){const r=e.isLessThan(t);let n=e;return r.getValue()&&(n=t),n}}class w_ extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){let t=y.create(Number.NEGATIVE_INFINITY);for(let r=0;r<e.length;r++){let n=e[r];if(!n.isNull()){if((n.isString()||n.isBoolean())&&(n=n.convertToNumberObjectValue()),n.isError())return n;if(n.isArray()&&n.iterator(s=>{let a=s;if((a==null||a.isNull()||a.isString())&&(a=y.create(0)),a.isBoolean()&&(a=a.convertToNumberObjectValue()),a.isError())return t=a,!1;t=this._validator(t,a)}),t.isError())return t;t=this._validator(t,n)}}return t.getValue()===Number.NEGATIVE_INFINITY?y.create(0):t}_validator(e,t){const r=e.isLessThan(t);let n=e;return r.getValue()&&(n=t),n}}class L_ extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",255)}calculate(e,...t){if(e.isError())return g.create(h.NA);if(!e.isArray()||t.length%2!==0||t.some((o,c)=>c%2===0&&!o.isArray()))return g.create(h.VALUE);const{maxRowLength:r,maxColumnLength:n}=nr(t),s=Vr(t,e,r,n);if(s)return s;const a=Or(t,r,n,!0);return this._aggregateResults(e,a)}_aggregateResults(e,t){const r=t.map(s=>s.map(a=>{const o=e.pick(a);return o.getColumnCount()===0?K.create("0"):o.max()})),n={calculateValueList:r,rowCount:r.length,columnCount:r[0].length,unitId:this.unitId||"",sheetId:this.subUnitId||"",row:this.row,column:this.column};return K.create(n)}}class P_ extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){const t=[];for(let r=0;r<e.length;r++){const n=e[r];if(n.isArray()){let s=!1,a=g.create(h.VALUE);if(n.iterator(o=>{if(o!=null&&o.isError())return s=!0,a=o,!1;if(o!=null&&o.isNull()||o!=null&&o.isBoolean())return!0;const c=o.getValue();if(!S.isRealNum(c))return!0;t.push(+c)}),s)return a}else{if(n.isError())return n;if(n.isNull()||n.isBoolean())continue;if(n.isString()){const a=n.convertToNumberObjectValue();if(a.isError())return a}const s=n.getValue();if(!S.isRealNum(s))continue;t.push(+s)}}return t.length===0?g.create(h.NUM):this._getResult(t.sort((r,n)=>r-n))}_getResult(e){const t=e.length;let r;if(t%2===0){const n=t/2;r=(e[n-1]+e[n])/2}else r=e[Math.floor(t/2)];return y.create(r)}}class j_ extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){let t=y.create(Number.POSITIVE_INFINITY);for(let r=0;r<e.length;r++){let n=e[r];if(!n.isNull()){if((n.isString()||n.isBoolean())&&(n=n.convertToNumberObjectValue()),n.isArray()&&(n=n.min()),n.isError())return n;t=this._validator(t,n)}}return t.getValue()===Number.POSITIVE_INFINITY?y.create(0):t}_validator(e,t){const r=e.isGreaterThan(t);let n=e;return r.getValue()&&(n=t),n}}class x_ extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){let t=y.create(Number.POSITIVE_INFINITY);for(let r=0;r<e.length;r++){let n=e[r];if(!n.isNull()){if((n.isString()||n.isBoolean())&&(n=n.convertToNumberObjectValue()),n.isError())return n;if(n.isArray()&&n.iterator(s=>{let a=s;if((a==null||a.isNull()||a.isString())&&(a=y.create(0)),a.isBoolean()&&(a=a.convertToNumberObjectValue()),a.isError())return t=a,!1;t=this._validator(t,a)}),t.isError())return t;t=this._validator(t,n)}}return t.getValue()===Number.POSITIVE_INFINITY?y.create(0):t}_validator(e,t){const r=e.isGreaterThan(t);let n=e;return r.getValue()&&(n=t),n}}class U_ extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",255)}calculate(e,...t){if(e.isError())return g.create(h.NA);if(!e.isArray()||t.length%2!==0||t.some((o,c)=>c%2===0&&!o.isArray()))return g.create(h.VALUE);const{maxRowLength:r,maxColumnLength:n}=nr(t),s=Vr(t,e,r,n);if(s)return s;const a=Or(t,r,n,!0);return this._aggregateResults(e,a)}_aggregateResults(e,t){const r=t.map(s=>s.map(a=>{const o=e.pick(a);return o.getColumnCount()===0?K.create("0"):o.min()})),n={calculateValueList:r,rowCount:r.length,columnCount:r[0].length,unitId:this.unitId||"",sheetId:this.subUnitId||"",row:this.row,column:this.column};return K.create(n)}}class v_ extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){const t={};let r=0,n=1;for(let s=0;s<e.length;s++){const a=e[s];if(a.isError())return a;if(a.isString()){const l=a.convertToNumberObjectValue();if(l.isError())return l}const o=a.isArray()?a.getRowCount():1,c=a.isArray()?a.getColumnCount():1;for(let l=0;l<o;l++)for(let f=0;f<c;f++){const m=a.isArray()?a.get(l,f):a;if(m.isError())return m;if(m.isNull()||m.isBoolean()||m.isString())continue;const d=m.getValue();S.isRealNum(d)&&(t[+d]?(t[+d].count++,t[+d].count>n&&(n=t[+d].count)):t[+d]={count:1,order:r++})}}return r===0||n===1?new g(h.NA):this._getResult(t,n)}_getResult(e,t){const r=Object.entries(e).filter(([n,{count:s}])=>s===t).sort((n,s)=>n[1].order-s[1].order).map(([n])=>+n);return r.length===1?y.create(r[0]):K.createByArray(r.map(n=>[n]))}}class T_ extends p{constructor(){super(...arguments);A(this,"minParams",4);A(this,"maxParams",4)}calculate(e,t,r,n){const s=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1),o=O(s,a,e,g.create(h.NA)),c=O(s,a,t,g.create(h.NA)),l=O(s,a,r,g.create(h.NA)),f=O(s,a,n,g.create(h.NA)),m=o.mapValue((d,C,_)=>{const E=c.get(C,_),b=l.get(C,_),R=f.get(C,_);return d.isError()?d:E.isError()?E:b.isError()?b:R.isError()?R:this._handleSignleObject(d,E,b,R)});return s===1&&a===1?m.get(0,0):m}_handleSignleObject(e,t,r,n){const{isError:s,errorObject:a,variants:o}=k(e,t,r,n);if(s)return a;const[c,l,f,m]=o,d=Math.floor(+c.getValue()),C=Math.floor(+l.getValue()),_=+f.getValue(),E=+m.getValue();if(d<0||C<1||_<=0||_>=1)return g.create(h.NUM);let b;return E?b=wm(d,C,_):b=ma(d,C,_),y.create(b)}}class B_ extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=O(r,n,e,g.create(h.NA)),a=O(r,n,t,g.create(h.NA)),o=s.mapValue((c,l,f)=>{const m=a.get(l,f);return c.isError()?c:m.isError()?m:this._handleSignleObject(c,m)});return r===1&&n===1?o.get(0,0):o}_handleSignleObject(e,t){const{isError:r,errorObject:n,variants:s}=k(e,t);if(r)return n;const[a,o]=s,c=+a.getValue(),l=+o.getValue();let f;return l?f=wr(c,0,1):f=Co(c,0,1),y.create(f)}}class F_ extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,s=t.isArray()?t.getRowCount():1,a=t.isArray()?t.getColumnCount():1;let o=e;if(e.isArray()&&r===1&&n===1&&(o=e.get(0,0)),o.isError())return o;let c=t;if(t.isArray()&&s===1&&a===1&&(c=t.get(0,0)),c.isError())return c;if(r*n===1||s*a===1)return o.isNull()||c.isNull()?g.create(h.VALUE):g.create(h.DIV_BY_ZERO);if(r*n!==s*a)return g.create(h.NA);const{isError:l,errorObject:f,array1Values:m,array2Values:d,noCalculate:C}=Ke(e,t,r*n,n,a);return l?f:C?g.create(h.DIV_BY_ZERO):this._getResult(m,d)}_getResult(e,t){const r=e.length;let n=0,s=0;for(let d=0;d<r;d++)n+=e[d],s+=t[d];const a=n/r,o=s/r;let c=0,l=0,f=0;for(let d=0;d<r;d++)c+=(e[d]-a)*(t[d]-o),l+=(e[d]-a)**2,f+=(t[d]-o)**2;if(l===0||f===0)return g.create(h.DIV_BY_ZERO);const m=c/Math.sqrt(l*f);return y.create(m)}}class I_ extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=this._getValues(e);if(t.isArray()){const n=t.mapValue(s=>this._handleSingleObject(r,s));return n.getRowCount()===1&&n.getColumnCount()===1?n.get(0,0):n}return this._handleSingleObject(r,t)}_handleSingleObject(e,t){if(e instanceof g)return e;const{isError:r,errorObject:n,variants:s}=k(t);if(r)return n;const[a]=s,o=+a.getValue(),c=e.length;if(o<1/(c+1)||o>1-1/(c+1))return g.create(h.NUM);const l=o*(c+1)-1,f=Math.floor(l),m=l-f;if(m===0)return y.create(e[f]);const d=e[f]+m*(e[f+1]-e[f]);return y.create(d)}_getValues(e){const t=e.isArray()?e.getRowCount():1,r=e.isArray()?e.getColumnCount():1,n=[];for(let s=0;s<t;s++)for(let a=0;a<r;a++){const o=e.isArray()?e.get(s,a):e;if(o.isError())return o;if(o.isNull()||o.isBoolean()||o.isString())continue;const c=o.getValue();S.isRealNum(c)&&n.push(+c)}return n.length===0?g.create(h.NUM):n.sort((s,a)=>s-a)}}class k_ extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",3)}calculate(e,t,r){const n=this._getValues(e);let s=r!=null?r:y.create(3);s.isNull()&&(s=y.create(3));const a=Math.max(t.isArray()?t.getRowCount():1,s.isArray()?s.getRowCount():1),o=Math.max(t.isArray()?t.getColumnCount():1,s.isArray()?s.getColumnCount():1),c=O(a,o,t,g.create(h.NA)),l=O(a,o,s,g.create(h.NA)),f=c.mapValue((m,d,C)=>{const _=l.get(d,C);return m.isError()?m:_.isError()?_:this._handleSingleObject(n,m,_)});return a===1&&o===1?f.get(0,0):f}_handleSingleObject(e,t,r){if(e instanceof g)return e;const{isError:n,errorObject:s,variants:a}=k(t,r);if(n)return s;const[o,c]=a,l=+o.getValue(),f=Math.floor(+c.getValue()),m=e.length;if(m===0||l<e[0]||l>e[m-1])return g.create(h.NA);if(m===1)return l===e[0]?y.create(1):g.create(h.NA);let d=0,C=!1,_=0;for(;!C&&_<m;)l===e[_]?(d=(_+1)/(m+1),C=!0):l>e[_]&&_+1<m&&l<e[_+1]&&(d=(_+1+(l-e[_])/(e[_+1]-e[_]))/(m+1),C=!0),_++;return C?f<1?g.create(h.NUM):(d=Ge(d,f),y.create(d)):g.create(h.NA)}_getValues(e){const t=e.isArray()?e.getRowCount():1,r=e.isArray()?e.getColumnCount():1,n=[];for(let s=0;s<t;s++)for(let a=0;a<r;a++){const o=e.isArray()?e.get(s,a):e;if(o.isError())return o;if(o.isNull()||o.isBoolean())continue;const c=o.getValue();S.isRealNum(c)&&n.push(+c)}return n.sort((s,a)=>s-a)}}class $_ extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=O(r,n,e,g.create(h.NA)),a=O(r,n,t,g.create(h.NA)),o=s.mapValue((c,l,f)=>{const m=a.get(l,f);if(c.isError())return c;if(m.isError())return m;const{isError:d,errorObject:C,variants:_}=k(c,m);if(d)return C;const[E,b]=_,R=Math.floor(+E.getValue()),N=Math.floor(+b.getValue());if(R<0||R>=2147483647||N<0||R<N)return g.create(h.NUM);let V=1;for(let M=R-N+1;M<=R;M++)V*=M;return Number.isFinite(V)?y.create(V):g.create(h.NUM)});return r===1&&n===1?o.get(0,0):o}}class Y_ extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=O(r,n,e,g.create(h.NA)),a=O(r,n,t,g.create(h.NA)),o=s.mapValue((c,l,f)=>{const m=a.get(l,f);if(c.isError())return c;if(m.isError())return m;const{isError:d,errorObject:C,variants:_}=k(c,m);if(d)return C;const[E,b]=_,R=Math.floor(+E.getValue()),N=Math.floor(+b.getValue());if(R<0||R>=2147483647||N<0)return g.create(h.NUM);if(R===0)return N===0?y.create(1):y.create(0);const V=R**N;return Number.isFinite(V)?y.create(V):g.create(h.NUM)});return r===1&&n===1?o.get(0,0):o}}class H_ extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.mapValue(r=>this._handleSingleObject(r));return t.getRowCount()===1&&t.getColumnCount()===1?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){const{isError:t,errorObject:r,variants:n}=k(e);if(t)return r;const[s]=n,a=+s.getValue(),o=Math.exp(-.5*a*a)/Math.sqrt(2*Math.PI);return y.create(o)}}class G_ extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",4)}calculate(e,t,r,n){const{isError:s,errorObject:a,xRangeValues:o,probRangeValues:c}=this._handleXRangeAndProbRange(e,t);let l=n!=null?n:r;n!=null&&n.isNull()&&(l=r);const f=Math.max(r.isArray()?r.getRowCount():1,l.isArray()?l.getRowCount():1),m=Math.max(r.isArray()?r.getColumnCount():1,l.isArray()?l.getColumnCount():1),d=O(f,m,r,g.create(h.NA)),C=O(f,m,l,g.create(h.NA)),_=d.mapValue((E,b,R)=>{const N=C.get(b,R);return e.isError()?e:t.isError()?t:E.isError()?E:N.isError()?N:s?a:this._handleSignleObject(o,c,E,N)});return f===1&&m===1?_.get(0,0):_}_handleSignleObject(e,t,r,n){const{isError:s,errorObject:a,variants:o}=k(r,n);if(s)return a;const[c,l]=o,f=+c.getValue(),m=+l.getValue();if(t.reduce((C,_)=>C+_,0)!==1)return g.create(h.NUM);let d=0;for(let C=0;C<e.length;C++)e[C]>=f&&e[C]<=m&&(d+=t[C]);return y.create(d)}_handleXRangeAndProbRange(e,t){const r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,s=t.isArray()?t.getRowCount():1,a=t.isArray()?t.getColumnCount():1;let o=e;if(e.isArray()&&r===1&&n===1&&(o=e.get(0,0)),o.isError())return{isError:!0,errorObject:o,xRangeValues:[],probRangeValues:[]};let c=t;if(t.isArray()&&s===1&&a===1&&(c=t.get(0,0)),c.isError())return{isError:!0,errorObject:c,xRangeValues:[],probRangeValues:[]};if((r*n===1||s*a===1)&&(o.isNull()||c.isNull()))return{isError:!0,errorObject:g.create(h.VALUE),xRangeValues:[],probRangeValues:[]};if(r*n!==s*a)return{isError:!0,errorObject:g.create(h.NA),xRangeValues:[],probRangeValues:[]};const{isError:l,errorObject:f,array1Values:m,array2Values:d,noCalculate:C}=Ke(e,t,r*n,n,a);return l?{isError:!0,errorObject:f,xRangeValues:[],probRangeValues:[]}:C?{isError:!0,errorObject:g.create(h.DIV_BY_ZERO),xRangeValues:[],probRangeValues:[]}:{isError:!1,errorObject:null,xRangeValues:m,probRangeValues:d}}}class W_ extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=this._getValues(e);if(t.isArray()){const n=t.mapValue(s=>this._handleSingleObject(r,s));return n.getRowCount()===1&&n.getColumnCount()===1?n.get(0,0):n}return this._handleSingleObject(r,t)}_handleSingleObject(e,t){if(e instanceof g)return e;const{isError:r,errorObject:n,variants:s}=k(t);if(r)return n;const[a]=s,o=Math.floor(+a.getValue());if(o<=0||o>=4)return g.create(h.NUM);const c=o/4,l=e.length;if(c<1/(l+1)||c>1-1/(l+1))return g.create(h.NUM);const f=c*(l+1)-1,m=Math.floor(f),d=f-m;if(d===0)return y.create(e[m]);const C=e[m]+d*(e[m+1]-e[m]);return y.create(C)}_getValues(e){const t=e.isArray()?e.getRowCount():1,r=e.isArray()?e.getColumnCount():1,n=[];for(let s=0;s<t;s++)for(let a=0;a<r;a++){const o=e.isArray()?e.get(s,a):e;if(o.isError())return o;if(o.isNull()||o.isBoolean())continue;const c=o.getValue();S.isRealNum(c)&&n.push(+c)}return n.length===0?g.create(h.NUM):n.sort((s,a)=>s-a)}}class Q_ extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",3);A(this,"needsReferenceObject",!0)}calculate(e,t,r){let n=e;n.isReferenceObject()&&(n=n.toArrayValueObject());const{refHasError:s,refErrorObject:a,refNumbers:o}=this._checkRefReferenceObject(t);let c=r!=null?r:y.create(0);c.isReferenceObject()&&(c=c.toArrayValueObject());const l=Math.max(n.isArray()?n.getRowCount():1,c.isArray()?c.getRowCount():1),f=Math.max(n.isArray()?n.getColumnCount():1,c.isArray()?c.getColumnCount():1),m=O(l,f,n,g.create(h.NA)),d=O(l,f,c,g.create(h.NA)),C=m.map((_,E,b)=>{const R=d.get(E,b);if(!e.isReferenceObject()&&e.isNull())return g.create(h.NA);if(s)return a;if(R.isError())return R;const N=+_.getValue(),V=+R.getValue();return Number.isNaN(N)||Number.isNaN(V)?g.create(h.VALUE):this._getResult(N,V,o)});return l===1&&f===1?C.get(0,0):C}_getResult(e,t,r){const n=r.sort((c,l)=>t?c-l:l-c);let s=n.indexOf(e);const a=[];for(;s>=0;){const c=s+1;a.push(c),s=n.indexOf(e,c)}if(a.length===0)return g.create(h.NA);const o=a.reduce((c,l)=>c+l,0)/a.length;return y.create(o)}_checkRefReferenceObject(e){let t=!1,r=g.create(h.NA);const n=[];return e.isReferenceObject()?(e.toArrayValueObject().iterator(a=>{const o=a;if(o.isError())return t=!0,r=o,!1;if(o.isNull()||o.isBoolean())return!0;const c=+o.getValue();if(Number.isNaN(c))return!0;n.push(c)}),{refHasError:t,refErrorObject:r,refNumbers:n}):{refHasError:!0,refErrorObject:r,refNumbers:n}}}class q_ extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",3);A(this,"needsReferenceObject",!0)}calculate(e,t,r){let n=e;n.isReferenceObject()&&(n=n.toArrayValueObject());const{refHasError:s,refErrorObject:a,refNumbers:o}=this._checkRefReferenceObject(t);let c=r!=null?r:y.create(0);c.isReferenceObject()&&(c=c.toArrayValueObject());const l=Math.max(n.isArray()?n.getRowCount():1,c.isArray()?c.getRowCount():1),f=Math.max(n.isArray()?n.getColumnCount():1,c.isArray()?c.getColumnCount():1),m=O(l,f,n,g.create(h.NA)),d=O(l,f,c,g.create(h.NA)),C=m.map((_,E,b)=>{const R=d.get(E,b);if(!e.isReferenceObject()&&e.isNull())return g.create(h.NA);if(s)return a;if(R.isError())return R;const N=+_.getValue(),V=+R.getValue();if(Number.isNaN(N)||Number.isNaN(V))return g.create(h.VALUE);const D=o.sort((L,P)=>V?L-P:P-L).indexOf(N);return D===-1?g.create(h.NA):y.create(D+1)});return l===1&&f===1?C.get(0,0):C}_checkRefReferenceObject(e){let t=!1,r=g.create(h.NA);const n=[];return e.isReferenceObject()?(e.toArrayValueObject().iterator(a=>{const o=a;if(o.isError())return t=!0,r=o,!1;if(o.isNull()||o.isBoolean())return!0;const c=+o.getValue();if(Number.isNaN(c))return!0;n.push(c)}),{refHasError:t,refErrorObject:r,refNumbers:n}):{refHasError:!0,refErrorObject:r,refNumbers:n}}}class K_ extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,s=t.isArray()?t.getRowCount():1,a=t.isArray()?t.getColumnCount():1;let o=e;if(e.isArray()&&r===1&&n===1&&(o=e.get(0,0)),o.isError())return o;let c=t;if(t.isArray()&&s===1&&a===1&&(c=t.get(0,0)),c.isError())return c;if((r*n===1||s*a===1)&&(o.isNull()||c.isNull()))return g.create(h.VALUE);if(r*n!==s*a)return g.create(h.NA);const{isError:l,errorObject:f,array1Values:m,array2Values:d,noCalculate:C}=Ke(e,t,r*n,n,a);return l?f:C?g.create(h.DIV_BY_ZERO):this._getResult(m,d)}_getResult(e,t){if(e.length===0)return g.create(h.DIV_BY_ZERO);const r=e.length;let n=0,s=0;for(let d=0;d<r;d++)n+=e[d],s+=t[d];const a=n/r,o=s/r;let c=0,l=0,f=0;for(let d=0;d<r;d++)c+=(e[d]-a)*(t[d]-o),l+=(e[d]-a)**2,f+=(t[d]-o)**2;if(l===0||f===0)return g.create(h.DIV_BY_ZERO);const m=(c/Math.sqrt(l*f))**2;return y.create(m)}}class X_ extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){const t=[];let r=0;for(let n=0;n<e.length;n++){const s=e[n];if(s.isError())return s;if(s.isString()){const c=s.convertToNumberObjectValue();if(c.isError())return c}const a=s.isArray()?s.getRowCount():1,o=s.isArray()?s.getColumnCount():1;for(let c=0;c<a;c++)for(let l=0;l<o;l++){const f=s.isArray()?s.get(c,l):s;if(f.isError())return f;if(f.isNull()||f.isBoolean())continue;const m=f.getValue();S.isRealNum(m)&&(t.push(+m),r+=+m)}}return t.length<=2?g.create(h.DIV_BY_ZERO):this._getResult(t,r)}_getResult(e,t){const r=e.length,n=t/r;let s=0;for(let l=0;l<r;l++)s+=(e[l]-n)**2;const a=Math.sqrt(s/(r-1));if(a===0)return g.create(h.DIV_BY_ZERO);let o=0;for(let l=0;l<r;l++)o+=((e[l]-n)/a)**3;const c=r/((r-1)*(r-2))*o;return y.create(c)}}class Z_ extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){const t=[];let r=0;for(let n=0;n<e.length;n++){const s=e[n];if(s.isError())return s;if(s.isString()){const c=s.convertToNumberObjectValue();if(c.isError())return c}const a=s.isArray()?s.getRowCount():1,o=s.isArray()?s.getColumnCount():1;for(let c=0;c<a;c++)for(let l=0;l<o;l++){const f=s.isArray()?s.get(c,l):s;if(f.isError())return f;if(f.isNull()||f.isBoolean())continue;const m=f.getValue();S.isRealNum(m)&&(t.push(+m),r+=+m)}}return t.length<=2?g.create(h.DIV_BY_ZERO):this._getResult(t,r)}_getResult(e,t){const r=e.length,n=t/r;let s=0;for(let l=0;l<r;l++)s+=(e[l]-n)**2;const a=Math.sqrt(s/r);if(a===0)return g.create(h.DIV_BY_ZERO);let o=0;for(let l=0;l<r;l++)o+=((e[l]-n)/a)**3;const c=o/r;return y.create(c)}}class z_ extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,s=t.isArray()?t.getRowCount():1,a=t.isArray()?t.getColumnCount():1;let o=e;if(e.isArray()&&r===1&&n===1&&(o=e.get(0,0)),o.isError())return o;let c=t;if(t.isArray()&&s===1&&a===1&&(c=t.get(0,0)),c.isError())return c;if(r*n===1||s*a===1)return o.isNull()||c.isNull()?g.create(h.VALUE):g.create(h.DIV_BY_ZERO);if(r*n!==s*a)return g.create(h.NA);const{isError:l,errorObject:f,array1Values:m,array2Values:d,noCalculate:C}=Ke(e,t,r*n,n,a);return l?f:C?g.create(h.DIV_BY_ZERO):this._getResult(m,d)}_getResult(e,t){const r=e.length;let n=0,s=0;for(let m=0;m<r;m++)n+=e[m],s+=t[m];const a=n/r,o=s/r;let c=0,l=0;for(let m=0;m<r;m++)c+=(e[m]-a)*(t[m]-o),l+=(t[m]-o)**2;if(l===0)return g.create(h.DIV_BY_ZERO);const f=c/l;return y.create(f)}}class J_ extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=this._getValues(e);if(t.isArray()){const n=t.mapValue(s=>this._handleSingleObject(r,s));return n.getRowCount()===1&&n.getColumnCount()===1?n.get(0,0):n}return this._handleSingleObject(r,t)}_handleSingleObject(e,t){if(e instanceof g)return e;const{isError:r,errorObject:n,variants:s}=k(t);if(r)return n;const[a]=s;let o=+a.getValue();return o<1||o>e.length?g.create(h.NUM):(o=Math.floor(o),y.create(e[o-1]))}_getValues(e){const t=e.isArray()?e.getRowCount():1,r=e.isArray()?e.getColumnCount():1,n=[];for(let s=0;s<t;s++)for(let a=0;a<r;a++){const o=e.isArray()?e.get(s,a):e;if(o.isError())return o;if(o.isNull()||o.isBoolean()||o.isString())continue;const c=o.getValue();S.isRealNum(c)&&n.push(+c)}return n.length===0?g.create(h.NUM):n.sort((s,a)=>s-a)}}class eA extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),o=O(n,s,t,g.create(h.NA)),c=O(n,s,r,g.create(h.NA)),l=a.mapValue((f,m,d)=>{const C=o.get(m,d),_=c.get(m,d);return f.isError()?f:C.isError()?C:_.isError()?_:this._handleSignleObject(f,C,_)});return n===1&&s===1?l.get(0,0):l}_handleSignleObject(e,t,r){const{isError:n,errorObject:s,variants:a}=k(e,t,r);if(n)return s;const[o,c,l]=a,f=+o.getValue(),m=+c.getValue(),d=+l.getValue();if(d<=0)return g.create(h.NUM);const C=(f-m)/d;return y.create(C)}}class tA extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){const t=this.flattenArray(e,!1);return t.isError()?t:t.std(1)}}class rA extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){const t=this.flattenArray(e,!1);return t.isError()?t:t.std()}}class nA extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,s=t.isArray()?t.getRowCount():1,a=t.isArray()?t.getColumnCount():1;let o=e;if(e.isArray()&&r===1&&n===1&&(o=e.get(0,0)),o.isError())return o;let c=t;if(t.isArray()&&s===1&&a===1&&(c=t.get(0,0)),c.isError())return c;if((r*n===1||s*a===1)&&(o.isNull()||c.isNull()))return g.create(h.VALUE);if(r*n!==s*a)return g.create(h.NA);const{isError:l,errorObject:f,array1Values:m,array2Values:d,noCalculate:C}=Ke(e,t,r*n,n,a);return l?f:C?g.create(h.DIV_BY_ZERO):this._getResult(m,d)}_getResult(e,t){const r=e.length;if(r<=2)return g.create(h.DIV_BY_ZERO);let n=0,s=0;for(let d=0;d<r;d++)n+=e[d],s+=t[d];const a=n/r,o=s/r;let c=0,l=0,f=0;for(let d=0;d<r;d++)c+=(e[d]-a)*(t[d]-o),l+=(e[d]-a)**2,f+=(t[d]-o)**2;if(f===0)return g.create(h.DIV_BY_ZERO);const m=Math.sqrt((l-c**2/f)/(r-2));return Number.isNaN(m)||!Number.isFinite(m)?g.create(h.NUM):y.create(m)}}class sA extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),o=O(n,s,t,g.create(h.NA)),c=O(n,s,r,g.create(h.NA)),l=a.mapValue((f,m,d)=>{const C=o.get(m,d),_=c.get(m,d);return f.isError()?f:C.isError()?C:_.isError()?_:this._handleSignleObject(f,C,_)});return n===1&&s===1?l.get(0,0):l}_handleSignleObject(e,t,r){const{isError:n,errorObject:s,variants:a}=k(e,t,r);if(n)return s;const[o,c,l]=a,f=+o.getValue(),m=Math.floor(+c.getValue()),d=+l.getValue();if(m<1)return g.create(h.NUM);let C;return d?C=Lr(f,m):C=Pm(f,m),Number.isNaN(C)||!Number.isFinite(C)?g.create(h.NUM):y.create(C)}}class aA extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=O(r,n,e,g.create(h.NA)),a=O(r,n,t,g.create(h.NA)),o=s.mapValue((c,l,f)=>{const m=a.get(l,f);return c.isError()?c:m.isError()?m:this._handleSignleObject(c,m)});return r===1&&n===1?o.get(0,0):o}_handleSignleObject(e,t){const{isError:r,errorObject:n,variants:s}=k(e,t);if(r)return n;const[a,o]=s,c=+a.getValue(),l=Math.floor(+o.getValue());if(c<0||l<1||l>10**10)return g.create(h.NUM);const f=Lr(-c,l)*2;return Number.isNaN(f)||!Number.isFinite(f)?g.create(h.NUM):y.create(f)}}class iA extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=O(r,n,e,g.create(h.NA)),a=O(r,n,t,g.create(h.NA)),o=s.mapValue((c,l,f)=>{const m=a.get(l,f);return c.isError()?c:m.isError()?m:this._handleSignleObject(c,m)});return r===1&&n===1?o.get(0,0):o}_handleSignleObject(e,t){const{isError:r,errorObject:n,variants:s}=k(e,t);if(r)return n;const[a,o]=s,c=+a.getValue(),l=Math.floor(+o.getValue());if(l<1||l>10**10)return g.create(h.NUM);const f=Lr(-c,l);return Number.isNaN(f)||!Number.isFinite(f)?g.create(h.NUM):y.create(f)}}class oA extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=O(r,n,e,g.create(h.NA)),a=O(r,n,t,g.create(h.NA)),o=s.mapValue((c,l,f)=>{const m=a.get(l,f);return c.isError()?c:m.isError()?m:this._handleSignleObject(c,m)});return r===1&&n===1?o.get(0,0):o}_handleSignleObject(e,t){const{isError:r,errorObject:n,variants:s}=k(e,t);if(r)return n;const[a,o]=s,c=+a.getValue(),l=Math.floor(+o.getValue());if(c<=0||c>1||l<1||l>10**10)return g.create(h.NUM);const f=jn(c,l);return Number.isNaN(f)||!Number.isFinite(f)?g.create(h.NUM):y.create(f)}}class uA extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",4)}calculate(e,t,r,n){const{isError:s,errorObject:a}=xn(e,t,r);if(s)return a;const o=gt(e);if(o instanceof g)return o;const c=this._getKnownXsValues(o,t);if(c instanceof g)return c;const l=this._getNewXsValues(c,r);if(l instanceof g)return l;let f=n!=null?n:T.create(!0);if(f.isArray()&&(f=f.get(0,0)),f.isString()&&(f=f.convertToNumberObjectValue()),f.isError())return f;const m=+f.getValue();return this._getResult(o,c,l,m)}_getResult(e,t,r,n){return e.length===1&&t.length>1||e[0].length===1&&t[0].length>1?e.length===1&&t.length>1&&(n?t.length+1:t.length)>e[0].length||e[0].length===1&&t[0].length>1&&(n?t[0].length+1:t[0].length)>e.length?g.create(h.NA):this._getResultByMultipleVariables(e,t,r,n):this._getResultBySimpleVariables(e,t,r,n)}_getResultByMultipleVariables(e,t,r,n){const s=e.length===1&&e[0].length>1,a=Tn(e,t,r,n,!1);if(a instanceof g)return a;const{coefficients:o,newX:c}=a,l=o[0].length,f=o[0][l-1];let m=[];for(let d=0;d<c.length;d++){m[d]=[];let C=f;for(let _=l-2;_>=0;_--)C+=o[0][l-2-_]*c[d][_];m[d].push(C)}return s&&(m=ht(m)),K.createByArray(m)}_getResultBySimpleVariables(e,t,r,n){const s=e.flat(),a=t.flat(),{slope:o,intercept:c}=vn(a,s,n,!1);if(Number.isNaN(o))return g.create(h.NA);const l=r.map(f=>f.map(m=>o*m+c));return K.createByArray(l)}_getKnownXsValues(e,t){return!t||t.isNull()?Un(e.length,e[0].length):gt(t)}_getNewXsValues(e,t){return!t||t.isNull()?e:gt(t)}}class cA extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=this._getValues(e);if(t.isArray()){const n=t.mapValue(s=>this._handleSingleObject(r,s));return n.getRowCount()===1&&n.getColumnCount()===1?n.get(0,0):n}return this._handleSingleObject(r,t)}_handleSingleObject(e,t){if(e instanceof g)return e;const{isError:r,errorObject:n,variants:s}=k(t);if(r)return n;const[a]=s,o=+a.getValue();if(o<0||o>=1)return g.create(h.NUM);const c=Ge(e.length*o/2,0)*2,l=e.slice(c/2,e.length-c/2),f=l.reduce((m,d)=>m+d,0)/l.length;return y.create(f)}_getValues(e){const t=e.isArray()?e.getRowCount():1,r=e.isArray()?e.getColumnCount():1,n=[];for(let s=0;s<t;s++)for(let a=0;a<r;a++){const o=e.isArray()?e.get(s,a):e;if(o.isError())return o;if(o.isNull()||o.isBoolean())continue;const c=o.getValue();S.isRealNum(c)&&n.push(+c)}return n.length===0?g.create(h.NUM):n.sort((s,a)=>s-a)}}class lA extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){const t=this.flattenArray(e,!1);return t.isError()?t:t.var(1)}}class fA extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){const t=this.flattenArray(e,!1);return t.isError()?t:t.var()}}const Ru=[[HC,B.AVEDEV],[WC,B.AVERAGE],[QC,B.AVERAGE_WEIGHTED],[qC,B.AVERAGEA],[KC,B.AVERAGEIF],[XC,B.AVERAGEIFS],[ZC,B.BETA_DIST],[Ao,B.BETA_INV],[Eo,B.BINOM_DIST],[zC,B.BINOM_DIST_RANGE],[bo,B.BINOM_INV],[JC,B.CHISQ_DIST],[yo,B.CHISQ_DIST_RT],[e_,B.CHISQ_INV],[Ro,B.CHISQ_INV_RT],[No,B.CHISQ_TEST],[po,B.CONFIDENCE_NORM],[t_,B.CONFIDENCE_T],[r_,B.CORREL],[n_,B.COUNT],[s_,B.COUNTA],[a_,B.COUNTBLANK],[i_,B.COUNTIF],[o_,B.COUNTIFS],[Vo,B.COVARIANCE_P],[c_,B.COVARIANCE_S],[l_,B.DEVSQ],[Oo,B.EXPON_DIST],[f_,B.F_DIST],[So,B.F_DIST_RT],[m_,B.F_INV],[Mo,B.F_INV_RT],[Do,B.F_TEST],[h_,B.FISHER],[g_,B.FISHERINV],[bu,B.FORECAST],[bu,B.FORECAST_LINEAR],[d_,B.FREQUENCY],[C_,B.GAMMA],[wo,B.GAMMA_DIST],[Lo,B.GAMMA_INV],[yu,B.GAMMALN],[yu,B.GAMMALN_PRECISE],[__,B.GAUSS],[A_,B.GEOMEAN],[E_,B.GROWTH],[b_,B.HARMEAN],[y_,B.HYPGEOM_DIST],[R_,B.INTERCEPT],[N_,B.KURT],[p_,B.LARGE],[V_,B.LINEST],[O_,B.LOGEST],[S_,B.LOGNORM_DIST],[Po,B.LOGNORM_INV],[M_,B.MARGINOFERROR],[D_,B.MAX],[w_,B.MAXA],[L_,B.MAXIFS],[P_,B.MEDIAN],[j_,B.MIN],[x_,B.MINA],[U_,B.MINIFS],[v_,B.MODE_MULT],[jo,B.MODE_SNGL],[T_,B.NEGBINOM_DIST],[xo,B.NORM_DIST],[Uo,B.NORM_INV],[B_,B.NORM_S_DIST],[vo,B.NORM_S_INV],[F_,B.PEARSON],[I_,B.PERCENTILE_EXC],[To,B.PERCENTILE_INC],[k_,B.PERCENTRANK_EXC],[Bo,B.PERCENTRANK_INC],[$_,B.PERMUT],[Y_,B.PERMUTATIONA],[H_,B.PHI],[Fo,B.POISSON_DIST],[G_,B.PROB],[W_,B.QUARTILE_EXC],[Io,B.QUARTILE_INC],[Q_,B.RANK_AVG],[q_,B.RANK_EQ],[K_,B.RSQ],[X_,B.SKEW],[Z_,B.SKEW_P],[z_,B.SLOPE],[J_,B.SMALL],[eA,B.STANDARDIZE],[ko,B.STDEV_P],[$o,B.STDEV_S],[tA,B.STDEVA],[rA,B.STDEVPA],[nA,B.STEYX],[sA,B.T_DIST],[aA,B.T_DIST_2T],[iA,B.T_DIST_RT],[oA,B.T_INV],[Yo,B.T_INV_2T],[Ho,B.T_TEST],[uA,B.TREND],[cA,B.TRIMMEAN],[Go,B.VAR_P],[Wo,B.VAR_S],[lA,B.VARA],[fA,B.VARPA],[Qo,B.WEIBULL_DIST],[qo,B.Z_TEST]];class mA extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",2)}calculate(e,t){let r=t!=null?t:y.create(0);if(t!=null&&t.isNull()&&(r=y.create(0)),r.isArray()){const n=r.mapValue(s=>this._handleSingleObject(e,s));return n.getRowCount()===1&&n.getColumnCount()===1?n.get(0,0):n}return this._handleSingleObject(e,r)}_handleSingleObject(e,t){const r=this._checkArray(e);if(r.isError())return r;const{isError:n,errorObject:s,variants:a}=k(t);if(n)return s;const[o]=a,c=+o.getValue(),l=e.isArray()?e.getRowCount():1,f=e.isArray()?e.getColumnCount():1;let m="";for(let d=0;d<l;d++)for(let C=0;C<f;C++){const _=e.isArray()?e.get(d,C):e;let E=`${_.getValue()}`;_.isNull()&&(E=""),_.isBoolean()&&(E=E.toLocaleUpperCase()),_.isString()&&c?m+=`"${E}"`:m+=E,d===l-1&&C===f-1||(c?C===f-1?m+=";":m+=",":m+=", ")}return c&&(m=`{${m}}`),m.length>32767?g.create(h.CALC):U.create(m)}_checkArray(e){if(e.isArray()){const t=e.getRowCount(),r=e.getColumnCount();return t>1||r>1?e:e.get(0,0)}return e}}class hA extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.mapValue(r=>this._handleSingleObject(r));return t.getRowCount()===1&&t.getColumnCount()===1?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError()||e.isNull()||e.isBoolean()||e.isNumber())return e;const t=e.getValue().toLocaleString();let r="";for(let n=0;n<t.length;n++){let s=t.charCodeAt(n);s===12288?s=32:s>=65281&&s<=65374&&(s-=65248),r+=String.fromCharCode(s)}return U.create(r)}}class gA extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.mapValue(r=>this._handleSingleObject(r));return t.getRowCount()===1&&t.getColumnCount()===1?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){const{isError:t,errorObject:r,variants:n}=k(e);if(t)return r;const[s]=n,a=+s.getValue(),o=Math.abs(Number.parseInt(a.toString(),10)),c=Number.parseFloat((Math.abs(a)-o).toFixed(2));let l="";return o===0?c!==0?l=`${a<0?"ลบ":""}${this._convertNumberToThaiText(c*100)}สตางค์`:l="ศูนย์บาทถ้วน":c===0?l=`${a<0?"ลบ":""}${this._convertNumberToThaiText(o)}บาทถ้วน`:l=`${a<0?"ลบ":""}${this._convertNumberToThaiText(o)}บาท${this._convertNumberToThaiText(c*100)}สตางค์`,U.create(l)}_convertNumberToThaiText(e){const t=["ล้าน","สิบ","ร้อย","พัน","หมื่น","แสน",""],r=["ศูนย์","หนึ่ง","สอง","สาม","สี่","ห้า","หก","เจ็ด","แปด","เก้า"],n=["ลบ","บาท","ถ้วน","สตางค์","ยี่","เอ็ด",","," ","฿"],s=e.toString(),a=s.length;let o="";for(let c=a;c>0;c--){const l=Number.parseInt(s.charAt(a-c),10);let f=r[l];const m=c>1?(c-1)%6:6;if(m===1&&l===2&&(f=n[4]),l===1)switch(m){case 0:case 6:o+=c<a?n[5]:f;break;case 1:break;default:o+=f;break}else if(l===0){m===0&&(o+=t[m]);continue}else o+=f;o+=t[m]}return o}}const dA=Object.values(S.DataStreamTreeTokenType).filter(i=>[S.DataStreamTreeTokenType.TABLE_START,S.DataStreamTreeTokenType.TABLE_ROW_START,S.DataStreamTreeTokenType.TABLE_CELL_START,S.DataStreamTreeTokenType.TABLE_CELL_END,S.DataStreamTreeTokenType.TABLE_ROW_END,S.DataStreamTreeTokenType.TABLE_END,S.DataStreamTreeTokenType.CUSTOM_BLOCK].includes(i));class CA extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.mapValue(r=>this._handleSingleObject(r));return t.getRowCount()===1&&t.getColumnCount()===1?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){const{isError:t,errorObject:r,variants:n}=k(e);if(t)return r;const[s]=n,a=Math.floor(+s.getValue());if(a<=0)return g.create(h.VALUE);let o=String.fromCharCode(a);return dA.some(c=>c===o)&&(o=""),U.create(o)}}class _A extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.mapValue(r=>this._handleSingleObject(r));return t.getRowCount()===1&&t.getColumnCount()===1?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError()||e.isBoolean()||e.isNumber())return e;if(e.isNull())return U.create("");const r=`${e.getValue()}`.replace(/[\0-\x1F]/g,"");return U.create(r)}}class AA extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.mapValue(r=>this._handleSingleObject(r));return t.getRowCount()===1&&t.getColumnCount()===1?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;if(e.isNull())return g.create(h.VALUE);let t=e.getValue().toLocaleString();if(e.isBoolean()&&(t=t.toLocaleUpperCase()),t==="")return g.create(h.VALUE);const r=t.charCodeAt(0);return y.create(r)}}class EA extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){let t="",r=null;for(const n of e)if(n.isArray()){if(n.iterator(s=>{if(s==null||s.isNull())return!0;if(s.isError())return r=s,!1;s.isBoolean()?t+=`${s.getValue()}`.toLocaleUpperCase():(s.isString()||s.isNumber())&&(t+=s.getValue())}),r)return r}else!n.isError()&&!n.isNull()&&(t+=n.getValue());return U.create(t)}}class bA extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){let t=0,r=0;e.forEach(s=>{if(s.isArray()){const a=s;t=Math.max(t,a.getRowCount()),r=Math.max(r,a.getColumnCount())}else t=Math.max(t,1),r=Math.max(r,1)});let n=null;for(const s of e)n=O(t,r,s,g.create(h.NA)).mapValue((o,c,l)=>{const f=n&&n.get(c,l);if(f!=null&&f.isError())return f;if(o.isError())return o;let m=f==null?void 0:f.getValue(),d=o==null?void 0:o.getValue();f!=null&&f.isBoolean()&&(m=`${m}`.toLocaleUpperCase()),o!=null&&o.isBoolean()&&(d=`${d}`.toLocaleUpperCase());const C=f!=null&&f.isNull()?"":m!=null?m:"",_=o!=null&&o.isNull()?"":d!=null?d:"";return U.create(`${C}${_}`)});return n||g.create(h.VALUE)}}class yA extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.mapValue(r=>this._handleSingleObject(r));return t.getRowCount()===1&&t.getColumnCount()===1?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;if(e.isNull())return U.create("");let t=`${e.getValue()}`;e.isBoolean()&&(t=t.toLocaleUpperCase());let r="";for(let n=0;n<t.length;n++){const s=t.charCodeAt(n);s>=33&&s<=126?r+=String.fromCharCode(s+65248):s===32?r+="　":r+=t.charAt(n)}return U.create(r)}}class RA extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",2);A(this,"needsLocale",!0)}calculate(e,t){let r=t!=null?t:y.create(2);r.isNull()&&(r=y.create(2));const n=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),o=O(n,s,r,g.create(h.NA)),c=a.mapValue((l,f,m)=>{const d=o.get(f,m);return l.isError()?l:d.isError()?d:this._handleSingleObject(l,d)});return n===1&&s===1?c.get(0,0):c}_handleSingleObject(e,t){const{isError:r,errorObject:n,variants:s}=k(e,t);if(r)return n;const[a,o]=s;let c=+a.getValue(),l=Math.trunc(+o.getValue());if(l>127)return g.create(h.VALUE);l<0&&(`${c}`.length<Math.abs(l)?c=0:c=c<0?-Dt(Math.abs(c),l):Dt(c,l),l=0);const f=Kc(this.getLocale(),c,l);return U.create(f)}}class NA extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=O(r,n,e,oe.create()),a=O(r,n,t,oe.create()),o=s.mapValue((c,l,f)=>{const m=a.get(l,f);return c.isError()?c:m.isError()?m:this._handleSingleObject(c,m)});return r===1&&n===1?o.get(0,0):o}_handleSingleObject(e,t){if(e.isNull()||t.isNull()){const a=e.isNull()&&t.isNull();return T.create(a)}let r=`${e.getValue()}`;e.isBoolean()&&(r=r.toLocaleUpperCase());let n=`${t.getValue()}`;t.isBoolean()&&(n=n.toLocaleUpperCase());const s=r===n;return T.create(s)}}const Ra=(i,u)=>S.numfmt.format(i,u,{throws:!1}),Se=i=>{let u=`${i.getValue()}`;return i.isNull()&&(u=""),i.isBoolean()&&(u=u.toLocaleUpperCase()),i.isNumber()&&(i.getPattern()!==""?u=Ra(i.getPattern(),+i.getValue()):u=`${xi(+i.getValue())}`),u};class pA extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",3)}calculate(e,t,r){const n=r!=null?r:y.create(1),s=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,n.isArray()?n.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,n.isArray()?n.getColumnCount():1),o=O(s,a,e,g.create(h.NA)),c=O(s,a,t,g.create(h.NA)),l=O(s,a,n,g.create(h.NA)),f=o.mapValue((m,d,C)=>{const _=c.get(d,C),E=l.get(d,C);return m.isError()?m:_.isError()?_:E.isError()?E:this._handleSingleObject(m,_,E)});return s===1&&a===1?f.get(0,0):f}_handleSingleObject(e,t,r){const n=Se(e),s=Se(t),{isError:a,errorObject:o,variants:c}=k(r);if(a)return o;const[l]=c,f=Math.floor(+l.getValue());if(t.isNull()||f<=0||f>s.length)return g.create(h.VALUE);if(e.isNull()||n.length===0)return y.create(f);const m=s.indexOf(n,f-1);return m===-1?g.create(h.VALUE):y.create(m+1)}}function Na(i){let u=0;for(let e=0;e<i.length;e++)u+=vr(i,e);return u}function vr(i,u,e="ltr"){return VA(i,u,e)>255?2:1}function Nu(i){return i>=55296&&i<=56319}function pu(i){return i>=56320&&i<=57343}function Vu(i,u){const e=(i&1023)<<10,t=u&1023;return e+t+65536}function VA(i,u,e="ltr"){const t=i.charCodeAt(u);if(e==="ltr"&&Nu(t)&&u+1<i.length){const r=i.charCodeAt(u+1);if(pu(r))return Vu(t,r)}if(e==="rtl"&&pu(t)&&u-1>=0){const r=i.charCodeAt(u-1);if(Nu(r))return Vu(r,t)}return t}class OA extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",3)}calculate(e,t,r){const n=r!=null?r:y.create(1),s=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,n.isArray()?n.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,n.isArray()?n.getColumnCount():1),o=O(s,a,e,g.create(h.NA)),c=O(s,a,t,g.create(h.NA)),l=O(s,a,n,g.create(h.NA)),f=o.mapValue((m,d,C)=>{const _=c.get(d,C),E=l.get(d,C);return m.isError()?m:_.isError()?_:E.isError()?E:this._handleSingleObject(m,_,E)});return s===1&&a===1?f.get(0,0):f}_handleSingleObject(e,t,r){const n=Se(e),s=Se(t),{isError:a,errorObject:o,variants:c}=k(r);if(a)return o;const[l]=c,f=Math.floor(+l.getValue());if(t.isNull()||f<=0||f>s.length)return g.create(h.VALUE);if(e.isNull()||n.length===0)return y.create(f);const m=s.indexOf(n,f-1);if(m===-1)return g.create(h.VALUE);const d=Na(s.substring(0,m))+1;return y.create(d)}}class SA extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",3)}calculate(e,t,r){let n=t!=null?t:y.create(2);n.isNull()&&(n=y.create(2));let s=r!=null?r:T.create(!1);s.isNull()&&(s=T.create(!1));const a=Math.max(e.isArray()?e.getRowCount():1,n.isArray()?n.getRowCount():1,s.isArray()?s.getRowCount():1),o=Math.max(e.isArray()?e.getColumnCount():1,n.isArray()?n.getColumnCount():1,s.isArray()?s.getColumnCount():1),c=O(a,o,e,g.create(h.NA)),l=O(a,o,n,g.create(h.NA)),f=O(a,o,s,g.create(h.NA)),m=c.mapValue((d,C,_)=>{const E=l.get(C,_),b=f.get(C,_);return d.isError()?d:E.isError()?E:b.isError()?b:this._handleSingleObject(d,E,b)});return a===1&&o===1?m.get(0,0):m}_handleSingleObject(e,t,r){const{isError:n,errorObject:s,variants:a}=k(e,t,r);if(n)return s;const[o,c,l]=a;let f=+o.getValue(),m=Math.trunc(+c.getValue());const d=+l.getValue();if(m>127)return g.create(h.VALUE);m<0&&(`${f}`.length<Math.abs(m)?f=0:f=f<0?-Dt(Math.abs(f),m):Dt(f,m),m=0);let C=d?"###0":"#,##0";m>0&&(C+=`.${"0".repeat(m)}`);const _=Ra(C,f);return U.create(_)}}class MA extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",2)}calculate(e,t){const r=t!=null?t:y.create(1),n=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),o=O(n,s,r,g.create(h.NA)),c=a.mapValue((l,f,m)=>{const d=o.get(f,m);return l.isError()?l:d.isError()?d:this._handleSingleObject(l,d)});return n===1&&s===1?c.get(0,0):c}_handleSingleObject(e,t){const r=Se(e),{isError:n,errorObject:s,variants:a}=k(t);if(n)return s;const[o]=a,c=Math.floor(+o.getValue());if(c<0)return g.create(h.VALUE);if(e.isNull()||c===0)return U.create("");if(c>=r.length)return U.create(r);const l=r.substring(0,c);return U.create(l)}}class DA extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",2)}calculate(e,t){const r=t!=null?t:y.create(1),n=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,oe.create()),o=O(n,s,r,oe.create()),c=a.mapValue((l,f,m)=>{const d=o.get(f,m);return l.isError()?l:d.isError()?d:this._handleSingleObject(l,d)});return n===1&&s===1?c.get(0,0):c}_handleSingleObject(e,t){const r=Se(e),{isError:n,errorObject:s,variants:a}=k(t);if(n)return s;const[o]=a,c=Math.floor(+o.getValue());if(c<0)return g.create(h.VALUE);if(e.isNull()||c===0)return U.create("");let l=0,f=0,m="";for(;f<c&&l<r.length;)f+=vr(r,l),m+=r.charAt(l),l++;return U.create(m)}}class wA extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.mapValue(r=>this._handleSingleText(r));return t.getRowCount()===1&&t.getColumnCount()===1?t.get(0,0):t}return this._handleSingleText(e)}_handleSingleText(e){if(e.isError())return e;const t=Se(e);return y.create(t.length)}}class LA extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.mapValue(r=>this._handleSingleText(r));return t.getRowCount()===1&&t.getColumnCount()===1?t.get(0,0):t}return this._handleSingleText(e)}_handleSingleText(e){if(e.isError())return e;const t=Se(e),r=Na(t);return y.create(r)}}class PA extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.mapValue(r=>this._handleSingleObject(r));return t.getRowCount()===1&&t.getColumnCount()===1?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;if(e.isNull())return U.create("");const t=`${e.getValue()}`.toLocaleLowerCase();return U.create(t)}}class jA extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),o=O(n,s,t,g.create(h.NA)),c=O(n,s,r,g.create(h.NA)),l=a.mapValue((f,m,d)=>{const C=o.get(m,d),_=c.get(m,d);return f.isError()?f:C.isError()?C:_.isError()?_:this._handleSingleObject(f,C,_)});return n===1&&s===1?l.get(0,0):l}_handleSingleObject(e,t,r){const n=Se(e),{isError:s,errorObject:a,variants:o}=k(t,r);if(s)return a;const[c,l]=o,f=Math.floor(+c.getValue()),m=Math.floor(+l.getValue());if(f<=0||m<0)return g.create(h.VALUE);if(e.isNull()||f>n.length||m===0)return U.create("");const d=n.substring(f-1,f-1+m);return U.create(d)}}class xA extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),o=O(n,s,t,g.create(h.NA)),c=O(n,s,r,g.create(h.NA)),l=a.mapValue((f,m,d)=>{const C=o.get(m,d),_=c.get(m,d);return f.isError()?f:C.isError()?C:_.isError()?_:this._handleSingleObject(f,C,_)});return n===1&&s===1?l.get(0,0):l}_handleSingleObject(e,t,r){let n=Se(e);const{isError:s,errorObject:a,variants:o}=k(t,r);if(s)return a;const[c,l]=o,f=Math.floor(+c.getValue()),m=Math.floor(+l.getValue());if(f<=0||m<0)return g.create(h.VALUE);if(e.isNull()||f>n.length||m===0)return U.create("");n=n.substring(f-1);let d=0,C=0,_="";for(;C<m&&d<n.length;)C+=vr(n,d),_+=n.charAt(d),d++;return U.create(_)}}const Tr=["〇","一","二","三","四","五","六","七","八","九"],Yn=["零","壹","贰","叁","肆","伍","陆","柒","捌","玖"],UA=["","十","百","千"],vA=["","拾","佰","仟"],TA=["","万","亿","兆"];class BA extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=O(r,n,e,g.create(h.NA)),a=O(r,n,t,g.create(h.NA)),o=s.mapValue((c,l,f)=>{const m=a.get(l,f);return c.isError()?c:m.isError()?m:this._handleSingleObject(c,m)});return r===1&&n===1?o.get(0,0):o}_handleSingleObject(e,t){const r=e.convertToNumberObjectValue();if(r.isError())return r;const n=t.convertToNumberObjectValue();if(n.isError())return n;let s=r.getValue();const a=Math.trunc(n.getValue());if(s<0||![1,2,3].includes(a))return g.create(h.NUM);s=Math.round(s);const o=s.toString(),c=o.length;let l="",f=!1;for(let m=0;m<c;m++){const d=Number(o[m]);if(c===1&&d===0){l+=a===2?Yn[0]:Tr[0];break}if(a===3){l+=Tr[d];continue}const C=c-m-1,_=C%4,E=Math.trunc(C/4);if(c>=17&&E>2){if(l+=a===1?Tr[d]:Yn[d],E>3)continue}else d===0?f=_!==0:(f&&(l+=a===1?Tr[0]:Yn[0],f=!1),l+=a===1?Tr[d]+UA[_]:Yn[d]+vA[_]);_===0&&E>0&&o.slice(Math.max(0,m-3),m+1)!=="0000"&&(l+=TA[E])}return U.create(l)}}class FA extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",3)}calculate(e,t,r){const n=t!=null?t:U.create("."),s=Math.max(e.isArray()?e.getRowCount():1,n.isArray()?n.getRowCount():1,r!=null&&r.isArray()?r.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,n.isArray()?n.getColumnCount():1,r!=null&&r.isArray()?r.getColumnCount():1),o=O(s,a,e,g.create(h.NA)),c=O(s,a,n,g.create(h.NA)),l=r?O(s,a,r,g.create(h.NA)):void 0,f=o.mapValue((m,d,C)=>{const _=c.get(d,C),E=r?l.get(d,C):void 0;return m.isError()?m:_.isError()?_:E!=null&&E.isError()?E:_.isNull()||E!=null&&E.isNull()?g.create(h.VALUE):m.isNull()?y.create(0):this._handleSingleObject(m,_,E)});return s===1&&a===1?f.get(0,0):f}_handleSingleObject(e,t,r){let n=`${e.getValue()}`;n=n.replace(/\s+/g,"");let s=`${t.getValue()}`;t.isBoolean()&&(s=s.toLocaleUpperCase()),s=s.charAt(0);let a;if(r&&(a=`${r.getValue()}`,r.isBoolean()&&(a=a.toLocaleUpperCase()),a=a.charAt(0),s===a))return g.create(h.VALUE);if(n.trim()==="")return y.create(0);if(!n.match(/^\s*[+-]?\s*(?:(?:\d+(?:\.\d*)?)|(?:\.\d+))(?:[eE][+-]?\d+)?[ \t]*/))return g.create(h.VALUE);const o=n.split(s);if(o.length>2)return g.create(h.VALUE);let c=o[0].replace(/,/g,"");r&&(c=c.split(a).join(""));let l=0;if(o.length===1){s===","&&(c=c.replace(/\./g,""));let f=0;for(;c.endsWith("%");)c=c.slice(0,-1),f++;f>0?l=+c/100**f:l=+c}else{if(!S.isRealNum(c))return g.create(h.VALUE);let f=o[1],m=0;for(;f.endsWith("%");)f=f.slice(0,-1),m++;const d=`${c}.${f}`;if(!S.isRealNum(d))return g.create(h.VALUE);m>0?l=+d/100**m:l=+d}return Number.isNaN(l)?g.create(h.VALUE):y.create(l)}}class IA extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.mapValue(r=>this._handleSingleObject(r));return t.getRowCount()===1&&t.getColumnCount()===1?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError()||e.isNull()||e.isBoolean()||e.isNumber())return e;const r=e.getValue().toLocaleString().toLocaleLowerCase().replace(/(^|\b|\W|\d|_)[a-z]/g,n=>n.toLocaleUpperCase());return U.create(r)}}const Ou=()=>[{type:4,from:48,to:57}],Su=()=>[{type:7,value:95},{type:4,from:97,to:122},{type:4,from:65,to:90},{type:4,from:48,to:57}],Mu=()=>[{type:7,value:9},{type:7,value:10},{type:7,value:11},{type:7,value:12},{type:7,value:13},{type:7,value:32},{type:7,value:160},{type:7,value:5760},{type:4,from:8192,to:8202},{type:7,value:8232},{type:7,value:8233},{type:7,value:8239},{type:7,value:8287},{type:7,value:12288},{type:7,value:65279}],Du=()=>({type:3,set:Su(),not:!1}),wu=()=>({type:3,set:Su(),not:!0}),Lu=()=>({type:3,set:Ou(),not:!1}),Pu=()=>({type:3,set:Ou(),not:!0}),ju=()=>({type:3,set:Mu(),not:!1}),xu=()=>({type:3,set:Mu(),not:!0}),kA=()=>({type:3,set:[{type:7,value:10},{type:7,value:13},{type:7,value:8232},{type:7,value:8233}],not:!0});function $A(i){const u={type:0,stack:[]};let e=u,t=u.stack;const r=[],n=[];let s=0;const a=f=>{throw new SyntaxError(`Invalid regular expression: /${i}/: Nothing to repeat at column ${f-1}`)},o=HA(i);let c=0,l;for(;c<o.length;)switch(l=o[c++],l){case"\\":if(c===o.length)throw new SyntaxError(`Invalid regular expression: /${i}/: \\ at end of pattern`);switch(l=o[c++],l){case"b":t.push({type:2,value:"b"});break;case"B":t.push({type:2,value:"B"});break;case"w":t.push(Du());break;case"W":t.push(wu());break;case"d":t.push(Lu());break;case"D":t.push(Pu());break;case"s":t.push(ju());break;case"S":t.push(xu());break;default:if(/\d/.test(l)){for(;/\d/.test(o[c])&&c<o.length;)l+=o[c++];const f=Number.parseInt(l,10);t.push({type:6,value:f}),n.push({reference:{type:6,value:f},stack:t,index:t.length-1})}else t.push({type:7,value:l.charCodeAt(0)})}break;case"^":t.push({type:2,value:"^"});break;case"$":t.push({type:2,value:"$"});break;case"[":{const f=o[c]==="^";f&&c++;const m=YA(o.slice(c),i);c+=m[1],t.push({type:3,set:m[0],not:f});break}case".":t.push(kA());break;case"(":{const f={type:1,stack:[],remember:!0};if(o[c]==="?"){const m=o[c+1];if(c+=2,m==="=")f.followedBy=!0;else if(m==="!")f.notFollowedBy=!0;else if(m!==":")throw new SyntaxError(`Invalid regular expression: /${i}/: Invalid group, character '${m}' after '?' at column ${c-1}`);f.remember=!1}else s+=1;t.push(f),r.push(e),e=f,t=f.stack;break}case")":if(r.length===0)throw new SyntaxError(`Invalid regular expression: /${i}/: Unmatched ) at column ${c-1}`);e=r.pop(),t=e.options?e.options[e.options.length-1]:e.stack;break;case"|":{e.options||(e.options=[e.stack],delete e.stack);const f=[];e.options.push(f),t=f;break}case"{":{const f=/^(\d+)(,(\d+)?)?\}/.exec(o.slice(c));if(f){t.length===0&&a(c);const m=Number.parseInt(f[1],10),d=f[2]?f[3]?Number.parseInt(f[3],10):1/0:m;c+=f[0].length,t.push({type:5,min:m,max:d,value:t.pop()})}else t.push({type:7,value:123});break}case"?":t.length===0&&a(c),t.push({type:5,min:0,max:1,value:t.pop()});break;case"+":t.length===0&&a(c),t.push({type:5,min:1,max:1/0,value:t.pop()});break;case"*":t.length===0&&a(c),t.push({type:5,min:0,max:1/0,value:t.pop()});break;default:t.push({type:7,value:l.charCodeAt(0)})}if(r.length>0)throw new SyntaxError(`Invalid regular expression: /${i}/: Unterminated group`);return GA(n,s),u}function YA(i,u){let e;const t=[],r=/\\(?:(w)|(d)|(s)|(W)|(D)|(S))|((?:(?:\\)(.)|([^\]\\]))-(((?:\\)])|(((?:\\)?([^\]])))))|(\])|(?:\\)?([^])/g;for(;(e=r.exec(i))!==null;){let n=null;const[,s,a,o,c,l,f,m,d,C,_]=e;if(s||a||o||c||l||f?n=(()=>{let E={type:3,set:[],not:!1};return s?E=Du():a?E=Lu():o?E=ju():c?E=wu():l?E=Pu():f&&(E=xu()),E})():m&&_?n={type:4,from:(d||C).charCodeAt(0),to:_.charCodeAt(_.length-1)}:e[16]&&(n={type:7,value:e[16].charCodeAt(0)}),!n)return[t,r.lastIndex];t.push(n)}throw new SyntaxError(`Invalid regular expression: /${u}/: Unterminated character class`)}function HA(i){return i.replace(/(\[\\b\])|(\\)?\\(?:u([A-F0-9]{4})|x([A-F0-9]{2})|c([@A-Z[\\\]^?])|([0tnvfr]))/g,(u,e,t,r,n,s,a)=>{if(t)return u;let o;e?o=8:r?o=Number.parseInt(r,16):n?o=Number.parseInt(n,16):s?o="@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^ ?".indexOf(s):o={0:0,t:9,n:10,v:11,f:12,r:13}[a];const c=String.fromCharCode(o);return/[[\]{}^$.|?*+()]/.test(c)?`\\${c}`:c})}function GA(i,u){for(const e of i.reverse()){const t=e.reference.value;if(u<t){e.reference.type=7;const r=t.toString();if(e.reference.value=Number.parseInt(r,8),!/^[0-7]+$/.test(r)){let n=0;for(;r[n]!=="8"&&r[n]!=="9"&&n<r.length;)n+=1;if(n===0?(e.reference.value=r.charCodeAt(0),n+=1):e.reference.value=Number.parseInt(r.slice(0,n),8),r.length>n){const s=e.stack.splice(e.index+1);for(const a of r.slice(n))e.stack.push({type:7,value:a.charCodeAt(0)});e.stack.push(...s)}}}}}function pa(i,u){if(!WA(i))return{isError:!0,regExp:null};try{const e=new RegExp(i,u?"ug":"u");return QA(e)?{isError:!1,regExp:e}:{isError:!0,regExp:null}}catch{return{isError:!0,regExp:null}}}function WA(i){return!(/\(\?<=.*?\)/g.test(i)&&!/\[.*?(\?<=.*?)\]/g.test(i)||/\(\?<!.*?\)/g.test(i)&&!/\[.*?(\?<!.*?)\]/g.test(i))}function QA(i,u){let t;Object.prototype.toString.call(i)==="[object RegExp]"?t=i.source:i&&typeof i!="string"&&(t=`${i}`);let r;try{r=$A(t)}catch{return!1}let n=0;const s=(a,o)=>{let c=o;if(a.type===5&&(c++,n++,c>1||n>25))return!1;if(a.options){for(const f of a.options)if(!s({stack:f},c))return!1}const l=a.stack||a.value&&a.value.stack;if(!l)return!0;for(const f of l)if(!s(f,c))return!1;return!0};return s(r,0)}class qA extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const{isError:r,errorObject:n,variants:s}=Dr(e,t);if(r)return n;const[a,o]=s;let c=a.getValue();a.isNull()&&(c=""),a.isBoolean()&&(c=c?"TRUE":"FALSE"),c=`${c}`;let l=o.getValue();o.isNull()&&(l=""),o.isBoolean()&&(l=l?"TRUE":"FALSE"),l=`${l}`;const{isError:f,regExp:m}=pa(l,!1);if(f)return g.create(h.REF);const d=c.match(m);if(d===null)return g.create(h.NA);if(d.length>1){const C=d.slice(1).map(_=>U.create(_));return C.length>1?K.create({calculateValueList:[C],rowCount:1,columnCount:C.length,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column}):C[0]}return U.create(d[0])}}class KA extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const{isError:r,errorObject:n,variants:s}=Dr(e,t);if(r)return n;const[a,o]=s;let c=a.getValue();a.isNull()&&(c=""),a.isBoolean()&&(c=c?"TRUE":"FALSE"),c=`${c}`;let l=o.getValue();o.isNull()&&(l=""),o.isBoolean()&&(l=l?"TRUE":"FALSE"),l=`${l}`;const{isError:f,regExp:m}=pa(l,!1);return f?g.create(h.REF):c.match(m)===null?T.create(!1):T.create(!0)}}class XA extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const{isError:n,errorObject:s,variants:a}=Dr(e,t,r);if(n)return s;const[o,c,l]=a;let f=o.getValue();o.isNull()&&(f=""),o.isBoolean()&&(f=f?"TRUE":"FALSE"),f=`${f}`;let m=c.getValue();c.isNull()&&(m=""),c.isBoolean()&&(m=m?"TRUE":"FALSE"),m=`${m}`;let d=l.getValue();l.isNull()&&(d=""),l.isBoolean()&&(d=d?"TRUE":"FALSE"),d=`${d}`;const{isError:C,regExp:_}=pa(m,!0);if(C)return g.create(h.REF);const E=f.replace(_,d);return U.create(E)}}class ZA extends p{constructor(){super(...arguments);A(this,"minParams",4);A(this,"maxParams",4)}calculate(e,t,r,n){const s=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1),o=O(s,a,e,g.create(h.NA)),c=O(s,a,t,g.create(h.NA)),l=O(s,a,r,g.create(h.NA)),f=O(s,a,n,g.create(h.NA)),m=o.mapValue((d,C,_)=>{const E=c.get(C,_),b=l.get(C,_),R=f.get(C,_);return d.isError()?d:E.isError()?E:b.isError()?b:R.isError()?R:this._handleSingleObject(d,E,b,R)});return s===1&&a===1?m.get(0,0):m}_handleSingleObject(e,t,r,n){const{isError:s,errorObject:a,variants:o}=k(t,r);if(s)return a;const[c,l]=o,f=Math.floor(+c.getValue()),m=Math.floor(+l.getValue());if(f<=0||m<0)return g.create(h.VALUE);const d=Se(e),C=Se(n),_=d.substring(0,f-1)+C+d.substring(f-1+m);return U.create(_)}}class zA extends p{constructor(){super(...arguments);A(this,"minParams",4);A(this,"maxParams",4)}calculate(e,t,r,n){const s=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1),o=O(s,a,e,g.create(h.NA)),c=O(s,a,t,g.create(h.NA)),l=O(s,a,r,g.create(h.NA)),f=O(s,a,n,g.create(h.NA)),m=o.mapValue((d,C,_)=>{const E=c.get(C,_),b=l.get(C,_),R=f.get(C,_);return d.isError()?d:E.isError()?E:b.isError()?b:R.isError()?R:this._handleSingleObject(d,E,b,R)});return s===1&&a===1?m.get(0,0):m}_handleSingleObject(e,t,r,n){const{isError:s,errorObject:a,variants:o}=k(t,r);if(s)return a;const[c,l]=o,f=Math.floor(+c.getValue()),m=Math.floor(+l.getValue());if(f<=0||m<0)return g.create(h.VALUE);let d=Se(e);const C=Se(n);let _=d.substring(0,f-1);d=d.substring(f-1);let E=0,b=0;for(;b<m&&E<d.length;)b+=vr(d,E),E++;return _+=C+d.substring(E),U.create(_)}}class JA extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=O(r,n,e,g.create(h.NA)),a=O(r,n,t,g.create(h.NA)),o=s.map((c,l,f)=>{let m=a.get(l,f);if(c.isError())return c;let d=c.getValue();if(c.isNull()&&(d=""),c.isBoolean()&&(d=d?"TRUE":"FALSE"),d+="",m.isString()&&(m=m.convertToNumberObjectValue()),m.isError())return m;const C=32767,_=Math.floor(+m.getValue());if(_<0||_>C/d.length)return g.create(h.VALUE);const E=d.repeat(_);return U.create(E)});return r===1&&n===1?o.get(0,0):o}}class eE extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",2)}calculate(e,t){const r=t!=null?t:y.create(1),n=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),o=O(n,s,r,g.create(h.NA)),c=a.mapValue((l,f,m)=>{const d=o.get(f,m);return l.isError()?l:d.isError()?d:this._handleSingleObject(l,d)});return n===1&&s===1?c.get(0,0):c}_handleSingleObject(e,t){const r=Se(e),{isError:n,errorObject:s,variants:a}=k(t);if(n)return s;const[o]=a,c=Math.floor(+o.getValue());if(c<0)return g.create(h.VALUE);if(e.isNull()||c===0)return U.create("");if(c>=r.length)return U.create(r);const l=r.substring(r.length-c);return U.create(l)}}class tE extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",2)}calculate(e,t){const r=t!=null?t:y.create(1),n=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),o=O(n,s,r,g.create(h.NA)),c=a.mapValue((l,f,m)=>{const d=o.get(f,m);return l.isError()?l:d.isError()?d:this._handleSingleObject(l,d)});return n===1&&s===1?c.get(0,0):c}_handleSingleObject(e,t){const r=Se(e),{isError:n,errorObject:s,variants:a}=k(t);if(n)return s;const[o]=a,c=Math.floor(+o.getValue());if(c<0)return g.create(h.VALUE);if(e.isNull()||c===0)return U.create("");let l=r.length-1,f=0,m="";for(;f<c&&l>=0;)f+=vr(r,l,"rtl"),m=r.charAt(l)+m,l--;return U.create(m)}}class rE extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",3)}calculate(e,t,r){const n=r!=null?r:y.create(1),s=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,n.isArray()?n.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,n.isArray()?n.getColumnCount():1),o=O(s,a,e,g.create(h.NA)),c=O(s,a,t,g.create(h.NA)),l=O(s,a,n,g.create(h.NA)),f=o.mapValue((m,d,C)=>{const _=c.get(d,C),E=l.get(d,C);return m.isError()?m:_.isError()?_:E.isError()?E:this._handleSingleObject(m,_,E)});return s===1&&a===1?f.get(0,0):f}_handleSingleObject(e,t,r){const n=Se(e).toLocaleUpperCase(),s=Se(t).toLocaleUpperCase(),{isError:a,errorObject:o,variants:c}=k(r);if(a)return o;const[l]=c,f=Math.floor(+l.getValue());if(t.isNull()||f<=0||f>s.length)return g.create(h.VALUE);if(e.isNull()||n.length===0)return y.create(f);const m=s.indexOf(n,f-1);return m===-1?g.create(h.VALUE):y.create(m+1)}}class nE extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",3)}calculate(e,t,r){const n=r!=null?r:y.create(1),s=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,n.isArray()?n.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,n.isArray()?n.getColumnCount():1),o=O(s,a,e,g.create(h.NA)),c=O(s,a,t,g.create(h.NA)),l=O(s,a,n,g.create(h.NA)),f=o.mapValue((m,d,C)=>{const _=c.get(d,C),E=l.get(d,C);return m.isError()?m:_.isError()?_:E.isError()?E:this._handleSingleObject(m,_,E)});return s===1&&a===1?f.get(0,0):f}_handleSingleObject(e,t,r){const n=Se(e).toLocaleUpperCase(),s=Se(t).toLocaleUpperCase(),{isError:a,errorObject:o,variants:c}=k(r);if(a)return o;const[l]=c,f=Math.floor(+l.getValue());if(t.isNull()||f<=0||f>s.length)return g.create(h.VALUE);if(e.isNull()||n.length===0)return y.create(f);const m=s.indexOf(n,f-1);if(m===-1)return g.create(h.VALUE);const d=Na(s.substring(0,m))+1;return y.create(d)}}class sE extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",4)}calculate(e,t,r,n){const s=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n!=null&&n.isArray()?n.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n!=null&&n.isArray()?n.getColumnCount():1),o=O(s,a,e,g.create(h.NA)),c=O(s,a,t,g.create(h.NA)),l=O(s,a,r,g.create(h.NA)),f=n?O(s,a,n,g.create(h.NA)):void 0,m=o.mapValue((d,C,_)=>{const E=c.get(C,_),b=l.get(C,_);let R=n?f.get(C,_):void 0;return d.isError()?d:E.isError()?E:b.isError()?b:R!=null&&R.isError()?R:R!=null&&R.isNull()||R!=null&&R.isBoolean()?g.create(h.VALUE):(R!=null&&R.isString()&&(R=R.convertToNumberObjectValue()),R!=null&&R.isError()?R:this._handleSingleObject(d,E,b,R))});return s===1&&a===1?m.get(0,0):m}_handleSingleObject(e,t,r,n){const s=this._getObjectString(e),a=this._getObjectString(t),o=this._getObjectString(r),c=n?Math.floor(+n.getValue()):void 0;if(n&&c<=0)return g.create(h.VALUE);if(a==="")return U.create(s);let l="",f=0;for(let m=0;m<s.length;m++){const d=s.substr(m,a.length);if(d===a||d.length===a.length&&d.trim()===a.trim()){if(f++,f===c){l=s.substr(0,m)+o+s.substr(m+a.length);break}c===void 0&&(l+=o),m+=a.length-1}else c===void 0&&(l+=s[m])}return c&&f<c&&(l=s),U.create(l)}_getObjectString(e){let t=`${e.getValue()}`;return e.isNull()&&(t=""),e.isBoolean()&&(t=t.toLocaleUpperCase()),t}}class aE extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1);A(this,"needsReferenceObject",!0)}calculate(e){let t=e;return e.isReferenceObject()&&(t=e.toArrayValueObject().get(0,0)),t.isArray()?t.mapValue(r=>this._handleSingleObject(r)):this._handleSingleObject(t)}_handleSingleObject(e){return e.isError()?e:e.isNull()||e.isBoolean()||e.isNumber()?U.create(""):e}}class iE extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=O(r,n,e),a=O(r,n,t);return s.map((o,c,l)=>{if(o.isError())return o;let f=a.get(c,l)||U.create(" ");if(f.isError())return f;if(f.isBoolean())return g.create(h.VALUE);if(o.isBoolean())return o;let m=o.getValue();if(o.isNull()&&(m=0),o.isString()){if(!S.isRealNum(m))return o;m=Number(m)}f.isNull()&&(f=U.create(" "));const d=`${f.getValue()}`,C=Ra(d,m);return U.create(d===" "?C.trimEnd():C)})}}class oE extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",6)}calculate(e,t,r,n,s,a){let o=!1,c=r!=null?r:y.create(1);c.isNull()&&(o=!0,c=y.create(1));const l=!n,f=n!=null?n:y.create(0),m=s!=null?s:y.create(0),d=a!=null?a:g.create(h.NA),C=Math.max(e.isArray()?e.getRowCount():1,c.isArray()?c.getRowCount():1,f.isArray()?f.getRowCount():1,m.isArray()?m.getRowCount():1,d.isArray()?d.getRowCount():1),_=Math.max(e.isArray()?e.getColumnCount():1,c.isArray()?c.getColumnCount():1,f.isArray()?f.getColumnCount():1,m.isArray()?m.getColumnCount():1,d.isArray()?d.getColumnCount():1),E=O(C,_,e,g.create(h.NA)),b=O(C,_,c,g.create(h.NA)),R=O(C,_,f,g.create(h.NA)),N=O(C,_,m,g.create(h.NA)),V=O(C,_,d,g.create(h.NA)),M=this._getResultArray(E,t,b,R,N,V,o,l);return C===1&&_===1?M.get(0,0):M}_getResultArray(e,t,r,n,s,a,o,c){return e.map((f,m,d)=>{const C=r.get(m,d),_=n.get(m,d),E=s.get(m,d),b=a.get(m,d),R=this._checkVariantsError(f,C,_,E);if(R.isError())return R;const N=this._getStringValue(f),V=this._getDelimiterValue(t);if(V instanceof g)return V;const M=this._getVariantsNumberFloorValue(C,_,E);if(M instanceof g)return M;const[D,L,P]=M;return D===0||L<0||L>1||P<0||P>1?g.create(h.VALUE):V.includes("")?D>0?U.create(N):U.create(""):!o&&Math.abs(D)>N.length?g.create(h.VALUE):V.every(j=>j.length>N.length)?g.create(h.NA):this._getResult(N,V,D,L,P,b,c)})}_checkVariantsError(...e){for(let t=0;t<e.length;t++){const r=e[t];if(r.isError())return r}return T.create(!0)}_getStringValue(e){let t=`${e.getValue()}`;return e.isNull()&&(t=""),e.isBoolean()&&(t=t.toLocaleUpperCase()),t}_getDelimiterValue(e){const t=[];if(e.isArray()){let r=!1,n=g.create(h.VALUE);if(e.iterator(s=>{const a=s;if(a.isError())return r=!0,n=a,!1;t.push(this._getStringValue(a))}),r)return n}else{if(e.isError())return e;t.push(this._getStringValue(e))}return t}_getVariantsNumberFloorValue(...e){const t=[];for(let r=0;r<e.length;r++){let n=e[r];if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;const s=Math.floor(+n.getValue());t.push(s)}return t}_getResult(e,t,r,n,s,a,o){let c=n?e.toLocaleLowerCase():e;const l=n?t.map(_=>_.toLocaleLowerCase()):t;let f=0,m=0,d=0;for(let _=0;_<Math.abs(r);_++)if(r<0){const E=l.map(b=>({index:c.lastIndexOf(b),length:b.length})).filter(b=>b.index!==-1).sort((b,R)=>R.index-b.index)[0];if(!E)break;f=E.index,c=c.substr(0,E.index),d=E.length,m++}else{const E=l.map(b=>({index:c.indexOf(b),length:b.length})).filter(b=>b.index!==-1).sort((b,R)=>b.index-R.index)[0];if(!E)break;f+=E.index+d,c=c.substr(E.index+E.length),d=E.length,m++}if(m&&m<Math.abs(r)&&o)return g.create(h.NA);if(!m||m<Math.abs(r))return s?r>0?U.create(""):U.create(e):a;const C=e.substr(f+d);return U.create(C)}}class uE extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",6)}calculate(e,t,r,n,s,a){let o=!1,c=r!=null?r:y.create(1);c.isNull()&&(o=!0,c=y.create(1));const l=!n,f=n!=null?n:y.create(0),m=s!=null?s:y.create(0),d=a!=null?a:g.create(h.NA),C=Math.max(e.isArray()?e.getRowCount():1,c.isArray()?c.getRowCount():1,f.isArray()?f.getRowCount():1,m.isArray()?m.getRowCount():1,d.isArray()?d.getRowCount():1),_=Math.max(e.isArray()?e.getColumnCount():1,c.isArray()?c.getColumnCount():1,f.isArray()?f.getColumnCount():1,m.isArray()?m.getColumnCount():1,d.isArray()?d.getColumnCount():1),E=O(C,_,e,g.create(h.NA)),b=O(C,_,c,g.create(h.NA)),R=O(C,_,f,g.create(h.NA)),N=O(C,_,m,g.create(h.NA)),V=O(C,_,d,g.create(h.NA)),M=this._getResultArray(E,t,b,R,N,V,o,l);return C===1&&_===1?M.get(0,0):M}_getResultArray(e,t,r,n,s,a,o,c){return e.map((f,m,d)=>{const C=r.get(m,d),_=n.get(m,d),E=s.get(m,d),b=a.get(m,d),R=this._checkVariantsError(f,C,_,E);if(R.isError())return R;const N=this._getStringValue(f),V=this._getDelimiterValue(t);if(V instanceof g)return V;const M=this._getVariantsNumberFloorValue(C,_,E);if(M instanceof g)return M;const[D,L,P]=M;return D===0||L<0||L>1||P<0||P>1?g.create(h.VALUE):V.includes("")?D>0?U.create(""):U.create(N):!o&&Math.abs(D)>N.length?g.create(h.VALUE):V.every(j=>j.length>N.length)?g.create(h.NA):this._getResult(N,V,D,L,P,b,c)})}_checkVariantsError(...e){for(let t=0;t<e.length;t++){const r=e[t];if(r.isError())return r}return T.create(!0)}_getStringValue(e){let t=`${e.getValue()}`;return e.isNull()&&(t=""),e.isBoolean()&&(t=t.toLocaleUpperCase()),t}_getDelimiterValue(e){const t=[];if(e.isArray()){let r=!1,n=g.create(h.VALUE);if(e.iterator(s=>{const a=s;if(a.isError())return r=!0,n=a,!1;t.push(this._getStringValue(a))}),r)return n}else{if(e.isError())return e;t.push(this._getStringValue(e))}return t}_getVariantsNumberFloorValue(...e){const t=[];for(let r=0;r<e.length;r++){let n=e[r];if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;const s=Math.floor(+n.getValue());t.push(s)}return t}_getResult(e,t,r,n,s,a,o){let c=n?e.toLocaleLowerCase():e;const l=n?t.map(_=>_.toLocaleLowerCase()):t;let f=0,m=0,d=0;for(let _=0;_<Math.abs(r);_++)if(r<0){const E=l.map(b=>({index:c.lastIndexOf(b),length:b.length})).filter(b=>b.index!==-1).sort((b,R)=>R.index-b.index)[0];if(!E)break;f=E.index,c=c.substr(0,E.index),m++}else{const E=l.map(b=>({index:c.indexOf(b),length:b.length})).filter(b=>b.index!==-1).sort((b,R)=>b.index-R.index)[0];if(!E)break;f+=E.index+d,c=c.substr(E.index+E.length),d=E.length,m++}if(m&&m<Math.abs(r)&&o)return g.create(h.NA);if(!m||m<Math.abs(r))return s?r>0?U.create(e):U.create(""):a;const C=e.substr(0,f);return U.create(C)}}class cE extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",255)}calculate(e,t,...r){const n=this._getDelimiterValues(e),s=this._getTextValues(r);if(t.isArray()){const o=t.mapValue(c=>this._handleSingleObject(n,c,s));return o.getRowCount()===1&&o.getColumnCount()===1?o.get(0,0):o}const a=t;if(a.isString()){const o=`${a.getValue()}`.toLocaleUpperCase();if(o==="TRUE")return this._handleSingleObject(n,T.create(!0),s);if(o==="FALSE")return this._handleSingleObject(n,T.create(!1),s)}return this._handleSingleObject(n,t,s)}_handleSingleObject(e,t,r){if(e instanceof g)return e;const{isError:n,errorObject:s,variants:a}=k(t);if(n)return s;if(r instanceof g)return r;const[o]=a,c=+o.getValue();let l=r;c&&(l=r.filter(m=>m!==null));let f="";for(let m=0;m<l.length;m++)l[m]!==null&&(f+=l[m]),m<l.length-1&&(f+=e[m%e.length]);return U.create(f)}_getDelimiterValues(e){const t=[],r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1;for(let s=0;s<r;s++)for(let a=0;a<n;a++){const o=e.isArray()?e.get(s,a):e;if(o.isError())return o;let c=`${o.getValue()}`;o.isNull()&&(c=""),o.isBoolean()&&(c=c.toLocaleUpperCase()),t.push(c)}return t}_getTextValues(e){const t=[];for(const r of e){const n=r.isArray()?r.getRowCount():1,s=r.isArray()?r.getColumnCount():1;for(let a=0;a<n;a++)for(let o=0;o<s;o++){const c=r.isArray()?r.get(a,o):r;if(c.isError())return c;if(c.isNull()){t.push(null);continue}let l=`${c.getValue()}`;c.isBoolean()&&(l=l.toLocaleUpperCase()),t.push(l)}}return t}}class lE extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",6)}calculate(e,t,r,n,s,a){let o=r!=null?r:U.create("\\s");const c=n!=null?n:y.create(0),l=s!=null?s:y.create(0),f=a!=null?a:U.create(h.NA),{_variant:m,values:d}=this._getStringValues(t),{_variant:C,values:_}=this._getStringValues(o,!1);o=C;const E=Math.max(e.isArray()?e.getRowCount():1,c.isArray()?c.getRowCount():1,l.isArray()?l.getRowCount():1),b=Math.max(e.isArray()?e.getColumnCount():1,c.isArray()?c.getColumnCount():1,l.isArray()?l.getColumnCount():1),R=O(E,b,e,g.create(h.NA)),N=O(E,b,c,g.create(h.NA)),V=O(E,b,l,g.create(h.NA)),M=this._getResultArray(R,m,o,N,V,f,d,_);return E===1&&b===1?M.get(0,0):M.map(D=>D.get(0,0))}_getStringValues(e,t=!0){let r=e;const n=[];if(r.isArray())r.iterator(s=>{if(s!=null&&s.isError())return r=s,!1;if(s!=null&&s.isNull()&&t)return r=g.create(h.VALUE),!1;const a=this._getRegExpStringValue(s);if(a==="")return r=g.create(h.VALUE),!1;n.push(a)});else{r.isNull()&&t&&(r=g.create(h.VALUE));const s=this._getRegExpStringValue(r);s===""&&(r=g.create(h.VALUE)),n.push(s)}return{_variant:r,values:n}}_getResultArray(e,t,r,n,s,a,o,c){return e.map((f,m,d)=>{let C=n.get(m,d),_=s.get(m,d);const E=this._checkVariantsError(f,t,r,C,_);if(E.isError())return E;if(f.isNull())return g.create(h.VALUE);let b=a;if(b.isArray()){const D=b.getRowCount(),L=b.getColumnCount();if(D>1||L>1)return g.create(h.VALUE);b=b.get(0,0)}let R=`${f.getValue()}`;if(f.isBoolean()&&(R=R.toLocaleUpperCase()),C.isString()&&(C=C.convertToNumberObjectValue(),C.isError()))return C;const N=Math.floor(+C.getValue());if(_.isString()&&(_=_.convertToNumberObjectValue(),_.isError()))return _;const V=Math.floor(+_.getValue());if(V<0||V>1)return g.create(h.VALUE);let M=`${b.getValue()}`;return b.isBoolean()&&(M=M.toLocaleUpperCase()),this._getResult(R,o,c,N,V,M)})}_getResult(e,t,r,n,s,a){const o=new RegExp(r.join("|"),`g${s?"i":""}`),c=new RegExp(t.join("|"),`g${s?"i":""}`),l=e.split(o);let f=1,m=l.map(d=>{let C=d.split(c);return n&&(C=C.filter(_=>_!=="")),f=Math.max(f,C.length),C});return m=m.map(d=>{let C=d;return C.length<f&&(C=C.concat(new Array(f-C.length).fill(a))),C}),K.createByArray(m)}_checkVariantsError(...e){for(let t=0;t<e.length;t++){const r=e[t];if(r.isError())return r}return T.create(!0)}_getRegExpStringValue(e){let t=e.getValue();return e.isNull()&&(t="\\s"),e.isBoolean()&&(t=t?"TRUE":"FALSE"),t+="",this._escapeRegExp(t)}_escapeRegExp(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}}class fE extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.mapValue(r=>this._handleSingleObject(r));return t.getRowCount()===1&&t.getColumnCount()===1?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;if(e.isNull())return U.create("");let t=`${e.getValue()}`;return e.isBoolean()&&(t=t.toLocaleUpperCase()),t=t.trim().replace(/\s+/g," "),U.create(t)}}const mE=Object.values(S.DataStreamTreeTokenType).filter(i=>[S.DataStreamTreeTokenType.TABLE_START,S.DataStreamTreeTokenType.TABLE_ROW_START,S.DataStreamTreeTokenType.TABLE_CELL_START,S.DataStreamTreeTokenType.TABLE_CELL_END,S.DataStreamTreeTokenType.TABLE_ROW_END,S.DataStreamTreeTokenType.TABLE_END,S.DataStreamTreeTokenType.CUSTOM_BLOCK].includes(i));class hE extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.mapValue(r=>this._handleSingleObject(r));return t.getRowCount()===1&&t.getColumnCount()===1?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){const{isError:t,errorObject:r,variants:n}=k(e);if(t)return r;const[s]=n,a=Math.floor(+s.getValue());if(a<1||a>1114111)return g.create(h.VALUE);if(a===1114111||a===1114110)return g.create(h.NA);let o=String.fromCharCode(a);return mE.some(c=>c===o)&&(o=""),U.create(o)}}class gE extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.mapValue(r=>this._handleSingleObject(r));return t.getRowCount()===1&&t.getColumnCount()===1?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;if(e.isNull())return g.create(h.VALUE);let t=e.getValue().toLocaleString();e.isBoolean()&&(t=t.toLocaleUpperCase());const r=t.charCodeAt(0);return y.create(r)}}class dE extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.mapValue(r=>this._handleSingleObject(r));return t.getRowCount()===1&&t.getColumnCount()===1?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;if(e.isNull())return U.create("");const t=`${e.getValue()}`.toLocaleUpperCase();return U.create(t)}}class CE extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.mapValue(r=>this._handleSingleObject(r));return t.getRowCount()===1&&t.getColumnCount()===1?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;if(e.isBoolean())return g.create(h.VALUE);let t=e;if(e.isString()&&(t=t.convertToNumberObjectValue(),t.isError()))return t;const r=+t.getValue();return y.create(r)}}class _E extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",2)}calculate(e,t){const r=t!=null?t:y.create(0),n=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),o=O(n,s,r,g.create(h.NA)),c=a.mapValue((l,f,m)=>{const d=o.get(f,m);return l.isError()?l:d.isError()?d:this._handleSingleObject(l,d)});return n===1&&s===1?c.get(0,0):c}_handleSingleObject(e,t){const{isError:r,errorObject:n,variants:s}=k(t);if(r)return n;const[a]=s,o=Math.floor(+a.getValue());if(o<0||o>1)return g.create(h.VALUE);if(e.isNull())return U.create("");if(e.isBoolean())return e;if(e.isNumber())return y.create(e.getValue());const c=o?`"${e.getValue()}"`:`${e.getValue()}`;return U.create(c)}}const Uu=[[hA,ae.ASC],[mA,ae.ARRAYTOTEXT],[gA,ae.BAHTTEXT],[CA,ae.CHAR],[_A,ae.CLEAN],[AA,ae.CODE],[EA,ae.CONCAT],[bA,ae.CONCATENATE],[yA,ae.DBCS],[RA,ae.DOLLAR],[NA,ae.EXACT],[pA,ae.FIND],[OA,ae.FINDB],[SA,ae.FIXED],[MA,ae.LEFT],[DA,ae.LEFTB],[wA,ae.LEN],[LA,ae.LENB],[PA,ae.LOWER],[jA,ae.MID],[xA,ae.MIDB],[BA,ae.NUMBERSTRING],[FA,ae.NUMBERVALUE],[qA,ae.REGEXEXTRACT],[KA,ae.REGEXMATCH],[XA,ae.REGEXREPLACE],[IA,ae.PROPER],[ZA,ae.REPLACE],[zA,ae.REPLACEB],[JA,ae.REPT],[eE,ae.RIGHT],[tE,ae.RIGHTB],[rE,ae.SEARCH],[nE,ae.SEARCHB],[sE,ae.SUBSTITUTE],[aE,ae.T],[iE,ae.TEXT],[oE,ae.TEXTAFTER],[uE,ae.TEXTBEFORE],[cE,ae.TEXTJOIN],[lE,ae.TEXTSPLIT],[fE,ae.TRIM],[hE,ae.UNICHAR],[gE,ae.UNICODE],[dE,ae.UPPER],[CE,ae.VALUE],[_E,ae.VALUETOTEXT]],vu=[];var Tu=(i=>i)(Tu||{});class AE extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.mapValue(r=>this._handleSingleObject(r));return t.getRowCount()===1&&t.getColumnCount()===1?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;const t=Se(e),r=encodeURIComponent(t).replace(/[!~'()*]/g,n=>`%${n.charCodeAt(0).toString(16).toLocaleUpperCase()}`);return U.create(r)}}var Va=(i=>(i.ENCODEURL="ENCODEURL",i.FILTERXML="FILTERXML",i.WEBSERVICE="WEBSERVICE",i))(Va||{});const Bu=[[AE,Va.ENCODEURL]];class Oa extends S.Disposable{constructor(){super(...arguments);A(this,"_allSubjects",[]);A(this,"_computingStatus$",new De.BehaviorSubject(!0));A(this,"computingStatus$",this._computingStatus$.pipe(De.distinctUntilChanged()));A(this,"_computingSubscription")}get computingStatus(){return this._computingStatus$.getValue()}dispose(){var e;super.dispose(),(e=this._computingSubscription)==null||e.unsubscribe(),this._computingStatus$.next(!0),this._computingStatus$.complete(),this._allSubjects.forEach(t=>{t.complete()})}pushComputingStatusSubject(e){return this._allSubjects.push(e),this._updateComputingObservable(),{dispose:()=>{const t=this._allSubjects.indexOf(e);t!==-1&&this._allSubjects.splice(t,1),this._updateComputingObservable()}}}_updateComputingObservable(){var e;if((e=this._computingSubscription)==null||e.unsubscribe(),this._allSubjects.length===0){this._computingStatus$.next(!0);return}this._computingSubscription=De.combineLatest(this._allSubjects).pipe(De.map(t=>t.every(r=>r))).subscribe(t=>this._computingStatus$.next(t))}}var EE=Object.getOwnPropertyDescriptor,bE=(i,u,e,t)=>{for(var r=t>1?void 0:t?EE(u,e):u,n=i.length-1,s;n>=0;n--)(s=i[n])&&(r=s(r)||r);return r},Fu=(i,u)=>(e,t)=>u(e,t,i);let Sa=class extends S.Disposable{constructor(u,e){super();A(this,"_computingCompleted$",new De.Observable(u=>{this._commandService.onCommandExecuted(e=>{if(e.id!==Er.id)return;const t=e.params;if(t.stageInfo)return u.next(t.stageInfo.stage===We.IDLE||t.stageInfo.stage===We.CALCULATION_COMPLETED)})}).pipe(De.distinctUntilChanged(),De.shareReplay()));this._commandService=u,this._globalComputingSrv=e;const t=new S.DisposableCollection,r=new De.BehaviorSubject(!0);t.add(this._globalComputingSrv.pushComputingStatusSubject(r)),t.add(this._computingCompleted$.subscribe(n=>r.next(n))),t.add(()=>r.complete()),this.disposeWithMe(t)}};Sa=bE([Fu(0,S.ICommandService),Fu(1,S.Inject(Oa))],Sa);var yE=Object.getOwnPropertyDescriptor,RE=(i,u,e,t)=>{for(var r=t>1?void 0:t?yE(u,e):u,n=i.length-1,s;n>=0;n--)(s=i[n])&&(r=s(r)||r);return r},Hn=(i,u)=>(e,t)=>u(e,t,i);let Gn=class extends S.Disposable{constructor(i,u,e,t){super(),this._commandService=i,this._functionService=u,this._configService=e,this._dataSyncPrimaryController=t,this._initialize()}_initialize(){this._registerCommands(),this._registerFunctions()}_registerCommands(){[us,kr,as,is,Er,os,Gr,ss,Wr,Qr,qr,Kr,ii,oi,cs,za].forEach(i=>{var u;this._commandService.registerCommand(i),(u=this._dataSyncPrimaryController)==null||u.registerSyncingMutations(i)})}_registerFunctions(){var e;const i=this._configService.getConfig(Zr),u=[...no,...Ko,...Xo,...Jo,...su,...au,...mu,...hu,...gu,...du,...Au,...Eu,...Ru,...Uu,...vu,...Bu].concat((e=i==null?void 0:i.function)!=null?e:[]).map(t=>{const r=t[0],n=t[1];return new r(n)});this._functionService.registerExecutors(...u)}};Gn=RE([Hn(0,S.ICommandService),Hn(1,Et),Hn(2,S.IConfigService),Hn(3,S.Optional(Qu.DataSyncPrimaryController))],Gn);var NE=Object.getOwnPropertyDescriptor,pE=(i,u,e,t)=>{for(var r=t>1?void 0:t?NE(u,e):u,n=i.length-1,s;n>=0;n--)(s=i[n])&&(r=s(r)||r);return r},Wn=(i,u)=>(e,t)=>u(e,t,i);let Qn=class extends S.Disposable{constructor(i,u,e){super(),this._commandService=i,this._dependencyManagerService=u,this._featureCalculationManagerService=e,this._initialize()}_initialize(){this._commandExecutedListener(),this._featureCalculationManagerServiceListener()}_featureCalculationManagerServiceListener(){this.disposeWithMe(this._featureCalculationManagerService.onChanged$.subscribe(i=>{const{unitId:u,subUnitId:e,featureIds:t}=i;this._dependencyManagerService.removeFeatureFormulaDependency(u,e,t)}))}_commandExecutedListener(){this.disposeWithMe(this._commandService.onCommandExecuted(i=>{if(i.id===Qr.id){const u=i.params;if(u==null)return;const{featureIds:e,unitId:t,subUnitId:r}=u;this._dependencyManagerService.removeFeatureFormulaDependency(t,r,e)}else if(i.id===Wr.id){const u=i.params;if(u==null)return;const{featureId:e,calculationParam:t}=u,{unitId:r,subUnitId:n}=t;this._dependencyManagerService.removeFeatureFormulaDependency(r,n,[e])}else if(i.id===Kr.id){const u=i.params;if(u==null)return;this._dependencyManagerService.removeOtherFormulaDependency(u.unitId,u.subUnitId,u.formulaIdList)}else if(i.id===qr.id){const u=i.params;if(u==null)return;const e=u.formulaMap,t=[];Object.keys(e).forEach(r=>{t.push(r)}),this._dependencyManagerService.removeOtherFormulaDependency(u.unitId,u.subUnitId,t)}else if(i.id===us.id){const u=i.params.formulaData;Object.keys(u).forEach(e=>{const t=u[e];if(t!==void 0){if(t===null){this._dependencyManagerService.clearFormulaDependency(e);return}Object.keys(t).forEach(r=>{const n=t[r];if(n!==void 0){if(n===null)return this._dependencyManagerService.clearFormulaDependency(e,r),!0;new S.ObjectMatrix(n).forValue((s,a)=>{this._dependencyManagerService.removeFormulaDependency(e,r,s,a)})}})}})}else i.id===Gr.id&&this._handleSetDefinedName(i)}))}_handleSetDefinedName(i){const u=i.params;if(u==null)return;const{unitId:e,name:t}=u;this._dependencyManagerService.removeFormulaDependencyByDefinedName(e,t)}};Qn=pE([Wn(0,S.ICommandService),Wn(1,ir),Wn(1,Mr),Wn(2,ir)],Qn);var VE=Object.getOwnPropertyDescriptor,OE=(i,u,e,t)=>{for(var r=t>1?void 0:t?VE(u,e):u,n=i.length-1,s;n>=0;n--)(s=i[n])&&(r=s(r)||r);return r},Iu=(i,u)=>(e,t)=>u(e,t,i);let qn=class extends S.Disposable{constructor(i,u){super(),this._commandService=i,this._featureCalculationManagerService=u,this._initialize()}_initialize(){this._commandExecutedListener()}_commandExecutedListener(){this.disposeWithMe(this._commandService.onCommandExecuted(i=>{if(i.id===Wr.id){const u=i.params;if(u==null)return;const{featureId:e,calculationParam:t}=u,{unitId:r,subUnitId:n}=t;this._featureCalculationManagerService.register(r,n,e,t)}else if(i.id===Qr.id){const u=i.params;if(u==null)return;const{featureIds:e,unitId:t,subUnitId:r}=u;this._featureCalculationManagerService.remove(t,r,e)}}))}};qn=OE([Iu(0,S.ICommandService),Iu(1,ir)],qn);var SE=Object.getOwnPropertyDescriptor,ME=(i,u,e,t)=>{for(var r=t>1?void 0:t?SE(u,e):u,n=i.length-1,s;n>=0;n--)(s=i[n])&&(r=s(r)||r);return r},Ma=(i,u)=>(e,t)=>u(e,t,i);let Kn=class extends S.Disposable{constructor(i,u,e){super(),this._commandService=i,this._otherFormulaManagerService=u,this._dependencyManagerService=e,this._initialize()}_initialize(){this._commandExecutedListener()}_commandExecutedListener(){this.disposeWithMe(this._commandService.onCommandExecuted(i=>{if(i.id===qr.id){const u=i.params;if(u==null)return;const e={[u.unitId]:{[u.subUnitId]:u.formulaMap}};this._otherFormulaManagerService.batchRegister(e)}else if(i.id===Kr.id){const u=i.params;if(u==null)return;const e={};u.formulaIdList.forEach(r=>e[r]=!0);const t={[u.unitId]:{[u.subUnitId]:e}};this._otherFormulaManagerService.batchRemove(t)}}))}};Kn=ME([Ma(0,S.ICommandService),Ma(1,yn),Ma(2,Mr)],Kn);class ku extends S.Disposable{constructor(){super(...arguments);A(this,"_tableMap",new Map);A(this,"_tableOptionMap",new Map)}dispose(){super.dispose(),this._tableMap.clear(),this._tableOptionMap.clear()}remove(e,t){var r;(r=this._tableMap.get(e))==null||r.delete(t)}getTableMap(e){return this._tableMap.get(e)}getTableOptionMap(){return this._tableOptionMap}registerTable(e,t,r){var n;this._tableMap.get(e)==null&&this._tableMap.set(e,new Map),(n=this._tableMap.get(e))==null||n.set(t,r)}registerTableOptionMap(e,t){this._tableOptionMap.set(e,t)}}const Da=S.createIdentifier("univer.formula.super-table.service");var DE=Object.getOwnPropertyDescriptor,wE=(i,u,e,t)=>{for(var r=t>1?void 0:t?DE(u,e):u,n=i.length-1,s;n>=0;n--)(s=i[n])&&(r=s(r)||r);return r},$u=(i,u)=>(e,t)=>u(e,t,i);let Xn=class extends S.Disposable{constructor(i,u){super(),this._commandService=i,this._superTableService=u,this._initialize()}_initialize(){this._commandExecutedListener()}_commandExecutedListener(){this.disposeWithMe(this._commandService.onCommandExecuted(i=>{if(i.id===Gr.id){const u=i.params;if(u==null)return;const{unitId:e,tableName:t,reference:r}=u;this._superTableService.registerTable(e,t,r)}else if(i.id===ss.id){const u=i.params;if(u==null)return;const{unitId:e,tableName:t}=u;this._superTableService.remove(e,t)}else if(i.id===cs.id){const u=i.params;if(u==null)return;const{tableOption:e,tableOptionType:t}=u;this._superTableService.registerTableOptionMap(e,t)}}))}};Xn=wE([$u(0,S.ICommandService),$u(1,Da)],Xn);class Yu extends S.Disposable{constructor(){super(...arguments);A(this,"_dirtyConversionMap",new Map)}dispose(){this._dirtyConversionMap.clear()}remove(e){this._dirtyConversionMap.delete(e)}get(e){return this._dirtyConversionMap.get(e)}has(e){return this._dirtyConversionMap.has(e)}register(e,t){this._dirtyConversionMap.set(e,t)}getDirtyConversionMap(){return this._dirtyConversionMap}}const Hu=S.createIdentifier("univer.formula.active-dirty-manager.service");var LE=Object.getOwnPropertyDescriptor,PE=(i,u,e,t)=>{for(var r=t>1?void 0:t?LE(u,e):u,n=i.length-1,s;n>=0;n--)(s=i[n])&&(r=s(r)||r);return r},Gu=(i,u)=>(e,t)=>u(e,t,i);const jE="UNIVER_ENGINE_FORMULA_PLUGIN";w.UniverFormulaEnginePlugin=(wa=class extends S.Plugin{constructor(u=mi,e,t){super(),this._config=u,this._injector=e,this._configService=t;const{...r}=S.merge({},mi,this._config);this._configService.setConfig(Zr,r)}onStarting(){this._initialize(),this._initializeWithOverride()}onReady(){var u;S.touchDependencies(this._injector,[[Gn],[Xn]]),(u=this._config)!=null&&u.notExecuteFormula||S.touchDependencies(this._injector,[[Kn],[qn],[Qn],[w.CalculateController]])}onRendered(){var u;(u=this._config)!=null&&u.notExecuteFormula||S.touchDependencies(this._injector,[[Vn],[pn]])}_initialize(){const u=!this._config.notExecuteFormula,e=[[Et,{useClass:Ii}],[vt,{useClass:w.DefinedNamesService}],[Hu,{useClass:Yu}],[Cs,{useClass:hi}],[Da,{useClass:ku}],[Oa],[w.FormulaDataModel],[Xr],[Gn],[Xn],[Sa]];u&&e.push([yn,{useClass:Zi}],[ct,{useClass:w.FormulaRuntimeService}],[Ct,{useClass:w.FormulaCurrentConfigService}],[ir,{useClass:Xi}],[w.CalculateController],[Kn],[Qn],[qn],[w.Interpreter],[w.AstTreeBuilder],[w.Lexer],[Fs],[w.FunctionNodeFactory],[w.LambdaNodeFactory],[$s],[w.OperatorNodeFactory],[w.PrefixNodeFactory],[w.ReferenceNodeFactory],[w.SuffixNodeFactory],[w.UnionNodeFactory],[Ws]),e.forEach(t=>this._injector.add(t))}_initializeWithOverride(){var u;(u=this._config)!=null&&u.notExecuteFormula||[[Vn,{useClass:w.CalculateFormulaService}],[Mr,{useClass:Ki}],[pn,{useClass:w.FormulaDependencyGenerator}]].forEach(t=>this._injector.add(t))}},A(wa,"pluginName",jE),wa),w.UniverFormulaEnginePlugin=PE([Gu(1,S.Inject(S.Injector)),Gu(2,S.IConfigService)],w.UniverFormulaEnginePlugin),w.ActiveDirtyManagerService=Yu,w.ArrayValueObject=K,w.AstRootNodeFactory=Fs,w.AsyncArrayObject=Ti,w.AsyncCustomFunction=$m,w.AsyncObject=vi,w.BaseFunction=p,w.BaseReferenceObject=Nr,w.BaseValueObject=_t,w.BooleanValue=bt,w.BooleanValueObject=T,w.CustomFunction=zo,w.DEFAULT_INTERVAL_COUNT=Ji,w.DependencyManagerBaseService=qi,w.DependencyManagerService=Ki,w.ENGINE_FORMULA_CYCLE_REFERENCE_COUNT=Tc,w.ENGINE_FORMULA_PLUGIN_CONFIG_KEY=Zr,w.ERROR_TYPE_SET=xt,w.ErrorType=h,w.ErrorValueObject=g,w.FUNCTION_NAMES_ARRAY=Sn,w.FUNCTION_NAMES_COMPATIBILITY=me,w.FUNCTION_NAMES_CUBE=Zo,w.FUNCTION_NAMES_DATABASE=$e,w.FUNCTION_NAMES_DATE=Ee,w.FUNCTION_NAMES_ENGINEERING=z,w.FUNCTION_NAMES_FINANCIAL=ee,w.FUNCTION_NAMES_INFORMATION=pe,w.FUNCTION_NAMES_LOGICAL=Oe,w.FUNCTION_NAMES_LOOKUP=ge,w.FUNCTION_NAMES_MATH=G,w.FUNCTION_NAMES_STATISTICAL=B,w.FUNCTION_NAMES_TEXT=ae,w.FUNCTION_NAMES_UNIVER=Tu,w.FUNCTION_NAMES_WEB=Va,w.FeatureCalculationManagerService=Xi,w.FormulaDependencyTree=Nn,w.FormulaDependencyTreeType=Rn,w.FormulaDependencyTreeVirtual=Qs,w.FormulaExecuteStageType=We,w.FormulaExecutedStateType=sr,w.FunctionService=Ii,w.FunctionType=xa,w.GlobalComputingStatusService=Oa,w.IActiveDirtyManagerService=Hu,w.ICalculateFormulaService=Vn,w.IDefinedNamesService=vt,w.IDependencyManagerService=Mr,w.IFeatureCalculationManagerService=ir,w.IFormulaCurrentConfigService=Ct,w.IFormulaDependencyGenerator=pn,w.IFormulaRuntimeService=ct,w.IFunctionService=Et,w.IOtherFormulaManagerService=yn,w.ISheetRowFilteredService=Cs,w.ISuperTableService=Da,w.LambdaParameterNodeFactory=$s,w.LambdaValueObjectObject=bn,w.LexerNode=ie,w.LexerTreeBuilder=Xr,w.NullValueObject=oe,w.NumberValueObject=y,w.OtherFormulaManagerService=Zi,w.RangeReferenceObject=pr,w.RegisterFunctionMutation=za,w.RemoveDefinedNameMutation=ss,w.RemoveFeatureCalculationMutation=Qr,w.RemoveOtherFormulaMutation=Kr,w.RemoveSuperTableMutation=oi,w.SetArrayFormulaDataMutation=kr,w.SetDefinedNameMutation=Gr,w.SetDefinedNameMutationFactory=Oc,w.SetFeatureCalculationMutation=Wr,w.SetFormulaCalculationNotificationMutation=Er,w.SetFormulaCalculationResultMutation=os,w.SetFormulaCalculationStartMutation=as,w.SetFormulaCalculationStopMutation=is,w.SetFormulaDataMutation=us,w.SetOtherFormulaMutation=qr,w.SetSuperTableMutation=ii,w.SetSuperTableOptionMutation=cs,w.SheetRowFilteredService=hi,w.StringValueObject=U,w.SuperTableService=ku,w.ValueNodeFactory=Ws,w.ValueObjectFactory=ut,w.compareToken=H,w.convertUnitDataToRuntime=Ta,w.deserializeRangeForR1C1=ro,w.deserializeRangeWithSheet=_r,w.deserializeRangeWithSheetWithCache=Tt,w.functionArray=no,w.functionCompatibility=Ko,w.functionCube=Xo,w.functionDatabase=Jo,w.functionDate=su,w.functionEngineering=au,w.functionFinancial=mu,w.functionInformation=hu,w.functionLogical=gu,w.functionLookup=du,w.functionMath=Au,w.functionMeta=Eu,w.functionStatistical=Ru,w.functionText=Uu,w.functionUniver=vu,w.functionWeb=Bu,w.generateAstNode=Is,w.generateExecuteAstNodeData=zn,w.generateRandomDependencyTreeId=kt,w.generateStringWithSequence=fs,w.getAbsoluteRefTypeWitString=_c,w.getAbsoluteRefTypeWithSingleString=Cr,w.getObjectValue=Ku,w.getRangeWithRefsString=Ec,w.handleNumfmtInCell=Hc,w.handleRefStringInfo=Hr,w.includeFormulaLexerToken=va,w.initSheetFormulaData=gs,w.isFormulaLexerToken=gr,w.isInDirtyRange=Pa,w.isReferenceString=Za,w.isReferenceStringWithEffectiveColumn=Ar,w.isReferenceStrings=ni,w.matchRefDrawToken=Ju,w.matchToken=X,w.normalizeSheetName=zu,w.operatorToken=Z,w.sequenceNodeType=Te,w.serializeRange=Ut,w.serializeRangeToRefString=$r,w.serializeRangeWithSheet=ei,w.serializeRangeWithSpreadsheet=ti,w.singleReferenceToGrid=Yr,w.strip=Ps,w.stripErrorMargin=xi,Object.defineProperty(w,Symbol.toStringTag,{value:"Module"})});
